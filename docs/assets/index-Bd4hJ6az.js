(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=e(o);fetch(o.href,l)}})();class hs{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Nr={PROPERTYCHANGE:"propertychange"};class Nh{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function j1(r,t,e){let n,o;e=e||ss;let l=0,u=r.length,g=!1;for(;l<u;)n=l+(u-l>>1),o=+e(r[n],t),o<0?l=n+1:(u=n,g=!o);return g?l:~l}function ss(r,t){return r>t?1:r<t?-1:0}function Ph(r,t,e){if(r[0]<=t)return 0;const n=r.length;if(t<=r[n-1])return n-1;if(typeof e=="function"){for(let o=1;o<n;++o){const l=r[o];if(l===t)return o;if(l<t)return e(t,r[o-1],l)>0?o-1:o}return n-1}if(e>0){for(let o=1;o<n;++o)if(r[o]<t)return o-1;return n-1}if(e<0){for(let o=1;o<n;++o)if(r[o]<=t)return o;return n-1}for(let o=1;o<n;++o){if(r[o]==t)return o;if(r[o]<t)return r[o-1]-t<t-r[o]?o-1:o}return n-1}function Z1(r,t,e){for(;t<e;){const n=r[t];r[t]=r[e],r[e]=n,++t,--e}}function bn(r,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let o=0;o<n;o++)r[r.length]=e[o]}function Ls(r,t){const e=r.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}function K1(r,t,e){const n=t||ss;return r.every(function(o,l){if(l===0)return!0;const u=n(r[l-1],o);return!(u>0||e&&u===0)})}function go(){return!0}function ka(){return!1}function Pr(){}function Hu(r){let t=!1,e,n,o;return function(){const l=Array.prototype.slice.call(arguments);return(!t||this!==o||!Ls(l,n))&&(t=!0,o=this,n=l,e=r.apply(this,arguments)),e}}function q1(r){function t(){let e;try{e=r()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function No(r){for(const t in r)delete r[t]}function er(r){let t;for(t in r)return!1;return!t}class Ga extends Nh{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),o=n[t]||(n[t]=[]);o.includes(e)||o.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,o=this.listeners_&&this.listeners_[n];if(!o)return;const l=e?new hs(t):t;l.target||(l.target=this.eventTarget_||this);const u=this.dispatching_||(this.dispatching_={}),g=this.pendingRemovals_||(this.pendingRemovals_={});n in u||(u[n]=0,g[n]=0),++u[n];let x;for(let E=0,w=o.length;E<w;++E)if("handleEvent"in o[E]?x=o[E].handleEvent(l):x=o[E].call(this,l),x===!1||l.propagationStopped){x=!1;break}if(--u[n]===0){let E=g[n];for(delete g[n];E--;)this.removeEventListener(n,Pr);delete u[n]}return x}disposeInternal(){this.listeners_&&No(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const o=n.indexOf(e);o!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[o]=Pr,++this.pendingRemovals_[t]):(n.splice(o,1),n.length===0&&delete this.listeners_[t]))}}const jt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function ge(r,t,e,n,o){if(n&&n!==r&&(e=e.bind(n)),o){const u=e;e=function(){r.removeEventListener(t,e),u.apply(this,arguments)}}const l={target:r,type:t,listener:e};return r.addEventListener(t,e),l}function wa(r,t,e,n){return ge(r,t,e,n,!0)}function Fe(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),No(r))}class Po extends Ga{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(jt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,o=new Array(n);for(let l=0;l<n;++l)o[l]=ge(this,t[l],e);return o}return ge(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const o=t.length;n=new Array(o);for(let l=0;l<o;++l)n[l]=wa(this,t[l],e)}else n=wa(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)J1(n);else if(Array.isArray(t))for(let o=0,l=t.length;o<l;++o)this.removeEventListener(t[o],e);else this.removeEventListener(t,e)}}Po.prototype.on;Po.prototype.once;Po.prototype.un;function J1(r){if(Array.isArray(r))for(let t=0,e=r.length;t<e;++t)Fe(r[t]);else Fe(r)}function Xt(){throw new Error("Unimplemented abstract method.")}let Q1=0;function be(r){return r.ol_uid||(r.ol_uid=String(++Q1))}class Pc extends hs{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class Rn extends Po{constructor(t){super(),this.on,this.once,this.un,be(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new Pc(n,t,e)),n=Nr.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new Pc(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const o=this.values_||(this.values_={});if(n)o[t]=e;else{const l=o[t];o[t]=e,l!==e&&this.notify(t,l)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],er(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}const Hi={ADD:"add",REMOVE:"remove"},Dc={LENGTH:"length"};class na extends hs{constructor(t,e,n){super(t),this.element=e,this.index=n}}class Bn extends Rn{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let n=0,o=this.array_.length;n<o;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,o=e.length;n<o;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Dc.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new na(Hi.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,o=e.length;n<o;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new na(Hi.REMOVE,e,t)),e}setAt(t,e){const n=this.getLength();if(t>=n){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const o=this.array_[t];this.array_[t]=e,this.dispatchEvent(new na(Hi.REMOVE,o,t)),this.dispatchEvent(new na(Hi.ADD,e,t))}updateLength_(){this.set(Dc.LENGTH,this.array_.length)}assertUnique_(t,e){for(let n=0,o=this.array_.length;n<o;++n)if(this.array_[n]===t&&n!==e)throw new Error("Duplicate item added to a unique collection")}}function pe(r,t){if(!r)throw new Error(t)}class sr extends Rn{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new sr(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Fe(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=ge(t,jt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?$1(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function $1(r){if(typeof r=="function")return r;let t;return Array.isArray(r)?t=r:(pe(typeof r.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[r]),function(){return t}}new Array(6);function Tn(){return[1,0,0,1,0,0]}function tf(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function bi(r,t){const e=t[0],n=t[1];return t[0]=r[0]*e+r[2]*n+r[4],t[1]=r[1]*e+r[3]*n+r[5],t}function as(r,t,e,n,o,l,u,g){const x=Math.sin(l),E=Math.cos(l);return r[0]=n*E,r[1]=o*x,r[2]=-n*x,r[3]=o*E,r[4]=u*n*E-g*n*x+t,r[5]=u*o*x+g*o*E+e,r}function ju(r,t){const e=ef(t);pe(e!==0,"Transformation matrix cannot be inverted");const n=t[0],o=t[1],l=t[2],u=t[3],g=t[4],x=t[5];return r[0]=u/e,r[1]=-o/e,r[2]=-l/e,r[3]=n/e,r[4]=(l*x-u*g)/e,r[5]=-(n*x-o*g)/e,r}function ef(r){return r[0]*r[3]-r[1]*r[2]}const Lc=[1e6,1e6,1e6,1e6,2,2];function nf(r){return"matrix("+r.map((e,n)=>Math.round(e*Lc[n])/Lc[n]).join(", ")+")"}const yi={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Fc(r){const t=mn();for(let e=0,n=r.length;e<n;++e)ho(t,r[e]);return t}function Dh(r,t,e){return e?(e[0]=r[0]-t,e[1]=r[1]-t,e[2]=r[2]+t,e[3]=r[3]+t,e):[r[0]-t,r[1]-t,r[2]+t,r[3]+t]}function Zu(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r.slice()}function rr(r,t,e){let n,o;return t<r[0]?n=r[0]-t:r[2]<t?n=t-r[2]:n=0,e<r[1]?o=r[1]-e:r[3]<e?o=e-r[3]:o=0,n*n+o*o}function Dr(r,t){return Lh(r,t[0],t[1])}function Zs(r,t){return r[0]<=t[0]&&t[2]<=r[2]&&r[1]<=t[1]&&t[3]<=r[3]}function Lh(r,t,e){return r[0]<=t&&t<=r[2]&&r[1]<=e&&e<=r[3]}function sh(r,t){const e=r[0],n=r[1],o=r[2],l=r[3],u=t[0],g=t[1];let x=yi.UNKNOWN;return u<e?x=x|yi.LEFT:u>o&&(x=x|yi.RIGHT),g<n?x=x|yi.BELOW:g>l&&(x=x|yi.ABOVE),x===yi.UNKNOWN&&(x=yi.INTERSECTING),x}function mn(){return[1/0,1/0,-1/0,-1/0]}function Os(r,t,e,n,o){return o?(o[0]=r,o[1]=t,o[2]=e,o[3]=n,o):[r,t,e,n]}function Do(r){return Os(1/0,1/0,-1/0,-1/0,r)}function Ku(r,t){const e=r[0],n=r[1];return Os(e,n,e,n,t)}function Fh(r,t,e,n,o){const l=Do(o);return Ju(l,r,t,e,n)}function mo(r,t){return r[0]==t[0]&&r[2]==t[2]&&r[1]==t[1]&&r[3]==t[3]}function qu(r,t){return t[0]<r[0]&&(r[0]=t[0]),t[2]>r[2]&&(r[2]=t[2]),t[1]<r[1]&&(r[1]=t[1]),t[3]>r[3]&&(r[3]=t[3]),r}function ho(r,t){t[0]<r[0]&&(r[0]=t[0]),t[0]>r[2]&&(r[2]=t[0]),t[1]<r[1]&&(r[1]=t[1]),t[1]>r[3]&&(r[3]=t[1])}function Ju(r,t,e,n,o){for(;e<n;e+=o)sf(r,t[e],t[e+1]);return r}function sf(r,t,e){r[0]=Math.min(r[0],t),r[1]=Math.min(r[1],e),r[2]=Math.max(r[2],t),r[3]=Math.max(r[3],e)}function Qu(r,t){let e;return e=t(Ua(r)),e||(e=t(za(r)),e)||(e=t(Wa(r)),e)||(e=t(or(r)),e)?e:!1}function rh(r){let t=0;return Xa(r)||(t=Ce(r)*Bi(r)),t}function Ua(r){return[r[0],r[1]]}function za(r){return[r[2],r[1]]}function Ns(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function rf(r,t){let e;if(t==="bottom-left")e=Ua(r);else if(t==="bottom-right")e=za(r);else if(t==="top-left")e=or(r);else if(t==="top-right")e=Wa(r);else throw new Error("Invalid corner");return e}function oh(r,t,e,n,o){const[l,u,g,x,E,w,A,S]=ah(r,t,e,n);return Os(Math.min(l,g,E,A),Math.min(u,x,w,S),Math.max(l,g,E,A),Math.max(u,x,w,S),o)}function ah(r,t,e,n){const o=t*n[0]/2,l=t*n[1]/2,u=Math.cos(e),g=Math.sin(e),x=o*u,E=o*g,w=l*u,A=l*g,S=r[0],P=r[1];return[S-x+A,P-E-w,S-x-A,P-E+w,S+x-A,P+E+w,S+x+A,P+E-w,S-x+A,P-E-w]}function Bi(r){return r[3]-r[1]}function co(r,t,e){const n=e||mn();return Zi(r,t)?(r[0]>t[0]?n[0]=r[0]:n[0]=t[0],r[1]>t[1]?n[1]=r[1]:n[1]=t[1],r[2]<t[2]?n[2]=r[2]:n[2]=t[2],r[3]<t[3]?n[3]=r[3]:n[3]=t[3]):Do(n),n}function or(r){return[r[0],r[3]]}function Wa(r){return[r[2],r[3]]}function Ce(r){return r[2]-r[0]}function Zi(r,t){return r[0]<=t[2]&&r[2]>=t[0]&&r[1]<=t[3]&&r[3]>=t[1]}function Xa(r){return r[2]<r[0]||r[3]<r[1]}function of(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r}function af(r,t,e){let n=!1;const o=sh(r,t),l=sh(r,e);if(o===yi.INTERSECTING||l===yi.INTERSECTING)n=!0;else{const u=r[0],g=r[1],x=r[2],E=r[3],w=t[0],A=t[1],S=e[0],P=e[1],L=(P-A)/(S-w);let F,V;l&yi.ABOVE&&!(o&yi.ABOVE)&&(F=S-(P-E)/L,n=F>=u&&F<=x),!n&&l&yi.RIGHT&&!(o&yi.RIGHT)&&(V=P-(S-x)*L,n=V>=g&&V<=E),!n&&l&yi.BELOW&&!(o&yi.BELOW)&&(F=S-(P-g)/L,n=F>=u&&F<=x),!n&&l&yi.LEFT&&!(o&yi.LEFT)&&(V=P-(S-u)*L,n=V>=g&&V<=E)}return n}function $u(r,t){const e=t.getExtent(),n=Ns(r);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){const o=Ce(e),u=Math.floor((n[0]-e[0])/o)*o;r[0]-=u,r[2]-=u}return r}function t0(r,t,e){if(t.canWrapX()){const n=t.getExtent();if(!isFinite(r[0])||!isFinite(r[2]))return[[n[0],r[1],n[2],r[3]]];$u(r,t);const o=Ce(n);if(Ce(r)>o&&!e)return[[n[0],r[1],n[2],r[3]]];if(r[0]<n[0])return[[r[0]+o,r[1],n[2],r[3]],[n[0],r[1],r[2],r[3]]];if(r[2]>n[2])return[[r[0],r[1],n[2],r[3]],[n[0],r[1],r[2]-o,r[3]]]}return[r]}const xo={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class lf{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||xo[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Bh=lf,Lo=6378137,Tr=Math.PI*Lo,hf=[-Tr,-Tr,Tr,Tr],cf=[-180,-85,180,85],sa=Lo*Math.log(Math.tan(Math.PI/2));class pr extends Bh{constructor(t){super({code:t,units:"m",extent:hf,global:!0,worldExtent:cf,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Lo)}})}}const Bc=[new pr("EPSG:3857"),new pr("EPSG:102100"),new pr("EPSG:102113"),new pr("EPSG:900913"),new pr("http://www.opengis.net/def/crs/EPSG/0/3857"),new pr("http://www.opengis.net/gml/srs/epsg.xml#3857")];function uf(r,t,e){const n=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(n));for(let o=0;o<n;o+=e){t[o]=Tr*r[o]/180;let l=Lo*Math.log(Math.tan(Math.PI*(+r[o+1]+90)/360));l>sa?l=sa:l<-sa&&(l=-sa),t[o+1]=l}return t}function ff(r,t,e){const n=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(n));for(let o=0;o<n;o+=e)t[o]=180*r[o]/Tr,t[o+1]=360*Math.atan(Math.exp(r[o+1]/Lo))/Math.PI-90;return t}const df=6378137,kc=[-180,-90,180,90],gf=Math.PI*df/180;class Xs extends Bh{constructor(t,e){super({code:t,units:"degrees",extent:kc,axisOrientation:e,global:!0,metersPerUnit:gf,worldExtent:kc})}}const Gc=[new Xs("CRS:84"),new Xs("EPSG:4326","neu"),new Xs("urn:ogc:def:crs:OGC:1.3:CRS84"),new Xs("urn:ogc:def:crs:OGC:2:84"),new Xs("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Xs("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Xs("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let lh={};function mf(r){return lh[r]||lh[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function xf(r,t){lh[r]=t}let Rr={};function Lr(r,t,e){const n=r.getCode(),o=t.getCode();n in Rr||(Rr[n]={}),Rr[n][o]=e}function e0(r,t){let e;return r in Rr&&t in Rr[r]&&(e=Rr[r][t]),e}function ei(r,t,e){return Math.min(Math.max(r,t),e)}function _f(r,t,e,n,o,l){const u=o-e,g=l-n;if(u!==0||g!==0){const x=((r-e)*u+(t-n)*g)/(u*u+g*g);x>1?(e=o,n=l):x>0&&(e+=u*x,n+=g*x)}return $s(r,t,e,n)}function $s(r,t,e,n){const o=e-r,l=n-t;return o*o+l*l}function pf(r){const t=r.length;for(let n=0;n<t;n++){let o=n,l=Math.abs(r[n][n]);for(let g=n+1;g<t;g++){const x=Math.abs(r[g][n]);x>l&&(l=x,o=g)}if(l===0)return null;const u=r[o];r[o]=r[n],r[n]=u;for(let g=n+1;g<t;g++){const x=-r[g][n]/r[n][n];for(let E=n;E<t+1;E++)n==E?r[g][E]=0:r[g][E]+=x*r[n][E]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=r[n][t]/r[n][n];for(let o=n-1;o>=0;o--)r[o][t]-=r[o][n]*e[n]}return e}function pa(r){return r*Math.PI/180}function vr(r,t){const e=r%t;return e*t<0?e+t:e}function en(r,t,e){return r+e*(t-r)}function kh(r,t){const e=Math.pow(10,t);return Math.round(r*e)/e}function ra(r,t){return Math.floor(kh(r,t))}function oa(r,t){return Math.ceil(kh(r,t))}function Qr(r,t,e){const n=e!==void 0?r.toFixed(e):""+r;let o=n.indexOf(".");return o=o===-1?n.length:o,o>t?n:new Array(1+t-o).join("0")+n}function yf(r,t){return r[0]+=+t[0],r[1]+=+t[1],r}function Ea(r,t){let e=!0;for(let n=r.length-1;n>=0;--n)if(r[n]!=t[n]){e=!1;break}return e}function Gh(r,t){const e=Math.cos(t),n=Math.sin(t),o=r[0]*e-r[1]*n,l=r[1]*e+r[0]*n;return r[0]=o,r[1]=l,r}function wf(r,t){return r[0]*=t,r[1]*=t,r}function i0(r,t){if(t.canWrapX()){const e=Ce(t.getExtent()),n=n0(r,t,e);n&&(r[0]-=n*e)}return r}function n0(r,t,e){const n=t.getExtent();let o=0;return t.canWrapX()&&(r[0]<n[0]||r[0]>n[2])&&(e=e||Ce(n),o=Math.floor((r[0]-n[0])/e)),o}const Ef=63710088e-1;function Uc(r,t,e){e=e||Ef;const n=pa(r[1]),o=pa(t[1]),l=(o-n)/2,u=pa(t[0]-r[0])/2,g=Math.sin(l)*Math.sin(l)+Math.sin(u)*Math.sin(u)*Math.cos(n)*Math.cos(o);return 2*e*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))}function s0(...r){console.warn(...r)}let hh=!0;function Cf(r){hh=!(r===void 0?!0:r)}function Uh(r,t){if(t!==void 0){for(let e=0,n=r.length;e<n;++e)t[e]=r[e];t=t}else t=r.slice();return t}function r0(r,t){if(t!==void 0&&r!==t){for(let e=0,n=r.length;e<n;++e)t[e]=r[e];r=t}return r}function o0(r){xf(r.getCode(),r),Lr(r,r,Uh)}function Af(r){r.forEach(o0)}function Be(r){return typeof r=="string"?mf(r):r||null}function zc(r,t,e,n){r=Be(r);let o;const l=r.getPointResolutionFunc();if(l){if(o=l(t,e),n&&n!==r.getUnits()){const u=r.getMetersPerUnit();u&&(o=o*u/xo[n])}}else{const u=r.getUnits();if(u=="degrees"&&!n||n=="degrees")o=t;else{const g=Va(r,Be("EPSG:4326"));if(g===r0&&u!=="degrees")o=t*r.getMetersPerUnit();else{let E=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];E=g(E,E,2);const w=Uc(E.slice(0,2),E.slice(2,4)),A=Uc(E.slice(4,6),E.slice(6,8));o=(w+A)/2}const x=n?xo[n]:r.getMetersPerUnit();x!==void 0&&(o/=x)}}return o}function ch(r){Af(r),r.forEach(function(t){r.forEach(function(e){t!==e&&Lr(t,e,Uh)})})}function If(r,t,e,n){r.forEach(function(o){t.forEach(function(l){Lr(o,l,e),Lr(l,o,n)})})}function zh(r,t){return r?typeof r=="string"?Be(r):r:Be(t)}function Wc(r){return function(t,e,n){const o=t.length;n=n!==void 0?n:2,e=e!==void 0?e:new Array(o);for(let l=0;l<o;l+=n){const u=r(t.slice(l,l+n)),g=u.length;for(let x=0,E=n;x<E;++x)e[l+x]=x>=g?t[l+x]:u[x]}return e}}function Mf(r,t,e,n){const o=Be(r),l=Be(t);Lr(o,l,Wc(e)),Lr(l,o,Wc(n))}function js(r,t){if(r===t)return!0;const e=r.getUnits()===t.getUnits();return(r.getCode()===t.getCode()||Va(r,t)===Uh)&&e}function Va(r,t){const e=r.getCode(),n=t.getCode();let o=e0(e,n);return o||(o=r0),o}function _o(r,t){const e=Be(r),n=Be(t);return Va(e,n)}function bf(r,t,e){return _o(t,e)(r,void 0,r.length)}let Tf=null;function Sf(){return Tf}function uh(r,t){return r}function $n(r,t){return hh&&!Ea(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&(hh=!1,s0("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r}function Wh(r,t){return r}function Ks(r,t){return r}function Xc(r,t,e){return function(n){let o,l;if(r.canWrapX()){const u=r.getExtent(),g=Ce(u);n=n.slice(0),l=n0(n,r,g),l&&(n[0]=n[0]-l*g),n[0]=ei(n[0],u[0],u[2]),n[1]=ei(n[1],u[1],u[3]),o=e(n)}else o=e(n);return l&&t.canWrapX()&&(o[0]+=l*Ce(t.getExtent())),o}}function Rf(){ch(Bc),ch(Gc),If(Gc,Bc,uf,ff)}Rf();function vs(r,t,e,n,o,l){l=l||[];let u=0;for(let g=t;g<e;g+=n){const x=r[g],E=r[g+1];l[u++]=o[0]*x+o[2]*E+o[4],l[u++]=o[1]*x+o[3]*E+o[5]}return l&&l.length!=u&&(l.length=u),l}function a0(r,t,e,n,o,l,u){u=u||[];const g=Math.cos(o),x=Math.sin(o),E=l[0],w=l[1];let A=0;for(let S=t;S<e;S+=n){const P=r[S]-E,L=r[S+1]-w;u[A++]=E+P*g-L*x,u[A++]=w+P*x+L*g;for(let F=S+2;F<S+n;++F)u[A++]=r[F]}return u&&u.length!=A&&(u.length=A),u}function vf(r,t,e,n,o,l,u,g){g=g||[];const x=u[0],E=u[1];let w=0;for(let A=t;A<e;A+=n){const S=r[A]-x,P=r[A+1]-E;g[w++]=x+o*S,g[w++]=E+l*P;for(let L=A+2;L<A+n;++L)g[w++]=r[L]}return g&&g.length!=w&&(g.length=w),g}function Of(r,t,e,n,o,l,u){u=u||[];let g=0;for(let x=t;x<e;x+=n){u[g++]=r[x]+o,u[g++]=r[x+1]+l;for(let E=x+2;E<x+n;++E)u[g++]=r[E]}return u&&u.length!=g&&(u.length=g),u}const Vc=Tn();class l0 extends Rn{constructor(){super(),this.extent_=mn(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Hu((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const o=this.clone();return o.applyTransform(n),o.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return Xt()}closestPointXY(t,e,n,o){return Xt()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Xt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Do(e),this.extentRevision_=this.getRevision()}return of(this.extent_,t)}rotate(t,e){Xt()}scale(t,e,n){Xt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Xt()}getType(){return Xt()}applyTransform(t){Xt()}intersectsExtent(t){return Xt()}translate(t,e){Xt()}transform(t,e){const n=Be(t),o=n.getUnits()=="tile-pixels"?function(l,u,g){const x=n.getExtent(),E=n.getWorldExtent(),w=Bi(E)/Bi(x);return as(Vc,E[0],E[3],w,-w,0,0,0),vs(l,0,l.length,g,Vc,u),_o(n,e)(l,u,g)}:_o(n,e);return this.applyTransform(o),this}}class ar extends l0{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Fh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Xt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Yc(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){Xt()}setLayout(t,e,n){let o;if(t)o=Yc(t);else{for(let l=0;l<n;++l){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}o=e.length,t=lr(o)}this.layout=t,this.stride=o}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const o=this.getStride();a0(n,0,n.length,o,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Ns(this.getExtent()));const o=this.getFlatCoordinates();if(o){const l=this.getStride();vf(o,0,o.length,l,t,e,n,o),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const o=this.getStride();Of(n,0,n.length,o,t,e,n),this.changed()}}}function lr(r){let t;return r==2?t="XY":r==3?t="XYZ":r==4&&(t="XYZM"),t}function Yc(r){let t;return r=="XY"?t=2:r=="XYZ"||r=="XYM"?t=3:r=="XYZM"&&(t=4),t}function Nf(r,t,e){const n=r.getFlatCoordinates();if(!n)return null;const o=r.getStride();return vs(n,0,n.length,o,t,e)}function Hc(r,t,e,n,o,l,u){const g=r[t],x=r[t+1],E=r[e]-g,w=r[e+1]-x;let A;if(E===0&&w===0)A=t;else{const S=((o-g)*E+(l-x)*w)/(E*E+w*w);if(S>1)A=e;else if(S>0){for(let P=0;P<n;++P)u[P]=en(r[t+P],r[e+P],S);u.length=n;return}else A=t}for(let S=0;S<n;++S)u[S]=r[A+S];u.length=n}function Xh(r,t,e,n,o){let l=r[t],u=r[t+1];for(t+=n;t<e;t+=n){const g=r[t],x=r[t+1],E=$s(l,u,g,x);E>o&&(o=E),l=g,u=x}return o}function Vh(r,t,e,n,o){for(let l=0,u=e.length;l<u;++l){const g=e[l];o=Xh(r,t,g,n,o),t=g}return o}function Pf(r,t,e,n,o){for(let l=0,u=e.length;l<u;++l){const g=e[l];o=Vh(r,t,g,n,o),t=g[g.length-1]}return o}function Yh(r,t,e,n,o,l,u,g,x,E,w){if(t==e)return E;let A,S;if(o===0){if(S=$s(u,g,r[t],r[t+1]),S<E){for(A=0;A<n;++A)x[A]=r[t+A];return x.length=n,S}return E}w=w||[NaN,NaN];let P=t+n;for(;P<e;)if(Hc(r,P-n,P,n,u,g,w),S=$s(u,g,w[0],w[1]),S<E){for(E=S,A=0;A<n;++A)x[A]=w[A];x.length=n,P+=n}else P+=n*Math.max((Math.sqrt(S)-Math.sqrt(E))/o|0,1);if(l&&(Hc(r,e-n,t,n,u,g,w),S=$s(u,g,w[0],w[1]),S<E)){for(E=S,A=0;A<n;++A)x[A]=w[A];x.length=n}return E}function Hh(r,t,e,n,o,l,u,g,x,E,w){w=w||[NaN,NaN];for(let A=0,S=e.length;A<S;++A){const P=e[A];E=Yh(r,t,P,n,o,l,u,g,x,E,w),t=P}return E}function Df(r,t,e,n,o,l,u,g,x,E,w){w=w||[NaN,NaN];for(let A=0,S=e.length;A<S;++A){const P=e[A];E=Hh(r,t,P,n,o,l,u,g,x,E,w),t=P[P.length-1]}return E}function Lf(r,t,e,n){for(let o=0,l=e.length;o<l;++o)r[t++]=e[o];return t}function Ya(r,t,e,n){for(let o=0,l=e.length;o<l;++o){const u=e[o];for(let g=0;g<n;++g)r[t++]=u[g]}return t}function Fo(r,t,e,n,o){o=o||[];let l=0;for(let u=0,g=e.length;u<g;++u){const x=Ya(r,t,e[u],n);o[l++]=x,t=x}return o.length=l,o}function h0(r,t,e,n,o){o=o||[];let l=0;for(let u=0,g=e.length;u<g;++u){const x=Fo(r,t,e[u],n,o[l]);x.length===0&&(x[0]=t),o[l++]=x,t=x[x.length-1]}return o.length=l,o}function Ha(r,t,e,n,o,l,u){const g=(e-t)/n;if(g<3){for(;t<e;t+=n)l[u++]=r[t],l[u++]=r[t+1];return u}const x=new Array(g);x[0]=1,x[g-1]=1;const E=[t,e-n];let w=0;for(;E.length>0;){const A=E.pop(),S=E.pop();let P=0;const L=r[S],F=r[S+1],V=r[A],z=r[A+1];for(let U=S+n;U<A;U+=n){const Y=r[U],Z=r[U+1],$=_f(Y,Z,L,F,V,z);$>P&&(w=U,P=$)}P>o&&(x[(w-t)/n]=1,S+n<w&&E.push(S,w),w+n<A&&E.push(w,A))}for(let A=0;A<g;++A)x[A]&&(l[u++]=r[t+A*n],l[u++]=r[t+A*n+1]);return u}function c0(r,t,e,n,o,l,u,g){for(let x=0,E=e.length;x<E;++x){const w=e[x];u=Ha(r,t,w,n,o,l,u),g.push(u),t=w}return u}function Hs(r,t){return t*Math.round(r/t)}function Ff(r,t,e,n,o,l,u){if(t==e)return u;let g=Hs(r[t],o),x=Hs(r[t+1],o);t+=n,l[u++]=g,l[u++]=x;let E,w;do if(E=Hs(r[t],o),w=Hs(r[t+1],o),t+=n,t==e)return l[u++]=E,l[u++]=w,u;while(E==g&&w==x);for(;t<e;){const A=Hs(r[t],o),S=Hs(r[t+1],o);if(t+=n,A==E&&S==w)continue;const P=E-g,L=w-x,F=A-g,V=S-x;if(P*V==L*F&&(P<0&&F<P||P==F||P>0&&F>P)&&(L<0&&V<L||L==V||L>0&&V>L)){E=A,w=S;continue}l[u++]=E,l[u++]=w,g=E,x=w,E=A,w=S}return l[u++]=E,l[u++]=w,u}function jh(r,t,e,n,o,l,u,g){for(let x=0,E=e.length;x<E;++x){const w=e[x];u=Ff(r,t,w,n,o,l,u),g.push(u),t=w}return u}function Bf(r,t,e,n,o,l,u,g){for(let x=0,E=e.length;x<E;++x){const w=e[x],A=[];u=jh(r,t,w,n,o,l,u,A),g.push(A),t=w[w.length-1]}return u}function bs(r,t,e,n,o){o=o!==void 0?o:[];let l=0;for(let u=t;u<e;u+=n)o[l++]=r.slice(u,u+n);return o.length=l,o}function po(r,t,e,n,o){o=o!==void 0?o:[];let l=0;for(let u=0,g=e.length;u<g;++u){const x=e[u];o[l++]=bs(r,t,x,n,o[l]),t=x}return o.length=l,o}function fh(r,t,e,n,o){o=o!==void 0?o:[];let l=0;for(let u=0,g=e.length;u<g;++u){const x=e[u];o[l++]=x.length===1&&x[0]===t?[]:po(r,t,x,n,o[l]),t=x[x.length-1]}return o.length=l,o}function u0(r,t,e,n){let o=0,l=r[e-n],u=r[e-n+1];for(;t<e;t+=n){const g=r[t],x=r[t+1];o+=u*g-l*x,l=g,u=x}return o/2}function f0(r,t,e,n){let o=0;for(let l=0,u=e.length;l<u;++l){const g=e[l];o+=u0(r,t,g,n),t=g}return o}function kf(r,t,e,n){let o=0;for(let l=0,u=e.length;l<u;++l){const g=e[l];o+=f0(r,t,g,n),t=g[g.length-1]}return o}class yo extends ar{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new yo(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,o){return o<rr(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,o))}getArea(){return u0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return bs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Ha(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new yo(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ya(this.flatCoordinates,0,t,this.stride),this.changed()}}class ir extends ar{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new ir(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,o){const l=this.flatCoordinates,u=$s(t,e,l[0],l[1]);if(u<o){const g=this.stride;for(let x=0;x<g;++x)n[x]=l[x];return n.length=g,u}return o}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Ku(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Lh(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Lf(this.flatCoordinates,0,t,this.stride),this.changed()}}function Gf(r,t,e,n,o){return!Qu(o,function(u){return!qs(r,t,e,n,u[0],u[1])})}function qs(r,t,e,n,o,l){let u=0,g=r[e-n],x=r[e-n+1];for(;t<e;t+=n){const E=r[t],w=r[t+1];x<=l?w>l&&(E-g)*(l-x)-(o-g)*(w-x)>0&&u++:w<=l&&(E-g)*(l-x)-(o-g)*(w-x)<0&&u--,g=E,x=w}return u!==0}function Zh(r,t,e,n,o,l){if(e.length===0||!qs(r,t,e[0],n,o,l))return!1;for(let u=1,g=e.length;u<g;++u)if(qs(r,e[u-1],e[u],n,o,l))return!1;return!0}function Uf(r,t,e,n,o,l){if(e.length===0)return!1;for(let u=0,g=e.length;u<g;++u){const x=e[u];if(Zh(r,t,x,n,o,l))return!0;t=x[x.length-1]}return!1}function Kh(r,t,e,n,o,l,u){let g,x,E,w,A,S,P;const L=o[l+1],F=[];for(let U=0,Y=e.length;U<Y;++U){const Z=e[U];for(w=r[Z-n],S=r[Z-n+1],g=t;g<Z;g+=n)A=r[g],P=r[g+1],(L<=S&&P<=L||S<=L&&L<=P)&&(E=(L-S)/(P-S)*(A-w)+w,F.push(E)),w=A,S=P}let V=NaN,z=-1/0;for(F.sort(ss),w=F[0],g=1,x=F.length;g<x;++g){A=F[g];const U=Math.abs(A-w);U>z&&(E=(w+A)/2,Zh(r,t,e,n,E,L)&&(V=E,z=U)),w=A}return isNaN(V)&&(V=o[l]),u?(u.push(V,L,z),u):[V,L,z]}function d0(r,t,e,n,o){let l=[];for(let u=0,g=e.length;u<g;++u){const x=e[u];l=Kh(r,t,x,n,o,2*u,l),t=x[x.length-1]}return l}function g0(r,t,e,n,o){let l;for(t+=n;t<e;t+=n)if(l=o(r.slice(t-n,t),r.slice(t,t+n)),l)return l;return!1}function ja(r,t,e,n,o){const l=Ju(mn(),r,t,e,n);return Zi(o,l)?Zs(o,l)||l[0]>=o[0]&&l[2]<=o[2]||l[1]>=o[1]&&l[3]<=o[3]?!0:g0(r,t,e,n,function(u,g){return af(o,u,g)}):!1}function zf(r,t,e,n,o){for(let l=0,u=e.length;l<u;++l){if(ja(r,t,e[l],n,o))return!0;t=e[l]}return!1}function m0(r,t,e,n,o){return!!(ja(r,t,e,n,o)||qs(r,t,e,n,o[0],o[1])||qs(r,t,e,n,o[0],o[3])||qs(r,t,e,n,o[2],o[1])||qs(r,t,e,n,o[2],o[3]))}function x0(r,t,e,n,o){if(!m0(r,t,e[0],n,o))return!1;if(e.length===1)return!0;for(let l=1,u=e.length;l<u;++l)if(Gf(r,e[l-1],e[l],n,o)&&!ja(r,e[l-1],e[l],n,o))return!1;return!0}function Wf(r,t,e,n,o){for(let l=0,u=e.length;l<u;++l){const g=e[l];if(x0(r,t,g,n,o))return!0;t=g[g.length-1]}return!1}function Xf(r,t,e,n){for(;t<e-n;){for(let o=0;o<n;++o){const l=r[t+o];r[t+o]=r[e-n+o],r[e-n+o]=l}t+=n,e-=n}}function qh(r,t,e,n){let o=0,l=r[e-n],u=r[e-n+1];for(;t<e;t+=n){const g=r[t],x=r[t+1];o+=(g-l)*(x+u),l=g,u=x}return o===0?void 0:o>0}function Jh(r,t,e,n,o){o=o!==void 0?o:!1;for(let l=0,u=e.length;l<u;++l){const g=e[l],x=qh(r,t,g,n);if(l===0){if(o&&x||!o&&!x)return!1}else if(o&&!x||!o&&x)return!1;t=g}return!0}function _0(r,t,e,n,o){for(let l=0,u=e.length;l<u;++l){const g=e[l];if(!Jh(r,t,g,n,o))return!1;g.length&&(t=g[g.length-1])}return!0}function Ca(r,t,e,n,o){o=o!==void 0?o:!1;for(let l=0,u=e.length;l<u;++l){const g=e[l],x=qh(r,t,g,n);(l===0?o&&x||!o&&!x:o&&!x||!o&&x)&&Xf(r,t,g,n),t=g}return t}function dh(r,t,e,n,o){for(let l=0,u=e.length;l<u;++l)t=Ca(r,t,e[l],n,o);return t}function Vf(r,t){const e=[];let n=0,o=0,l;for(let u=0,g=t.length;u<g;++u){const x=t[u],E=qh(r,n,x,2);if(l===void 0&&(l=E),E===l)e.push(t.slice(o,u+1));else{if(e.length===0)continue;e[e.length-1].push(t[o])}o=u+1,n=x}return e}class Ps extends ar{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?bn(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Ps(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,o){return o<rr(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Vh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Hh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,o))}containsXY(t,e){return Zh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return f0(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Ca(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,po(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Ns(this.getExtent());this.flatInteriorPoint_=Kh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new ir(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new yo(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,o=[];let l=0;for(let u=0,g=n.length;u<g;++u){const x=n[u],E=new yo(e.slice(l,x),t);o.push(E),l=x}return o}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Jh(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ca(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=jh(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new Ps(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return x0(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Fo(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function jc(r){if(Xa(r))throw new Error("Cannot create polygon from empty extent");const t=r[0],e=r[1],n=r[2],o=r[3],l=[t,e,t,o,n,o,n,e,t,e];return new Ps(l,"XY",[l.length])}const gn={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},ie={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},wo={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Ti={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Ti.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Ti.max=Ti.whitepoint[2].D65;Ti.rgb=function(r,t){t=t||Ti.whitepoint[2].E;var e=r[0]/t[0],n=r[1]/t[1],o=r[2]/t[2],l,u,g;return l=e*3.240969941904521+n*-1.537383177570093+o*-.498610760293,u=e*-.96924363628087+n*1.87596750150772+o*.041555057407175,g=e*.055630079696993+n*-.20397695888897+o*1.056971514242878,l=l>.0031308?1.055*Math.pow(l,1/2.4)-.055:l=l*12.92,u=u>.0031308?1.055*Math.pow(u,1/2.4)-.055:u=u*12.92,g=g>.0031308?1.055*Math.pow(g,1/2.4)-.055:g=g*12.92,l=Math.min(Math.max(0,l),1),u=Math.min(Math.max(0,u),1),g=Math.min(Math.max(0,g),1),[l*255,u*255,g*255]};wo.xyz=function(r,t){var e=r[0]/255,n=r[1]/255,o=r[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92;var l=e*.41239079926595+n*.35758433938387+o*.18048078840183,u=e*.21263900587151+n*.71516867876775+o*.072192315360733,g=e*.019330818715591+n*.11919477979462+o*.95053215224966;return t=t||Ti.whitepoint[2].E,[l*t[0],u*t[1],g*t[2]]};const Qh={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(r,t,e){var n,o,l,u,g,x,E,w,A,S,P,L,F;if(l=r[0],u=r[1],g=r[2],l===0)return[0,0,0];var V=.0011070564598794539;return t=t||"D65",e=e||2,A=Ti.whitepoint[e][t][0],S=Ti.whitepoint[e][t][1],P=Ti.whitepoint[e][t][2],L=4*A/(A+15*S+3*P),F=9*S/(A+15*S+3*P),n=u/(13*l)+L||0,o=g/(13*l)+F||0,E=l>8?S*Math.pow((l+16)/116,3):S*l*V,x=E*9*n/(4*o)||0,w=E*(12-3*n-20*o)/(4*o)||0,[x,E,w]}};Ti.luv=function(r,t,e){var n,o,l,u,g,x,E,w,A,S,P,L,F,V=.008856451679035631,z=903.2962962962961;t=t||"D65",e=e||2,A=Ti.whitepoint[e][t][0],S=Ti.whitepoint[e][t][1],P=Ti.whitepoint[e][t][2],L=4*A/(A+15*S+3*P),F=9*S/(A+15*S+3*P),x=r[0],E=r[1],w=r[2],n=4*x/(x+15*E+3*w)||0,o=9*E/(x+15*E+3*w)||0;var U=E/S;return l=U<=V?z*U:116*Math.pow(U,1/3)-16,u=13*l*(n-L),g=13*l*(o-F),[l,u,g]};var p0={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(r){var t=r[0],e=r[1],n=r[2],o,l,u;return u=n/360*2*Math.PI,o=e*Math.cos(u),l=e*Math.sin(u),[t,o,l]},xyz:function(r){return Qh.xyz(p0.luv(r))}};Qh.lchuv=function(r){var t=r[0],e=r[1],n=r[2],o=Math.sqrt(e*e+n*n),l=Math.atan2(n,e),u=l*360/2/Math.PI;return u<0&&(u+=360),[t,o,u]};Ti.lchuv=function(r){return Qh.lchuv(Ti.luv(r))};const Zc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Kc={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Yf(r){var t,e=[],n=1,o;if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(r=String(r).toLowerCase(),Zc[r])e=Zc[r].slice(),o="rgb";else if(r==="transparent")n=0,o="rgb",e=[0,0,0];else if(r[0]==="#"){var l=r.slice(1),u=l.length,g=u<=4;n=1,g?(e=[parseInt(l[0]+l[0],16),parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16)],u===4&&(n=parseInt(l[3]+l[3],16)/255)):(e=[parseInt(l[0]+l[1],16),parseInt(l[2]+l[3],16),parseInt(l[4]+l[5],16)],u===8&&(n=parseInt(l[6]+l[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),o="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(r)){var x=t[1];o=x.replace(/a$/,"");var E=o==="cmyk"?4:o==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),o==="color"&&(o=e.shift()),e=e.map(function(w,A){if(w[w.length-1]==="%")return w=parseFloat(w)/100,A===3?w:o==="rgb"?w*255:o[0]==="h"||o[0]==="l"&&!A?w*100:o==="lab"?w*125:o==="lch"?A<2?w*150:w*360:o[0]==="o"&&!A?w:o==="oklab"?w*.4:o==="oklch"?A<2?w*.4:w*360:w;if(o[A]==="h"||A===2&&o[o.length-1]==="h"){if(Kc[w]!==void 0)return Kc[w];if(w.endsWith("deg"))return parseFloat(w);if(w.endsWith("turn"))return parseFloat(w)*360;if(w.endsWith("grad"))return parseFloat(w)*360/400;if(w.endsWith("rad"))return parseFloat(w)*180/Math.PI}return w==="none"?0:parseFloat(w)}),n=e.length>E?e.pop():1}else/[0-9](?:\s|\/|,)/.test(r)&&(e=r.match(/([0-9]+)/g).map(function(w){return parseFloat(w)}),o=r.match(/([a-z])/ig)?.join("")?.toLowerCase()||"rgb");return{space:o,values:e,alpha:n}}const Ol={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(r){var t=r[0]/360,e=r[1]/100,n=r[2]/100,o,l,u,g,x,E=0;if(e===0)return x=n*255,[x,x,x];for(l=n<.5?n*(1+e):n+e-n*e,o=2*n-l,g=[0,0,0];E<3;)u=t+1/3*-(E-1),u<0?u++:u>1&&u--,x=6*u<1?o+(l-o)*6*u:2*u<1?l:3*u<2?o+(l-o)*(2/3-u)*6:o,g[E++]=x*255;return g}};wo.hsl=function(r){var t=r[0]/255,e=r[1]/255,n=r[2]/255,o=Math.min(t,e,n),l=Math.max(t,e,n),u=l-o,g,x,E;return l===o?g=0:t===l?g=(e-n)/u:e===l?g=2+(n-t)/u:n===l&&(g=4+(t-e)/u),g=Math.min(g*60,360),g<0&&(g+=360),E=(o+l)/2,l===o?x=0:E<=.5?x=u/(l+o):x=u/(2-l-o),[g,x*100,E*100]};function Hf(r){Array.isArray(r)&&r.raw&&(r=String.raw(...arguments)),r instanceof Number&&(r=+r);var t,e=Yf(r);if(!e.space)return[];const n=e.space[0]==="h"?Ol.min:wo.min,o=e.space[0]==="h"?Ol.max:wo.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),o[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),o[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),o[2]),e.space[0]==="h"&&(t=Ol.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function jf(r){return typeof r=="string"?r:tc(r)}const Zf=1024,$r={};let Nl=0;function Kf(r){if(r.length===4)return r;const t=r.slice();return t[3]=1,t}function qc(r){const t=Ti.lchuv(wo.xyz(r));return t[3]=r[3],t}function qf(r){const t=Ti.rgb(p0.xyz(r));return t[3]=r[3],t}function $h(r){if($r.hasOwnProperty(r))return $r[r];if(Nl>=Zf){let e=0;for(const n in $r)e++&3||(delete $r[n],--Nl)}const t=Hf(r);if(t.length!==4)throw new Error('Failed to parse "'+r+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+r+'" as color');return y0(t),$r[r]=t,++Nl,t}function Eo(r){return Array.isArray(r)?r:$h(r)}function y0(r){return r[0]=ei(r[0]+.5|0,0,255),r[1]=ei(r[1]+.5|0,0,255),r[2]=ei(r[2]+.5|0,0,255),r[3]=ei(r[3],0,1),r}function tc(r){let t=r[0];t!=(t|0)&&(t=t+.5|0);let e=r[1];e!=(e|0)&&(e=e+.5|0);let n=r[2];n!=(n|0)&&(n=n+.5|0);const o=r[3]===void 0?1:Math.round(r[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+o+")"}function Jf(r){try{return $h(r),!0}catch{return!1}}const Ds=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Qf=Ds.includes("firefox"),$f=Ds.includes("safari")&&!Ds.includes("chrom");$f&&(Ds.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Ds));const td=Ds.includes("webkit")&&!Ds.includes("edge"),w0=Ds.includes("macintosh"),E0=typeof devicePixelRatio<"u"?devicePixelRatio:1,C0=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,A0=typeof Image<"u"&&Image.prototype.decode,I0=function(){let r=!1;try{const t=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return r}();function Si(r,t,e,n){let o;return e&&e.length?o=e.shift():C0?o=new OffscreenCanvas(r||300,t||300):o=document.createElement("canvas"),r&&(o.width=r),t&&(o.height=t),o.getContext("2d",n)}let Pl;function Aa(){return Pl||(Pl=Si(1,1)),Pl}function Za(r){const t=r.canvas;t.width=1,t.height=1,r.clearRect(0,0,1,1)}function ed(r){let t=r.offsetWidth;const e=getComputedStyle(r);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function id(r){let t=r.offsetHeight;const e=getComputedStyle(r);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function Jc(r,t){const e=t.parentNode;e&&e.replaceChild(r,t)}function Ia(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function M0(r){for(;r.lastChild;)r.removeChild(r.lastChild)}function nd(r,t){const e=r.childNodes;for(let n=0;;++n){const o=e[n],l=t[n];if(!o&&!l)break;if(o!==l){if(!o){r.appendChild(l);continue}if(!l){r.removeChild(o),--n;continue}r.insertBefore(l,o)}}}function sd(r,t,e){const n=r;let o=!0,l=!1,u=!1;const g=[wa(n,jt.LOAD,function(){u=!0,l||t()})];return n.src&&A0?(l=!0,n.decode().then(function(){o&&t()}).catch(function(x){o&&(u?t():e())})):g.push(wa(n,jt.ERROR,e)),function(){o=!1,g.forEach(Fe)}}function rd(r,t){return new Promise((e,n)=>{function o(){u(),e(r)}function l(){u(),n(new Error("Image load error"))}function u(){r.removeEventListener("load",o),r.removeEventListener("error",l)}r.addEventListener("load",o),r.addEventListener("error",l),t&&(r.src=t)})}function od(r,t){return t&&(r.src=t),r.src&&A0?new Promise((e,n)=>r.decode().then(()=>e(r)).catch(o=>r.complete&&r.width?e(r):n(o))):rd(r)}class ad{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const o=Dl(t,e,n);return o in this.cache_?this.cache_[o]:null}getPattern(t,e,n){const o=Dl(t,e,n);return o in this.patternCache_?this.patternCache_[o]:null}set(t,e,n,o,l){const u=Dl(t,e,n),g=u in this.cache_;this.cache_[u]=o,l&&(o.getImageState()===ie.IDLE&&o.load(),o.getImageState()===ie.LOADING?o.ready().then(()=>{this.patternCache_[u]=Aa().createPattern(o.getImage(1),"repeat")}):this.patternCache_[u]=Aa().createPattern(o.getImage(1),"repeat")),g||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Dl(r,t,e){const n=e?Eo(e):"null";return t+":"+r+":"+n}const kn=new ad;let to=null;class ld extends Ga{constructor(t,e,n,o,l){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=l,this.imageState_=o===void 0?ie.IDLE:o,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ie.LOADED){to||(to=Si(1,1,void 0,{willReadFrequently:!0})),to.drawImage(this.image_,0,0);try{to.getImageData(0,0,1,1),this.tainted_=!1}catch{to=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(jt.CHANGE)}handleImageError_(){this.imageState_=ie.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ie.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=Si(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ie.IDLE){this.image_||this.initializeImage_(),this.imageState_=ie.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&od(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==ie.LOADED)return;const e=this.image_,n=document.createElement("canvas");n.width=Math.ceil(e.width*t),n.height=Math.ceil(e.height*t);const o=n.getContext("2d");o.scale(t,t),o.drawImage(e,0,0),o.globalCompositeOperation="multiply",o.fillStyle=jf(this.color_),o.fillRect(0,0,n.width/t,n.height/t),o.globalCompositeOperation="destination-in",o.drawImage(e,0,0),this.canvas_[t]=n}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===ie.LOADED||this.imageState_===ie.ERROR?t():this.addEventListener(jt.CHANGE,function e(){(this.imageState_===ie.LOADED||this.imageState_===ie.ERROR)&&(this.removeEventListener(jt.CHANGE,e),t())})})),this.ready_}}function ec(r,t,e,n,o,l){let u=t===void 0?void 0:kn.get(t,e,o);return u||(u=new ld(r,r&&"src"in r?r.src||void 0:t,e,n,o),kn.set(t,e,o,u,l)),l&&u&&!kn.getPattern(t,e,o)&&kn.set(t,e,o,u,l),u}class Bo{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Bo({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=ec(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===ie.IDLE&&e.load(),e.getImageState()===ie.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function Ma(r,t,e,n,o,l,u){let g,x;const E=(e-t)/n;if(E===1)g=t;else if(E===2)g=t,x=o;else if(E!==0){let w=r[t],A=r[t+1],S=0;const P=[0];for(let V=t+n;V<e;V+=n){const z=r[V],U=r[V+1];S+=Math.sqrt((z-w)*(z-w)+(U-A)*(U-A)),P.push(S),w=z,A=U}const L=o*S,F=j1(P,L);F<0?(x=(L-P[-F-2])/(P[-F-1]-P[-F-2]),g=t+(-F-2)*n):g=t+F*n}u=u>1?u:2,l=l||new Array(u);for(let w=0;w<u;++w)l[w]=g===void 0?NaN:x===void 0?r[g+w]:en(r[g+w],r[g+n+w],x);return l}function gh(r,t,e,n,o,l){if(e==t)return null;let u;if(o<r[t+n-1])return l?(u=r.slice(t,t+n),u[n-1]=o,u):null;if(r[e-1]<o)return l?(u=r.slice(e-n,e),u[n-1]=o,u):null;if(o==r[t+n-1])return r.slice(t,t+n);let g=t/n,x=e/n;for(;g<x;){const S=g+x>>1;o<r[(S+1)*n-1]?x=S:g=S+1}const E=r[g*n-1];if(o==E)return r.slice((g-1)*n,(g-1)*n+n);const w=r[(g+1)*n-1],A=(o-E)/(w-E);u=[];for(let S=0;S<n-1;++S)u.push(en(r[(g-1)*n+S],r[g*n+S],A));return u.push(o),u}function hd(r,t,e,n,o,l,u){if(u)return gh(r,t,e[e.length-1],n,o,l);let g;if(o<r[n-1])return l?(g=r.slice(0,n),g[n-1]=o,g):null;if(r[r.length-1]<o)return l?(g=r.slice(r.length-n),g[n-1]=o,g):null;for(let x=0,E=e.length;x<E;++x){const w=e[x];if(t!=w){if(o<r[t+n-1])return null;if(o<=r[w-1])return gh(r,t,w,n,o,!1);t=w}}return null}function b0(r,t,e,n){let o=r[t],l=r[t+1],u=0;for(let g=t+n;g<e;g+=n){const x=r[g],E=r[g+1];u+=Math.sqrt((x-o)*(x-o)+(E-l)*(E-l)),o=x,l=E}return u}class nr extends ar{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){bn(this.flatCoordinates,t),this.changed()}clone(){const t=new nr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,o){return o<rr(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,o))}forEachSegment(t){return g0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,gh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return bs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Ma(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return b0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Ha(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new nr(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return ja(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ya(this.flatCoordinates,0,t,this.stride),this.changed()}}class Ka{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Ka({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}function Qc(r){return r[0]>0&&r[1]>0}function cd(r,t,e){return e===void 0&&(e=[0,0]),e[0]=r[0]*t+.5|0,e[1]=r[1]*t+.5|0,e}function sn(r,t){return Array.isArray(r)?r:(t===void 0?t=[r,r]:(t[0]=r,t[1]=r),t)}class qa{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=sn(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new qa({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Xt()}getImage(t){return Xt()}getHitDetectionImage(){return Xt()}getPixelRatio(t){return 1}getImageState(){return Xt()}getImageSize(){return Xt()}getOrigin(){return Xt()}getSize(){return Xt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=sn(t)}listenImageChange(t){Xt()}load(){Xt()}unlistenImageChange(t){Xt()}ready(){return Promise.resolve()}}function Gn(r){return r?Array.isArray(r)?tc(r):typeof r=="object"&&"src"in r?ud(r):r:null}function ud(r){if(!r.offset||!r.size)return kn.getPattern(r.src,"anonymous",r.color);const t=r.src+":"+r.offset,e=kn.getPattern(t,void 0,r.color);if(e)return e;const n=kn.get(r.src,"anonymous",null);if(n.getImageState()!==ie.LOADED)return null;const o=Si(r.size[0],r.size[1]);return o.drawImage(n.getImage(1),r.offset[0],r.offset[1],r.size[0],r.size[1],0,0,r.size[0],r.size[1]),ec(o.canvas,t,void 0,ie.LOADED,r.color,!0),kn.getPattern(t,void 0,r.color)}const aa="ol-hidden",fd="ol-selectable",Ja="ol-unselectable",ic="ol-control",$c="ol-collapsed",dd=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),tu=["style","variant","weight","size","lineHeight","family"],T0=function(r){const t=r.match(dd);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,o=tu.length;n<o;++n){const l=t[n+1];l!==void 0&&(e[tu[n]]=l)}return e.families=e.family.split(/,\s?/),e},S0="10px sans-serif",ji="#000",Fr="round",rs=[],os=0,Br="round",Co=10,Ao="#000",Io="center",ba="middle",Js=[0,0,0,0],Mo=1,ts=new Rn;let Ar=null,mh;const xh={},gd=function(){const t="32px ",e=["monospace","serif"],n=e.length,o="wmytzilWMYTZIL@#/&?$%10";let l,u;function g(E,w,A){let S=!0;for(let P=0;P<n;++P){const L=e[P];if(u=Ta(E+" "+w+" "+t+L,o),A!=L){const F=Ta(E+" "+w+" "+t+A+","+L,o);S=S&&F!=u}}return!!S}function x(){let E=!0;const w=ts.getKeys();for(let A=0,S=w.length;A<S;++A){const P=w[A];ts.get(P)<100&&(g.apply(this,P.split(`
`))?(No(xh),Ar=null,mh=void 0,ts.set(P,100)):(ts.set(P,ts.get(P)+1,!0),E=!1))}E&&(clearInterval(l),l=void 0)}return function(E){const w=T0(E);if(!w)return;const A=w.families;for(let S=0,P=A.length;S<P;++S){const L=A[S],F=w.style+`
`+w.weight+`
`+L;ts.get(F)===void 0&&(ts.set(F,100,!0),g(w.style,w.weight,L)||(ts.set(F,0,!0),l===void 0&&(l=setInterval(x,32))))}}}(),md=function(){let r;return function(t){let e=xh[t];if(e==null){if(C0){const n=T0(t),o=R0(t,"Žg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(o.actualBoundingBoxAscent+o.actualBoundingBoxDescent)}else r||(r=document.createElement("div"),r.innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=t,document.body.appendChild(r),e=r.offsetHeight,document.body.removeChild(r);xh[t]=e}return e}}();function R0(r,t){return Ar||(Ar=Si(1,1)),r!=mh&&(Ar.font=r,mh=Ar.font),Ar.measureText(t)}function Ta(r,t){return R0(r,t).width}function eu(r,t,e){if(t in e)return e[t];const n=t.split(`
`).reduce((o,l)=>Math.max(o,Ta(r,l)),0);return e[t]=n,n}function xd(r,t){const e=[],n=[],o=[];let l=0,u=0,g=0,x=0;for(let E=0,w=t.length;E<=w;E+=2){const A=t[E];if(A===`
`||E===w){l=Math.max(l,u),o.push(u),u=0,g+=x,x=0;continue}const S=t[E+1]||r.font,P=Ta(S,A);e.push(P),u+=P;const L=md(S);n.push(L),x=Math.max(x,L)}return{width:l,height:g,widths:e,heights:n,lineWidths:o}}function _d(r,t,e,n,o,l,u,g,x,E,w){r.save(),e!==1&&(r.globalAlpha===void 0?r.globalAlpha=A=>A.globalAlpha*=e:r.globalAlpha*=e),t&&r.transform.apply(r,t),n.contextInstructions?(r.translate(x,E),r.scale(w[0],w[1]),pd(n,r)):w[0]<0||w[1]<0?(r.translate(x,E),r.scale(w[0],w[1]),r.drawImage(n,o,l,u,g,0,0,u,g)):r.drawImage(n,o,l,u,g,x,E,u*w[0],g*w[1]),r.restore()}function pd(r,t){const e=r.contextInstructions;for(let n=0,o=e.length;n<o;n+=2)Array.isArray(e[n+1])?t[e[n]].apply(t,e[n+1]):t[e[n]]=e[n+1]}class Qa extends qa{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?ie.LOADING:ie.LOADED,this.imageState_===ie.LOADING&&this.ready().then(()=>this.imageState_=ie.LOADED),this.render()}clone(){const t=this.getScale(),e=new Qa({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const n=this.renderOptions_,o=Si(n.size*t,n.size*t);this.draw_(n,o,t),e=o.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let o=this.radius_,l=this.radius2_===void 0?o:this.radius2_;if(o<l){const ot=o;o=l,l=ot}const u=this.radius2_===void 0?this.points_:this.points_*2,g=2*Math.PI/u,x=l*Math.sin(g),E=Math.sqrt(l*l-x*x),w=o-E,A=Math.sqrt(x*x+w*w),S=A/x;if(t==="miter"&&S<=n)return S*e;const P=e/2/S,L=e/2*(w/A),V=Math.sqrt((o+P)*(o+P)+L*L)-o;if(this.radius2_===void 0||t==="bevel")return V*2;const z=o*Math.sin(g),U=Math.sqrt(o*o-z*z),Y=l-U,$=Math.sqrt(z*z+Y*Y)/z;if($<=n){const ot=$*e/2-l-o;return 2*Math.max(V,ot)}return V*2}createRenderOptions(){let t=Fr,e=Br,n=0,o=null,l=0,u,g=0;this.stroke_&&(u=Gn(this.stroke_.getColor()??Ao),g=this.stroke_.getWidth()??Mo,o=this.stroke_.getLineDash(),l=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Br,t=this.stroke_.getLineCap()??Fr,n=this.stroke_.getMiterLimit()??Co);const x=this.calculateLineJoinSize_(e,g,n),E=Math.max(this.radius_,this.radius2_||0),w=Math.ceil(2*E+x);return{strokeStyle:u,strokeWidth:g,size:w,lineCap:t,lineDash:o,lineDashOffset:l,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let o=this.fill_.getColor();o===null&&(o=ji),e.fillStyle=Gn(o),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),o=0;typeof n=="string"&&(n=Eo(n)),n===null?o=1:Array.isArray(n)&&(o=n.length===4?n[3]:1),o===0&&(e=Si(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const o=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const l=this.angle_-Math.PI/2,u=2*Math.PI/e;for(let g=0;g<e;g++){const x=l+g*u,E=g%2===0?n:o;t.lineTo(E*Math.cos(x),E*Math.sin(x))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=ji,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class $a extends Qa{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new $a({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}class tl{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=iu,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new tl({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=iu,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function yd(r){let t;if(typeof r=="function")t=r;else{let e;Array.isArray(r)?e=r:(pe(typeof r.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[r]),t=function(){return e}}return t}let Ll=null;function v0(r,t){if(!Ll){const e=new Bo({color:"rgba(255,255,255,0.4)"}),n=new Ka({color:"#3399CC",width:1.25});Ll=[new tl({image:new $a({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return Ll}function iu(r){return r.getGeometry()}const ya=tl,wd="#333";class nc{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=sn(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Bo({color:wd}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new nc({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=sn(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const ve={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class O0 extends Rn{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[ve.OPACITY]=t.opacity!==void 0?t.opacity:1,pe(typeof e[ve.OPACITY]=="number","Layer opacity must be a number"),e[ve.VISIBLE]=t.visible!==void 0?t.visible:!0,e[ve.Z_INDEX]=t.zIndex,e[ve.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[ve.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[ve.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[ve.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=ei(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return Xt()}getLayerStatesArray(t){return Xt()}getExtent(){return this.get(ve.EXTENT)}getMaxResolution(){return this.get(ve.MAX_RESOLUTION)}getMinResolution(){return this.get(ve.MIN_RESOLUTION)}getMinZoom(){return this.get(ve.MIN_ZOOM)}getMaxZoom(){return this.get(ve.MAX_ZOOM)}getOpacity(){return this.get(ve.OPACITY)}getSourceState(){return Xt()}getVisible(){return this.get(ve.VISIBLE)}getZIndex(){return this.get(ve.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(ve.EXTENT,t)}setMaxResolution(t){this.set(ve.MAX_RESOLUTION,t)}setMinResolution(t){this.set(ve.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(ve.MAX_ZOOM,t)}setMinZoom(t){this.set(ve.MIN_ZOOM,t)}setOpacity(t){pe(typeof t=="number","Layer opacity must be a number"),this.set(ve.OPACITY,t)}setVisible(t){this.set(ve.VISIBLE,t)}setZIndex(t){this.set(ve.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Fi={ANIMATING:0,INTERACTING:1},An={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},Ed=42,sc=256;function nu(r,t,e){return function(n,o,l,u,g){if(!n)return;if(!o&&!t)return n;const x=t?0:l[0]*o,E=t?0:l[1]*o,w=g?g[0]:0,A=g?g[1]:0;let S=r[0]+x/2+w,P=r[2]-x/2+w,L=r[1]+E/2+A,F=r[3]-E/2+A;S>P&&(S=(P+S)/2,P=S),L>F&&(L=(F+L)/2,F=L);let V=ei(n[0],S,P),z=ei(n[1],L,F);if(u&&e&&o){const U=30*o;V+=-U*Math.log(1+Math.max(0,S-n[0])/U)+U*Math.log(1+Math.max(0,n[0]-P)/U),z+=-U*Math.log(1+Math.max(0,L-n[1])/U)+U*Math.log(1+Math.max(0,n[1]-F)/U)}return[V,z]}}function Cd(r){return r}function rc(r,t,e,n){const o=Ce(t)/e[0],l=Bi(t)/e[1];return n?Math.min(r,Math.max(o,l)):Math.min(r,Math.min(o,l))}function oc(r,t,e){let n=Math.min(r,t);const o=50;return n*=Math.log(1+o*Math.max(0,r/t-1))/o+1,e&&(n=Math.max(n,e),n/=Math.log(1+o*Math.max(0,e/r-1))/o+1),ei(n,e/2,t*2)}function Ad(r,t,e,n){return t=t!==void 0?t:!0,function(o,l,u,g){if(o!==void 0){const x=r[0],E=r[r.length-1],w=e?rc(x,e,u,n):x;if(g)return t?oc(o,w,E):ei(o,E,w);const A=Math.min(w,o),S=Math.floor(Ph(r,A,l));return r[S]>w&&S<r.length-1?r[S+1]:r[S]}}}function Id(r,t,e,n,o,l){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(u,g,x,E){if(u!==void 0){const w=o?rc(t,o,x,l):t;if(E)return n?oc(u,w,e):ei(u,e,w);const A=1e-9,S=Math.ceil(Math.log(t/w)/Math.log(r)-A),P=-g*(.5-A)+.5,L=Math.min(w,u),F=Math.floor(Math.log(t/L)/Math.log(r)+P),V=Math.max(S,F),z=t/Math.pow(r,V);return ei(z,e,w)}}}function su(r,t,e,n,o){return e=e!==void 0?e:!0,function(l,u,g,x){if(l!==void 0){const E=n?rc(r,n,g,o):r;return!e||!x?ei(l,t,E):oc(l,E,t)}}}function ac(r){if(r!==void 0)return 0}function ru(r){if(r!==void 0)return r}function Md(r){const t=2*Math.PI/r;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function bd(r){const t=r===void 0?pa(5):r;return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}function N0(r){return Math.pow(r,3)}function Wr(r){return 1-N0(1-r)}function Td(r){return 3*r*r-2*r*r*r}function Sd(r){return r}const Fl=0;class Rd extends Rn{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=zh(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Cf(),t.center&&(t.center=$n(t.center,this.projection_)),t.extent&&(t.extent=Ks(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const g in An)delete e[g];this.setProperties(e,!0);const n=Od(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const o=vd(t),l=n.constraint,u=Nd(t);this.constraints_={center:o,resolution:l,rotation:u},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const o=t||[0,0,0,0];e=e||[0,0,0,0];const l=this.getResolution(),u=l/2*(o[3]-e[3]+e[1]-o[1]),g=l/2*(o[0]-e[0]+e[2]-o[2]);this.setCenterInternal([n[0]+u,n[1]-g])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let o=arguments[n];o.center&&(o=Object.assign({},o),o.center=$n(o.center,this.getProjection())),o.anchor&&(o=Object.assign({},o),o.anchor=$n(o.anchor,this.getProjection())),e[n]=o}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let o=0;for(;o<e&&!this.isDef();++o){const w=arguments[o];w.center&&this.setCenterInternal(w.center),w.zoom!==void 0?this.setZoom(w.zoom):w.resolution&&this.setResolution(w.resolution),w.rotation!==void 0&&this.setRotation(w.rotation)}if(o===e){n&&la(n,!0);return}let l=Date.now(),u=this.targetCenter_.slice(),g=this.targetResolution_,x=this.targetRotation_;const E=[];for(;o<e;++o){const w=arguments[o],A={start:l,complete:!1,anchor:w.anchor,duration:w.duration!==void 0?w.duration:1e3,easing:w.easing||Td,callback:n};if(w.center&&(A.sourceCenter=u,A.targetCenter=w.center.slice(),u=A.targetCenter),w.zoom!==void 0?(A.sourceResolution=g,A.targetResolution=this.getResolutionForZoom(w.zoom),g=A.targetResolution):w.resolution&&(A.sourceResolution=g,A.targetResolution=w.resolution,g=A.targetResolution),w.rotation!==void 0){A.sourceRotation=x;const S=vr(w.rotation-x+Math.PI,2*Math.PI)-Math.PI;A.targetRotation=x+S,x=A.targetRotation}Pd(A)?A.complete=!0:l+=A.duration,E.push(A)}this.animations_.push(E),this.setHint(Fi.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Fi.ANIMATING]>0}getInteracting(){return this.hints_[Fi.INTERACTING]>0}cancelAnimations(){this.setHint(Fi.ANIMATING,-this.hints_[Fi.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const o=this.animations_[e];if(o[0].callback&&la(o[0].callback,!1),!t)for(let l=0,u=o.length;l<u;++l){const g=o[l];if(!g.complete){t=g.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const o=this.animations_[n];let l=!0;for(let u=0,g=o.length;u<g;++u){const x=o[u];if(x.complete)continue;const E=t-x.start;let w=x.duration>0?E/x.duration:1;w>=1?(x.complete=!0,w=1):l=!1;const A=x.easing(w);if(x.sourceCenter){const S=x.sourceCenter[0],P=x.sourceCenter[1],L=x.targetCenter[0],F=x.targetCenter[1];this.nextCenter_=x.targetCenter;const V=S+A*(L-S),z=P+A*(F-P);this.targetCenter_=[V,z]}if(x.sourceResolution&&x.targetResolution){const S=A===1?x.targetResolution:x.sourceResolution+A*(x.targetResolution-x.sourceResolution);if(x.anchor){const P=this.getViewportSize_(this.getRotation()),L=this.constraints_.resolution(S,0,P,!0);this.targetCenter_=this.calculateCenterZoom(L,x.anchor)}this.nextResolution_=x.targetResolution,this.targetResolution_=S,this.applyTargetState_(!0)}if(x.sourceRotation!==void 0&&x.targetRotation!==void 0){const S=A===1?vr(x.targetRotation+Math.PI,2*Math.PI)-Math.PI:x.sourceRotation+A*(x.targetRotation-x.sourceRotation);if(x.anchor){const P=this.constraints_.rotation(S,!0);this.targetCenter_=this.calculateCenterRotate(P,x.anchor)}this.nextRotation_=x.targetRotation,this.targetRotation_=S}if(this.applyTargetState_(!0),e=!0,!x.complete)break}if(l){this.animations_[n]=null,this.setHint(Fi.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const u=o[0].callback;u&&la(u,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const o=this.getCenterInternal();return o!==void 0&&(n=[o[0]-e[0],o[1]-e[1]],Gh(n,t-this.getRotation()),yf(n,e)),n}calculateCenterZoom(t,e){let n;const o=this.getCenterInternal(),l=this.getResolution();if(o!==void 0&&l!==void 0){const u=e[0]-t*(e[0]-o[0])/l,g=e[1]-t*(e[1]-o[1])/l;n=[u,g]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],o=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(o*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(o*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&uh(t,this.getProjection())}getCenterInternal(){return this.get(An.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return Wh(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();pe(e,"The view center is not defined");const n=this.getResolution();pe(n!==void 0,"The view resolution is not defined");const o=this.getRotation();return pe(o!==void 0,"The view rotation is not defined"),oh(e,n,o,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(An.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Ks(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=Ce(t)/e[0],o=Bi(t)/e[1];return Math.max(n,o)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,o=Math.log(e/n)/Math.log(t);return function(l){return e/Math.pow(t,l*o)}}getRotation(){return this.get(An.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),o=this.minResolution_,l=Math.log(n/o)/e;return function(u){return Math.log(n/u)/e/l}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let o=this.getCenterInternal();const l=this.padding_;if(l){const u=this.getViewportSizeMinusPadding_();o=Bl(o,this.getViewportSize_(),[u[0]/2+l[3],u[1]/2+l[0]],e,n)}return{center:o.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,o;if(this.resolutions_){const l=Ph(this.resolutions_,t,1);e=l,n=this.resolutions_[l],l==this.resolutions_.length-1?o=2:o=n/this.resolutions_[l+1]}else n=this.maxResolution_,o=this.zoomFactor_;return e+Math.log(n/t)/Math.log(o)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=ei(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,ei(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(pe(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){pe(!Xa(t),"Cannot fit empty extent provided as `geometry`");const o=Ks(t,this.getProjection());n=jc(o)}else if(t.getType()==="Circle"){const o=Ks(t.getExtent(),this.getProjection());n=jc(o),n.rotate(this.getRotation(),Ns(o))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),o=Math.sin(-e),l=t.getFlatCoordinates(),u=t.getStride();let g=1/0,x=1/0,E=-1/0,w=-1/0;for(let A=0,S=l.length;A<S;A+=u){const P=l[A]*n-l[A+1]*o,L=l[A]*o+l[A+1]*n;g=Math.min(g,P),x=Math.min(x,L),E=Math.max(E,P),w=Math.max(w,L)}return[g,x,E,w]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const o=e.padding!==void 0?e.padding:[0,0,0,0],l=e.nearest!==void 0?e.nearest:!1;let u;e.minResolution!==void 0?u=e.minResolution:e.maxZoom!==void 0?u=this.getResolutionForZoom(e.maxZoom):u=0;const g=this.rotatedExtentForGeometry(t);let x=this.getResolutionForExtentInternal(g,[n[0]-o[1]-o[3],n[1]-o[0]-o[2]]);x=isNaN(x)?u:Math.max(x,u),x=this.getConstrainedResolution(x,l?0:1);const E=this.getRotation(),w=Math.sin(E),A=Math.cos(E),S=Ns(g);S[0]+=(o[1]-o[3])/2*x,S[1]+=(o[0]-o[2])/2*x;const P=S[0]*A-S[1]*w,L=S[1]*A+S[0]*w,F=this.getConstrainedCenter([P,L],x),V=e.callback?e.callback:Pr;e.duration!==void 0?this.animateInternal({resolution:x,center:F,duration:e.duration,easing:e.easing},V):(this.targetResolution_=x,this.targetCenter_=F,this.applyTargetState_(!1,!0),la(V,!0))}centerOn(t,e,n){this.centerOnInternal($n(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(Bl(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,o){let l;const u=this.padding_;if(u&&t){const g=this.getViewportSizeMinusPadding_(-n),x=Bl(t,o,[g[0]/2+u[3],g[1]/2+u[0]],e,n);l=[t[0]-x[0],t[1]-x[1]]}return l}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=uh(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&$n(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),o=this.getViewportSize_(this.getRotation()),l=this.constraints_.resolution(this.targetResolution_*t,0,o,n);e&&(this.targetCenter_=this.calculateCenterZoom(l,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=$n(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),o=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(o,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&$n(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,o=this.constraints_.rotation(this.targetRotation_,n),l=this.getViewportSize_(o),u=this.constraints_.resolution(this.targetResolution_,0,l,n),g=this.constraints_.center(this.targetCenter_,u,l,n,this.calculateCenterShift(this.targetCenter_,u,o,l));this.get(An.ROTATION)!==o&&this.set(An.ROTATION,o),this.get(An.RESOLUTION)!==u&&(this.set(An.RESOLUTION,u),this.set("zoom",this.getZoom(),!0)),(!g||!this.get(An.CENTER)||!Ea(this.get(An.CENTER),g))&&this.set(An.CENTER,g),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const o=e||0,l=this.constraints_.rotation(this.targetRotation_),u=this.getViewportSize_(l),g=this.constraints_.resolution(this.targetResolution_,o,u),x=this.constraints_.center(this.targetCenter_,g,u,!1,this.calculateCenterShift(this.targetCenter_,g,l,u));if(t===0&&!this.cancelAnchor_){this.targetResolution_=g,this.targetRotation_=l,this.targetCenter_=x,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==g||this.getRotation()!==l||!this.getCenterInternal()||!Ea(this.getCenterInternal(),x))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:l,center:x,resolution:g,duration:t,easing:Wr,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Fi.INTERACTING,1)}endInteraction(t,e,n){n=n&&$n(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(Fi.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function la(r,t){setTimeout(function(){r(t)},0)}function vd(r){if(r.extent!==void 0){const e=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return nu(r.extent,r.constrainOnlyCenter,e)}const t=zh(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,nu(e,!1,!1)}return Cd}function Od(r){let t,e,n,u=r.minZoom!==void 0?r.minZoom:Fl,g=r.maxZoom!==void 0?r.maxZoom:28;const x=r.zoomFactor!==void 0?r.zoomFactor:2,E=r.multiWorld!==void 0?r.multiWorld:!1,w=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,A=r.showFullExtent!==void 0?r.showFullExtent:!1,S=zh(r.projection,"EPSG:3857"),P=S.getExtent();let L=r.constrainOnlyCenter,F=r.extent;if(!E&&!F&&S.isGlobal()&&(L=!1,F=P),r.resolutions!==void 0){const V=r.resolutions;e=V[u],n=V[g]!==void 0?V[g]:V[V.length-1],r.constrainResolution?t=Ad(V,w,!L&&F,A):t=su(e,n,w,!L&&F,A)}else{const z=(P?Math.max(Ce(P),Bi(P)):360*xo.degrees/S.getMetersPerUnit())/sc/Math.pow(2,Fl),U=z/Math.pow(2,28-Fl);e=r.maxResolution,e!==void 0?u=0:e=z/Math.pow(x,u),n=r.minResolution,n===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?n=e/Math.pow(x,g):n=z/Math.pow(x,g):n=U),g=u+Math.floor(Math.log(e/n)/Math.log(x)),n=e/Math.pow(x,g-u),r.constrainResolution?t=Id(x,e,n,w,!L&&F,A):t=su(e,n,w,!L&&F,A)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:u,zoomFactor:x}}function Nd(r){if(r.enableRotation!==void 0?r.enableRotation:!0){const e=r.constrainRotation;return e===void 0||e===!0?bd():e===!1?ru:typeof e=="number"?Md(e):ru}return ac}function Pd(r){return!(r.sourceCenter&&r.targetCenter&&!Ea(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function Bl(r,t,e,n,o){const l=Math.cos(-o);let u=Math.sin(-o),g=r[0]*l-r[1]*u,x=r[1]*l+r[0]*u;g+=(t[0]/2-e[0])*n,x+=(e[1]-t[1]/2)*n,u=-u;const E=g*l-x*u,w=x*l+g*u;return[E,w]}const Ln=Rd;class el extends O0{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(ve.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(ve.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Fe(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=ge(t,jt.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof Ln?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let o;e.layerStatesArray?o=e.layerStatesArray.find(u=>u.layer===this):o=this.getLayerState();const l=this.getExtent();return lc(o,e.viewState)&&(!l||Zi(l,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const n=this.getSource();if(n&&(e=n.getAttributions()),!e)return[];const o=t instanceof Ln?t.getViewStateAndExtent():t;let l=e(o);return Array.isArray(l)||(l=[l]),l}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(ve.MAP,t)}getMapInternal(){return this.get(ve.MAP)}setMap(t){this.mapPrecomposeKey_&&(Fe(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Fe(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=ge(t,gn.PRECOMPOSE,function(e){const o=e.frameState.layerStatesArray,l=this.getLayerState(!1);pe(!o.some(function(u){return u.layer===l.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),o.push(l)},this),this.mapRenderKey_=ge(this,jt.CHANGE,t.render,t),this.changed())}setSource(t){this.set(ve.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function lc(r,t){if(!r.visible)return!1;const e=t.resolution;if(e<r.minResolution||e>=r.maxResolution)return!1;const n=t.zoom;return n>r.minZoom&&n<=r.maxZoom}function Dd(r,t,e,n,o){P0(r,t,e||0,n||r.length-1,o||Ld)}function P0(r,t,e,n,o){for(;n>e;){if(n-e>600){var l=n-e+1,u=t-e+1,g=Math.log(l),x=.5*Math.exp(2*g/3),E=.5*Math.sqrt(g*x*(l-x)/l)*(u-l/2<0?-1:1),w=Math.max(e,Math.floor(t-u*x/l+E)),A=Math.min(n,Math.floor(t+(l-u)*x/l+E));P0(r,t,w,A,o)}var S=r[t],P=e,L=n;for(eo(r,e,t),o(r[n],S)>0&&eo(r,e,n);P<L;){for(eo(r,P,L),P++,L--;o(r[P],S)<0;)P++;for(;o(r[L],S)>0;)L--}o(r[e],S)===0?eo(r,e,L):(L++,eo(r,L,n)),L<=t&&(e=L+1),t<=L&&(n=L-1)}}function eo(r,t,e){var n=r[t];r[t]=r[e],r[e]=n}function Ld(r,t){return r<t?-1:r>t?1:0}let D0=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!ca(t,e))return n;const o=this.toBBox,l=[];for(;e;){for(let u=0;u<e.children.length;u++){const g=e.children[u],x=e.leaf?o(g):g;ca(t,x)&&(e.leaf?n.push(g):Gl(t,x)?this._all(g,n):l.push(g))}e=l.pop()}return n}collides(t){let e=this.data;if(!ca(t,e))return!1;const n=[];for(;e;){for(let o=0;o<e.children.length;o++){const l=e.children[o],u=e.leaf?this.toBBox(l):l;if(ca(t,u)){if(e.leaf||Gl(t,u))return!0;n.push(l)}}e=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const n=this.data;this.data=e,e=n}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Ir([]),this}remove(t,e){if(!t)return this;let n=this.data;const o=this.toBBox(t),l=[],u=[];let g,x,E;for(;n||l.length;){if(n||(n=l.pop(),x=l[l.length-1],g=u.pop(),E=!0),n.leaf){const w=Fd(t,n.children,e);if(w!==-1)return n.children.splice(w,1),l.push(n),this._condense(l),this}!E&&!n.leaf&&Gl(n,o)?(l.push(n),u.push(g),g=0,x=n,n=n.children[0]):x?(g++,n=x.children[g],E=!1):n=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,o){const l=n-e+1;let u=this._maxEntries,g;if(l<=u)return g=Ir(t.slice(e,n+1)),yr(g,this.toBBox),g;o||(o=Math.ceil(Math.log(l)/Math.log(u)),u=Math.ceil(l/Math.pow(u,o-1))),g=Ir([]),g.leaf=!1,g.height=o;const x=Math.ceil(l/u),E=x*Math.ceil(Math.sqrt(u));ou(t,e,n,E,this.compareMinX);for(let w=e;w<=n;w+=E){const A=Math.min(w+E-1,n);ou(t,w,A,x,this.compareMinY);for(let S=w;S<=A;S+=x){const P=Math.min(S+x-1,A);g.children.push(this._build(t,S,P,o-1))}}return yr(g,this.toBBox),g}_chooseSubtree(t,e,n,o){for(;o.push(e),!(e.leaf||o.length-1===n);){let l=1/0,u=1/0,g;for(let x=0;x<e.children.length;x++){const E=e.children[x],w=kl(E),A=Gd(t,E)-w;A<u?(u=A,l=w<l?w:l,g=E):A===u&&w<l&&(l=w,g=E)}e=g||e.children[0]}return e}_insert(t,e,n){const o=n?t:this.toBBox(t),l=[],u=this._chooseSubtree(o,this.data,e,l);for(u.children.push(t),ro(u,o);e>=0&&l[e].children.length>this._maxEntries;)this._split(l,e),e--;this._adjustParentBBoxes(o,l,e)}_split(t,e){const n=t[e],o=n.children.length,l=this._minEntries;this._chooseSplitAxis(n,l,o);const u=this._chooseSplitIndex(n,l,o),g=Ir(n.children.splice(u,n.children.length-u));g.height=n.height,g.leaf=n.leaf,yr(n,this.toBBox),yr(g,this.toBBox),e?t[e-1].children.push(g):this._splitRoot(n,g)}_splitRoot(t,e){this.data=Ir([t,e]),this.data.height=t.height+1,this.data.leaf=!1,yr(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let o,l=1/0,u=1/0;for(let g=e;g<=n-e;g++){const x=so(t,0,g,this.toBBox),E=so(t,g,n,this.toBBox),w=Ud(x,E),A=kl(x)+kl(E);w<l?(l=w,o=g,u=A<u?A:u):w===l&&A<u&&(u=A,o=g)}return o||n-e}_chooseSplitAxis(t,e,n){const o=t.leaf?this.compareMinX:Bd,l=t.leaf?this.compareMinY:kd,u=this._allDistMargin(t,e,n,o),g=this._allDistMargin(t,e,n,l);u<g&&t.children.sort(o)}_allDistMargin(t,e,n,o){t.children.sort(o);const l=this.toBBox,u=so(t,0,e,l),g=so(t,n-e,n,l);let x=ha(u)+ha(g);for(let E=e;E<n-e;E++){const w=t.children[E];ro(u,t.leaf?l(w):w),x+=ha(u)}for(let E=n-e-1;E>=e;E--){const w=t.children[E];ro(g,t.leaf?l(w):w),x+=ha(g)}return x}_adjustParentBBoxes(t,e,n){for(let o=n;o>=0;o--)ro(e[o],t)}_condense(t){for(let e=t.length-1,n;e>=0;e--)t[e].children.length===0?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():yr(t[e],this.toBBox)}};function Fd(r,t,e){if(!e)return t.indexOf(r);for(let n=0;n<t.length;n++)if(e(r,t[n]))return n;return-1}function yr(r,t){so(r,0,r.children.length,t,r)}function so(r,t,e,n,o){o||(o=Ir(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let l=t;l<e;l++){const u=r.children[l];ro(o,r.leaf?n(u):u)}return o}function ro(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r}function Bd(r,t){return r.minX-t.minX}function kd(r,t){return r.minY-t.minY}function kl(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function ha(r){return r.maxX-r.minX+(r.maxY-r.minY)}function Gd(r,t){return(Math.max(t.maxX,r.maxX)-Math.min(t.minX,r.minX))*(Math.max(t.maxY,r.maxY)-Math.min(t.minY,r.minY))}function Ud(r,t){const e=Math.max(r.minX,t.minX),n=Math.max(r.minY,t.minY),o=Math.min(r.maxX,t.maxX),l=Math.min(r.maxY,t.maxY);return Math.max(0,o-e)*Math.max(0,l-n)}function Gl(r,t){return r.minX<=t.minX&&r.minY<=t.minY&&t.maxX<=r.maxX&&t.maxY<=r.maxY}function ca(r,t){return t.minX<=r.maxX&&t.minY<=r.maxY&&t.maxX>=r.minX&&t.maxY>=r.minY}function Ir(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ou(r,t,e,n,o){const l=[t,e];for(;l.length;){if(e=l.pop(),t=l.pop(),e-t<=n)continue;const u=t+Math.ceil((e-t)/n/2)*n;Dd(r,u,t,e,o),l.push(t,u,u,e)}}function au(r,t,e,n){return e!==void 0&&n!==void 0?[e/r,n/t]:e!==void 0?e/r:n!==void 0?n/t:1}class il extends qa{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,o=t.scale!==void 0?t.scale:1,l=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:o,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:l,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const u=t.img!==void 0?t.img:null;let g=t.src;pe(!(g!==void 0&&u),"`image` and `src` cannot be provided at the same time"),(g===void 0||g.length===0)&&u&&(g=u.src||be(u)),pe(g!==void 0&&g.length>0,"A defined and non-empty `src` or `image` must be provided"),pe(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let x;if(t.src!==void 0?x=ie.IDLE:u!==void 0&&("complete"in u?u.complete?x=u.src?ie.LOADED:ie.IDLE:x=ie.LOADING:x=ie.LOADED),this.color_=t.color!==void 0?Eo(t.color):null,this.iconImage_=ec(u,g,this.crossOrigin_,x,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let E,w;if(t.size)[E,w]=t.size;else{const A=this.getImage(1);if(A.width&&A.height)E=A.width,w=A.height;else if(A instanceof HTMLImageElement){this.initialOptions_=t;const S=()=>{if(this.unlistenImageChange(S),!this.initialOptions_)return;const P=this.iconImage_.getSize();this.setScale(au(P[0],P[1],t.width,t.height))};this.listenImageChange(S);return}}E!==void 0&&this.setScale(au(E,w,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new il({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const o=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!o)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=o[0]),this.anchorYUnits_=="fraction"&&(t[1]*=o[1])}if(this.anchorOrigin_!="top-left"){if(!o)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+o[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+o[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==ie.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==ie.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(jt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(jt.CHANGE,t)}ready(){return this.iconImage_.ready()}}let hr=0;const Xr=0,$e=1<<hr++,Pt=1<<hr++,nn=1<<hr++,wi=1<<hr++,Un=1<<hr++,uo=1<<hr++,Di=Math.pow(2,hr)-1,L0={[$e]:"boolean",[Pt]:"number",[nn]:"string",[wi]:"color",[Un]:"number[]",[uo]:"size"},zd=Object.keys(L0).map(Number).sort(ss);function ki(r){const t=[];for(const e of zd)Wd(r,e)&&t.push(L0[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Wd(r,t){return(r&t)===t}function zn(r,t){return!!(r&t)}function nl(r,t){return r===t}class Ts{constructor(t,e){this.type=t,this.value=e}}class Xd{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function F0(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function Vd(r){switch(r){case"string":return nn;case"color":return wi;case"number":return Pt;case"boolean":return $e;case"number[]":return Un;default:throw new Error(`Unrecognized type hint: ${r}`)}}function Me(r,t,e){switch(typeof r){case"boolean":return new Ts($e,r);case"number":return new Ts(e===uo?uo:Pt,r);case"string":{let o=nn;return Jf(r)&&(o|=wi),nl(o&e,Xr)||(o&=e),new Ts(o,r)}}if(!Array.isArray(r))throw new Error("Expression must be an array or a primitive value");if(r.length===0)throw new Error("Empty expression");if(typeof r[0]=="string")return ig(r,t,e);for(const o of r)if(typeof o!="number")throw new Error("Expected an array of numbers");let n=Un;return r.length===2?n|=uo:(r.length===3||r.length===4)&&(n|=wi),e&&(n&=e),new Ts(n,r)}const ft={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},Yd={[ft.Get]:Yt(([r,t])=>t!==void 0?Vd(t.value):Di,Jt(1,2),Hd),[ft.Var]:Yt(([r])=>r.type,Jt(1,1),jd),[ft.Id]:Yt(Pt|nn,io,Zd),[ft.Concat]:Yt(nn,Jt(2,1/0),_e(Di)),[ft.GeometryType]:Yt(nn,io,Kd),[ft.Resolution]:Yt(Pt,io),[ft.Zoom]:Yt(Pt,io),[ft.Time]:Yt(Pt,io),[ft.Any]:Yt($e,Jt(2,1/0),_e($e)),[ft.All]:Yt($e,Jt(2,1/0),_e($e)),[ft.Not]:Yt($e,Jt(1,1),_e($e)),[ft.Equal]:Yt($e,Jt(2,2),_e(Di),ys),[ft.NotEqual]:Yt($e,Jt(2,2),_e(Di),ys),[ft.GreaterThan]:Yt($e,Jt(2,2),_e(Di),ys),[ft.GreaterThanOrEqualTo]:Yt($e,Jt(2,2),_e(Di),ys),[ft.LessThan]:Yt($e,Jt(2,2),_e(Di),ys),[ft.LessThanOrEqualTo]:Yt($e,Jt(2,2),_e(Di),ys),[ft.Multiply]:Yt(r=>{let t=Pt|wi;for(let e=0;e<r.length;e++)t&=r[e].type;return t},Jt(2,1/0),_e(Pt|wi),ys),[ft.Coalesce]:Yt(r=>{let t=Di;for(let e=1;e<r.length;e+=2)t&=r[e].type;return t&=r[r.length-1].type,t},Jt(2,1/0),_e(Di),ys),[ft.Divide]:Yt(Pt,Jt(2,2),_e(Pt)),[ft.Add]:Yt(Pt,Jt(2,1/0),_e(Pt)),[ft.Subtract]:Yt(Pt,Jt(2,2),_e(Pt)),[ft.Clamp]:Yt(Pt,Jt(3,3),_e(Pt)),[ft.Mod]:Yt(Pt,Jt(2,2),_e(Pt)),[ft.Pow]:Yt(Pt,Jt(2,2),_e(Pt)),[ft.Abs]:Yt(Pt,Jt(1,1),_e(Pt)),[ft.Floor]:Yt(Pt,Jt(1,1),_e(Pt)),[ft.Ceil]:Yt(Pt,Jt(1,1),_e(Pt)),[ft.Round]:Yt(Pt,Jt(1,1),_e(Pt)),[ft.Sin]:Yt(Pt,Jt(1,1),_e(Pt)),[ft.Cos]:Yt(Pt,Jt(1,1),_e(Pt)),[ft.Atan]:Yt(Pt,Jt(1,2),_e(Pt)),[ft.Sqrt]:Yt(Pt,Jt(1,1),_e(Pt)),[ft.Match]:Yt(r=>{let t=Di;for(let e=2;e<r.length;e+=2)t&=r[e].type;return t&=r[r.length-1].type,t},Jt(4,1/0),lu,Jd),[ft.Between]:Yt($e,Jt(3,3),_e(Pt)),[ft.Interpolate]:Yt(r=>{let t=wi|Pt;for(let e=3;e<r.length;e+=2)t&=r[e].type;return t},Jt(6,1/0),lu,Qd),[ft.Case]:Yt(r=>{let t=Di;for(let e=1;e<r.length;e+=2)t&=r[e].type;return t&=r[r.length-1].type,t},Jt(3,1/0),qd,$d),[ft.In]:Yt($e,Jt(2,2),tg),[ft.Number]:Yt(Pt,Jt(1,1/0),_e(Di)),[ft.String]:Yt(nn,Jt(1,1/0),_e(Di)),[ft.Array]:Yt(r=>r.length===2?Un|uo:r.length===3||r.length===4?Un|wi:Un,Jt(1,1/0),_e(Pt)),[ft.Color]:Yt(wi,Jt(1,4),_e(Pt)),[ft.Band]:Yt(Pt,Jt(1,3),_e(Pt)),[ft.Palette]:Yt(wi,Jt(2,2),eg),[ft.ToString]:Yt(nn,Jt(1,1),_e($e|Pt|nn|wi))};function Hd(r,t){const e=Me(r[1],t);if(!(e instanceof Ts))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),r.length===3){const n=Me(r[2],t);return[e,n]}return[e]}function jd(r,t,e,n){const o=r[1];if(typeof o!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(o),!("variables"in t.style)||t.style.variables[o]===void 0)return[new Ts(Di,o)];const l=t.style.variables[o],u=Me(l,t);if(u.value=o,n&&!zn(n,u.type))throw new Error(`The variable ${o} has type ${ki(u.type)} but the following type was expected: ${ki(n)}`);return[u]}function Zd(r,t){t.featureId=!0}function Kd(r,t){t.geometryType=!0}function io(r,t){const e=r[0];if(r.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function Jt(r,t){return function(e,n){const o=e[0],l=e.length-1;if(r===t){if(l!==r){const u=r===1?"":"s";throw new Error(`Expected ${r} argument${u} for ${o}, got ${l}`)}}else if(l<r||l>t){const u=t===1/0?`${r} or more`:`${r} to ${t}`;throw new Error(`Expected ${u} arguments for ${o}, got ${l}`)}}}function _e(r){return function(t,e){const n=t[0],o=t.length-1,l=new Array(o);for(let u=0;u<o;++u){const g=Me(t[u+1],e);if(!zn(r,g.type)){const x=ki(r),E=ki(g.type);throw new Error(`Unexpected type for argument ${u} of ${n} operation, got ${x} but expected ${E}`)}g.type&=r,l[u]=g}return l}}function ys(r,t,e){const n=r[0],o=r.length-1;let l=Di;for(let g=0;g<e.length;++g)l&=e[g].type;if(l===Xr)throw new Error(`No common type could be found for arguments of ${n} operation`);const u=new Array(o);for(let g=0;g<o;++g)u[g]=Me(r[g+1],t,l);return u}function qd(r,t){const e=r[0],n=r.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function lu(r,t){const e=r[0],n=r.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function Jd(r,t,e,n){const o=r.length-1;let u=Me(r[1],t).type;const g=Me(r[r.length-1],t);let x=n!==void 0?n&g.type:g.type;const E=new Array(o-2);for(let A=0;A<o-2;A+=2){const S=Me(r[A+2],t),P=Me(r[A+3],t);u&=S.type,x&=P.type,E[A]=S,E[A+1]=P}const w=nn|Pt|$e;if(!zn(w,u))throw new Error(`Expected an input of type ${ki(w)} for the interpolate operation, got ${ki(u)} instead`);if(u&=w,nl(x,Xr))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(r));for(let A=0;A<o-2;A+=2){const S=Me(r[A+2],t,u),P=Me(r[A+3],t,x);E[A]=S,E[A+1]=P}return[Me(r[1],t,u),...E,Me(r[r.length-1],t,x)]}function Qd(r,t,e,n){const o=r[1];let l;switch(o[0]){case"linear":l=1;break;case"exponential":if(l=o[1],typeof l!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);break;default:l=null}if(!l)throw new Error(`Invalid interpolation type: ${JSON.stringify(o)}`);l=Me(l,t);let u=Me(r[2],t);if(!zn(Pt,u.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${ki(u.type)} instead`);u=Me(r[2],t,Pt);const g=new Array(r.length-3);for(let x=0;x<g.length;x+=2){let E=Me(r[x+3],t);if(!zn(Pt,E.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${ki(E.type)} at position ${x+2} instead`);let w=Me(r[x+4],t);if(!zn(Pt|wi,w.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${ki(w.type)} at position ${x+3} instead`);E=Me(r[x+3],t,Pt),w=Me(r[x+4],t,Pt|wi),g[x]=E,g[x+1]=w}return[l,u,...g]}function $d(r,t,e,n){const o=Me(r[r.length-1],t,n);let l=n!==void 0?n&o.type:o.type;const u=new Array(r.length-1);for(let g=0;g<u.length-1;g+=2){const x=Me(r[g+1],t),E=Me(r[g+2],t,n);if(!zn($e,x.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${ki(x.type)} at position ${g} instead`);l&=E.type,u[g]=x,u[g+1]=E}if(nl(l,Xr))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(r));for(let g=0;g<u.length-1;g+=2)u[g+1]=Me(r[g+2],t,l);return u[u.length-1]=Me(r[r.length-1],t,l),u}function tg(r,t){let e=r[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let n=nn|Pt;const o=new Array(e.length);for(let u=0;u<o.length;u++){const g=Me(e[u],t);n&=g.type,o[u]=g}if(nl(n,Xr))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(r));return[Me(r[1],t,n),...o]}function eg(r,t){const e=Me(r[1],t,Pt);if(e.type!==Pt)throw new Error(`The first argument of palette must be an number, got ${ki(e.type)} instead`);const n=r[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const o=new Array(n.length);for(let l=0;l<o.length;l++){const u=Me(n[l],t,wi);if(!(u instanceof Ts))throw new Error(`The palette color at index ${l} must be a literal value`);if(!zn(u.type,wi))throw new Error(`The palette color at index ${l} should be of type color, got ${ki(u.type)} instead`);o[l]=u}return[e,...o]}function Yt(r,...t){return function(e,n,o){const l=e[0];let u=[];for(let x=0;x<t.length;x++)u=t[x](e,n,u,o)||u;let g=typeof r=="function"?r(u):r;if(o!==void 0){if(!zn(g,o))throw new Error(`The following expression was expected to return ${ki(o)}, but returns ${ki(g)} instead: ${JSON.stringify(e)}`);g&=o}if(g===Xr)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new Xd(g,l,...u)}}function ig(r,t,e){const n=r[0],o=Yd[n];if(!o)throw new Error(`Unknown operator: ${n}`);return o(r,t,e)}function B0(r){if(!r)return"";const t=r.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return B0(r.getGeometries()[0]);default:return""}}function k0(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function cs(r,t,e){const n=Me(r,e);if(!zn(t,n.type)){const o=ki(t),l=ki(n.type);throw new Error(`Expected expression to be of type ${o}, got ${l}`)}return Sn(n)}function Sn(r,t){if(r instanceof Ts){if(r.type===wi&&typeof r.value=="string"){const n=$h(r.value);return function(){return n}}return function(){return r.value}}const e=r.operator;switch(e){case ft.Number:case ft.String:case ft.Coalesce:return ng(r);case ft.Get:case ft.Var:return sg(r);case ft.Id:return n=>n.featureId;case ft.GeometryType:return n=>n.geometryType;case ft.Concat:{const n=r.args.map(o=>Sn(o));return o=>"".concat(...n.map(l=>l(o).toString()))}case ft.Resolution:return n=>n.resolution;case ft.Any:case ft.All:case ft.Between:case ft.In:case ft.Not:return og(r);case ft.Equal:case ft.NotEqual:case ft.LessThan:case ft.LessThanOrEqualTo:case ft.GreaterThan:case ft.GreaterThanOrEqualTo:return rg(r);case ft.Multiply:case ft.Divide:case ft.Add:case ft.Subtract:case ft.Clamp:case ft.Mod:case ft.Pow:case ft.Abs:case ft.Floor:case ft.Ceil:case ft.Round:case ft.Sin:case ft.Cos:case ft.Atan:case ft.Sqrt:return ag(r);case ft.Case:return lg(r);case ft.Match:return hg(r);case ft.Interpolate:return cg(r);case ft.ToString:return ug(r);default:throw new Error(`Unsupported operator ${e}`)}}function ng(r,t){const e=r.operator,n=r.args.length,o=new Array(n);for(let l=0;l<n;++l)o[l]=Sn(r.args[l]);switch(e){case ft.Coalesce:return l=>{for(let u=0;u<n;++u){const g=o[u](l);if(typeof g<"u"&&g!==null)return g}throw new Error("Expected one of the values to be non-null")};case ft.Number:case ft.String:return l=>{for(let u=0;u<n;++u){const g=o[u](l);if(typeof g===e)return g}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function sg(r,t){const n=r.args[0].value;switch(r.operator){case ft.Get:return o=>o.properties[n];case ft.Var:return o=>o.variables[n];default:throw new Error(`Unsupported accessor operator ${r.operator}`)}}function rg(r,t){const e=r.operator,n=Sn(r.args[0]),o=Sn(r.args[1]);switch(e){case ft.Equal:return l=>n(l)===o(l);case ft.NotEqual:return l=>n(l)!==o(l);case ft.LessThan:return l=>n(l)<o(l);case ft.LessThanOrEqualTo:return l=>n(l)<=o(l);case ft.GreaterThan:return l=>n(l)>o(l);case ft.GreaterThanOrEqualTo:return l=>n(l)>=o(l);default:throw new Error(`Unsupported comparison operator ${e}`)}}function og(r,t){const e=r.operator,n=r.args.length,o=new Array(n);for(let l=0;l<n;++l)o[l]=Sn(r.args[l]);switch(e){case ft.Any:return l=>{for(let u=0;u<n;++u)if(o[u](l))return!0;return!1};case ft.All:return l=>{for(let u=0;u<n;++u)if(!o[u](l))return!1;return!0};case ft.Between:return l=>{const u=o[0](l),g=o[1](l),x=o[2](l);return u>=g&&u<=x};case ft.In:return l=>{const u=o[0](l);for(let g=1;g<n;++g)if(u===o[g](l))return!0;return!1};case ft.Not:return l=>!o[0](l);default:throw new Error(`Unsupported logical operator ${e}`)}}function ag(r,t){const e=r.operator,n=r.args.length,o=new Array(n);for(let l=0;l<n;++l)o[l]=Sn(r.args[l]);switch(e){case ft.Multiply:return l=>{let u=1;for(let g=0;g<n;++g)u*=o[g](l);return u};case ft.Divide:return l=>o[0](l)/o[1](l);case ft.Add:return l=>{let u=0;for(let g=0;g<n;++g)u+=o[g](l);return u};case ft.Subtract:return l=>o[0](l)-o[1](l);case ft.Clamp:return l=>{const u=o[0](l),g=o[1](l);if(u<g)return g;const x=o[2](l);return u>x?x:u};case ft.Mod:return l=>o[0](l)%o[1](l);case ft.Pow:return l=>Math.pow(o[0](l),o[1](l));case ft.Abs:return l=>Math.abs(o[0](l));case ft.Floor:return l=>Math.floor(o[0](l));case ft.Ceil:return l=>Math.ceil(o[0](l));case ft.Round:return l=>Math.round(o[0](l));case ft.Sin:return l=>Math.sin(o[0](l));case ft.Cos:return l=>Math.cos(o[0](l));case ft.Atan:return n===2?l=>Math.atan2(o[0](l),o[1](l)):l=>Math.atan(o[0](l));case ft.Sqrt:return l=>Math.sqrt(o[0](l));default:throw new Error(`Unsupported numeric operator ${e}`)}}function lg(r,t){const e=r.args.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=Sn(r.args[o]);return o=>{for(let l=0;l<e-1;l+=2)if(n[l](o))return n[l+1](o);return n[e-1](o)}}function hg(r,t){const e=r.args.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=Sn(r.args[o]);return o=>{const l=n[0](o);for(let u=1;u<e;u+=2)if(l===n[u](o))return n[u+1](o);return n[e-1](o)}}function cg(r,t){const e=r.args.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=Sn(r.args[o]);return o=>{const l=n[0](o),u=n[1](o);let g,x;for(let E=2;E<e;E+=2){const w=n[E](o);let A=n[E+1](o);const S=Array.isArray(A);if(S&&(A=Kf(A)),w>=u)return E===2?A:S?fg(l,u,g,x,w,A):oo(l,u,g,x,w,A);g=w,x=A}return x}}function ug(r,t){const e=r.operator,n=r.args.length,o=new Array(n);for(let l=0;l<n;++l)o[l]=Sn(r.args[l]);switch(e){case ft.ToString:return l=>{const u=o[0](l);return r.args[0].type===wi?tc(u):u.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function oo(r,t,e,n,o,l){const u=o-e;if(u===0)return n;const g=t-e,x=r===1?g/u:(Math.pow(r,g)-1)/(Math.pow(r,u)-1);return n+x*(l-n)}function fg(r,t,e,n,o,l){if(o-e===0)return n;const g=qc(n),x=qc(l);let E=x[2]-g[2];E>180?E-=360:E<-180&&(E+=360);const w=[oo(r,t,e,g[0],o,x[0]),oo(r,t,e,g[1],o,x[1]),g[2]+oo(r,t,e,0,o,E),oo(r,t,e,n[3],o,l[3])];return y0(qf(w))}function dg(r){return!0}function gg(r){const t=F0(),e=mg(r,t),n=k0();return function(o,l){if(n.properties=o.getPropertiesInternal(),n.resolution=l,t.featureId){const u=o.getId();u!==void 0?n.featureId=u:n.featureId=null}return t.geometryType&&(n.geometryType=B0(o.getGeometry())),e(n)}}function hu(r){const t=F0(),e=r.length,n=new Array(e);for(let u=0;u<e;++u)n[u]=_h(r[u],t);const o=k0(),l=new Array(e);return function(u,g){if(o.properties=u.getPropertiesInternal(),o.resolution=g,t.featureId){const E=u.getId();E!==void 0?o.featureId=E:o.featureId=null}let x=0;for(let E=0;E<e;++E){const w=n[E](o);w&&(l[x]=w,x+=1)}return l.length=x,l}}function mg(r,t){const e=r.length,n=new Array(e);for(let o=0;o<e;++o){const l=r[o],u="filter"in l?cs(l.filter,$e,t):dg;let g;if(Array.isArray(l.style)){const x=l.style.length;g=new Array(x);for(let E=0;E<x;++E)g[E]=_h(l.style[E],t)}else g=[_h(l.style,t)];n[o]={filter:u,styles:g}}return function(o){const l=[];let u=!1;for(let g=0;g<e;++g){const x=n[g].filter;if(x(o)&&!(r[g].else&&u)){u=!0;for(const E of n[g].styles){const w=E(o);w&&l.push(w)}}}return l}}function _h(r,t){const e=bo(r,"",t),n=To(r,"",t),o=xg(r,t),l=_g(r,t),u=Ki(r,"z-index",t);if(!e&&!n&&!o&&!l&&!er(r))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(r));const g=new ya;return function(x){let E=!0;if(e){const w=e(x);w&&(E=!1),g.setFill(w)}if(n){const w=n(x);w&&(E=!1),g.setStroke(w)}if(o){const w=o(x);w&&(E=!1),g.setText(w)}if(l){const w=l(x);w&&(E=!1),g.setImage(w)}return u&&g.setZIndex(u(x)),E?null:g}}function bo(r,t,e){let n;if(t+"fill-pattern-src"in r?n=Eg(r,t+"fill-",e):n=hc(r,t+"fill-color",e),!n)return null;const o=new Bo;return function(l){const u=n(l);return u==="none"?null:(o.setColor(u),o)}}function To(r,t,e){const n=Ki(r,t+"stroke-width",e),o=hc(r,t+"stroke-color",e);if(!n&&!o)return null;const l=ns(r,t+"stroke-line-cap",e),u=ns(r,t+"stroke-line-join",e),g=G0(r,t+"stroke-line-dash",e),x=Ki(r,t+"stroke-line-dash-offset",e),E=Ki(r,t+"stroke-miter-limit",e),w=new Ka;return function(A){if(o){const S=o(A);if(S==="none")return null;w.setColor(S)}if(n&&w.setWidth(n(A)),l){const S=l(A);if(S!=="butt"&&S!=="round"&&S!=="square")throw new Error("Expected butt, round, or square line cap");w.setLineCap(S)}if(u){const S=u(A);if(S!=="bevel"&&S!=="round"&&S!=="miter")throw new Error("Expected bevel, round, or miter line join");w.setLineJoin(S)}return g&&w.setLineDash(g(A)),x&&w.setLineDashOffset(x(A)),E&&w.setMiterLimit(E(A)),w}}function xg(r,t){const e="text-",n=ns(r,e+"value",t);if(!n)return null;const o=bo(r,e,t),l=bo(r,e+"background-",t),u=To(r,e,t),g=To(r,e+"background-",t),x=ns(r,e+"font",t),E=Ki(r,e+"max-angle",t),w=Ki(r,e+"offset-x",t),A=Ki(r,e+"offset-y",t),S=So(r,e+"overflow",t),P=ns(r,e+"placement",t),L=Ki(r,e+"repeat",t),F=sl(r,e+"scale",t),V=So(r,e+"rotate-with-view",t),z=Ki(r,e+"rotation",t),U=ns(r,e+"align",t),Y=ns(r,e+"justify",t),Z=ns(r,e+"baseline",t),$=G0(r,e+"padding",t),ot=rl(r,e+"declutter-mode"),X=new nc({declutterMode:ot});return function(J){if(X.setText(n(J)),o&&X.setFill(o(J)),l&&X.setBackgroundFill(l(J)),u&&X.setStroke(u(J)),g&&X.setBackgroundStroke(g(J)),x&&X.setFont(x(J)),E&&X.setMaxAngle(E(J)),w&&X.setOffsetX(w(J)),A&&X.setOffsetY(A(J)),S&&X.setOverflow(S(J)),P){const H=P(J);if(H!=="point"&&H!=="line")throw new Error("Expected point or line for text-placement");X.setPlacement(H)}if(L&&X.setRepeat(L(J)),F&&X.setScale(F(J)),V&&X.setRotateWithView(V(J)),z&&X.setRotation(z(J)),U){const H=U(J);if(H!=="left"&&H!=="center"&&H!=="right"&&H!=="end"&&H!=="start")throw new Error("Expected left, right, center, start, or end for text-align");X.setTextAlign(H)}if(Y){const H=Y(J);if(H!=="left"&&H!=="right"&&H!=="center")throw new Error("Expected left, right, or center for text-justify");X.setJustify(H)}if(Z){const H=Z(J);if(H!=="bottom"&&H!=="top"&&H!=="middle"&&H!=="alphabetic"&&H!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");X.setTextBaseline(H)}return $&&X.setPadding($(J)),X}}function _g(r,t){return"icon-src"in r?pg(r,t):"shape-points"in r?yg(r,t):"circle-radius"in r?wg(r,t):null}function pg(r,t){const e="icon-",n=e+"src",o=U0(r[n],n),l=Sa(r,e+"anchor",t),u=sl(r,e+"scale",t),g=Ki(r,e+"opacity",t),x=Sa(r,e+"displacement",t),E=Ki(r,e+"rotation",t),w=So(r,e+"rotate-with-view",t),A=uu(r,e+"anchor-origin"),S=fu(r,e+"anchor-x-units"),P=fu(r,e+"anchor-y-units"),L=Mg(r,e+"color"),F=Ag(r,e+"cross-origin"),V=Ig(r,e+"offset"),z=uu(r,e+"offset-origin"),U=Ra(r,e+"width"),Y=Ra(r,e+"height"),Z=Cg(r,e+"size"),$=rl(r,e+"declutter-mode"),ot=new il({src:o,anchorOrigin:A,anchorXUnits:S,anchorYUnits:P,color:L,crossOrigin:F,offset:V,offsetOrigin:z,height:Y,width:U,size:Z,declutterMode:$});return function(X){return g&&ot.setOpacity(g(X)),x&&ot.setDisplacement(x(X)),E&&ot.setRotation(E(X)),w&&ot.setRotateWithView(w(X)),u&&ot.setScale(u(X)),l&&ot.setAnchor(l(X)),ot}}function yg(r,t){const e="shape-",n=e+"points",o=e+"radius",l=ph(r[n],n),u=ph(r[o],o),g=bo(r,e,t),x=To(r,e,t),E=sl(r,e+"scale",t),w=Sa(r,e+"displacement",t),A=Ki(r,e+"rotation",t),S=So(r,e+"rotate-with-view",t),P=Ra(r,e+"radius2"),L=Ra(r,e+"angle"),F=rl(r,e+"declutter-mode"),V=new Qa({points:l,radius:u,radius2:P,angle:L,declutterMode:F});return function(z){return g&&V.setFill(g(z)),x&&V.setStroke(x(z)),w&&V.setDisplacement(w(z)),A&&V.setRotation(A(z)),S&&V.setRotateWithView(S(z)),E&&V.setScale(E(z)),V}}function wg(r,t){const e="circle-",n=bo(r,e,t),o=To(r,e,t),l=Ki(r,e+"radius",t),u=sl(r,e+"scale",t),g=Sa(r,e+"displacement",t),x=Ki(r,e+"rotation",t),E=So(r,e+"rotate-with-view",t),w=rl(r,e+"declutter-mode"),A=new $a({radius:5,declutterMode:w});return function(S){return l&&A.setRadius(l(S)),n&&A.setFill(n(S)),o&&A.setStroke(o(S)),g&&A.setDisplacement(g(S)),x&&A.setRotation(x(S)),E&&A.setRotateWithView(E(S)),u&&A.setScale(u(S)),A}}function Ki(r,t,e){if(!(t in r))return;const n=cs(r[t],Pt,e);return function(o){return ph(n(o),t)}}function ns(r,t,e){if(!(t in r))return null;const n=cs(r[t],nn,e);return function(o){return U0(n(o),t)}}function Eg(r,t,e){const n=ns(r,t+"pattern-src",e),o=cu(r,t+"pattern-offset",e),l=cu(r,t+"pattern-size",e),u=hc(r,t+"color",e);return function(g){return{src:n(g),offset:o&&o(g),size:l&&l(g),color:u&&u(g)}}}function So(r,t,e){if(!(t in r))return null;const n=cs(r[t],$e,e);return function(o){const l=n(o);if(typeof l!="boolean")throw new Error(`Expected a boolean for ${t}`);return l}}function hc(r,t,e){if(!(t in r))return null;const n=cs(r[t],wi|nn,e);return function(o){return z0(n(o),t)}}function G0(r,t,e){if(!(t in r))return null;const n=cs(r[t],Un,e);return function(o){return ko(n(o),t)}}function Sa(r,t,e){if(!(t in r))return null;const n=cs(r[t],Un,e);return function(o){const l=ko(n(o),t);if(l.length!==2)throw new Error(`Expected two numbers for ${t}`);return l}}function cu(r,t,e){if(!(t in r))return null;const n=cs(r[t],Un,e);return function(o){return W0(n(o),t)}}function sl(r,t,e){if(!(t in r))return null;const n=cs(r[t],Un|Pt,e);return function(o){return bg(n(o),t)}}function Ra(r,t){const e=r[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function Cg(r,t){const e=r[t];if(e!==void 0){if(typeof e=="number")return sn(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Ag(r,t){const e=r[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function uu(r,t){const e=r[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function fu(r,t){const e=r[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Ig(r,t){const e=r[t];if(e!==void 0)return ko(e,t)}function rl(r,t){const e=r[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Mg(r,t){const e=r[t];if(e!==void 0)return z0(e,t)}function ko(r,t){if(!Array.isArray(r))throw new Error(`Expected an array for ${t}`);const e=r.length;for(let n=0;n<e;++n)if(typeof r[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return r}function U0(r,t){if(typeof r!="string")throw new Error(`Expected a string for ${t}`);return r}function ph(r,t){if(typeof r!="number")throw new Error(`Expected a number for ${t}`);return r}function z0(r,t){if(typeof r=="string")return r;const e=ko(r,t),n=e.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function W0(r,t){const e=ko(r,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function bg(r,t){return typeof r=="number"?r:W0(r,t)}const du={RENDER_ORDER:"renderOrder"};class X0 extends el{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(du.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new D0(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(du.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?v0:t;const e=Tg(t);this.styleFunction_=t===null?void 0:yd(e),this.changed()}}function Tg(r){if(r===void 0)return v0;if(!r)return null;if(typeof r=="function"||r instanceof ya)return r;if(!Array.isArray(r))return hu([r]);if(r.length===0)return[];const t=r.length,e=r[0];if(e instanceof ya){const o=new Array(t);for(let l=0;l<t;++l){const u=r[l];if(!(u instanceof ya))throw new Error("Expected a list of style instances");o[l]=u}return o}if("style"in e){const o=new Array(t);for(let l=0;l<t;++l){const u=r[l];if(!("style"in u))throw new Error("Expected a list of rules with a style property");o[l]=u}return gg(o)}return hu(r)}const Bt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ua=[Bt.FILL],Ss=[Bt.STROKE],Qs=[Bt.BEGIN_PATH],gu=[Bt.CLOSE_PATH];class V0{drawCustom(t,e,n,o,l){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class Go extends V0{constructor(t,e,n,o){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=o,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})}appendFlatPointCoordinates(t,e){const n=this.getBufferedMaxExtent(),o=this.tmpCoordinate_,l=this.coordinates;let u=l.length;for(let g=0,x=t.length;g<x;g+=e)o[0]=t[g],o[1]=t[g+1],Dr(n,o)&&(l[u++]=o[0],l[u++]=o[1]);return u}appendFlatLineCoordinates(t,e,n,o,l,u){const g=this.coordinates;let x=g.length;const E=this.getBufferedMaxExtent();u&&(e+=o);let w=t[e],A=t[e+1];const S=this.tmpCoordinate_;let P=!0,L,F,V;for(L=e+o;L<n;L+=o)S[0]=t[L],S[1]=t[L+1],V=sh(E,S),V!==F?(P&&(g[x++]=w,g[x++]=A,P=!1),g[x++]=S[0],g[x++]=S[1]):V===yi.INTERSECTING?(g[x++]=S[0],g[x++]=S[1],P=!1):P=!0,w=S[0],A=S[1],F=V;return(l&&P||L===e+o)&&(g[x++]=w,g[x++]=A),x}drawCustomCoordinates_(t,e,n,o,l){for(let u=0,g=n.length;u<g;++u){const x=n[u],E=this.appendFlatLineCoordinates(t,e,x,o,!1,!1);l.push(E),e=x}return e}drawCustom(t,e,n,o,l){this.beginGeometry(t,e,l);const u=t.getType(),g=t.getStride(),x=this.coordinates.length;let E,w,A,S,P;switch(u){case"MultiPolygon":E=t.getOrientedFlatCoordinates(),S=[];const L=t.getEndss();P=0;for(let F=0,V=L.length;F<V;++F){const z=[];P=this.drawCustomCoordinates_(E,P,L[F],g,z),S.push(z)}this.instructions.push([Bt.CUSTOM,x,S,t,n,fh,l]),this.hitDetectionInstructions.push([Bt.CUSTOM,x,S,t,o||n,fh,l]);break;case"Polygon":case"MultiLineString":A=[],E=u=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),P=this.drawCustomCoordinates_(E,0,t.getEnds(),g,A),this.instructions.push([Bt.CUSTOM,x,A,t,n,po,l]),this.hitDetectionInstructions.push([Bt.CUSTOM,x,A,t,o||n,po,l]);break;case"LineString":case"Circle":E=t.getFlatCoordinates(),w=this.appendFlatLineCoordinates(E,0,E.length,g,!1,!1),this.instructions.push([Bt.CUSTOM,x,w,t,n,bs,l]),this.hitDetectionInstructions.push([Bt.CUSTOM,x,w,t,o||n,bs,l]);break;case"MultiPoint":E=t.getFlatCoordinates(),w=this.appendFlatPointCoordinates(E,g),w>x&&(this.instructions.push([Bt.CUSTOM,x,w,t,n,bs,l]),this.hitDetectionInstructions.push([Bt.CUSTOM,x,w,t,o||n,bs,l]));break;case"Point":E=t.getFlatCoordinates(),this.coordinates.push(E[0],E[1]),w=this.coordinates.length,this.instructions.push([Bt.CUSTOM,x,w,t,n,void 0,l]),this.hitDetectionInstructions.push([Bt.CUSTOM,x,w,t,o||n,void 0,l]);break}this.endGeometry(e)}beginGeometry(t,e,n){this.beginGeometryInstruction1_=[Bt.BEGIN_GEOMETRY,e,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Bt.BEGIN_GEOMETRY,e,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const n=t.length;let o,l,u=-1;for(e=0;e<n;++e)o=t[e],l=o[0],l==Bt.END_GEOMETRY?u=e:l==Bt.BEGIN_GEOMETRY&&(o[2]=e,Z1(this.hitDetectionInstructions,u,e),u=-1)}setFillStrokeStyle(t,e){const n=this.state;if(t){const o=t.getColor();n.fillPatternScale=o&&typeof o=="object"&&"src"in o?this.pixelRatio:1,n.fillStyle=Gn(o||ji)}else n.fillStyle=void 0;if(e){const o=e.getColor();n.strokeStyle=Gn(o||Ao);const l=e.getLineCap();n.lineCap=l!==void 0?l:Fr;const u=e.getLineDash();n.lineDash=u?u.slice():rs;const g=e.getLineDashOffset();n.lineDashOffset=g||os;const x=e.getLineJoin();n.lineJoin=x!==void 0?x:Br;const E=e.getWidth();n.lineWidth=E!==void 0?E:Mo;const w=e.getMiterLimit();n.miterLimit=w!==void 0?w:Co,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(t){const e=t.fillStyle,n=[Bt.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[Bt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,e){const n=t.strokeStyle,o=t.lineCap,l=t.lineDash,u=t.lineDashOffset,g=t.lineJoin,x=t.lineWidth,E=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=o||l!=t.currentLineDash&&!Ls(t.currentLineDash,l)||t.currentLineDashOffset!=u||t.currentLineJoin!=g||t.currentLineWidth!=x||t.currentMiterLimit!=E)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=o,t.currentLineDash=l,t.currentLineDashOffset=u,t.currentLineJoin=g,t.currentLineWidth=x,t.currentMiterLimit=E)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[Bt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Zu(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Dh(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Sg extends Go{constructor(t,e,n,o){super(t,e,n,o),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,n){if(!this.image_||this.maxExtent&&!Dr(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,n);const o=t.getFlatCoordinates(),l=t.getStride(),u=this.coordinates.length,g=this.appendFlatPointCoordinates(o,l);this.instructions.push([Bt.DRAW_IMAGE,u,g,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Bt.DRAW_IMAGE,u,g,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,n){if(!this.image_)return;this.beginGeometry(t,e,n);const o=t.getFlatCoordinates(),l=[];for(let x=0,E=o.length;x<E;x+=t.getStride())(!this.maxExtent||Dr(this.maxExtent,o.slice(x,x+2)))&&l.push(o[x],o[x+1]);const u=this.coordinates.length,g=this.appendFlatPointCoordinates(l,2);this.instructions.push([Bt.DRAW_IMAGE,u,g,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Bt.DRAW_IMAGE,u,g,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const n=t.getAnchor(),o=t.getSize(),l=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=o[1],this.opacity_=t.getOpacity(),this.originX_=l[0],this.originY_=l[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=o[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Rg=Sg;class vg extends Go{constructor(t,e,n,o){super(t,e,n,o)}drawFlatCoordinates_(t,e,n,o){const l=this.coordinates.length,u=this.appendFlatLineCoordinates(t,e,n,o,!1,!1),g=[Bt.MOVE_TO_LINE_TO,l,u];return this.instructions.push(g),this.hitDetectionInstructions.push(g),n}drawLineString(t,e,n){const o=this.state,l=o.strokeStyle,u=o.lineWidth;if(l===void 0||u===void 0)return;this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([Bt.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,rs,os],Qs);const g=t.getFlatCoordinates(),x=t.getStride();this.drawFlatCoordinates_(g,0,g.length,x),this.hitDetectionInstructions.push(Ss),this.endGeometry(e)}drawMultiLineString(t,e,n){const o=this.state,l=o.strokeStyle,u=o.lineWidth;if(l===void 0||u===void 0)return;this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([Bt.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,rs,os],Qs);const g=t.getEnds(),x=t.getFlatCoordinates(),E=t.getStride();let w=0;for(let A=0,S=g.length;A<S;++A)w=this.drawFlatCoordinates_(x,w,g[A],E);this.hitDetectionInstructions.push(Ss),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Ss),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Ss),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Qs)}}const Og=vg;class Ng extends Go{constructor(t,e,n,o){super(t,e,n,o)}drawFlatCoordinatess_(t,e,n,o){const l=this.state,u=l.fillStyle!==void 0,g=l.strokeStyle!==void 0,x=n.length;this.instructions.push(Qs),this.hitDetectionInstructions.push(Qs);for(let E=0;E<x;++E){const w=n[E],A=this.coordinates.length,S=this.appendFlatLineCoordinates(t,e,w,o,!0,!g),P=[Bt.MOVE_TO_LINE_TO,A,S];this.instructions.push(P),this.hitDetectionInstructions.push(P),g&&(this.instructions.push(gu),this.hitDetectionInstructions.push(gu)),e=w}return u&&(this.instructions.push(ua),this.hitDetectionInstructions.push(ua)),g&&(this.instructions.push(Ss),this.hitDetectionInstructions.push(Ss)),e}drawCircle(t,e,n){const o=this.state,l=o.fillStyle,u=o.strokeStyle;if(l===void 0&&u===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_FILL_STYLE,ji]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,rs,os]);const g=t.getFlatCoordinates(),x=t.getStride(),E=this.coordinates.length;this.appendFlatLineCoordinates(g,0,g.length,x,!1,!1);const w=[Bt.CIRCLE,E];this.instructions.push(Qs,w),this.hitDetectionInstructions.push(Qs,w),o.fillStyle!==void 0&&(this.instructions.push(ua),this.hitDetectionInstructions.push(ua)),o.strokeStyle!==void 0&&(this.instructions.push(Ss),this.hitDetectionInstructions.push(Ss)),this.endGeometry(e)}drawPolygon(t,e,n){const o=this.state,l=o.fillStyle,u=o.strokeStyle;if(l===void 0&&u===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_FILL_STYLE,ji]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,rs,os]);const g=t.getEnds(),x=t.getOrientedFlatCoordinates(),E=t.getStride();this.drawFlatCoordinatess_(x,0,g,E),this.endGeometry(e)}drawMultiPolygon(t,e,n){const o=this.state,l=o.fillStyle,u=o.strokeStyle;if(l===void 0&&u===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_FILL_STYLE,ji]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,rs,os]);const g=t.getEndss(),x=t.getOrientedFlatCoordinates(),E=t.getStride();let w=0;for(let A=0,S=g.length;A<S;++A)w=this.drawFlatCoordinatess_(x,w,g[A],E);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let n=0,o=e.length;n<o;++n)e[n]=Hs(e[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const mu=Ng;function Pg(r,t,e,n,o){const l=[];let u=e,g=0,x=t.slice(e,2);for(;g<r&&u+o<n;){const[E,w]=x.slice(-2),A=t[u+o],S=t[u+o+1],P=Math.sqrt((A-E)*(A-E)+(S-w)*(S-w));if(g+=P,g>=r){const L=(r-g+P)/P,F=en(E,A,L),V=en(w,S,L);x.push(F,V),l.push(x),x=[F,V],g==r&&(u+=o),g=0}else if(g<r)x.push(t[u+o],t[u+o+1]),u+=o;else{const L=P-g,F=en(E,A,L/P),V=en(w,S,L/P);x.push(F,V),l.push(x),x=[F,V],g=0,u+=o}}return g>0&&l.push(x),l}function Dg(r,t,e,n,o){let l=e,u=e,g=0,x=0,E=e,w,A,S,P,L,F,V,z,U,Y;for(A=e;A<n;A+=o){const Z=t[A],$=t[A+1];L!==void 0&&(U=Z-L,Y=$-F,P=Math.sqrt(U*U+Y*Y),V!==void 0&&(x+=S,w=Math.acos((V*U+z*Y)/(S*P)),w>r&&(x>g&&(g=x,l=E,u=A),x=0,E=A-o)),S=P,V=U,z=Y),L=Z,F=$}return x+=P,x>g?[E,A]:[l,u]}const va={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Lg extends Go{constructor(t,e,n,o){super(t,e,n,o),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[ji]={fillStyle:ji},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,n){const o=this.textFillState_,l=this.textStrokeState_,u=this.textState_;if(this.text_===""||!u||!o&&!l)return;const g=this.coordinates;let x=g.length;const E=t.getType();let w=null,A=t.getStride();if(u.placement==="line"&&(E=="LineString"||E=="MultiLineString"||E=="Polygon"||E=="MultiPolygon")){if(!Zi(this.maxExtent,t.getExtent()))return;let S;if(w=t.getFlatCoordinates(),E=="LineString")S=[w.length];else if(E=="MultiLineString")S=t.getEnds();else if(E=="Polygon")S=t.getEnds().slice(0,1);else if(E=="MultiPolygon"){const V=t.getEndss();S=[];for(let z=0,U=V.length;z<U;++z)S.push(V[z][0])}this.beginGeometry(t,e,n);const P=u.repeat,L=P?void 0:u.textAlign;let F=0;for(let V=0,z=S.length;V<z;++V){let U;P?U=Pg(P*this.resolution,w,F,S[V],A):U=[w.slice(F,S[V])];for(let Y=0,Z=U.length;Y<Z;++Y){const $=U[Y];let ot=0,X=$.length;if(L==null){const H=Dg(u.maxAngle,$,0,$.length,2);ot=H[0],X=H[1]}for(let H=ot;H<X;H+=A)g.push($[H],$[H+1]);const J=g.length;F=S[V],this.drawChars_(x,J),x=J}}this.endGeometry(e)}else{let S=u.overflow?null:[];switch(E){case"Point":case"MultiPoint":w=t.getFlatCoordinates();break;case"LineString":w=t.getFlatMidpoint();break;case"Circle":w=t.getCenter();break;case"MultiLineString":w=t.getFlatMidpoints(),A=2;break;case"Polygon":w=t.getFlatInteriorPoint(),u.overflow||S.push(w[2]/this.resolution),A=3;break;case"MultiPolygon":const U=t.getFlatInteriorPoints();w=[];for(let Y=0,Z=U.length;Y<Z;Y+=3)u.overflow||S.push(U[Y+2]/this.resolution),w.push(U[Y],U[Y+1]);if(w.length===0)return;A=2;break}const P=this.appendFlatPointCoordinates(w,A);if(P===x)return;if(S&&(P-x)/2!==w.length/A){let U=x/2;S=S.filter((Y,Z)=>{const $=g[(U+Z)*2]===w[Z*A]&&g[(U+Z)*2+1]===w[Z*A+1];return $||--U,$})}this.saveTextStates_(),(u.backgroundFill||u.backgroundStroke)&&(this.setFillStrokeStyle(u.backgroundFill,u.backgroundStroke),u.backgroundFill&&this.updateFillStyle(this.state,this.createFill),u.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,n);let L=u.padding;if(L!=Js&&(u.scale[0]<0||u.scale[1]<0)){let U=u.padding[0],Y=u.padding[1],Z=u.padding[2],$=u.padding[3];u.scale[0]<0&&(Y=-Y,$=-$),u.scale[1]<0&&(U=-U,Z=-Z),L=[U,Y,Z,$]}const F=this.pixelRatio;this.instructions.push([Bt.DRAW_IMAGE,x,P,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,L==Js?Js:L.map(function(U){return U*F}),!!u.backgroundFill,!!u.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,S]);const V=1/F,z=this.state.fillStyle;u.backgroundFill&&(this.state.fillStyle=ji,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([Bt.DRAW_IMAGE,x,P,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[V,V],NaN,this.declutterMode_,this.declutterImageWithText_,L,!!u.backgroundFill,!!u.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?ji:this.fillKey_,this.textOffsetX_,this.textOffsetY_,S]),u.backgroundFill&&(this.state.fillStyle=z,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,o=this.strokeKey_;t&&(o in this.strokeStates||(this.strokeStates[o]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const l=this.textKey_;l in this.textStates||(this.textStates[l]={font:e.font,textAlign:e.textAlign||Io,justify:e.justify,textBaseline:e.textBaseline||ba,scale:e.scale});const u=this.fillKey_;n&&(u in this.fillStates||(this.fillStates[u]={fillStyle:n.fillStyle}))}drawChars_(t,e){const n=this.textStrokeState_,o=this.textState_,l=this.strokeKey_,u=this.textKey_,g=this.fillKey_;this.saveTextStates_();const x=this.pixelRatio,E=va[o.textBaseline],w=this.textOffsetY_*x,A=this.text_,S=n?n.lineWidth*Math.abs(o.scale[0])/2:0;this.instructions.push([Bt.DRAW_CHARS,t,e,E,o.overflow,g,o.maxAngle,x,w,l,S*x,A,u,1,this.declutterMode_]),this.hitDetectionInstructions.push([Bt.DRAW_CHARS,t,e,E,o.overflow,g&&ji,o.maxAngle,x,w,l,S*x,A,u,1/x,this.declutterMode_])}setTextStyle(t,e){let n,o,l;if(!t)this.text_="";else{const u=t.getFill();u?(o=this.textFillState_,o||(o={},this.textFillState_=o),o.fillStyle=Gn(u.getColor()||ji)):(o=null,this.textFillState_=o);const g=t.getStroke();if(!g)l=null,this.textStrokeState_=l;else{l=this.textStrokeState_,l||(l={},this.textStrokeState_=l);const L=g.getLineDash(),F=g.getLineDashOffset(),V=g.getWidth(),z=g.getMiterLimit();l.lineCap=g.getLineCap()||Fr,l.lineDash=L?L.slice():rs,l.lineDashOffset=F===void 0?os:F,l.lineJoin=g.getLineJoin()||Br,l.lineWidth=V===void 0?Mo:V,l.miterLimit=z===void 0?Co:z,l.strokeStyle=Gn(g.getColor()||Ao)}n=this.textState_;const x=t.getFont()||S0;gd(x);const E=t.getScaleArray();n.overflow=t.getOverflow(),n.font=x,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||ba,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Js,n.scale=E===void 0?[1,1]:E;const w=t.getOffsetX(),A=t.getOffsetY(),S=t.getRotateWithView(),P=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=w===void 0?0:w,this.textOffsetY_=A===void 0?0:A,this.textRotateWithView_=S===void 0?!1:S,this.textRotation_=P===void 0?0:P,this.strokeKey_=l?(typeof l.strokeStyle=="string"?l.strokeStyle:be(l.strokeStyle))+l.lineCap+l.lineDashOffset+"|"+l.lineWidth+l.lineJoin+l.miterLimit+"["+l.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=o&&o.fillStyle?typeof o.fillStyle=="string"?o.fillStyle:"|"+be(o.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Fg={Circle:mu,Default:Go,Image:Rg,LineString:Og,Polygon:mu,Text:Lg};class Bg{constructor(t,e,n,o){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=o,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const n=this.buildersByZIndex_[e];for(const o in n){const l=n[o].finish();t[e][o]=l}}return t}getBuilder(t,e){const n=t!==void 0?t.toString():"0";let o=this.buildersByZIndex_[n];o===void 0&&(o={},this.buildersByZIndex_[n]=o);let l=o[e];if(l===void 0){const u=Fg[e];l=new u(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),o[e]=l}return l}}class kg extends Po{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t}getFeatures(t){return Xt()}getData(t){return null}prepareFrame(t){return Xt()}renderFrame(t,e){return Xt()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return(o,l)=>{const u=this.loadedTileCallback.bind(this,n,o);return t.forEachLoadedTile(e,o,l,u)}}forEachFeatureAtCoordinate(t,e,n,o,l){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===ie.LOADED||e.getState()===ie.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=ie.LOADED&&e!=ie.ERROR&&t.addEventListener(jt.CHANGE,this.boundHandleImageChange_),e==ie.IDLE&&(t.load(),e=t.getState()),e==ie.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class Y0 extends hs{constructor(t,e,n,o){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=o}}class H0{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Aa(),{get:(t,e)=>{if(typeof Aa()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,n),!0)})}pushMethodArgs_=(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this);pushFunction(t){this.instructions_[this.zIndex+this.offset_].push(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let n=0,o=e.length;n<o;++n){const l=e[n];if(typeof l=="function"){l(t);continue}const u=e[++n];if(typeof t[l]=="function")t[l](...u);else{if(typeof u=="function"){t[l]=u(t);continue}t[l]=u}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const xu=[];let Mr=null;function Gg(){Mr=Si(1,1,void 0,{willReadFrequently:!0})}class j0 extends kg{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Tn(),this.pixelTransform=Tn(),this.inversePixelTransform=Tn(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){Mr||Gg(),Mr.clearRect(0,0,1,1);let o;try{Mr.drawImage(t,e,n,1,1,0,0,1,1),o=Mr.getImageData(0,0,1,1).data}catch{return Mr=null,null}return o}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,e,n){const o=this.getLayer().getClassName();let l,u;if(t&&t.className===o&&(!n||t&&t.style.backgroundColor&&Ls(Eo(t.style.backgroundColor),Eo(n)))){const g=t.firstElementChild;g instanceof HTMLCanvasElement&&(u=g.getContext("2d"))}if(u&&u.canvas.style.transform===e?(this.container=t,this.context=u,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){l=document.createElement("div"),l.className=o;let g=l.style;g.position="absolute",g.width="100%",g.height="100%",u=Si();const x=u.canvas;l.appendChild(x),g=x.style,g.position="absolute",g.left="0",g.transformOrigin="top left",this.container=l,this.context=u}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const o=or(n),l=Wa(n),u=za(n),g=Ua(n);bi(e.coordinateToPixelTransform,o),bi(e.coordinateToPixelTransform,l),bi(e.coordinateToPixelTransform,u),bi(e.coordinateToPixelTransform,g);const x=this.inversePixelTransform;bi(x,o),bi(x,l),bi(x,u),bi(x,g),t.save(),t.beginPath(),t.moveTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(l[0]),Math.round(l[1])),t.lineTo(Math.round(u[0]),Math.round(u[1])),t.lineTo(Math.round(g[0]),Math.round(g[1])),t.clip()}prepareContainer(t,e){const n=t.extent,o=t.viewState.resolution,l=t.viewState.rotation,u=t.pixelRatio,g=Math.round(Ce(n)/o*u),x=Math.round(Bi(n)/o*u);as(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/u,1/u,l,-g/2,-x/2),ju(this.inversePixelTransform,this.pixelTransform);const E=nf(this.pixelTransform);if(this.useContainer(e,E,this.getBackground(t)),!this.containerReused){const w=this.context.canvas;w.width!=g||w.height!=x?(w.width=g,w.height=x):this.context.clearRect(0,0,g,x),E!==w.style.transform&&(w.style.transform=E)}}dispatchRenderEvent_(t,e,n){const o=this.getLayer();if(o.hasListener(t)){const l=new Y0(t,this.inversePixelTransform,n,e);o.dispatchEvent(l)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(gn.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(gn.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new H0),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(gn.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(gn.POSTRENDER,this.context,t))}getRenderTransform(t,e,n,o,l,u,g){const x=l/2,E=u/2,w=o/e,A=-w,S=-t[0]+g,P=-t[1];return as(this.tempTransform,x,E,w,A,-n,S,P)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function Ug(r,t,e,n,o,l,u,g,x,E,w,A){let S=r[t],P=r[t+1],L=0,F=0,V=0,z=0;function U(){L=S,F=P,t+=n,S=r[t],P=r[t+1],z+=V,V=Math.sqrt((S-L)*(S-L)+(P-F)*(P-F))}do U();while(t<e-n&&z+V<l);let Y=V===0?0:(l-z)/V;const Z=en(L,S,Y),$=en(F,P,Y),ot=t-n,X=z,J=l+g*x(E,o,w);for(;t<e-n&&z+V<J;)U();Y=V===0?0:(J-z)/V;const H=en(L,S,Y),_t=en(F,P,Y);let xt;if(A){const lt=[Z,$,H,_t];a0(lt,0,4,2,A,lt,lt),xt=lt[0]>lt[2]}else xt=Z>H;const at=Math.PI,ut=[],pt=ot+n===t;t=ot,V=0,z=X,S=r[t],P=r[t+1];let q;if(pt){U(),q=Math.atan2(P-F,S-L),xt&&(q+=q>0?-at:at);const lt=(H+Z)/2,yt=(_t+$)/2;return ut[0]=[lt,yt,(J-l)/2,q,o],ut}o=o.replace(/\n/g," ");for(let lt=0,yt=o.length;lt<yt;){U();let Lt=Math.atan2(P-F,S-L);if(xt&&(Lt+=Lt>0?-at:at),q!==void 0){let gt=Lt-q;if(gt+=gt>at?-2*at:gt<-at?2*at:0,Math.abs(gt)>u)return null}q=Lt;const oe=lt;let Gt=0;for(;lt<yt;++lt){const gt=xt?yt-lt-1:lt,ii=g*x(E,o[gt],w);if(t+n<e&&z+V<l+Gt+ii/2)break;Gt+=ii}if(lt===oe)continue;const $t=xt?o.substring(yt-oe,yt-lt):o.substring(oe,lt);Y=V===0?0:(l+Gt/2-z)/V;const Ft=en(L,S,Y),te=en(F,P,Y);ut.push([Ft,te,Gt/2,Lt,$t]),l+=Gt}return ut}const wr=mn(),ws=[],Jn=[],Qn=[],Es=[];function _u(r){return r[3].declutterBox}const pu=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function Ul(r,t){return t==="start"?t=pu.test(r)?"right":"left":t==="end"&&(t=pu.test(r)?"left":"right"),va[t]}function zg(r,t,e){return e>0&&r.push(`
`,""),r.push(t,""),r}class Wg{constructor(t,e,n,o,l){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=o.instructions,this.coordinates=o.coordinates,this.coordinateCache_={},this.renderedTransform_=Tn(),this.hitDetectionInstructions=o.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=o.fillStates||{},this.strokeStates=o.strokeStates||{},this.textStates=o.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=l?new H0:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,n,o){const l=t+e+n+o;if(this.labels_[l])return this.labels_[l];const u=o?this.strokeStates[o]:null,g=n?this.fillStates[n]:null,x=this.textStates[e],E=this.pixelRatio,w=[x.scale[0]*E,x.scale[1]*E],A=Array.isArray(t),S=x.justify?va[x.justify]:Ul(Array.isArray(t)?t[0]:t,x.textAlign||Io),P=o&&u.lineWidth?u.lineWidth:0,L=A?t:t.split(`
`).reduce(zg,[]),{width:F,height:V,widths:z,heights:U,lineWidths:Y}=xd(x,L),Z=F+P,$=[],ot=(Z+2)*w[0],X=(V+P)*w[1],J={width:ot<0?Math.floor(ot):Math.ceil(ot),height:X<0?Math.floor(X):Math.ceil(X),contextInstructions:$};(w[0]!=1||w[1]!=1)&&$.push("scale",w),o&&($.push("strokeStyle",u.strokeStyle),$.push("lineWidth",P),$.push("lineCap",u.lineCap),$.push("lineJoin",u.lineJoin),$.push("miterLimit",u.miterLimit),$.push("setLineDash",[u.lineDash]),$.push("lineDashOffset",u.lineDashOffset)),n&&$.push("fillStyle",g.fillStyle),$.push("textBaseline","middle"),$.push("textAlign","center");const H=.5-S;let _t=S*Z+H*P;const xt=[],at=[];let ut=0,pt=0,q=0,lt=0,yt;for(let Lt=0,oe=L.length;Lt<oe;Lt+=2){const Gt=L[Lt];if(Gt===`
`){pt+=ut,ut=0,_t=S*Z+H*P,++lt;continue}const $t=L[Lt+1]||x.font;$t!==yt&&(o&&xt.push("font",$t),n&&at.push("font",$t),yt=$t),ut=Math.max(ut,U[q]);const Ft=[Gt,_t+H*z[q]+S*(z[q]-Y[lt]),.5*(P+ut)+pt];_t+=z[q],o&&xt.push("strokeText",Ft),n&&at.push("fillText",Ft),++q}return Array.prototype.push.apply($,xt),Array.prototype.push.apply($,at),this.labels_[l]=J,J}replayTextBackground_(t,e,n,o,l,u,g){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,o),t.lineTo.apply(t,l),t.lineTo.apply(t,e),u&&(this.alignAndScaleFill_=u[2],this.fill_(t)),g&&(this.setStrokeStyle_(t,g),t.stroke())}calculateImageOrLabelDimensions_(t,e,n,o,l,u,g,x,E,w,A,S,P,L,F,V){g*=S[0],x*=S[1];let z=n-g,U=o-x;const Y=l+E>t?t-E:l,Z=u+w>e?e-w:u,$=L[3]+Y*S[0]+L[1],ot=L[0]+Z*S[1]+L[2],X=z-L[3],J=U-L[0];(F||A!==0)&&(ws[0]=X,Es[0]=X,ws[1]=J,Jn[1]=J,Jn[0]=X+$,Qn[0]=Jn[0],Qn[1]=J+ot,Es[1]=Qn[1]);let H;return A!==0?(H=as(Tn(),n,o,1,1,A,-n,-o),bi(H,ws),bi(H,Jn),bi(H,Qn),bi(H,Es),Os(Math.min(ws[0],Jn[0],Qn[0],Es[0]),Math.min(ws[1],Jn[1],Qn[1],Es[1]),Math.max(ws[0],Jn[0],Qn[0],Es[0]),Math.max(ws[1],Jn[1],Qn[1],Es[1]),wr)):Os(Math.min(X,X+$),Math.min(J,J+ot),Math.max(X,X+$),Math.max(J,J+ot),wr),P&&(z=Math.round(z),U=Math.round(U)),{drawImageX:z,drawImageY:U,drawImageW:Y,drawImageH:Z,originX:E,originY:w,declutterBox:{minX:wr[0],minY:wr[1],maxX:wr[2],maxY:wr[3],value:V},canvasTransform:H,scale:S}}replayImageOrLabel_(t,e,n,o,l,u,g){const x=!!(u||g),E=o.declutterBox,w=g?g[2]*o.scale[0]/2:0;return E.minX-w<=e[0]&&E.maxX+w>=0&&E.minY-w<=e[1]&&E.maxY+w>=0&&(x&&this.replayTextBackground_(t,ws,Jn,Qn,Es,u,g),_d(t,o.canvasTransform,l,n,o.originX,o.originY,o.drawImageW,o.drawImageH,o.drawImageX,o.drawImageY,o.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const n=bi(this.renderedTransform_,[0,0]),o=512*this.pixelRatio;t.save(),t.translate(n[0]%o,n[1]%o),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,n,o){const l=this.textStates[e],u=this.createLabel(t,e,o,n),g=this.strokeStates[n],x=this.pixelRatio,E=Ul(Array.isArray(t)?t[0]:t,l.textAlign||Io),w=va[l.textBaseline||ba],A=g&&g.lineWidth?g.lineWidth:0,S=u.width/x-2*l.scale[0],P=E*S+2*(.5-E)*A,L=w*u.height/x+2*(.5-w)*A;return{label:u,anchorX:P,anchorY:L}}execute_(t,e,n,o,l,u,g,x){const E=this.zIndexContext_;let w;this.pixelCoordinates_&&Ls(n,this.renderedTransform_)?w=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),w=vs(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),tf(this.renderedTransform_,n));let A=0;const S=o.length;let P=0,L,F,V,z,U,Y,Z,$,ot,X,J,H,_t,xt=0,at=0,ut=null,pt=null;const q=this.coordinateCache_,lt=this.viewRotation_,yt=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,Lt={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:lt},oe=this.instructions!=o||this.overlaps?0:200;let Gt,$t,Ft,te;for(;A<S;){const gt=o[A];switch(gt[0]){case Bt.BEGIN_GEOMETRY:Gt=gt[1],te=gt[3],Gt.getGeometry()?g!==void 0&&!Zi(g,te.getExtent())?A=gt[2]+1:++A:A=gt[2],E&&(E.zIndex=gt[4]);break;case Bt.BEGIN_PATH:xt>oe&&(this.fill_(t),xt=0),at>oe&&(t.stroke(),at=0),!xt&&!at&&(t.beginPath(),U=NaN,Y=NaN),++A;break;case Bt.CIRCLE:P=gt[1];const Rt=w[P],Ne=w[P+1],ye=w[P+2],mi=w[P+3],ke=ye-Rt,Ke=mi-Ne,ze=Math.sqrt(ke*ke+Ke*Ke);t.moveTo(Rt+ze,Ne),t.arc(Rt,Ne,ze,0,2*Math.PI,!0),++A;break;case Bt.CLOSE_PATH:t.closePath(),++A;break;case Bt.CUSTOM:P=gt[1],L=gt[2];const ne=gt[3],xi=gt[4],hi=gt[5];Lt.geometry=ne,Lt.feature=Gt,A in q||(q[A]=[]);const Ei=q[A];hi?hi(w,P,L,2,Ei):(Ei[0]=w[P],Ei[1]=w[P+1],Ei.length=2),E&&(E.zIndex=gt[6]),xi(Ei,Lt),++A;break;case Bt.DRAW_IMAGE:P=gt[1],L=gt[2],ot=gt[3],F=gt[4],V=gt[5];let Ge=gt[6];const he=gt[7],ee=gt[8],_i=gt[9],St=gt[10];let Ci=gt[11];const on=gt[12];let ci=gt[13];z=gt[14]||"declutter";const Ui=gt[15];if(!ot&&gt.length>=20){X=gt[19],J=gt[20],H=gt[21],_t=gt[22];const fe=this.drawLabelWithPointPlacement_(X,J,H,_t);ot=fe.label,gt[3]=ot;const ue=gt[23];F=(fe.anchorX-ue)*this.pixelRatio,gt[4]=F;const Wt=gt[24];V=(fe.anchorY-Wt)*this.pixelRatio,gt[5]=V,Ge=ot.height,gt[6]=Ge,ci=ot.width,gt[13]=ci}let ni;gt.length>25&&(ni=gt[25]);let qi,qe,ce;gt.length>17?(qi=gt[16],qe=gt[17],ce=gt[18]):(qi=Js,qe=!1,ce=!1),St&&yt?Ci+=lt:!St&&!yt&&(Ci-=lt);let cr=0;for(;P<L;P+=2){if(ni&&ni[cr++]<ci/this.pixelRatio)continue;const fe=this.calculateImageOrLabelDimensions_(ot.width,ot.height,w[P],w[P+1],ci,Ge,F,V,ee,_i,Ci,on,l,qi,qe||ce,Gt),ue=[t,e,ot,fe,he,qe?ut:null,ce?pt:null];if(x){let Wt,si,Vt;if(Ui){const Se=L-P;if(!Ui[Se]){Ui[Se]={args:ue,declutterMode:z};continue}const de=Ui[Se];Wt=de.args,si=de.declutterMode,delete Ui[Se],Vt=_u(Wt)}let Le,ui;if(Wt&&(si!=="declutter"||!x.collides(Vt))&&(Le=!0),(z!=="declutter"||!x.collides(fe.declutterBox))&&(ui=!0),si==="declutter"&&z==="declutter"){const Se=Le&&ui;Le=Se,ui=Se}Le&&(si!=="none"&&x.insert(Vt),this.replayImageOrLabel_.apply(this,Wt)),ui&&(z!=="none"&&x.insert(fe.declutterBox),this.replayImageOrLabel_.apply(this,ue))}else this.replayImageOrLabel_.apply(this,ue)}++A;break;case Bt.DRAW_CHARS:const Xn=gt[1],Vn=gt[2],Ae=gt[3],It=gt[4];_t=gt[5];const Te=gt[6],se=gt[7],we=gt[8];H=gt[9];const xn=gt[10];X=gt[11],J=gt[12];const vn=[gt[13],gt[13]];z=gt[14]||"declutter";const an=this.textStates[J],ht=an.font,Gi=[an.scale[0]*se,an.scale[1]*se];let On;ht in this.widths_?On=this.widths_[ht]:(On={},this.widths_[ht]=On);const Bs=b0(w,Xn,Vn,2),Ct=Math.abs(Gi[0])*eu(ht,X,On);if(It||Ct<=Bs){const fe=this.textStates[J].textAlign,ue=(Bs-Ct)*Ul(X,fe),Wt=Ug(w,Xn,Vn,2,X,ue,Te,Math.abs(Gi[0]),eu,ht,On,yt?0:this.viewRotation_);t:if(Wt){const si=[];let Vt,Le,ui,Se,de;if(H)for(Vt=0,Le=Wt.length;Vt<Le;++Vt){de=Wt[Vt],ui=de[4],Se=this.createLabel(ui,J,"",H),F=de[2]+(Gi[0]<0?-xn:xn),V=Ae*Se.height+(.5-Ae)*2*xn*Gi[1]/Gi[0]-we;const Ye=this.calculateImageOrLabelDimensions_(Se.width,Se.height,de[0],de[1],Se.width,Se.height,F,V,0,0,de[3],vn,!1,Js,!1,Gt);if(x&&z==="declutter"&&x.collides(Ye.declutterBox))break t;si.push([t,e,Se,Ye,1,null,null])}if(_t)for(Vt=0,Le=Wt.length;Vt<Le;++Vt){de=Wt[Vt],ui=de[4],Se=this.createLabel(ui,J,_t,""),F=de[2],V=Ae*Se.height-we;const Ye=this.calculateImageOrLabelDimensions_(Se.width,Se.height,de[0],de[1],Se.width,Se.height,F,V,0,0,de[3],vn,!1,Js,!1,Gt);if(x&&z==="declutter"&&x.collides(Ye.declutterBox))break t;si.push([t,e,Se,Ye,1,null,null])}x&&z!=="none"&&x.load(si.map(_u));for(let Ye=0,Ri=si.length;Ye<Ri;++Ye)this.replayImageOrLabel_.apply(this,si[Ye])}}++A;break;case Bt.END_GEOMETRY:if(u!==void 0){Gt=gt[1];const fe=u(Gt,te,z);if(fe)return fe}++A;break;case Bt.FILL:oe?xt++:this.fill_(t),++A;break;case Bt.MOVE_TO_LINE_TO:for(P=gt[1],L=gt[2],$t=w[P],Ft=w[P+1],t.moveTo($t,Ft),U=$t+.5|0,Y=Ft+.5|0,P+=2;P<L;P+=2)$t=w[P],Ft=w[P+1],Z=$t+.5|0,$=Ft+.5|0,(P==L-2||Z!==U||$!==Y)&&(t.lineTo($t,Ft),U=Z,Y=$);++A;break;case Bt.SET_FILL_STYLE:ut=gt,this.alignAndScaleFill_=gt[2],xt&&(this.fill_(t),xt=0,at&&(t.stroke(),at=0)),t.fillStyle=gt[1],++A;break;case Bt.SET_STROKE_STYLE:pt=gt,at&&(t.stroke(),at=0),this.setStrokeStyle_(t,gt),++A;break;case Bt.STROKE:oe?at++:t.stroke(),++A;break;default:++A;break}}xt&&this.fill_(t),at&&t.stroke()}execute(t,e,n,o,l,u){this.viewRotation_=o,this.execute_(t,e,n,this.instructions,l,void 0,void 0,u)}executeHitDetection(t,e,n,o,l){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,o,l)}}const Sr=["Polygon","Circle","LineString","Image","Text","Default"],Z0=["Image","Text"],Xg=Sr.filter(r=>!Z0.includes(r));class Vg{constructor(t,e,n,o,l,u,g){this.maxExtent_=t,this.overlaps_=o,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=u,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Tn(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(l,g)}clip(t,e){const n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,e){for(const n in t){let o=this.executorsByZIndex_[n];o===void 0&&(o={},this.executorsByZIndex_[n]=o);const l=t[n];for(const u in l){const g=l[u];o[u]=new Wg(this.resolution_,this.pixelRatio_,this.overlaps_,g,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const n=this.executorsByZIndex_[e];for(let o=0,l=t.length;o<l;++o)if(t[o]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,n,o,l,u){o=Math.round(o);const g=o*2+1,x=as(this.hitDetectionTransform_,o+.5,o+.5,1/e,-1/e,-n,-t[0],-t[1]),E=!this.hitDetectionContext_;E&&(this.hitDetectionContext_=Si(g,g,void 0,{willReadFrequently:!0}));const w=this.hitDetectionContext_;w.canvas.width!==g||w.canvas.height!==g?(w.canvas.width=g,w.canvas.height=g):E||w.clearRect(0,0,g,g);let A;this.renderBuffer_!==void 0&&(A=mn(),ho(A,t),Dh(A,e*(this.renderBuffer_+o),A));const S=Yg(o);let P;function L($,ot,X){const J=w.getImageData(0,0,g,g).data;for(let H=0,_t=S.length;H<_t;H++)if(J[S[H]]>0){if(!u||X==="none"||P!=="Image"&&P!=="Text"||u.includes($)){const xt=(S[H]-3)/4,at=o-xt%g,ut=o-(xt/g|0),pt=l($,ot,at*at+ut*ut);if(pt)return pt}w.clearRect(0,0,g,g);break}}const F=Object.keys(this.executorsByZIndex_).map(Number);F.sort(ss);let V,z,U,Y,Z;for(V=F.length-1;V>=0;--V){const $=F[V].toString();for(U=this.executorsByZIndex_[$],z=Sr.length-1;z>=0;--z)if(P=Sr[z],Y=U[P],Y!==void 0&&(Z=Y.executeHitDetection(w,x,n,L,A),Z))return Z}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const n=e[0],o=e[1],l=e[2],u=e[3],g=[n,o,n,u,l,u,l,o];return vs(g,0,8,2,t,g),g}isEmpty(){return er(this.executorsByZIndex_)}execute(t,e,n,o,l,u,g){const x=Object.keys(this.executorsByZIndex_).map(Number);x.sort(ss),u=u||Sr;const E=Sr.length;let w,A,S,P,L;for(g&&x.reverse(),w=0,A=x.length;w<A;++w){const F=x[w].toString();for(L=this.executorsByZIndex_[F],S=0,P=u.length;S<P;++S){const V=u[S],z=L[V];if(z!==void 0){const U=g===null?void 0:z.getZIndexContext(),Y=U?U.getContext():t,Z=this.maxExtent_&&V!=="Image"&&V!=="Text";if(Z&&(Y.save(),this.clip(Y,n)),!U||V==="Text"||V==="Image"?z.execute(Y,e,n,o,l,g):U.pushFunction($=>z.execute($,e,n,o,l,g)),Z&&Y.restore(),U){U.offset();const $=x[w]*E+S;this.deferredZIndexContexts_[$]||(this.deferredZIndexContexts_[$]=[]),this.deferredZIndexContexts_[$].push(U)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(ss);for(let n=0,o=e.length;n<o;++n)t[e[n]].forEach(l=>{l.draw(this.renderedContext_),l.clear()}),t[e[n]].length=0}}const zl={};function Yg(r){if(zl[r]!==void 0)return zl[r];const t=r*2+1,e=r*r,n=new Array(e+1);for(let l=0;l<=r;++l)for(let u=0;u<=r;++u){const g=l*l+u*u;if(g>e)break;let x=n[g];x||(x=[],n[g]=x),x.push(((r+l)*t+(r+u))*4+3),l>0&&x.push(((r-l)*t+(r+u))*4+3),u>0&&(x.push(((r+l)*t+(r-u))*4+3),l>0&&x.push(((r-l)*t+(r-u))*4+3))}const o=[];for(let l=0,u=n.length;l<u;++l)n[l]&&o.push(...n[l]);return zl[r]=o,o}class Hg extends V0{constructor(t,e,n,o,l,u,g){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=o,this.transformRotation_=o?kh(Math.atan2(o[1],o[0]),10):0,this.viewRotation_=l,this.squaredTolerance_=u,this.userTransform_=g,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Tn()}drawImages_(t,e,n,o){if(!this.image_)return;const l=vs(t,e,n,o,this.transform_,this.pixelCoordinates_),u=this.context_,g=this.tmpLocalTransform_,x=u.globalAlpha;this.imageOpacity_!=1&&(u.globalAlpha=x*this.imageOpacity_);let E=this.imageRotation_;this.transformRotation_===0&&(E-=this.viewRotation_),this.imageRotateWithView_&&(E+=this.viewRotation_);for(let w=0,A=l.length;w<A;w+=2){const S=l[w]-this.imageAnchorX_,P=l[w+1]-this.imageAnchorY_;if(E!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const L=S+this.imageAnchorX_,F=P+this.imageAnchorY_;as(g,L,F,1,1,E,-L,-F),u.save(),u.transform.apply(u,g),u.translate(L,F),u.scale(this.imageScale_[0],this.imageScale_[1]),u.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),u.restore()}else u.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,S,P,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(u.globalAlpha=x)}drawText_(t,e,n,o){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const l=vs(t,e,n,o,this.transform_,this.pixelCoordinates_),u=this.context_;let g=this.textRotation_;for(this.transformRotation_===0&&(g-=this.viewRotation_),this.textRotateWithView_&&(g+=this.viewRotation_);e<n;e+=o){const x=l[e]+this.textOffsetX_,E=l[e+1]+this.textOffsetY_;g!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(u.save(),u.translate(x-this.textOffsetX_,E-this.textOffsetY_),u.rotate(g),u.translate(this.textOffsetX_,this.textOffsetY_),u.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&u.strokeText(this.text_,0,0),this.textFillState_&&u.fillText(this.text_,0,0),u.restore()):(this.textStrokeState_&&u.strokeText(this.text_,x,E),this.textFillState_&&u.fillText(this.text_,x,E))}}moveToLineTo_(t,e,n,o,l){const u=this.context_,g=vs(t,e,n,o,this.transform_,this.pixelCoordinates_);u.moveTo(g[0],g[1]);let x=g.length;l&&(x-=2);for(let E=2;E<x;E+=2)u.lineTo(g[E],g[E+1]);return l&&u.closePath(),n}drawRings_(t,e,n,o){for(let l=0,u=n.length;l<u;++l)e=this.moveToLineTo_(t,e,n[l],o,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Zi(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Nf(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],o=e[3]-e[1],l=Math.sqrt(n*n+o*o),u=this.context_;u.beginPath(),u.arc(e[0],e[1],l,0,2*Math.PI),this.fillState_&&u.fill(),this.strokeState_&&u.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,o=e.length;n<o;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Zi(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Zi(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,o=t.getFlatCoordinates();let l=0;const u=t.getEnds(),g=t.getStride();n.beginPath();for(let x=0,E=u.length;x<E;++x)l=this.moveToLineTo_(o,l,u[x],g,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Zi(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Zi(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let o=0;const l=t.getEndss(),u=t.getStride();e.beginPath();for(let g=0,x=l.length;g<x;++g){const E=l[g];o=this.drawRings_(n,o,E,u)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),Ls(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,o=t.textAlign?t.textAlign:Io;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=o&&(n.textAlign=o,e.textAlign=o),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=o,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:o,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:Gn(n||ji)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),o=e.getLineCap(),l=e.getLineDash(),u=e.getLineDashOffset(),g=e.getLineJoin(),x=e.getWidth(),E=e.getMiterLimit(),w=l||rs;this.strokeState_={lineCap:o!==void 0?o:Fr,lineDash:this.pixelRatio_===1?w:w.map(A=>A*this.pixelRatio_),lineDashOffset:(u||os)*this.pixelRatio_,lineJoin:g!==void 0?g:Br,lineWidth:(x!==void 0?x:Mo)*this.pixelRatio_,miterLimit:E!==void 0?E:Co,strokeStyle:Gn(n||Ao)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),o=t.getAnchor(),l=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=o[0]*n,this.imageAnchorY_=o[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=l[0],this.imageOriginY_=l[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const u=t.getScaleArray();this.imageScale_=[u[0]*this.pixelRatio_/n,u[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const P=e.getColor();this.textFillState_={fillStyle:Gn(P||ji)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const P=n.getColor(),L=n.getLineCap(),F=n.getLineDash(),V=n.getLineDashOffset(),z=n.getLineJoin(),U=n.getWidth(),Y=n.getMiterLimit();this.textStrokeState_={lineCap:L!==void 0?L:Fr,lineDash:F||rs,lineDashOffset:V||os,lineJoin:z!==void 0?z:Br,lineWidth:U!==void 0?U:Mo,miterLimit:Y!==void 0?Y:Co,strokeStyle:Gn(P||Ao)}}const o=t.getFont(),l=t.getOffsetX(),u=t.getOffsetY(),g=t.getRotateWithView(),x=t.getRotation(),E=t.getScaleArray(),w=t.getText(),A=t.getTextAlign(),S=t.getTextBaseline();this.textState_={font:o!==void 0?o:S0,textAlign:A!==void 0?A:Io,textBaseline:S!==void 0?S:ba},this.text_=w!==void 0?Array.isArray(w)?w.reduce((P,L,F)=>P+=F%2?" ":L,""):w:"",this.textOffsetX_=l!==void 0?this.pixelRatio_*l:0,this.textOffsetY_=u!==void 0?this.pixelRatio_*u:0,this.textRotateWithView_=g!==void 0?g:!1,this.textRotation_=x!==void 0?x:0,this.textScale_=[this.pixelRatio_*E[0],this.pixelRatio_*E[1]]}}}const jg=Hg,Fn=.5;function Zg(r,t,e,n,o,l,u,g,x){const E=x?Wh(o):o,w=r[0]*Fn,A=r[1]*Fn,S=Si(w,A);S.imageSmoothingEnabled=!1;const P=S.canvas,L=new jg(S,Fn,o,null,u,g,x?Va(Sf(),x):null),F=e.length,V=Math.floor((256*256*256-1)/F),z={};for(let Y=1;Y<=F;++Y){const Z=e[Y-1],$=Z.getStyleFunction()||n;if(!$)continue;let ot=$(Z,l);if(!ot)continue;Array.isArray(ot)||(ot=[ot]);const J=(Y*V).toString(16).padStart(7,"#00000");for(let H=0,_t=ot.length;H<_t;++H){const xt=ot[H],at=xt.getGeometryFunction()(Z);if(!at||!Zi(E,at.getExtent()))continue;const ut=xt.clone(),pt=ut.getFill();pt&&pt.setColor(J);const q=ut.getStroke();q&&(q.setColor(J),q.setLineDash(null)),ut.setText(void 0);const lt=xt.getImage();if(lt){const Gt=lt.getImageSize();if(!Gt)continue;const $t=Si(Gt[0],Gt[1],void 0,{alpha:!1}),Ft=$t.canvas;$t.fillStyle=J,$t.fillRect(0,0,Ft.width,Ft.height),ut.setImage(new il({img:Ft,anchor:lt.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:lt.getOrigin(),opacity:1,size:lt.getSize(),scale:lt.getScale(),rotation:lt.getRotation(),rotateWithView:lt.getRotateWithView()}))}const yt=ut.getZIndex()||0;let Lt=z[yt];Lt||(Lt={},z[yt]=Lt,Lt.Polygon=[],Lt.Circle=[],Lt.LineString=[],Lt.Point=[]);const oe=at.getType();if(oe==="GeometryCollection"){const Gt=at.getGeometriesArrayRecursive();for(let $t=0,Ft=Gt.length;$t<Ft;++$t){const te=Gt[$t];Lt[te.getType().replace("Multi","")].push(te,ut)}}else Lt[oe.replace("Multi","")].push(at,ut)}}const U=Object.keys(z).map(Number).sort(ss);for(let Y=0,Z=U.length;Y<Z;++Y){const $=z[U[Y]];for(const ot in $){const X=$[ot];for(let J=0,H=X.length;J<H;J+=2){L.setStyle(X[J+1]);for(let _t=0,xt=t.length;_t<xt;++_t)L.setTransform(t[_t]),L.drawGeometry(X[J])}}}return S.getImageData(0,0,P.width,P.height)}function Kg(r,t,e){const n=[];if(e){const o=Math.floor(Math.round(r[0])*Fn),l=Math.floor(Math.round(r[1])*Fn),u=(ei(o,0,e.width-1)+ei(l,0,e.height-1)*e.width)*4,g=e.data[u],x=e.data[u+1],w=e.data[u+2]+256*(x+256*g),A=Math.floor((256*256*256-1)/t.length);w&&w%A===0&&n.push(t[w/A-1])}return n}const qg=.5,K0={Point:s2,LineString:e2,Polygon:o2,MultiPoint:r2,MultiLineString:i2,MultiPolygon:n2,GeometryCollection:t2,Circle:Qg};function Jg(r,t){return parseInt(be(r),10)-parseInt(be(t),10)}function yu(r,t){const e=q0(r,t);return e*e}function q0(r,t){return qg*r/t}function Qg(r,t,e,n,o){const l=e.getFill(),u=e.getStroke();if(l||u){const x=r.getBuilder(e.getZIndex(),"Circle");x.setFillStrokeStyle(l,u),x.drawCircle(t,n,o)}const g=e.getText();if(g&&g.getText()){const x=r.getBuilder(e.getZIndex(),"Text");x.setTextStyle(g),x.drawText(t,n)}}function wu(r,t,e,n,o,l,u,g){const x=[],E=e.getImage();if(E){let S=!0;const P=E.getImageState();P==ie.LOADED||P==ie.ERROR?S=!1:P==ie.IDLE&&E.load(),S&&x.push(E.ready())}const w=e.getFill();w&&w.loading()&&x.push(w.ready());const A=x.length>0;return A&&Promise.all(x).then(()=>o(null)),$g(r,t,e,n,l,u,g),A}function $g(r,t,e,n,o,l,u){const g=e.getGeometryFunction()(t);if(!g)return;const x=g.simplifyTransformed(n,o);if(e.getRenderer())J0(r,x,e,t,u);else{const w=K0[x.getType()];w(r,x,e,t,u,l)}}function J0(r,t,e,n,o){if(t.getType()=="GeometryCollection"){const u=t.getGeometries();for(let g=0,x=u.length;g<x;++g)J0(r,u[g],e,n,o);return}r.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer(),o)}function t2(r,t,e,n,o,l){const u=t.getGeometriesArray();let g,x;for(g=0,x=u.length;g<x;++g){const E=K0[u[g].getType()];E(r,u[g],e,n,o,l)}}function e2(r,t,e,n,o){const l=e.getStroke();if(l){const g=r.getBuilder(e.getZIndex(),"LineString");g.setFillStrokeStyle(null,l),g.drawLineString(t,n,o)}const u=e.getText();if(u&&u.getText()){const g=r.getBuilder(e.getZIndex(),"Text");g.setTextStyle(u),g.drawText(t,n,o)}}function i2(r,t,e,n,o){const l=e.getStroke();if(l){const g=r.getBuilder(e.getZIndex(),"LineString");g.setFillStrokeStyle(null,l),g.drawMultiLineString(t,n,o)}const u=e.getText();if(u&&u.getText()){const g=r.getBuilder(e.getZIndex(),"Text");g.setTextStyle(u),g.drawText(t,n,o)}}function n2(r,t,e,n,o){const l=e.getFill(),u=e.getStroke();if(u||l){const x=r.getBuilder(e.getZIndex(),"Polygon");x.setFillStrokeStyle(l,u),x.drawMultiPolygon(t,n,o)}const g=e.getText();if(g&&g.getText()){const x=r.getBuilder(e.getZIndex(),"Text");x.setTextStyle(g),x.drawText(t,n,o)}}function s2(r,t,e,n,o,l){const u=e.getImage(),g=e.getText(),x=g&&g.getText(),E=l&&u&&x?{}:void 0;if(u){if(u.getImageState()!=ie.LOADED)return;const w=r.getBuilder(e.getZIndex(),"Image");w.setImageStyle(u,E),w.drawPoint(t,n,o)}if(x){const w=r.getBuilder(e.getZIndex(),"Text");w.setTextStyle(g,E),w.drawText(t,n,o)}}function r2(r,t,e,n,o,l){const u=e.getImage(),g=u&&u.getOpacity()!==0,x=e.getText(),E=x&&x.getText(),w=l&&g&&E?{}:void 0;if(g){if(u.getImageState()!=ie.LOADED)return;const A=r.getBuilder(e.getZIndex(),"Image");A.setImageStyle(u,w),A.drawMultiPoint(t,n,o)}if(E){const A=r.getBuilder(e.getZIndex(),"Text");A.setTextStyle(x,w),A.drawText(t,n,o)}}function o2(r,t,e,n,o){const l=e.getFill(),u=e.getStroke();if(l||u){const x=r.getBuilder(e.getZIndex(),"Polygon");x.setFillStrokeStyle(l,u),x.drawPolygon(t,n,o)}const g=e.getText();if(g&&g.getText()){const x=r.getBuilder(e.getZIndex(),"Text");x.setTextStyle(g),x.drawText(t,n,o)}}class a2 extends j0{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=mn(),this.wrappedRenderedExtent_=mn(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,n){const o=e.extent,l=e.viewState,u=l.center,g=l.resolution,x=l.projection,E=l.rotation,w=x.getExtent(),A=this.getLayer().getSource(),S=this.getLayer().getDeclutter(),P=e.pixelRatio,L=e.viewHints,F=!(L[Fi.ANIMATING]||L[Fi.INTERACTING]),V=this.context,z=Math.round(Ce(o)/g*P),U=Math.round(Bi(o)/g*P),Y=A.getWrapX()&&x.canWrapX(),Z=Y?Ce(w):null,$=Y?Math.ceil((o[2]-w[2])/Z)+1:1;let ot=Y?Math.floor((o[0]-w[0])/Z):0;do{let X=this.getRenderTransform(u,g,0,P,z,U,ot*Z);e.declutter&&(X=X.slice(0)),t.execute(V,[V.canvas.width,V.canvas.height],X,E,F,n===void 0?Sr:n?Z0:Xg,n?S&&e.declutter[S]:void 0)}while(++ot<$)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Si(this.context.canvas.width,this.context.canvas.height,xu))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Za(this.context),xu.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex];this.opacity_=n.opacity;const o=t.viewState;this.prepareContainer(t,e);const l=this.context,u=this.replayGroup_;let g=u&&!u.isEmpty();if(!g&&!(this.getLayer().hasListener(gn.PRERENDER)||this.getLayer().hasListener(gn.POSTRENDER)))return null;if(this.setDrawContext_(),this.preRender(l,t),o.projection,this.clipped_=!1,g&&n.extent&&this.clipping){const x=Ks(n.extent);g=Zi(x,t.extent),this.clipped_=g&&!Zs(x,t.extent),this.clipped_&&this.clipUnrotated(l,t,x)}return g&&this.renderWorlds(u,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&l.restore(),this.postRender(l,t),this.renderedRotation_!==o.rotation&&(this.renderedRotation_=o.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=this.frameState.size.slice(),o=this.renderedCenter_,l=this.renderedResolution_,u=this.renderedRotation_,g=this.renderedProjection_,x=this.wrappedRenderedExtent_,E=this.getLayer(),w=[],A=n[0]*Fn,S=n[1]*Fn;w.push(this.getRenderTransform(o,l,u,Fn,A,S,0).slice());const P=E.getSource(),L=g.getExtent();if(P.getWrapX()&&g.canWrapX()&&!Zs(L,x)){let F=x[0];const V=Ce(L);let z=0,U;for(;F<L[0];)--z,U=V*z,w.push(this.getRenderTransform(o,l,u,Fn,A,S,U).slice()),F+=V;for(z=0,F=x[2];F>L[2];)++z,U=V*z,w.push(this.getRenderTransform(o,l,u,Fn,A,S,U).slice()),F-=V}this.hitDetectionImageData_=Zg(n,w,this.renderedFeatures_,E.getStyleFunction(),x,l,u,yu(l,this.renderedPixelRatio_),null)}e(Kg(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,n,o,l){if(!this.replayGroup_)return;const u=e.viewState.resolution,g=e.viewState.rotation,x=this.getLayer(),E={},w=function(L,F,V){const z=be(L),U=E[z];if(U){if(U!==!0&&V<U.distanceSq){if(V===0)return E[z]=!0,l.splice(l.lastIndexOf(U),1),o(L,x,F);U.geometry=F,U.distanceSq=V}}else{if(V===0)return E[z]=!0,o(L,x,F);l.push(E[z]={feature:L,layer:x,geometry:F,distanceSq:V,callback:o})}};let A;const S=[this.replayGroup_],P=this.getLayer().getDeclutter();return S.some(L=>A=L.forEachFeatureAtCoordinate(t,u,g,n,w,P&&e.declutter[P]?e.declutter[P].all().map(F=>F.value):null)),A}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),n=e.getSource();if(!n)return!1;const o=t.viewHints[Fi.ANIMATING],l=t.viewHints[Fi.INTERACTING],u=e.getUpdateWhileAnimating(),g=e.getUpdateWhileInteracting();if(this.ready&&!u&&o||!g&&l)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const x=t.extent,E=t.viewState,w=E.projection,A=E.resolution,S=t.pixelRatio,P=e.getRevision(),L=e.getRenderBuffer();let F=e.getRenderOrder();F===void 0&&(F=Jg);const V=E.center.slice(),z=Dh(x,L*A),U=z.slice(),Y=[z.slice()],Z=w.getExtent();if(n.getWrapX()&&w.canWrapX()&&!Zs(Z,t.extent)){const pt=Ce(Z),q=Math.max(Ce(z)/2,pt);z[0]=Z[0]-q,z[2]=Z[2]+q,i0(V,w);const lt=$u(Y[0],w);lt[0]<Z[0]&&lt[2]<Z[2]?Y.push([lt[0]+pt,lt[1],lt[2]+pt,lt[3]]):lt[0]>Z[0]&&lt[2]>Z[2]&&Y.push([lt[0]-pt,lt[1],lt[2]-pt,lt[3]])}if(this.ready&&this.renderedResolution_==A&&this.renderedRevision_==P&&this.renderedRenderOrder_==F&&this.renderedFrameDeclutter_===!!t.declutter&&Zs(this.wrappedRenderedExtent_,z))return Ls(this.renderedExtent_,U)||(this.hitDetectionImageData_=null,this.renderedExtent_=U),this.renderedCenter_=V,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const $=new Bg(q0(A,S),z,A,S);let ot;for(let pt=0,q=Y.length;pt<q;++pt)n.loadFeatures(Y[pt],A,w);const X=yu(A,S);let J=!0;const H=(pt,q)=>{let lt;const yt=pt.getStyleFunction()||e.getStyleFunction();if(yt&&(lt=yt(pt,A)),lt){const Lt=this.renderFeature(pt,X,lt,$,ot,this.getLayer().getDeclutter(),q);J=J&&!Lt}},_t=Wh(z),xt=n.getFeaturesInExtent(_t);F&&xt.sort(F);for(let pt=0,q=xt.length;pt<q;++pt)H(xt[pt],pt);this.renderedFeatures_=xt,this.ready=J;const at=$.finish(),ut=new Vg(z,A,S,n.getOverlaps(),at,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=A,this.renderedRevision_=P,this.renderedRenderOrder_=F,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=U,this.wrappedRenderedExtent_=z,this.renderedCenter_=V,this.renderedProjection_=w,this.renderedPixelRatio_=S,this.replayGroup_=ut,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,n,o,l,u,g){if(!n)return!1;let x=!1;if(Array.isArray(n))for(let E=0,w=n.length;E<w;++E)x=wu(o,t,n[E],e,this.boundHandleStyleImageChange_,l,u,g)||x;else x=wu(o,t,n,e,this.boundHandleStyleImageChange_,l,u,g);return x}}class l2 extends X0{constructor(t){super(t)}createRenderer(){return new a2(this)}}const Eu=l2;class Cu{constructor(t){this.rbush_=new D0(t),this.items_={}}insert(t,e){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[be(e)]=n}load(t,e){const n=new Array(e.length);for(let o=0,l=e.length;o<l;o++){const u=t[o],g=e[o],x={minX:u[0],minY:u[1],maxX:u[2],maxY:u[3],value:g};n[o]=x,this.items_[be(g)]=x}this.rbush_.load(n)}remove(t){const e=be(t),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(t,e){const n=this.items_[be(e)],o=[n.minX,n.minY,n.maxX,n.maxY];mo(o,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(o){return o.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let n;for(let o=0,l=t.length;o<l;o++)if(n=e(t[o]),n)return n;return n}isEmpty(){return er(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Os(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class Oa extends l0{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Fe),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,n=t.length;e<n;++e)this.changeEventsKeys_.push(ge(t[e],jt.CHANGE,this.changed,this))}clone(){const t=new Oa(Wl(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,n,o){if(o<rr(this.getExtent(),t,e))return o;const l=this.geometries_;for(let u=0,g=l.length;u<g;++u)o=l[u].closestPointXY(t,e,n,o);return o}containsXY(t,e){const n=this.geometries_;for(let o=0,l=n.length;o<l;++o)if(n[o].containsXY(t,e))return!0;return!1}computeExtent(t){Do(t);const e=this.geometries_;for(let n=0,o=e.length;n<o;++n)qu(t,e[n].getExtent());return t}getGeometries(){return Wl(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,o=e.length;n<o;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let o=!1;for(let l=0,u=n.length;l<u;++l){const g=n[l],x=g.getSimplifiedGeometry(t);e.push(x),x!==g&&(o=!0)}return o?new Oa(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,o=e.length;n<o;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let o=0,l=n.length;o<l;++o)n[o].rotate(t,e);this.changed()}scale(t,e,n){n||(n=Ns(this.getExtent()));const o=this.geometries_;for(let l=0,u=o.length;l<u;++l)o[l].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(Wl(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,o=e.length;n<o;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let o=0,l=n.length;o<l;++o)n[o].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Wl(r){return r.map(t=>t.clone())}const h2=Oa;class Ro extends ar{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{const o=t,l=[],u=[];for(let x=0,E=o.length;x<E;++x){const w=o[x];bn(l,w.getFlatCoordinates()),u.push(l.length)}const g=o.length===0?this.getLayout():o[0].getLayout();this.setFlatCoordinates(g,l),this.ends_=u}}appendLineString(t){bn(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Ro(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,o){return o<rr(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Vh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Hh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,o))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,hd(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return po(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new nr(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,o=[];let l=0;for(let u=0,g=e.length;u<g;++u){const x=e[u],E=new nr(t.slice(l,x),n);o.push(E),l=x}return o}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const o=this.ends_,l=this.stride;for(let u=0,g=o.length;u<g;++u){const x=o[u],E=Ma(e,n,x,l,.5);bn(t,E),n=x}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=c0(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new Ro(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return zf(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Fo(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}class cc extends ar{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){bn(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new cc(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,o){if(o<rr(this.getExtent(),t,e))return o;const l=this.flatCoordinates,u=this.stride;for(let g=0,x=l.length;g<x;g+=u){const E=$s(t,e,l[g],l[g+1]);if(E<o){o=E;for(let w=0;w<u;++w)n[w]=l[g+w];n.length=u}}return o}getCoordinates(){return bs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new ir(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,o=[];for(let l=0,u=t.length;l<u;l+=n){const g=new ir(t.slice(l,l+n),e);o.push(g)}return o}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let o=0,l=e.length;o<l;o+=n){const u=e[o],g=e[o+1];if(Lh(t,u,g))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ya(this.flatCoordinates,0,t,this.stride),this.changed()}}const Q0=cc;function $0(r,t,e,n){const o=[];let l=mn();for(let u=0,g=e.length;u<g;++u){const x=e[u];l=Fh(r,t,x[0],n),o.push((l[0]+l[2])/2,(l[1]+l[3])/2),t=x[x.length-1]}return o}class Na extends ar{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const o=t,l=[],u=[];for(let g=0,x=o.length;g<x;++g){const E=o[g],w=l.length,A=E.getEnds();for(let S=0,P=A.length;S<P;++S)A[S]+=w;bn(l,E.getFlatCoordinates()),u.push(A)}e=o.length===0?this.getLayout():o[0].getLayout(),t=l,n=u}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;bn(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let o=0,l=e.length;o<l;++o)e[o]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let o=0;o<t;++o)e[o]=this.endss_[o].slice();const n=new Na(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,o){return o<rr(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Pf(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Df(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,o))}containsXY(t,e){return Uf(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return kf(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),dh(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,fh(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=$0(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=d0(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Q0(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;_0(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=dh(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Bf(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new Na(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const l=this.endss_[t-1];e=l[l.length-1]}const n=this.endss_[t].slice(),o=n[n.length-1];if(e!==0)for(let l=0,u=n.length;l<u;++l)n[l]-=e;return new Ps(this.flatCoordinates.slice(e,o),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,o=[];let l=0;for(let u=0,g=n.length;u<g;++u){const x=n[u].slice(),E=x[x.length-1];if(l!==0)for(let A=0,S=x.length;A<S;++A)x[A]-=l;const w=new Ps(e.slice(l,E),t,x);o.push(w),l=E}return o}getType(){return"MultiPolygon"}intersectsExtent(t){return Wf(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=h0(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const o=n[n.length-1];this.flatCoordinates.length=o.length===0?0:o[o.length-1]}this.changed()}}const c2=Na,Au=Tn();class Yi{constructor(t,e,n,o,l,u){this.styleFunction,this.extent_,this.id_=u,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=l,this.squaredTolerance_,this.stride_=o,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Ku(this.flatCoordinates_):Fh(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Ns(this.getExtent());this.flatInteriorPoints_=Kh(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Vf(this.flatCoordinates_,this.ends_),e=$0(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=d0(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Ma(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let o=0,l=n.length;o<l;++o){const u=n[o],g=Ma(t,e,u,2,.5);bn(this.flatMidpoints_,g),e=u}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Be(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const o=Bi(n)/Bi(e);as(Au,n[0],n[3],o,-o,0,0,0),vs(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Au,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new Yi(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Hu((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let o;switch(this.type_){case"LineString":n.length=Ha(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),o=[n.length];break;case"MultiLineString":o=[],n.length=c0(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,o);break;case"Polygon":o=[],n.length=jh(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,o);break}return o&&(this.simplifiedGeometry_=new Yi(this.type_,n,o,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}Yi.prototype.getFlatCoordinates=Yi.prototype.getOrientedFlatCoordinates;class t1 extends Rn{constructor(t){super(),this.projection=Be(t.projection),this.attributions_=Iu(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,o){e.viewResolver=n,e.viewRejector=o})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Iu(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Iu(r){return r?Array.isArray(r)?function(t){return r}:typeof r=="function"?r:function(t){return[r]}:null}const dn={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function u2(r,t){return[[-1/0,-1/0,1/0,1/0]]}let f2=!1;function d2(r,t,e,n,o,l,u){const g=new XMLHttpRequest;g.open("GET",typeof r=="function"?r(e,n,o):r,!0),t.getType()=="arraybuffer"&&(g.responseType="arraybuffer"),g.withCredentials=f2,g.onload=function(x){if(!g.status||g.status>=200&&g.status<300){const E=t.getType();try{let w;E=="text"||E=="json"?w=g.responseText:E=="xml"?w=g.responseXML||g.responseText:E=="arraybuffer"&&(w=g.response),w?l(t.readFeatures(w,{extent:e,featureProjection:o}),t.readProjection(w)):u()}catch{u()}}else u()},g.onerror=u,g.send()}function Mu(r,t){return function(e,n,o,l,u){const g=this;d2(r,t,e,n,o,function(x,E){g.addFeatures(x),l!==void 0&&l(x)},u||Pr)}}class Cs extends hs{constructor(t,e,n){super(t),this.feature=e,this.features=n}}class g2 extends t1{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Pr,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(pe(this.format_,"`format` must be set when `url` is set"),this.loader_=Mu(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:u2;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Cu:null,this.loadedExtentsRtree_=new Cu,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,o;Array.isArray(t.features)?o=t.features:t.features&&(n=t.features,o=n.getArray()),!e&&n===void 0&&(n=new Bn(o)),o!==void 0&&this.addFeaturesInternal(o),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=be(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const n=t.getGeometry();if(n){const o=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Cs(dn.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof Yi||(this.featureChangeKeys_[t]=[ge(e,jt.CHANGE,this.handleFeatureChange_,this),ge(e,Nr.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let n=!0;if(e.getId()!==void 0){const o=String(e.getId());if(!(o in this.idIndex_))this.idIndex_[o]=e;else if(e instanceof Yi){const l=this.idIndex_[o];l instanceof Yi?Array.isArray(l)?l.push(e):this.idIndex_[o]=[l,e]:n=!1}else n=!1}return n&&(pe(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],n=[],o=[];for(let l=0,u=t.length;l<u;l++){const g=t[l],x=be(g);this.addToIndex_(x,g)&&n.push(g)}for(let l=0,u=n.length;l<u;l++){const g=n[l],x=be(g);this.setupChangeEvents_(x,g);const E=g.getGeometry();if(E){const w=E.getExtent();e.push(w),o.push(g)}else this.nullGeometryFeatures_[x]=g}if(this.featuresRtree_&&this.featuresRtree_.load(e,o),this.hasListener(dn.ADDFEATURE))for(let l=0,u=n.length;l<u;l++)this.dispatchEvent(new Cs(dn.ADDFEATURE,n[l]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(dn.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(dn.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(Hi.ADD,n=>{e||(e=!0,this.addFeature(n.element),e=!1)}),t.addEventListener(Hi.REMOVE,n=>{e||(e=!0,this.removeFeature(n.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(Fe);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=o=>{this.removeFeatureInternal(o)};this.featuresRtree_.forEach(n);for(const o in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[o])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Cs(dn.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(o){const l=o.getGeometry();if(l instanceof Yi||l.intersectsCoordinate(t))return e(o)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(n){const o=n.getGeometry();if(o instanceof Yi||o.intersectsExtent(t)){const l=e(n);if(l)return l}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),er(this.nullGeometryFeatures_)||bn(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const o=t0(t,e);return[].concat(...o.map(l=>this.featuresRtree_.getInExtent(l)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const n=t[0],o=t[1];let l=null;const u=[NaN,NaN];let g=1/0;const x=[-1/0,-1/0,1/0,1/0];return e=e||go,this.featuresRtree_.forEachInExtent(x,function(E){if(e(E)){const w=E.getGeometry(),A=g;if(g=w instanceof Yi?0:w.closestPointXY(n,o,u,g),g<A){l=E;const S=Math.sqrt(g);x[0]=n-S,x[1]=o-S,x[2]=n+S,x[3]=o+S}}}),l}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,n=be(e),o=e.getGeometry();if(!o)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{const u=o.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(u,e)):this.featuresRtree_&&this.featuresRtree_.update(u,e)}const l=e.getId();if(l!==void 0){const u=l.toString();this.idIndex_[u]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[u]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Cs(dn.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:be(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&er(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,n){const o=this.loadedExtentsRtree_,l=this.strategy_(t,e,n);for(let u=0,g=l.length;u<g;++u){const x=l[u];o.forEachInExtent(x,function(w){return Zs(w.extent,x)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Cs(dn.FEATURESLOADSTART)),this.loader_.call(this,x,e,n,w=>{--this.loadingExtentsCount_,this.dispatchEvent(new Cs(dn.FEATURESLOADEND,void 0,w))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Cs(dn.FEATURESLOADERROR))}),o.insert(x,{extent:x.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let n;e.forEachInExtent(t,function(o){if(mo(o.extent,t))return n=o,!0}),n&&e.remove(n)}removeFeatures(t){const e=[];for(let n=0,o=t.length;n<o;++n){const l=t[n],u=this.removeFeatureInternal(l);u&&e.push(u)}e.length>0&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=be(t);if(!(e in this.uidIndex_))return;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[e]?.forEach(Fe),delete this.featureChangeKeys_[e];const o=t.getId();if(o!==void 0){const l=o.toString(),u=this.idIndex_[l];u===t?delete this.idIndex_[l]:Array.isArray(u)&&(u.splice(u.indexOf(t),1),u.length===1&&(this.idIndex_[l]=u[0]))}return delete this.uidIndex_[e],this.hasListener(dn.REMOVEFEATURE)&&this.dispatchEvent(new Cs(dn.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const n in this.idIndex_){const o=this.idIndex_[n];if(t instanceof Yi&&Array.isArray(o)&&o.includes(t))o.splice(o.indexOf(t),1);else if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){pe(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Mu(t,this.format_))}}const bu=g2,kt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class e1 extends Ga{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(jt.CHANGE)}release(){this.state===kt.ERROR&&this.setState(kt.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==kt.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==kt.LOADED){t.interimTile=null;break}t.getState()==kt.LOADING?e=t:t.getState()==kt.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==kt.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){Xt()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const o=e-n+1e3/60;return o>=this.transition_?1:N0(o/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}class i1 extends e1{constructor(t,e,n,o,l,u){super(t,e,u),this.crossOrigin_=o,this.src_=n,this.key=n,this.image_=new Image,o!==null&&(this.image_.crossOrigin=o),this.unlisten_=null,this.tileLoadFunction_=l}getImage(){return this.image_}setImage(t){this.image_=t,this.state=kt.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=kt.ERROR,this.unlistenImage_(),this.image_=m2(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=kt.LOADED:this.state=kt.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==kt.ERROR&&(this.state=kt.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==kt.IDLE&&(this.state=kt.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=sd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function m2(){const r=Si(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}class x2{constructor(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const o=this.points_[e+2]-this.points_[n+2];if(o<1e3/60)return!1;const l=this.points_[e]-this.points_[n],u=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(u,l),this.initialVelocity_=Math.sqrt(l*l+u*u)/o,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class _2 extends Nh{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){Xt()}calculateMatrices2D(t){const e=t.viewState,n=t.coordinateToPixelTransform,o=t.pixelToCoordinateTransform;as(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),ju(o,n)}forEachFeatureAtCoordinate(t,e,n,o,l,u,g,x){let E;const w=e.viewState;function A(Z,$,ot,X){return l.call(u,$,Z?ot:null,X)}const S=w.projection,P=i0(t.slice(),S),L=[[0,0]];if(S.canWrapX()&&o){const Z=S.getExtent(),$=Ce(Z);L.push([-$,0],[$,0])}const F=e.layerStatesArray,V=F.length,z=[],U=[];for(let Z=0;Z<L.length;Z++)for(let $=V-1;$>=0;--$){const ot=F[$],X=ot.layer;if(X.hasRenderer()&&lc(ot,w)&&g.call(x,X)){const J=X.getRenderer(),H=X.getSource();if(J&&H){const _t=H.getWrapX()?P:t,xt=A.bind(null,ot.managed);U[0]=_t[0]+L[Z][0],U[1]=_t[1]+L[Z][1],E=J.forEachFeatureAtCoordinate(U,e,n,xt,z)}if(E)return E}}if(z.length===0)return;const Y=1/z.length;return z.forEach((Z,$)=>Z.distanceSq+=$*Y),z.sort((Z,$)=>Z.distanceSq-$.distanceSq),z.some(Z=>E=Z.callback(Z.feature,Z.layer,Z.geometry)),E}hasFeatureAtCoordinate(t,e,n,o,l,u){return this.forEachFeatureAtCoordinate(t,e,n,o,go,this,l,u)!==void 0}getMap(){return this.map_}renderFrame(t){Xt()}scheduleExpireIconCache(t){kn.canExpireCache()&&t.postRenderFunctions.push(p2)}}function p2(r,t){kn.expire()}class y2 extends _2{constructor(t){super(t),this.fontChangeListenerKey_=ge(ts,Nr.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Ja+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const n=this.getMap();if(n.hasListener(t)){const o=new Y0(t,void 0,e);n.dispatchEvent(o)}}disposeInternal(){Fe(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(gn.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(g,x){return g.zIndex-x.zIndex});e.some(g=>g.layer instanceof X0&&g.layer.getDeclutter())&&(t.declutter={});const o=t.viewState;this.children_.length=0;const l=[];let u=null;for(let g=0,x=e.length;g<x;++g){const E=e[g];t.layerIndex=g;const w=E.layer,A=w.getSourceState();if(!lc(E,o)||A!="ready"&&A!="undefined"){w.unrender();continue}const S=w.render(t,u);S&&(S!==u&&(this.children_.push(S),u=S),l.push(E))}this.declutter(t,l),nd(this.element_,this.children_),this.dispatchRenderEvent(gn.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let n=e.length-1;n>=0;--n){const o=e[n],l=o.layer;l.getDeclutter()&&l.renderDeclutter(t,o)}e.forEach(n=>n.layer.renderDeferred(t))}}}class Ms extends hs{constructor(t,e){super(t),this.layer=e}}const Xl={LAYERS:"layers"};class Vr extends O0{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Xl.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Bn(n.slice(),{unique:!0}):pe(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Bn(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Fe),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(ge(t,Hi.ADD,this.handleLayersAdd_,this),ge(t,Hi.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(Fe);No(this.listenerKeys_);const e=t.getArray();for(let n=0,o=e.length;n<o;n++){const l=e[n];this.registerLayerListeners_(l),this.dispatchEvent(new Ms("addlayer",l))}this.changed()}registerLayerListeners_(t){const e=[ge(t,Nr.PROPERTYCHANGE,this.handleLayerChange_,this),ge(t,jt.CHANGE,this.handleLayerChange_,this)];t instanceof Vr&&e.push(ge(t,"addlayer",this.handleLayerGroupAdd_,this),ge(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[be(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Ms("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Ms("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Ms("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=be(e);this.listenerKeys_[n].forEach(Fe),delete this.listenerKeys_[n],this.dispatchEvent(new Ms("removelayer",e)),this.changed()}getLayers(){return this.get(Xl.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let o=0,l=n.length;o<l;++o)this.dispatchEvent(new Ms("removelayer",n[o]))}this.set(Xl.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(u){u.getLayerStatesArray(e)});const o=this.getLayerState();let l=o.zIndex;!t&&o.zIndex===void 0&&(l=0);for(let u=n,g=e.length;u<g;u++){const x=e[u];x.opacity*=o.opacity,x.visible=x.visible&&o.visible,x.maxResolution=Math.min(x.maxResolution,o.maxResolution),x.minResolution=Math.max(x.minResolution,o.minResolution),x.minZoom=Math.max(x.minZoom,o.minZoom),x.maxZoom=Math.min(x.maxZoom,o.maxZoom),o.extent!==void 0&&(x.extent!==void 0?x.extent=co(x.extent,o.extent):x.extent=o.extent),x.zIndex===void 0&&(x.zIndex=l)}return e}getSourceState(){return"ready"}}class br extends hs{constructor(t,e,n){super(t),this.map=e,this.frameState=n!==void 0?n:null}}class Is extends br{constructor(t,e,n,o,l,u){super(t,e,l),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=o!==void 0?o:!1,this.activePointers=u}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const ti={SINGLECLICK:"singleclick",CLICK:jt.CLICK,DBLCLICK:jt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},yh={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class w2 extends Ga{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=ge(n,yh.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=ge(n,yh.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(jt.TOUCHMOVE,this.boundHandleTouchMove_,I0?{passive:!1}:!1)}emulateClick_(t){let e=new Is(ti.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Is(ti.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Is(ti.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){const e=t,n=e.pointerId;if(e.type==ti.POINTERUP||e.type==ti.POINTERCANCEL){delete this.trackedTouches_[n];for(const o in this.trackedTouches_)if(this.trackedTouches_[o].target!==e.target){delete this.trackedTouches_[o];break}}else(e.type==ti.POINTERDOWN||e.type==ti.POINTERMOVE)&&(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Is(ti.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Fe),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new Is(ti.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ge(n,ti.POINTERMOVE,this.handlePointerMove_,this),ge(n,ti.POINTERUP,this.handlePointerUp_,this),ge(this.element_,ti.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(ge(this.element_.getRootNode(),ti.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Is(ti.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Is(ti.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Fe(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(jt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Fe(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Fe),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const es={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Li={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Pa=1/0;class E2{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,No(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const o=this.keyFunction_(n);return delete this.queuedElements_[o],n}enqueue(t){pe(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=Pa?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,o=e.length,l=e[t],u=n[t],g=t;for(;t<o>>1;){const x=this.getLeftChildIndex_(t),E=this.getRightChildIndex_(t),w=E<o&&n[E]<n[x]?E:x;e[t]=e[w],n[t]=n[w],t=w}e[t]=l,n[t]=u,this.siftDown_(g,t)}siftDown_(t,e){const n=this.elements_,o=this.priorities_,l=n[e],u=o[e];for(;e>t;){const g=this.getParentIndex_(e);if(o[g]>u)n[e]=n[g],o[e]=o[g],e=g;else break}n[e]=l,o[e]=u}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let o=0;const l=e.length;let u,g,x;for(g=0;g<l;++g)u=e[g],x=t(u),x==Pa?delete this.queuedElements_[this.keyFunction_(u)]:(n[o]=x,e[o++]=u);e.length=o,n.length=o,this.heapify_()}}class C2 extends E2{constructor(t,e){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(jt.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===kt.LOADED||n===kt.ERROR||n===kt.EMPTY){n!==kt.ERROR&&e.removeEventListener(jt.CHANGE,this.boundHandleTileChange_);const o=e.getKey();o in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[o],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0,o,l,u;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;)l=this.dequeue()[0],u=l.getKey(),o=l.getState(),o===kt.IDLE&&!(u in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[u]=!0,++this.tilesLoading_,++n,l.load())}}function A2(r,t,e,n,o){if(!r||!(e in r.wantedTiles)||!r.wantedTiles[e][t.getKey()])return Pa;const l=r.viewState.center,u=n[0]-l[0],g=n[1]-l[1];return 65536*Math.log(o)+Math.sqrt(u*u+g*g)/o}class uc extends Rn{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){Ia(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&Ia(this.element);for(let e=0,n=this.listenerKeys.length;e<n;++e)Fe(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Pr&&this.listenerKeys.push(ge(t,es.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class I2 extends uc{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",o=t.expandClassName!==void 0?t.expandClassName:e+"-expand",l=t.collapseLabel!==void 0?t.collapseLabel:"›",u=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof l=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=l,this.collapseLabel_.className=u):this.collapseLabel_=l;const g=t.label!==void 0?t.label:"i";typeof g=="string"?(this.label_=document.createElement("span"),this.label_.textContent=g,this.label_.className=o):this.label_=g;const x=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(x),this.toggleButton_.addEventListener(jt.CLICK,this.handleClick_.bind(this),!1);const E=e+" "+Ja+" "+ic+(this.collapsed_&&this.collapsible_?" "+$c:"")+(this.collapsible_?"":" ol-uncollapsible"),w=this.element;w.className=E,w.appendChild(this.toggleButton_),w.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap(o=>o.getAttributions(t)))),n=!this.getMap().getAllLayers().some(o=>o.getSource()&&o.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),e}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(o=>q1(()=>o))),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Ls(e,this.renderedAttributions_)){M0(this.ulElement_);for(let o=0,l=e.length;o<l;++o){const u=document.createElement("li");u.innerHTML=e[o],this.ulElement_.appendChild(u)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle($c),this.collapsed_?Jc(this.collapseLabel_,this.label_):Jc(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}const M2=I2;class b2 extends uc{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"⇧",o=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=o,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(o));const l=t.tipLabel?t.tipLabel:"Reset rotation",u=document.createElement("button");u.className=e+"-reset",u.setAttribute("type","button"),u.title=l,u.appendChild(this.label_),u.addEventListener(jt.CLICK,this.handleClick_.bind(this),!1);const g=e+" "+Ja+" "+ic,x=this.element;x.className=g,x.appendChild(u),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(aa)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const n=e.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Wr}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const n=e.viewState.rotation;if(n!=this.rotation_){const o="rotate("+n+"rad)";if(this.autoHide_){const l=this.element.classList.contains(aa);!l&&n===0?this.element.classList.add(aa):l&&n!==0&&this.element.classList.remove(aa)}this.label_.style.transform=o}this.rotation_=n}}const T2=b2;class S2 extends uc{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,o=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",l=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",u=t.zoomInLabel!==void 0?t.zoomInLabel:"+",g=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",x=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",E=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",w=document.createElement("button");w.className=o,w.setAttribute("type","button"),w.title=x,w.appendChild(typeof u=="string"?document.createTextNode(u):u),w.addEventListener(jt.CLICK,this.handleClick_.bind(this,n),!1);const A=document.createElement("button");A.className=l,A.setAttribute("type","button"),A.title=E,A.appendChild(typeof g=="string"?document.createTextNode(g):g),A.addEventListener(jt.CLICK,this.handleClick_.bind(this,-n),!1);const S=e+" "+Ja+" "+ic,P=this.element;P.className=S,P.appendChild(w),P.appendChild(A),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const n=this.getMap().getView();if(!n)return;const o=n.getZoom();if(o!==void 0){const l=n.getConstrainedZoom(o+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:l,duration:this.duration_,easing:Wr})):n.setZoom(l)}}}const R2=S2;function v2(r){r=r||{};const t=new Bn;return(r.zoom!==void 0?r.zoom:!0)&&t.push(new R2(r.zoomOptions)),(r.rotate!==void 0?r.rotate:!0)&&t.push(new T2(r.rotateOptions)),(r.attribution!==void 0?r.attribution:!0)&&t.push(new M2(r.attributionOptions)),t}const Tu={ACTIVE:"active"};class Uo extends Rn{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Tu.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Tu.ACTIVE,t)}setMap(t){this.map_=t}}function O2(r,t,e){const n=r.getCenterInternal();if(n){const o=[n[0]+t[0],n[1]+t[1]];r.animateInternal({duration:e!==void 0?e:250,easing:Sd,center:r.getConstrainedCenter(o)})}}function fc(r,t,e,n){const o=r.getZoom();if(o===void 0)return;const l=r.getConstrainedZoom(o+t),u=r.getResolutionForZoom(l);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:u,anchor:e,duration:n!==void 0?n:250,easing:Wr})}class N2 extends Uo{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==ti.DBLCLICK){const n=t.originalEvent,o=t.map,l=t.coordinate,u=n.shiftKey?-this.delta_:this.delta_,g=o.getView();fc(g,u,l,this.duration_),n.preventDefault(),e=!0}return!e}}const P2=N2;class zo extends Uo{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==ti.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==ti.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==ti.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==ti.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function dc(r){const t=r.length;let e=0,n=0;for(let o=0;o<t;o++)e+=r[o].clientX,n+=r[o].clientY;return{clientX:e/t,clientY:n/t}}function wh(r){const t=arguments;return function(e){let n=!0;for(let o=0,l=t.length;o<l&&(n=n&&t[o](e),!!n);++o);return n}}const D2=function(r){const t=r.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},L2=function(r){const t=r.map.getTargetElement(),e=r.map.getOwnerDocument().activeElement;return t.contains(e)},n1=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?L2(r):!0},F2=go,s1=function(r){const t=r.originalEvent;return t.button==0&&!(td&&w0&&t.ctrlKey)},r1=function(r){const t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},B2=function(r){const t=r.originalEvent;return w0?t.metaKey:t.ctrlKey},k2=function(r){const t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},o1=function(r){const t=r.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},Vl=function(r){const t=r.originalEvent;return pe(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},G2=function(r){const t=r.originalEvent;return pe(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class U2 extends zo{constructor(t){super({stopDown:ka}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:wh(r1,G2);this.condition_=t.onFocusOnly?wh(n1,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const n=this.targetPointers,o=e.getEventPixel(dc(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(o[0],o[1]),this.lastCentroid){const l=[this.lastCentroid[0]-o[0],o[1]-this.lastCentroid[1]],g=t.map.getView();wf(l,g.getResolution()),Gh(l,g.getRotation()),g.adjustCenterInternal(l)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=o,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const o=this.kinetic_.getDistance(),l=this.kinetic_.getAngle(),u=n.getCenterInternal(),g=e.getPixelFromCoordinateInternal(u),x=e.getCoordinateFromPixelInternal([g[0]-o*Math.cos(l),g[1]-o*Math.sin(l)]);n.animateInternal({center:n.getConstrainedCenter(x),duration:500,easing:Wr})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const z2=U2;class W2 extends zo{constructor(t){t=t||{},super({stopDown:ka}),this.condition_=t.condition?t.condition:D2,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Vl(t))return;const e=t.map,n=e.getView();if(n.getConstraints().rotation===ac)return;const o=e.getSize(),l=t.pixel,u=Math.atan2(o[1]/2-l[1],l[0]-o[0]/2);if(this.lastAngle_!==void 0){const g=u-this.lastAngle_;n.adjustRotationInternal(-g)}this.lastAngle_=u}handleUpEvent(t){return Vl(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Vl(t)&&s1(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class X2 extends Nh{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,n="px",o=this.element_.style;o.left=Math.min(t[0],e[0])+n,o.top=Math.min(t[1],e[1])+n,o.width=Math.abs(e[0]-t[0])+n,o.height=Math.abs(e[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,o=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);o[4]=o[0].slice(),this.geometry_?this.geometry_.setCoordinates([o]):this.geometry_=new Ps([o])}getGeometry(){return this.geometry_}}const no={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class fa extends hs{constructor(t,e,n){super(t),this.coordinate=e,this.mapBrowserEvent=n}}class V2 extends zo{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new X2(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:s1,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,n){const o=n[0]-e[0],l=n[1]-e[1];return o*o+l*l>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new fa(no.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new fa(e?no.BOXEND:no.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new fa(no.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new fa(no.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}}class Y2 extends V2{constructor(t){t=t||{};const e=t.condition?t.condition:k2;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const n=this.getMap().getView();let o=this.getGeometry();if(this.out_){const l=n.rotatedExtentForGeometry(o),u=n.getResolutionForExtentInternal(l),g=n.getResolution()/u;o=o.clone(),o.scale(g*g)}n.fitInternal(o,{duration:this.duration_,easing:Wr})}}const H2=Y2,Vs={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class j2 extends Uo{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return r1(e)&&o1(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==jt.KEYDOWN){const n=t.originalEvent,o=n.key;if(this.condition_(t)&&(o==Vs.DOWN||o==Vs.LEFT||o==Vs.RIGHT||o==Vs.UP)){const u=t.map.getView(),g=u.getResolution()*this.pixelDelta_;let x=0,E=0;o==Vs.DOWN?E=-g:o==Vs.LEFT?x=-g:o==Vs.RIGHT?x=g:E=g;const w=[x,E];Gh(w,u.getRotation()),O2(u,w,this.duration_),n.preventDefault(),e=!0}}return!e}}class Z2 extends Uo{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!B2(e)&&o1(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==jt.KEYDOWN||t.type==jt.KEYPRESS){const n=t.originalEvent,o=n.key;if(this.condition_(t)&&(o==="+"||o==="-")){const l=t.map,u=o==="+"?this.delta_:-this.delta_,g=l.getView();fc(g,u,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}}const K2=Z2;class q2 extends Uo{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:F2;this.condition_=t.onFocusOnly?wh(n1,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==jt.WHEEL)return!0;const n=t.map,o=t.originalEvent;o.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let l;if(t.type==jt.WHEEL&&(l=o.deltaY,Qf&&o.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(l/=E0),o.deltaMode===WheelEvent.DOM_DELTA_LINE&&(l*=40)),l===0)return!1;this.lastDelta_=l;const u=Date.now();this.startTime_===void 0&&(this.startTime_=u),(!this.mode_||u-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(l)<4?"trackpad":"wheel");const g=n.getView();if(this.mode_==="trackpad"&&!(g.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(g.getAnimating()&&g.cancelAnimations(),g.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),g.adjustZoom(-l/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=u,!1;this.totalDelta_+=l;const x=Math.max(this.timeout_-(u-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),x),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let n=-ei(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),fc(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}const J2=q2;class Q2 extends zo{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=ka),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const n=this.targetPointers[0],o=this.targetPointers[1],l=Math.atan2(o.clientY-n.clientY,o.clientX-n.clientX);if(this.lastAngle_!==void 0){const x=l-this.lastAngle_;this.rotationDelta_+=x,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=x}this.lastAngle_=l;const u=t.map,g=u.getView();g.getConstraints().rotation!==ac&&(this.anchor_=u.getCoordinateFromPixelInternal(u.getEventPixel(dc(this.targetPointers))),this.rotating_&&(u.render(),g.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class $2 extends zo{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=ka),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const n=this.targetPointers[0],o=this.targetPointers[1],l=n.clientX-o.clientX,u=n.clientY-o.clientY,g=Math.sqrt(l*l+u*u);this.lastDistance_!==void 0&&(e=this.lastDistance_/g),this.lastDistance_=g;const x=t.map,E=x.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=x.getCoordinateFromPixelInternal(x.getEventPixel(dc(this.targetPointers))),x.render(),E.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const n=t.map.getView(),o=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,o),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}const tm=$2;function em(r){r=r||{};const t=new Bn,e=new x2(-.005,.05,100);return(r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0)&&t.push(new W2),(r.doubleClickZoom!==void 0?r.doubleClickZoom:!0)&&t.push(new P2({delta:r.zoomDelta,duration:r.zoomDuration})),(r.dragPan!==void 0?r.dragPan:!0)&&t.push(new z2({onFocusOnly:r.onFocusOnly,kinetic:e})),(r.pinchRotate!==void 0?r.pinchRotate:!0)&&t.push(new Q2),(r.pinchZoom!==void 0?r.pinchZoom:!0)&&t.push(new tm({duration:r.zoomDuration})),(r.keyboard!==void 0?r.keyboard:!0)&&(t.push(new j2),t.push(new K2({delta:r.zoomDelta,duration:r.zoomDuration}))),(r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0)&&t.push(new J2({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(r.shiftDragZoom!==void 0?r.shiftDragZoom:!0)&&t.push(new H2({duration:r.zoomDuration})),t}function a1(r){if(r instanceof el){r.setMapInternal(null);return}r instanceof Vr&&r.getLayers().forEach(a1)}function l1(r,t){if(r instanceof el){r.setMapInternal(t);return}if(r instanceof Vr){const e=r.getLayers().getArray();for(let n=0,o=e.length;n<o;++n)l1(e[n],t)}}let im=class extends Rn{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=nm(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:E0,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Tn(),this.pixelToCoordinateTransform_=Tn(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||v2(),this.interactions=e.interactions||em({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new C2(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Li.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Li.VIEW,this.handleViewChanged_),this.addChangeListener(Li.SIZE,this.handleSizeChanged_),this.addChangeListener(Li.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const n=this;t.view&&!(t.view instanceof Ln)&&t.view.then(function(o){n.setView(new Ln(o))}),this.controls.addEventListener(Hi.ADD,o=>{o.element.setMap(this)}),this.controls.addEventListener(Hi.REMOVE,o=>{o.element.setMap(null)}),this.interactions.addEventListener(Hi.ADD,o=>{o.element.setMap(this)}),this.interactions.addEventListener(Hi.REMOVE,o=>{o.element.setMap(null)}),this.overlays_.addEventListener(Hi.ADD,o=>{this.addOverlayInternal_(o.element)}),this.overlays_.addEventListener(Hi.REMOVE,o=>{const l=o.element.getId();l!==void 0&&delete this.overlayIdIndex_[l.toString()],o.element.setMap(null)}),this.controls.forEach(o=>{o.setMap(this)}),this.interactions.forEach(o=>{o.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){l1(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,n){if(!this.frameState_||!this.renderer_)return;const o=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};const l=n.hitTolerance!==void 0?n.hitTolerance:0,u=n.layerFilter!==void 0?n.layerFilter:go,g=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(o,this.frameState_,l,g,e,null,u,null)}getFeaturesAtPixel(t,e){const n=[];return this.forEachFeatureAtPixel(t,function(o){n.push(o)},e),n}getAllLayers(){const t=[];function e(n){n.forEach(function(o){o instanceof Vr?e(o.getLayers()):t.push(o)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const o=e.layerFilter!==void 0?e.layerFilter:go,l=e.hitTolerance!==void 0?e.hitTolerance:0,u=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,l,u,o,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const n=this.viewport_.getBoundingClientRect(),o=this.getSize(),l=n.width/o[0],u=n.height/o[1],g="changedTouches"in t?t.changedTouches[0]:t;return[(g.clientX-n.left)/l,(g.clientY-n.top)/u]}getTarget(){return this.get(Li.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return uh(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?bi(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Li.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof Bn){e.setLayers(t);return}const n=e.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const o=t[e];if(!o.visible)continue;const l=o.layer.getRenderer();if(l&&!l.ready)return!0;const u=o.layer.getSource();if(u&&u.loading)return!0}return!1}getPixelFromCoordinate(t){const e=$n(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?bi(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Li.SIZE)}getView(){return this.get(Li.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,n,o){return A2(this.frameState_,t,e,n,o)}handleBrowserEvent(t,e){e=e||t.type;const n=new Is(e,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,n=e.type;if(n===yh.POINTERDOWN||n===jt.WHEEL||n===jt.KEYDOWN){const o=this.getOwnerDocument(),l=this.viewport_.getRootNode?this.viewport_.getRootNode():o,u=e.target;if(this.overlayContainerStopEvent_.contains(u)||!(l===o?o.documentElement:l).contains(u))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const o=this.getInteractions().getArray().slice();for(let l=o.length-1;l>=0;l--){const u=o[l];if(u.getMap()!==this||!u.getActive()||!this.getTargetElement())continue;if(!u.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let o=this.maxTilesLoading_,l=o;if(t){const u=t.viewHints;if(u[Fi.ANIMATING]||u[Fi.INTERACTING]){const g=Date.now()-t.time>8;o=g?0:8,l=g?0:2}}e.getTilesLoading()<o&&(e.reprioritize(),e.loadMoreTiles(o,l))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(gn.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(gn.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new br(es.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new br(es.LOADSTART,this,t))));const n=this.postRenderFunctions_;for(let o=0,l=n.length;o<l;++o)n[o](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,o=this.targetChangeHandlerKeys_.length;n<o;++n)Fe(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(jt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(jt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Ia(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new y2(this)),this.mapBrowserEventHandler_=new w2(this,this.moveTolerance_);for(const l in ti)this.mapBrowserEventHandler_.addEventListener(ti[l],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(jt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(jt.WHEEL,this.boundHandleBrowserEvent_,I0?{passive:!1}:!1);const n=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[ge(n,jt.KEYDOWN,this.handleBrowserEvent,this),ge(n,jt.KEYPRESS,this.handleBrowserEvent,this)];const o=e.getRootNode();o instanceof ShadowRoot&&this.resizeObserver_.observe(o.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Fe(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Fe(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=ge(t,Nr.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ge(t,jt.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Fe),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Ms("addlayer",t)),this.layerGroupPropertyListenerKeys_=[ge(t,Nr.PROPERTYCHANGE,this.render,this),ge(t,jt.CHANGE,this.render,this),ge(t,"addlayer",this.handleLayerAdd_,this),ge(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const o=t[e].layer;o.hasRenderer()&&o.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){a1(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),n=this.getView(),o=this.frameState_;let l=null;if(e!==void 0&&Qc(e)&&n&&n.isDef()){const u=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),g=n.getState();if(l={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:oh(g.center,g.resolution,g.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:g,viewHints:u,wantedTiles:{},mapId:be(this),renderTargets:{}},g.nextCenter&&g.nextResolution){const x=isNaN(g.nextRotation)?g.rotation:g.nextRotation;l.nextExtent=oh(g.nextCenter,g.nextResolution,x,e)}}this.frameState_=l,this.renderer_.renderFrame(l),l&&(l.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,l.postRenderFunctions),o&&(!this.previousExtent_||!Xa(this.previousExtent_)&&!mo(l.extent,this.previousExtent_))&&(this.dispatchEvent(new br(es.MOVESTART,this,o)),this.previousExtent_=Do(this.previousExtent_)),this.previousExtent_&&!l.viewHints[Fi.ANIMATING]&&!l.viewHints[Fi.INTERACTING]&&!mo(l.extent,this.previousExtent_)&&(this.dispatchEvent(new br(es.MOVEEND,this,l)),Zu(l.extent,this.previousExtent_))),this.dispatchEvent(new br(es.POSTRENDER,this,l)),this.renderComplete_=this.hasListener(es.LOADSTART)||this.hasListener(es.LOADEND)||this.hasListener(gn.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Ms("removelayer",e)),this.set(Li.LAYERGROUP,t)}setSize(t){this.set(Li.SIZE,t)}setTarget(t){this.set(Li.TARGET,t)}setView(t){if(!t||t instanceof Ln){this.set(Li.VIEW,t);return}this.set(Li.VIEW,new Ln);const e=this;t.then(function(n){e.setView(new Ln(n))})}updateSize(){const t=this.getTargetElement();let e;if(t){const o=getComputedStyle(t),l=t.offsetWidth-parseFloat(o.borderLeftWidth)-parseFloat(o.paddingLeft)-parseFloat(o.paddingRight)-parseFloat(o.borderRightWidth),u=t.offsetHeight-parseFloat(o.borderTopWidth)-parseFloat(o.paddingTop)-parseFloat(o.paddingBottom)-parseFloat(o.borderBottomWidth);!isNaN(l)&&!isNaN(u)&&(e=[l,u],!Qc(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&s0("No map visible because the map container's width or height are 0."))}const n=this.getSize();e&&(!n||!Ls(e,n))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}};function nm(r){let t=null;r.keyboardEventTarget!==void 0&&(t=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);const e={},n=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new Vr({layers:r.layers});e[Li.LAYERGROUP]=n,e[Li.TARGET]=r.target,e[Li.VIEW]=r.view instanceof Ln?r.view:new Ln;let o;r.controls!==void 0&&(Array.isArray(r.controls)?o=new Bn(r.controls.slice()):(pe(typeof r.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),o=r.controls));let l;r.interactions!==void 0&&(Array.isArray(r.interactions)?l=new Bn(r.interactions.slice()):(pe(typeof r.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),l=r.interactions));let u;return r.overlays!==void 0?Array.isArray(r.overlays)?u=new Bn(r.overlays.slice()):(pe(typeof r.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),u=r.overlays):u=new Bn,{controls:o,interactions:l,keyboardEventTarget:t,overlays:u,values:e}}const sm=im,Pi={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class rm extends Rn{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+fd,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Pi.ELEMENT,this.handleElementChanged),this.addChangeListener(Pi.MAP,this.handleMapChanged),this.addChangeListener(Pi.OFFSET,this.handleOffsetChanged),this.addChangeListener(Pi.POSITION,this.handlePositionChanged),this.addChangeListener(Pi.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(Pi.ELEMENT)}getId(){return this.id}getMap(){return this.get(Pi.MAP)||null}getOffset(){return this.get(Pi.OFFSET)}getPosition(){return this.get(Pi.POSITION)}getPositioning(){return this.get(Pi.POSITIONING)}handleElementChanged(){M0(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(Ia(this.element),Fe(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=ge(t,es.POSTRENDER,this.render,this),this.updatePixelPosition();const e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(Pi.ELEMENT,t)}setMap(t){this.set(Pi.MAP,t)}setOffset(t){this.set(Pi.OFFSET,t)}setPosition(t){this.set(Pi.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(Pi.POSITION))return;const n=this.getRect(e.getTargetElement(),e.getSize()),o=this.getElement(),l=this.getRect(o,[ed(o),id(o)]);t=t||{};const u=t.margin===void 0?20:t.margin;if(!Zs(n,l)){const g=l[0]-n[0],x=n[2]-l[2],E=l[1]-n[1],w=n[3]-l[3],A=[0,0];if(g<0?A[0]=g-u:x<0&&(A[0]=Math.abs(x)+u),E<0?A[1]=E-u:w<0&&(A[1]=Math.abs(w)+u),A[0]!==0||A[1]!==0){const S=e.getView().getCenterInternal(),P=e.getPixelFromCoordinateInternal(S);if(!P)return;const L=[P[0]+A[0],P[1]+A[1]],F=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(L),duration:F.duration,easing:F.easing})}}}getRect(t,e){const n=t.getBoundingClientRect(),o=n.left+window.pageXOffset,l=n.top+window.pageYOffset;return[o,l,o+e[0],l+e[1]]}setPositioning(t){this.set(Pi.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}const n=t.getPixelFromCoordinate(e),o=t.getSize();this.updateRenderedPosition(n,o)}updateRenderedPosition(t,e){const n=this.element.style,o=this.getOffset(),l=this.getPositioning();this.setVisible(!0);const u=Math.round(t[0]+o[0])+"px",g=Math.round(t[1]+o[1])+"px";let x="0%",E="0%";l=="bottom-right"||l=="center-right"||l=="top-right"?x="-100%":(l=="bottom-center"||l=="center-center"||l=="top-center")&&(x="-50%"),l=="bottom-left"||l=="bottom-center"||l=="bottom-right"?E="-100%":(l=="center-left"||l=="center-center"||l=="center-right")&&(E="-50%");const w=`translate(${x}, ${E}) translate(${u}, ${g})`;this.rendered.transform_!=w&&(this.rendered.transform_=w,n.transform=w)}getOptions(){return this.options}}class om{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return pe(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return pe(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){pe(!(t in this.entries_),"Tried to set a value for a key that is used already");const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}function Su(r,t,e,n){return n!==void 0?(n[0]=r,n[1]=t,n[2]=e,n):[r,t,e]}function ol(r,t,e){return r+"/"+t+"/"+e}function h1(r){return ol(r[0],r[1],r[2])}function am(r){return r.split("/").map(Number)}function lm(r){return(r[1]<<r[0])+r[2]}function hm(r,t){const e=r[0],n=r[1],o=r[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const l=t.getFullTileRange(e);return l?l.containsXY(n,o):!0}class c1 extends om{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),n=am(t)[0];this.forEach(o=>{o.tileCoord[0]!==n&&(this.remove(h1(o.tileCoord)),o.release())})}}class gc{constructor(t,e,n,o){this.minX=t,this.maxX=e,this.minY=n,this.maxY=o}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Er(r,t,e,n,o){return o!==void 0?(o.minX=r,o.maxX=t,o.minY=e,o.maxY=n,o):new gc(r,t,e,n)}const da={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class cm extends el{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(da.PRELOAD)}setPreload(t){this.set(da.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(da.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(da.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const um=.5,fm=10,Ru=.25;class dm{constructor(t,e,n,o,l,u){this.sourceProj_=t,this.targetProj_=e;let g={};const x=_o(this.targetProj_,this.sourceProj_);this.transformInv_=function(U){const Y=U[0]+"/"+U[1];return g[Y]||(g[Y]=x(U)),g[Y]},this.maxSourceExtent_=o,this.errorThresholdSquared_=l*l,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!o&&!!this.sourceProj_.getExtent()&&Ce(o)>=Ce(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Ce(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Ce(this.targetProj_.getExtent()):null;const E=or(n),w=Wa(n),A=za(n),S=Ua(n),P=this.transformInv_(E),L=this.transformInv_(w),F=this.transformInv_(A),V=this.transformInv_(S),z=fm+(u?Math.max(0,Math.ceil(Math.log2(rh(n)/(u*u*256*256)))):0);if(this.addQuad_(E,w,A,S,P,L,F,V,z),this.wrapsXInSource_){let U=1/0;this.triangles_.forEach(function(Y,Z,$){U=Math.min(U,Y.source[0][0],Y.source[1][0],Y.source[2][0])}),this.triangles_.forEach(Y=>{if(Math.max(Y.source[0][0],Y.source[1][0],Y.source[2][0])-U>this.sourceWorldWidth_/2){const Z=[[Y.source[0][0],Y.source[0][1]],[Y.source[1][0],Y.source[1][1]],[Y.source[2][0],Y.source[2][1]]];Z[0][0]-U>this.sourceWorldWidth_/2&&(Z[0][0]-=this.sourceWorldWidth_),Z[1][0]-U>this.sourceWorldWidth_/2&&(Z[1][0]-=this.sourceWorldWidth_),Z[2][0]-U>this.sourceWorldWidth_/2&&(Z[2][0]-=this.sourceWorldWidth_);const $=Math.min(Z[0][0],Z[1][0],Z[2][0]);Math.max(Z[0][0],Z[1][0],Z[2][0])-$<this.sourceWorldWidth_/2&&(Y.source=Z)}})}g={}}addTriangle_(t,e,n,o,l,u){this.triangles_.push({source:[o,l,u],target:[t,e,n]})}addQuad_(t,e,n,o,l,u,g,x,E){const w=Fc([l,u,g,x]),A=this.sourceWorldWidth_?Ce(w)/this.sourceWorldWidth_:null,S=this.sourceWorldWidth_,P=this.sourceProj_.canWrapX()&&A>.5&&A<1;let L=!1;if(E>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const V=Fc([t,e,n,o]);L=Ce(V)/this.targetWorldWidth_>Ru||L}!P&&this.sourceProj_.isGlobal()&&A&&(L=A>Ru||L)}if(!L&&this.maxSourceExtent_&&isFinite(w[0])&&isFinite(w[1])&&isFinite(w[2])&&isFinite(w[3])&&!Zi(w,this.maxSourceExtent_))return;let F=0;if(!L&&(!isFinite(l[0])||!isFinite(l[1])||!isFinite(u[0])||!isFinite(u[1])||!isFinite(g[0])||!isFinite(g[1])||!isFinite(x[0])||!isFinite(x[1]))){if(E>0)L=!0;else if(F=(!isFinite(l[0])||!isFinite(l[1])?8:0)+(!isFinite(u[0])||!isFinite(u[1])?4:0)+(!isFinite(g[0])||!isFinite(g[1])?2:0)+(!isFinite(x[0])||!isFinite(x[1])?1:0),F!=1&&F!=2&&F!=4&&F!=8)return}if(E>0){if(!L){const V=[(t[0]+n[0])/2,(t[1]+n[1])/2],z=this.transformInv_(V);let U;P?U=(vr(l[0],S)+vr(g[0],S))/2-vr(z[0],S):U=(l[0]+g[0])/2-z[0];const Y=(l[1]+g[1])/2-z[1];L=U*U+Y*Y>this.errorThresholdSquared_}if(L){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const V=[(e[0]+n[0])/2,(e[1]+n[1])/2],z=this.transformInv_(V),U=[(o[0]+t[0])/2,(o[1]+t[1])/2],Y=this.transformInv_(U);this.addQuad_(t,e,V,U,l,u,z,Y,E-1),this.addQuad_(U,V,n,o,Y,z,g,x,E-1)}else{const V=[(t[0]+e[0])/2,(t[1]+e[1])/2],z=this.transformInv_(V),U=[(n[0]+o[0])/2,(n[1]+o[1])/2],Y=this.transformInv_(U);this.addQuad_(t,V,U,o,l,z,Y,x,E-1),this.addQuad_(V,e,n,U,z,u,g,Y,E-1)}return}}if(P){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}F&11||this.addTriangle_(t,n,o,l,g,x),F&14||this.addTriangle_(t,n,e,l,g,u),F&&(F&13||this.addTriangle_(e,o,t,u,x,l),F&7||this.addTriangle_(e,o,n,u,x,g))}calculateSourceExtent(){const t=mn();return this.triangles_.forEach(function(e,n,o){const l=e.source;ho(t,l[0]),ho(t,l[1]),ho(t,l[2])}),t}getTriangles(){return this.triangles_}}let Yl;const Or=[];function vu(r,t,e,n,o){r.beginPath(),r.moveTo(0,0),r.lineTo(t,e),r.lineTo(n,o),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(t,n)+1,Math.max(e,o)),r.restore()}function Hl(r,t){return Math.abs(r[t*4]-210)>2||Math.abs(r[t*4+3]-.75*255)>2}function gm(){if(Yl===void 0){const r=Si(6,6,Or);r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",vu(r,4,5,4,0),vu(r,4,5,0,5);const t=r.getImageData(0,0,3,3).data;Yl=Hl(t,0)||Hl(t,4)||Hl(t,8),Za(r),Or.push(r.canvas)}return Yl}function Ou(r,t,e,n){const o=bf(e,t,r);let l=zc(t,n,e);const u=t.getMetersPerUnit();u!==void 0&&(l*=u);const g=r.getMetersPerUnit();g!==void 0&&(l/=g);const x=r.getExtent();if(!x||Dr(x,o)){const E=zc(r,l,o)/l;isFinite(E)&&E>0&&(l/=E)}return l}function mm(r,t,e,n){const o=Ns(e);let l=Ou(r,t,o,n);return(!isFinite(l)||l<=0)&&Qu(e,function(u){return l=Ou(r,t,u,n),isFinite(l)&&l>0}),l}function xm(r,t,e,n,o,l,u,g,x,E,w,A,S,P){const L=Si(Math.round(e*r),Math.round(e*t),Or);if(A||(L.imageSmoothingEnabled=!1),x.length===0)return L.canvas;L.scale(e,e);function F($){return Math.round($*e)/e}L.globalCompositeOperation="lighter";const V=mn();x.forEach(function($,ot,X){qu(V,$.extent)});let z;const U=e/n,Y=(A?1:1+Math.pow(2,-24))/U;if(!S||x.length!==1||E!==0){if(z=Si(Math.round(Ce(V)*U),Math.round(Bi(V)*U),Or),A||(z.imageSmoothingEnabled=!1),o&&P){const $=(o[0]-V[0])*U,ot=-(o[3]-V[3])*U,X=Ce(o)*U,J=Bi(o)*U;z.rect($,ot,X,J),z.clip()}x.forEach(function($,ot,X){if($.image.width>0&&$.image.height>0){if($.clipExtent){z.save();const at=($.clipExtent[0]-V[0])*U,ut=-($.clipExtent[3]-V[3])*U,pt=Ce($.clipExtent)*U,q=Bi($.clipExtent)*U;z.rect(A?at:Math.round(at),A?ut:Math.round(ut),A?pt:Math.round(at+pt)-Math.round(at),A?q:Math.round(ut+q)-Math.round(ut)),z.clip()}const J=($.extent[0]-V[0])*U,H=-($.extent[3]-V[3])*U,_t=Ce($.extent)*U,xt=Bi($.extent)*U;z.drawImage($.image,E,E,$.image.width-2*E,$.image.height-2*E,A?J:Math.round(J),A?H:Math.round(H),A?_t:Math.round(J+_t)-Math.round(J),A?xt:Math.round(H+xt)-Math.round(H)),$.clipExtent&&z.restore()}})}const Z=or(u);return g.getTriangles().forEach(function($,ot,X){const J=$.source,H=$.target;let _t=J[0][0],xt=J[0][1],at=J[1][0],ut=J[1][1],pt=J[2][0],q=J[2][1];const lt=F((H[0][0]-Z[0])/l),yt=F(-(H[0][1]-Z[1])/l),Lt=F((H[1][0]-Z[0])/l),oe=F(-(H[1][1]-Z[1])/l),Gt=F((H[2][0]-Z[0])/l),$t=F(-(H[2][1]-Z[1])/l),Ft=_t,te=xt;_t=0,xt=0,at-=Ft,ut-=te,pt-=Ft,q-=te;const gt=[[at,ut,0,0,Lt-lt],[pt,q,0,0,Gt-lt],[0,0,at,ut,oe-yt],[0,0,pt,q,$t-yt]],ii=pf(gt);if(!ii)return;if(L.save(),L.beginPath(),gm()||!A){L.moveTo(Lt,oe);const Ne=4,ye=lt-Lt,mi=yt-oe;for(let ke=0;ke<Ne;ke++)L.lineTo(Lt+F((ke+1)*ye/Ne),oe+F(ke*mi/(Ne-1))),ke!=Ne-1&&L.lineTo(Lt+F((ke+1)*ye/Ne),oe+F((ke+1)*mi/(Ne-1)));L.lineTo(Gt,$t)}else L.moveTo(Lt,oe),L.lineTo(lt,yt),L.lineTo(Gt,$t);L.clip(),L.transform(ii[0],ii[2],ii[1],ii[3],lt,yt),L.translate(V[0]-Ft,V[3]-te);let Rt;if(z)Rt=z.canvas,L.scale(Y,-Y);else{const Ne=x[0],ye=Ne.extent;Rt=Ne.image,L.scale(Ce(ye)/Rt.width,-Bi(ye)/Rt.height)}L.drawImage(Rt,0,0),L.restore()}),z&&(Za(z),Or.push(z.canvas)),w&&(L.save(),L.globalCompositeOperation="source-over",L.strokeStyle="black",L.lineWidth=1,g.getTriangles().forEach(function($,ot,X){const J=$.target,H=(J[0][0]-Z[0])/l,_t=-(J[0][1]-Z[1])/l,xt=(J[1][0]-Z[0])/l,at=-(J[1][1]-Z[1])/l,ut=(J[2][0]-Z[0])/l,pt=-(J[2][1]-Z[1])/l;L.beginPath(),L.moveTo(xt,at),L.lineTo(H,_t),L.lineTo(ut,pt),L.closePath(),L.stroke()}),L.restore()),L.canvas}class Eh extends e1{constructor(t,e,n,o,l,u,g,x,E,w,A,S){super(l,kt.IDLE,S),this.renderEdges_=A!==void 0?A:!1,this.pixelRatio_=g,this.gutter_=x,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=o,this.wrappedTileCoord_=u||l,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const P=o.getTileCoordExtent(this.wrappedTileCoord_),L=this.targetTileGrid_.getExtent();let F=this.sourceTileGrid_.getExtent();const V=L?co(P,L):P;if(rh(V)===0){this.state=kt.EMPTY;return}const z=t.getExtent();z&&(F?F=co(F,z):F=z);const U=o.getResolution(this.wrappedTileCoord_[0]),Y=mm(t,n,V,U);if(!isFinite(Y)||Y<=0){this.state=kt.EMPTY;return}const Z=w!==void 0?w:um;if(this.triangulation_=new dm(t,n,V,F,Y*Z,U),this.triangulation_.getTriangles().length===0){this.state=kt.EMPTY;return}this.sourceZ_=e.getZForResolution(Y);let $=this.triangulation_.calculateSourceExtent();if(F&&(t.canWrapX()?($[1]=ei($[1],F[1],F[3]),$[3]=ei($[3],F[1],F[3])):$=co($,F)),!rh($))this.state=kt.EMPTY;else{let ot=0,X=0;t.canWrapX()&&(ot=Ce(z),X=Math.floor(($[0]-z[0])/ot)),t0($.slice(),t,!0).forEach(H=>{const _t=e.getTileRangeForExtentAndZ(H,this.sourceZ_);for(let xt=_t.minX;xt<=_t.maxX;xt++)for(let at=_t.minY;at<=_t.maxY;at++){const ut=E(this.sourceZ_,xt,at,g);if(ut){const pt=X*ot;this.sourceTiles_.push({tile:ut,offset:pt})}}++X}),this.sourceTiles_.length===0&&(this.state=kt.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{const n=e.tile;if(n&&n.getState()==kt.LOADED){const o=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);o[0]+=e.offset,o[2]+=e.offset;const l=this.clipExtent_?.slice();l&&(l[0]+=e.offset,l[2]+=e.offset),t.push({extent:o,clipExtent:l,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=kt.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),o=typeof n=="number"?n:n[0],l=typeof n=="number"?n:n[1],u=this.targetTileGrid_.getResolution(e),g=this.sourceTileGrid_.getResolution(this.sourceZ_),x=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=xm(o,l,this.pixelRatio_,g,this.sourceTileGrid_.getExtent(),u,x,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=kt.LOADED}this.changed()}load(){if(this.state==kt.IDLE){this.state=kt.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const n=e.getState();if(n==kt.IDLE||n==kt.LOADING){t++;const o=ge(e,jt.CHANGE,function(l){const u=e.getState();(u==kt.LOADED||u==kt.ERROR||u==kt.EMPTY)&&(Fe(o),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},n,o){e.getState()==kt.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Fe),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Za(this.canvas_.getContext("2d")),Or.push(this.canvas_),this.canvas_=null),super.release()}}class _m extends j0{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=mn(),this.tmpTileRange_=new gc(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),n=t.getState(),o=e.getUseInterimTilesOnError();return n==kt.LOADED||n==kt.EMPTY||n==kt.ERROR&&!o}getTile(t,e,n,o){const l=o.pixelRatio,u=o.viewState.projection,g=this.getLayer();let E=g.getSource().getTile(t,e,n,l,u);return E.getState()==kt.ERROR&&g.getUseInterimTilesOnError()&&g.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(E)||(E=E.getInterimTile()),E}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),o=bi(e.pixelToCoordinateTransform,t.slice()),l=n.getExtent();if(l&&!Dr(l,o))return null;const u=e.pixelRatio,g=e.viewState.projection,x=e.viewState,E=n.getRenderSource(),w=E.getTileGridForProjection(x.projection),A=E.getTilePixelRatio(e.pixelRatio);for(let S=w.getZForResolution(x.resolution);S>=w.getMinZoom();--S){const P=w.getTileCoordForCoordAndZ(o,S),L=E.getTile(S,P[1],P[2],u,g);if(!(L instanceof i1||L instanceof Eh)||L instanceof Eh&&L.getState()===kt.EMPTY)return null;if(L.getState()!==kt.LOADED)continue;const F=w.getOrigin(S),V=sn(w.getTileSize(S)),z=w.getResolution(S),U=Math.floor(A*((o[0]-F[0])/z-P[1]*V[0])),Y=Math.floor(A*((F[1]-o[1])/z-P[2]*V[1])),Z=Math.round(A*E.getGutterForProjection(x.projection));return this.getImageData(L.getImage(),U+Z,Y+Z)}return null}loadedTileCallback(t,e,n){return this.isDrawableTile(n)?super.loadedTileCallback(t,e,n):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex],o=t.viewState,l=o.projection,u=o.resolution,g=o.center,x=o.rotation,E=t.pixelRatio,w=this.getLayer(),A=w.getSource(),S=A.getRevision(),P=A.getTileGridForProjection(l),L=P.getZForResolution(u,A.zDirection),F=P.getResolution(L);let V=t.extent;const z=t.viewState.resolution,U=A.getTilePixelRatio(E);this.prepareContainer(t,e);const Y=this.context.canvas.width,Z=this.context.canvas.height,$=n.extent&&Ks(n.extent);$&&(V=co(V,Ks(n.extent)));const ot=F*Y/2/U,X=F*Z/2/U,J=[g[0]-ot,g[1]-X,g[0]+ot,g[1]+X],H=P.getTileRangeForExtentAndZ(V,L),_t={};_t[L]={};const xt=this.createLoadedTileFinder(A,l,_t),at=this.tmpExtent,ut=this.tmpTileRange_;this.newTiles_=!1;const pt=x?ah(o.center,z,x,t.size):void 0;for(let $t=H.minX;$t<=H.maxX;++$t)for(let Ft=H.minY;Ft<=H.maxY;++Ft){if(x&&!P.tileCoordIntersectsViewport([L,$t,Ft],pt))continue;const te=this.getTile(L,$t,Ft,t);if(this.isDrawableTile(te)){const Rt=be(this);if(te.getState()==kt.LOADED){_t[L][te.tileCoord.toString()]=te;let Ne=te.inTransition(Rt);Ne&&n.opacity!==1&&(te.endTransition(Rt),Ne=!1),!this.newTiles_&&(Ne||!this.renderedTiles.includes(te))&&(this.newTiles_=!0)}if(te.getAlpha(Rt,t.time)===1)continue}const gt=P.getTileCoordChildTileRange(te.tileCoord,ut,at);let ii=!1;gt&&(ii=xt(L+1,gt)),ii||P.forEachTileCoordParentTileRange(te.tileCoord,xt,ut,at)}const q=F/u*E/U,lt=this.getRenderContext(t);as(this.tempTransform,Y/2,Z/2,q,q,0,-Y/2,-Z/2),$&&this.clipUnrotated(lt,t,$),A.getInterpolate()||(lt.imageSmoothingEnabled=!1),this.preRender(lt,t),this.renderedTiles.length=0;let yt=Object.keys(_t).map(Number);yt.sort(ss);let Lt,oe,Gt;n.opacity===1&&(!this.containerReused||A.getOpaque(t.viewState.projection))?yt=yt.reverse():(Lt=[],oe=[]);for(let $t=yt.length-1;$t>=0;--$t){const Ft=yt[$t],te=A.getTilePixelSize(Ft,E,l),ii=P.getResolution(Ft)/F,Rt=te[0]*ii*q,Ne=te[1]*ii*q,ye=P.getTileCoordForCoordAndZ(or(J),Ft),mi=P.getTileCoordExtent(ye),ke=bi(this.tempTransform,[U*(mi[0]-J[0])/F,U*(J[3]-mi[3])/F]),Ke=U*A.getGutterForProjection(l),ze=_t[Ft];for(const ne in ze){const xi=ze[ne],hi=xi.tileCoord,Ei=ye[1]-hi[1],Ge=Math.round(ke[0]-(Ei-1)*Rt),he=ye[2]-hi[2],ee=Math.round(ke[1]-(he-1)*Ne),_i=Math.round(ke[0]-Ei*Rt),St=Math.round(ke[1]-he*Ne),Ci=Ge-_i,on=ee-St,ci=L===Ft,Ui=ci&&xi.getAlpha(be(this),t.time)!==1;let ni=!1;if(!Ui)if(Lt){Gt=[_i,St,_i+Ci,St,_i+Ci,St+on,_i,St+on];for(let qi=0,qe=Lt.length;qi<qe;++qi)if(L!==Ft&&Ft<oe[qi]){const ce=Lt[qi];Zi([_i,St,_i+Ci,St+on],[ce[0],ce[3],ce[4],ce[7]])&&(ni||(lt.save(),ni=!0),lt.beginPath(),lt.moveTo(Gt[0],Gt[1]),lt.lineTo(Gt[2],Gt[3]),lt.lineTo(Gt[4],Gt[5]),lt.lineTo(Gt[6],Gt[7]),lt.moveTo(ce[6],ce[7]),lt.lineTo(ce[4],ce[5]),lt.lineTo(ce[2],ce[3]),lt.lineTo(ce[0],ce[1]),lt.clip())}Lt.push(Gt),oe.push(Ft)}else lt.clearRect(_i,St,Ci,on);this.drawTileImage(xi,t,_i,St,Ci,on,Ke,ci),Lt&&!Ui?(ni&&lt.restore(),this.renderedTiles.unshift(xi)):this.renderedTiles.push(xi),this.updateUsedTiles(t.usedTiles,A,xi)}}return this.renderedRevision=S,this.renderedResolution=F,this.extentChanged=!this.renderedExtent_||!mo(this.renderedExtent_,J),this.renderedExtent_=J,this.renderedPixelRatio=E,this.renderedProjection=l,this.manageTilePyramid(t,A,P,E,l,V,L,w.getPreload()),this.scheduleExpireCache(t,A),this.postRender(this.context,t),n.extent&&lt.restore(),lt.imageSmoothingEnabled=!0,this.container}drawTileImage(t,e,n,o,l,u,g,x){const E=this.getTileImage(t);if(!E)return;const w=this.getRenderContext(e),A=be(this),S=e.layerStatesArray[e.layerIndex],P=S.opacity*(x?t.getAlpha(A,e.time):1),L=P!==w.globalAlpha;L&&(w.save(),w.globalAlpha=P),w.drawImage(E,g,g,E.width-2*g,E.height-2*g,n,o,l,u),L&&w.restore(),P!==S.opacity?e.animate=!0:x&&t.endTransition(A)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const n=function(o,l,u){const g=be(o);g in u.usedTiles&&o.expireCache(u.viewState.projection,u.usedTiles[g])}.bind(null,e);t.postRenderFunctions.push(n)}}updateUsedTiles(t,e,n){const o=be(e);o in t||(t[o]={}),t[o][n.getKey()]=!0}manageTilePyramid(t,e,n,o,l,u,g,x,E){const w=be(e);w in t.wantedTiles||(t.wantedTiles[w]={});const A=t.wantedTiles[w],S=t.tileQueue,P=n.getMinZoom(),L=t.viewState.rotation,F=L?ah(t.viewState.center,t.viewState.resolution,L,t.size):void 0;let V=0,z,U,Y,Z,$,ot;for(ot=P;ot<=g;++ot)for(U=n.getTileRangeForExtentAndZ(u,ot,U),Y=n.getResolution(ot),Z=U.minX;Z<=U.maxX;++Z)for($=U.minY;$<=U.maxY;++$)L&&!n.tileCoordIntersectsViewport([ot,Z,$],F)||(g-ot<=x?(++V,z=e.getTile(ot,Z,$,o,l),z.getState()==kt.IDLE&&(A[z.getKey()]=!0,S.isKeyQueued(z.getKey())||S.enqueue([z,w,n.getTileCoordCenter(z.tileCoord),Y])),E!==void 0&&E(z)):e.useTile(ot,Z,$,l));e.updateCacheSize(V,l)}}class pm extends cm{constructor(t){super(t)}createRenderer(){return new _m(this)}}const ym=pm,jl={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Cr=[0,0,0],As=5;class wm{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,pe(K1(this.resolutions_,(o,l)=>l-o,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let o=0,l=this.resolutions_.length-1;o<l;++o)if(!e)e=this.resolutions_[o]/this.resolutions_[o+1];else if(this.resolutions_[o]/this.resolutions_[o+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,pe(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=or(n)),pe(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,pe(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:sc,pe(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((o,l)=>{const u=new gc(Math.min(0,o[0]),Math.max(o[0]-1,-1),Math.min(0,o[1]),Math.max(o[1]-1,-1));if(n){const g=this.getTileRangeForExtentAndZ(n,l);u.minX=Math.max(g.minX,u.minX),u.maxX=Math.min(g.maxX,u.maxX),u.minY=Math.max(g.minY,u.minY),u.maxY=Math.min(g.maxY,u.maxY)}return u}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const o=this.getTileRangeForExtentAndZ(t,e);for(let l=o.minX,u=o.maxX;l<=u;++l)for(let g=o.minY,x=o.maxY;g<=x;++g)n([e,l,g])}forEachTileCoordParentTileRange(t,e,n,o){let l,u,g,x=null,E=t[0]-1;for(this.zoomFactor_===2?(u=t[1],g=t[2]):x=this.getTileCoordExtent(t,o);E>=this.minZoom;){if(u!==void 0&&g!==void 0?(u=Math.floor(u/2),g=Math.floor(g/2),l=Er(u,u,g,g,n)):l=this.getTileRangeForExtentAndZ(x,E,n),e(E,l))return!0;--E}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const l=t[1]*2,u=t[2]*2;return Er(l,l+1,u,u+1,e)}const o=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const o=t[0],l=t[1],u=t[2];if(e===o)return Er(l,u,l,u,n);if(this.zoomFactor_){const x=Math.pow(this.zoomFactor_,e-o),E=Math.floor(l*x),w=Math.floor(u*x);if(e<o)return Er(E,E,w,w,n);const A=Math.floor(x*(l+1))-1,S=Math.floor(x*(u+1))-1;return Er(E,A,w,S,n)}const g=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(g,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Cr);const o=Cr[1],l=Cr[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Cr);const u=Cr[1],g=Cr[2];return Er(o,u,l,g,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),o=sn(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*o[0]*n,e[1]-(t[2]+.5)*o[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),o=this.getResolution(t[0]),l=sn(this.getTileSize(t[0]),this.tmpSize_),u=n[0]+t[1]*l[0]*o,g=n[1]-(t[2]+1)*l[1]*o,x=u+l[0]*o,E=g+l[1]*o;return Os(u,g,x,E,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,o,l){const u=this.getZForResolution(n),g=n/this.getResolution(u),x=this.getOrigin(u),E=sn(this.getTileSize(u),this.tmpSize_);let w=g*(t-x[0])/n/E[0],A=g*(x[1]-e)/n/E[1];return o?(w=oa(w,As)-1,A=oa(A,As)-1):(w=ra(w,As),A=ra(A,As)),Su(u,w,A,l)}getTileCoordForXYAndZ_(t,e,n,o,l){const u=this.getOrigin(n),g=this.getResolution(n),x=sn(this.getTileSize(n),this.tmpSize_);let E=(t-u[0])/g/x[0],w=(u[1]-e)/g/x[1];return o?(E=oa(E,As)-1,w=oa(w,As)-1):(E=ra(E,As),w=ra(w,As)),Su(n,E,w,l)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=Ph(this.resolutions_,t,e||0);return ei(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return m0(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let o=this.minZoom;o<e;++o)n[o]=this.getTileRangeForExtentAndZ(t,o);this.fullTileRanges_=n}}const u1=wm;function f1(r){let t=r.getDefaultTileGrid();return t||(t=Im(r),r.setDefaultTileGrid(t)),t}function Em(r,t,e){const n=t[0],o=r.getTileCoordCenter(t),l=mc(e);if(!Dr(l,o)){const u=Ce(l),g=Math.ceil((l[0]-o[0])/u);return o[0]+=u*g,r.getTileCoordForCoordAndZ(o,n)}return t}function Cm(r,t,e,n){n=n!==void 0?n:"top-left";const o=d1(r,t,e);return new u1({extent:r,origin:rf(r,n),resolutions:o,tileSize:e})}function Am(r){const t=r||{},e=t.extent||Be("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:d1(e,t.maxZoom,t.tileSize,t.maxResolution)};return new u1(n)}function d1(r,t,e,n){t=t!==void 0?t:Ed,e=sn(e!==void 0?e:sc);const o=Bi(r),l=Ce(r);n=n>0?n:Math.max(l/e[0],o/e[1]);const u=t+1,g=new Array(u);for(let x=0;x<u;++x)g[x]=n/Math.pow(2,x);return g}function Im(r,t,e,n){const o=mc(r);return Cm(o,t,e,n)}function mc(r){r=Be(r);let t=r.getExtent();if(!t){const e=180*xo.degrees/r.getMetersPerUnit();t=Os(-e,-e,e,e)}return t}class Mm extends t1{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&sn(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new c1(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,o){const l=this.getTileCacheForProjection(t);if(!l)return!1;let u=!0,g,x,E;for(let w=n.minX;w<=n.maxX;++w)for(let A=n.minY;A<=n.maxY;++A)x=ol(e,w,A),E=!1,l.containsKey(x)&&(g=l.get(x),E=g.getState()===kt.LOADED,E&&(E=o(g)!==!1)),E||(u=!1);return u}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,o,l){return Xt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:f1(t)}getTileCacheForProjection(t){const e=this.getProjection();return pe(e===null||js(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const o=this.getTileGridForProjection(n),l=this.getTilePixelRatio(e),u=sn(o.getTileSize(t),this.tmpSize);return l==1?u:cd(u,l,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=Em(n,t,e)),hm(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,o){}}class bm extends hs{constructor(t,e){super(t),this.tile=e}}function Tm(r,t){const e=/\{z\}/g,n=/\{x\}/g,o=/\{y\}/g,l=/\{-y\}/g;return function(u,g,x){if(u)return r.replace(e,u[0].toString()).replace(n,u[1].toString()).replace(o,u[2].toString()).replace(l,function(){const E=u[0],w=t.getFullTileRange(E);if(!w)throw new Error("The {-y} placeholder requires a tile grid with extent");return(w.getHeight()-u[2]-1).toString()})}}function Sm(r,t){const e=r.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=Tm(r[o],t);return Rm(n)}function Rm(r){return r.length===1?r[0]:function(t,e,n){if(!t)return;const o=lm(t),l=vr(o,r.length);return r[l](t,e,n)}}function vm(r){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(r);if(e){const n=e[1].charCodeAt(0),o=e[2].charCodeAt(0);let l;for(l=n;l<=o;++l)t.push(r.replace(e[0],String.fromCharCode(l)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(r),e){const n=parseInt(e[2],10);for(let o=parseInt(e[1],10);o<=n;o++)t.push(r.replace(e[0],o.toString()));return t}return t.push(r),t}class xc extends Mm{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===xc.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=be(e),o=e.getState();let l;o==kt.LOADING?(this.tileLoadingKeys_[n]=!0,l=jl.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],l=o==kt.ERROR?jl.TILELOADERROR:o==kt.LOADED?jl.TILELOADEND:void 0),l!=null&&this.dispatchEvent(new bm(l,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=vm(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Sm(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const o=ol(t,e,n);this.tileCache.containsKey(o)&&this.tileCache.get(o)}}class Om extends xc{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Nm,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:i1,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const o in this.tileCacheForProjection){const l=this.tileCacheForProjection[o];l.expireCache(l==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!js(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!js(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||js(e,t)))return this.tileGrid;const n=be(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=f1(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||js(e,t))return this.tileCache;const n=be(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new c1(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,e,n,o,l,u){const g=[t,e,n],x=this.getTileCoordForTileUrlFunction(g,l),E=x?this.tileUrlFunction(x,o,l):void 0,w=new this.tileClass(g,E!==void 0?kt.IDLE:kt.EMPTY,E!==void 0?E:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return w.key=u,w.addEventListener(jt.CHANGE,this.handleTileChange.bind(this)),w}getTile(t,e,n,o,l){const u=this.getProjection();if(!u||!l||js(u,l))return this.getTileInternal(t,e,n,o,u||l);const g=this.getTileCacheForProjection(l),x=[t,e,n];let E;const w=h1(x);g.containsKey(w)&&(E=g.get(w));const A=this.getKey();if(E&&E.key==A)return E;const S=this.getTileGridForProjection(u),P=this.getTileGridForProjection(l),L=this.getTileCoordForTileUrlFunction(x,l),F=new Eh(u,S,l,P,x,L,this.getTilePixelRatio(o),this.getGutter(),(V,z,U,Y)=>this.getTileInternal(V,z,U,Y,u),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return F.key=A,E?(F.interimTile=E,F.refreshInterimChain(),g.replace(w,F)):g.set(w,F),F}getTileInternal(t,e,n,o,l){let u=null;const g=ol(t,e,n),x=this.getKey();if(!this.tileCache.containsKey(g))u=this.createTile_(t,e,n,o,l,x),this.tileCache.set(g,u);else if(u=this.tileCache.get(g),u.key!=x){const E=u;u=this.createTile_(t,e,n,o,l,x),E.getState()==kt.IDLE?u.interimTile=E.interimTile:u.interimTile=E,u.refreshInterimChain(),this.tileCache.replace(g,u)}return u}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const n=Be(t);if(n){const o=be(n);o in this.tileGridForProjection||(this.tileGridForProjection[o]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function Nm(r,t){r.getImage().src=t}class Pm extends Om{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:Am({extent:mc(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}class g1{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=sr,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?Be(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=Be(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return Xt()}readFeature(t,e){return Xt()}readFeatures(t,e){return Xt()}readGeometry(t,e){return Xt()}readProjection(t){return Xt()}writeFeature(t,e){return Xt()}writeFeatures(t,e){return Xt()}writeGeometry(t,e){return Xt()}}function us(r,t,e){const n=e?Be(e.featureProjection):null,o=e?Be(e.dataProjection):null;let l=r;if(n&&o&&!js(n,o)){t&&(l=r.clone());const u=t?n:o,g=t?o:n;u.getUnits()==="tile-pixels"?l.transform(u,g):l.applyTransform(_o(u,g))}if(t&&e&&e.decimals!==void 0){const u=Math.pow(10,e.decimals),g=function(x){for(let E=0,w=x.length;E<w;++E)x[E]=Math.round(x[E]*u)/u;return x};l===r&&(l=r.clone()),l.applyTransform(g)}return l}const Dm={Point:ir,LineString:nr,Polygon:Ps,MultiPoint:Q0,MultiLineString:Ro,MultiPolygon:c2};function Lm(r,t,e){return Array.isArray(t[0])?(_0(r,0,t,e)||(r=r.slice(),dh(r,0,t,e)),r):(Jh(r,0,t,e)||(r=r.slice(),Ca(r,0,t,e)),r)}function m1(r,t){const e=r.geometry;if(!e)return[];if(Array.isArray(e))return e.map(l=>m1({...r,geometry:l})).flat();const n=e.type==="MultiPolygon"?"Polygon":e.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const o=e.layout.length;return us(new Yi(n,n==="Polygon"?Lm(e.flatCoordinates,e.ends,o):e.flatCoordinates,e.ends?.flat(),o,r.properties||{},r.id).enableSimplifyTransformed(),!1,t)}function _c(r,t){if(!r)return null;if(Array.isArray(r)){const n=r.map(o=>_c(o,t));return new h2(n)}const e=Dm[r.type];return us(new e(r.flatCoordinates,r.layout,r.ends),!1,t)}const Nu="http://www.w3.org/2001/XMLSchema-instance";function pc(r,t){return Wo().createElementNS(r,t)}function al(r,t){return x1(r,t,[]).join("")}function x1(r,t,e){if(r.nodeType==Node.CDATA_SECTION_NODE||r.nodeType==Node.TEXT_NODE)t?e.push(String(r.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(r.nodeValue);else{let n;for(n=r.firstChild;n;n=n.nextSibling)x1(n,t,e)}return e}function ao(r){return"documentElement"in r}function lo(r){return new DOMParser().parseFromString(r,"application/xml")}function Zl(r,t){return function(e,n){const o=r.call(t!==void 0?t:this,e,n);o!==void 0&&n[n.length-1].push(o)}}function Ht(r,t,e){return function(n,o){const l=r.call(e!==void 0?e:this,n,o);if(l!==void 0){const u=o[o.length-1],g=t!==void 0?t:n.localName;u[g]=l}}}function Qt(r,t){return function(e,n,o){r.call(t!==void 0?t:this,e,n,o),o[o.length-1].node.appendChild(e)}}function _1(r,t){let e,n;return function(o,l,u){if(e===void 0){e={};const g={};g[o.localName]=r,e[o.namespaceURI]=g,n=yc(o.localName)}p1(e,n,l,u)}}function yc(r,t){return function(e,n,o){const u=n[n.length-1].node;let g=r;g===void 0&&(g=o);const x=t!==void 0?t:u.namespaceURI;return pc(x,g)}}const ll=yc();function wc(r,t){const e=t.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=r[t[o]];return n}function li(r,t,e){e=e!==void 0?e:{};let n,o;for(n=0,o=r.length;n<o;++n)e[r[n]]=t;return e}function Ec(r,t,e,n){let o;for(o=t.firstElementChild;o;o=o.nextElementSibling){const l=r[o.namespaceURI];if(l!==void 0){const u=l[o.localName];u!==void 0&&u.call(n,o,e)}}}function ls(r,t,e,n,o){return n.push(r),Ec(t,e,n,o),n.pop()}function p1(r,t,e,n,o,l){const u=(o!==void 0?o:e).length;let g,x;for(let E=0;E<u;++E)g=e[E],g!==void 0&&(x=t.call(l!==void 0?l:this,g,n,o!==void 0?o[E]:void 0),x!==void 0&&r[x.namespaceURI][x.localName].call(l,x,g,n))}function Yr(r,t,e,n,o,l,u){return o.push(r),p1(t,e,n,o,l,u),o.pop()}let Kl;function Fm(){return Kl===void 0&&typeof XMLSerializer<"u"&&(Kl=new XMLSerializer),Kl}let ql;function Wo(){return ql===void 0&&typeof document<"u"&&(ql=document.implementation.createDocument("","",null)),ql}class Bm extends g1{constructor(){super(),this.xmlSerializer_=Fm()}getType(){return"xml"}readFeature(t,e){if(!t)return null;if(typeof t=="string"){const n=lo(t);return this.readFeatureFromDocument(n,e)}return ao(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}readFeatureFromDocument(t,e){const n=this.readFeaturesFromDocument(t,e);return n.length>0?n[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(!t)return[];if(typeof t=="string"){const n=lo(t);return this.readFeaturesFromDocument(n,e)}return ao(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}readFeaturesFromDocument(t,e){const n=[];for(let o=t.firstChild;o;o=o.nextSibling)o.nodeType==Node.ELEMENT_NODE&&bn(n,this.readFeaturesFromNode(o,e));return n}readFeaturesFromNode(t,e){return Xt()}readGeometry(t,e){if(!t)return null;if(typeof t=="string"){const n=lo(t);return this.readGeometryFromDocument(n,e)}return ao(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(!t)return null;if(typeof t=="string"){const e=lo(t);return this.readProjectionFromDocument(e)}return ao(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){const n=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeFeatureNode(t,e){return null}writeFeatures(t,e){const n=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){const n=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(n)}writeGeometryNode(t,e){return null}}function hl(r){const t=al(r,!1),e=Date.parse(t);return isNaN(e)?void 0:e/1e3}function is(r){const t=al(r,!1);return km(t)}function km(r){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(r);if(t)return parseFloat(t[1])}function vo(r){const t=al(r,!1);return Gm(t)}function Gm(r){const t=/^\s*(\d+)\s*$/.exec(r);if(t)return parseInt(t[1],10)}function Ve(r){return al(r,!1).trim()}function Um(r,t){const e=new Date(t*1e3),n=e.getUTCFullYear()+"-"+Qr(e.getUTCMonth()+1,2)+"-"+Qr(e.getUTCDate(),2)+"T"+Qr(e.getUTCHours(),2)+":"+Qr(e.getUTCMinutes(),2)+":"+Qr(e.getUTCSeconds(),2)+"Z";r.appendChild(Wo().createTextNode(n))}function Ys(r,t){const e=t.toPrecision();r.appendChild(Wo().createTextNode(e))}function Da(r,t){const e=t.toString();r.appendChild(Wo().createTextNode(e))}function gi(r,t){r.appendChild(Wo().createTextNode(t))}const Ue=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],zm="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Wm={rte:y1,trk:w1,wpt:E1},Xm=li(Ue,{rte:Zl(y1),trk:Zl(w1),wpt:Zl(E1)}),Vm=li(Ue,{text:Ht(Ve,"linkText"),type:Ht(Ve,"linkType")}),Ym=li(Ue,{name:Ht(Ve),email:px,link:Xo}),Hm=li(Ue,{name:Ht(Ve),desc:Ht(Ve),author:Ht(mx),copyright:Ht(xx),link:Xo,time:Ht(hl),keywords:Ht(Ve),bounds:_x,extensions:cl}),jm=li(Ue,{year:Ht(vo),license:Ht(Ve)}),Zm=li(Ue,{rte:Qt(Cx),trk:Qt(Ax),wpt:Qt(Mx)});class Km extends Bm{constructor(t){super(),t=t||{},this.dataProjection=Be("EPSG:4326"),this.readExtensions_=t.readExtensions}handleReadExtensions_(t){t||(t=[]);for(let e=0,n=t.length;e<n;++e){const o=t[e];if(this.readExtensions_){const l=o.get("extensionsNode_")||null;this.readExtensions_(o,l)}o.set("extensionsNode_",void 0)}}readMetadata(t){return t?typeof t=="string"?this.readMetadataFromDocument(lo(t)):ao(t)?this.readMetadataFromDocument(t):this.readMetadataFromNode(t):null}readMetadataFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType===Node.ELEMENT_NODE){const n=this.readMetadataFromNode(e);if(n)return n}return null}readMetadataFromNode(t){if(!Ue.includes(t.namespaceURI))return null;for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(Ue.includes(e.namespaceURI)&&e.localName==="metadata")return ls({},Hm,e,[]);return null}readFeatureFromNode(t,e){if(!Ue.includes(t.namespaceURI))return null;const n=Wm[t.localName];if(!n)return null;const o=n(t,[this.getReadOptions(t,e)]);return o?(this.handleReadExtensions_([o]),o):null}readFeaturesFromNode(t,e){if(!Ue.includes(t.namespaceURI))return[];if(t.localName=="gpx"){const n=ls([],Xm,t,[this.getReadOptions(t,e)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(t,e){e=this.adaptOptions(e);const n=pc("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Nu),n.setAttributeNS(Nu,"xsi:schemaLocation",zm),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),Yr({node:n},Zm,gx,t,[e]),n}}const qm=li(Ue,{name:Ht(Ve),cmt:Ht(Ve),desc:Ht(Ve),src:Ht(Ve),link:Xo,number:Ht(vo),extensions:cl,type:Ht(Ve),rtept:yx}),Jm=li(Ue,{ele:Ht(is),time:Ht(hl)}),Qm=li(Ue,{name:Ht(Ve),cmt:Ht(Ve),desc:Ht(Ve),src:Ht(Ve),link:Xo,number:Ht(vo),type:Ht(Ve),extensions:cl,trkseg:Ex}),$m=li(Ue,{trkpt:wx}),tx=li(Ue,{ele:Ht(is),time:Ht(hl)}),ex=li(Ue,{ele:Ht(is),time:Ht(hl),magvar:Ht(is),geoidheight:Ht(is),name:Ht(Ve),cmt:Ht(Ve),desc:Ht(Ve),src:Ht(Ve),link:Xo,sym:Ht(Ve),type:Ht(Ve),fix:Ht(Ve),sat:Ht(vo),hdop:Ht(is),vdop:Ht(is),pdop:Ht(is),ageofdgpsdata:Ht(is),dgpsid:Ht(vo),extensions:cl}),ix=["text","type"],nx=li(Ue,{text:Qt(gi),type:Qt(gi)}),sx=li(Ue,["name","cmt","desc","src","link","number","type","rtept"]),rx=li(Ue,{name:Qt(gi),cmt:Qt(gi),desc:Qt(gi),src:Qt(gi),link:Qt(Ic),number:Qt(Da),type:Qt(gi),rtept:_1(Qt(Mc))}),ox=li(Ue,["ele","time"]),ax=li(Ue,["name","cmt","desc","src","link","number","type","trkseg"]),lx=li(Ue,{name:Qt(gi),cmt:Qt(gi),desc:Qt(gi),src:Qt(gi),link:Qt(Ic),number:Qt(Da),type:Qt(gi),trkseg:_1(Qt(Ix))}),hx=yc("trkpt"),cx=li(Ue,{trkpt:Qt(Mc)}),ux=li(Ue,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),fx=li(Ue,{ele:Qt(Ys),time:Qt(Um),magvar:Qt(Ys),geoidheight:Qt(Ys),name:Qt(gi),cmt:Qt(gi),desc:Qt(gi),src:Qt(gi),link:Qt(Ic),sym:Qt(gi),type:Qt(gi),fix:Qt(gi),sat:Qt(Da),hdop:Qt(Ys),vdop:Qt(Ys),pdop:Qt(Ys),ageofdgpsdata:Qt(Ys),dgpsid:Qt(Da)}),dx={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function gx(r,t,e){const n=r.getGeometry();if(n){const o=dx[n.getType()];if(o){const l=t[t.length-1].node;return pc(l.namespaceURI,o)}}}function Cc(r,t,e,n){return r.push(parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))),"ele"in n?(r.push(n.ele),delete n.ele,t.hasZ=!0):r.push(0),"time"in n?(r.push(n.time),delete n.time,t.hasM=!0):r.push(0),r}function Ac(r,t,e){let n="XY",o=2;if(r.hasZ&&r.hasM?(n="XYZM",o=4):r.hasZ?(n="XYZ",o=3):r.hasM&&(n="XYM",o=3),o!==4){for(let l=0,u=t.length/4;l<u;l++)t[l*o]=t[l*4],t[l*o+1]=t[l*4+1],r.hasZ&&(t[l*o+2]=t[l*4+2]),r.hasM&&(t[l*o+2]=t[l*4+3]);if(t.length=t.length/4*o,e)for(let l=0,u=e.length;l<u;l++)e[l]=e[l]/4*o}return n}function mx(r,t){const e=ls({},Ym,r,t);if(e)return e}function xx(r,t){const e=ls({},jm,r,t);if(e){const n=r.getAttribute("author");return n!==null&&(e.author=n),e}}function _x(r,t){const e=t[t.length-1],n=r.getAttribute("minlat"),o=r.getAttribute("minlon"),l=r.getAttribute("maxlat"),u=r.getAttribute("maxlon");o!==null&&n!==null&&u!==null&&l!==null&&(e.bounds=[[parseFloat(o),parseFloat(n)],[parseFloat(u),parseFloat(l)]])}function px(r,t){const e=t[t.length-1],n=r.getAttribute("id"),o=r.getAttribute("domain");n!==null&&o!==null&&(e.email=`${n}@${o}`)}function Xo(r,t){const e=t[t.length-1],n=r.getAttribute("href");n!==null&&(e.link=n),Ec(Vm,r,t)}function cl(r,t){const e=t[t.length-1];e.extensionsNode_=r}function yx(r,t){const e=ls({},Jm,r,t);if(e){const n=t[t.length-1],o=n.flatCoordinates,l=n.layoutOptions;Cc(o,l,r,e)}}function wx(r,t){const e=ls({},tx,r,t);if(e){const n=t[t.length-1],o=n.flatCoordinates,l=n.layoutOptions;Cc(o,l,r,e)}}function Ex(r,t){const e=t[t.length-1];Ec($m,r,t);const n=e.flatCoordinates;e.ends.push(n.length)}function y1(r,t){const e=t[0],n=ls({flatCoordinates:[],layoutOptions:{}},qm,r,t);if(!n)return;const o=n.flatCoordinates;delete n.flatCoordinates;const l=n.layoutOptions;delete n.layoutOptions;const u=Ac(l,o),g=new nr(o,u);us(g,!1,e);const x=new sr(g);return x.setProperties(n,!0),x}function w1(r,t){const e=t[0],n=ls({flatCoordinates:[],ends:[],layoutOptions:{}},Qm,r,t);if(!n)return;const o=n.flatCoordinates;delete n.flatCoordinates;const l=n.ends;delete n.ends;const u=n.layoutOptions;delete n.layoutOptions;const g=Ac(u,o,l),x=new Ro(o,g,l);us(x,!1,e);const E=new sr(x);return E.setProperties(n,!0),E}function E1(r,t){const e=t[0],n=ls({},ex,r,t);if(!n)return;const o={},l=Cc([],o,r,n),u=Ac(o,l),g=new ir(l,u);us(g,!1,e);const x=new sr(g);return x.setProperties(n,!0),x}function Ic(r,t,e){r.setAttribute("href",t);const o=e[e.length-1].properties,l=[o.linkText,o.linkType];Yr({node:r},nx,ll,l,e,ix)}function Mc(r,t,e){const n=e[e.length-1],l=n.node.namespaceURI,u=n.properties;switch(r.setAttributeNS(null,"lat",String(t[1])),r.setAttributeNS(null,"lon",String(t[0])),n.geometryLayout){case"XYZM":t[3]!==0&&(u.time=t[3]);case"XYZ":t[2]!==0&&(u.ele=t[2]);break;case"XYM":t[2]!==0&&(u.time=t[2]);break}const x=r.nodeName=="rtept"?ox[l]:ux[l],E=wc(u,x);Yr({node:r,properties:u},fx,ll,E,e,x)}function Cx(r,t,e){const n=e[0],o=t.getProperties(),l={node:r};l.properties=o;const u=t.getGeometry();if(u.getType()=="LineString"){const w=us(u,!0,n);l.geometryLayout=w.getLayout(),o.rtept=w.getCoordinates()}const g=e[e.length-1].node,x=sx[g.namespaceURI],E=wc(o,x);Yr(l,rx,ll,E,e,x)}function Ax(r,t,e){const n=e[0],o=t.getProperties(),l={node:r};l.properties=o;const u=t.getGeometry();if(u.getType()=="MultiLineString"){const w=us(u,!0,n);o.trkseg=w.getLineStrings()}const g=e[e.length-1].node,x=ax[g.namespaceURI],E=wc(o,x);Yr(l,lx,ll,E,e,x)}function Ix(r,t,e){const n={node:r};n.geometryLayout=t.getLayout(),n.properties={},Yr(n,cx,hx,t.getCoordinates(),e)}function Mx(r,t,e){const n=e[0],o=e[e.length-1];o.properties=t.getProperties();const l=t.getGeometry();if(l.getType()=="Point"){const u=us(l,!0,n);o.geometryLayout=u.getLayout(),Mc(r,u.getCoordinates(),e)}}class bx extends g1{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(ga(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(ga(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return Xt()}readFeaturesFromObject(t,e){return Xt()}readGeometry(t,e){return this.readGeometryFromObject(ga(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return Xt()}readProjection(t){return this.readProjectionFromObject(ga(t))}readProjectionFromObject(t){return Xt()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return Xt()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return Xt()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return Xt()}}function ga(r){if(typeof r=="string"){const t=JSON.parse(r);return t||null}return r!==null?r:null}class Tx extends bx{constructor(t){t=t||{},super(),this.dataProjection=Be(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=Be(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const o=bc(n.geometry);if(this.featureClass===Yi)return m1({geometry:o,id:n.id,properties:n.properties},e);const l=new sr;return this.geometryName_?l.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&l.setGeometryName(n.geometry_name),l.setGeometry(_c(o,e)),"id"in n&&l.setId(n.id),n.properties&&l.setProperties(n.properties,!0),l}readFeaturesFromObject(t,e){const n=t;let o=null;if(n.type==="FeatureCollection"){const l=t;o=[];const u=l.features;for(let g=0,x=u.length;g<x;++g){const E=this.readFeatureFromObject(u[g],e);E&&o.push(E)}}else o=[this.readFeatureFromObject(t,e)];return o.flat()}readGeometryFromObject(t,e){return Sx(t,e)}readProjectionFromObject(t){const e=t.crs;let n;if(e)if(e.type=="name")n=Be(e.properties.name);else if(e.type==="EPSG")n=Be("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},o=t.getId();if(o!==void 0&&(n.id=o),!t.hasProperties())return n;const l=t.getProperties(),u=t.getGeometry();return u&&(n.geometry=Ch(u,e),delete l[t.getGeometryName()]),er(l)||(n.properties=l),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let o=0,l=t.length;o<l;++o)n.push(this.writeFeatureObject(t[o],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return Ch(t,this.adaptOptions(e))}}function bc(r,t){if(!r)return null;let e;switch(r.type){case"Point":{e=vx(r);break}case"LineString":{e=Ox(r);break}case"Polygon":{e=Lx(r);break}case"MultiPoint":{e=Px(r);break}case"MultiLineString":{e=Nx(r);break}case"MultiPolygon":{e=Dx(r);break}case"GeometryCollection":{e=Rx(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return e}function Sx(r,t){const e=bc(r);return _c(e,t)}function Rx(r,t){return r.geometries.map(function(n){return bc(n)})}function vx(r){const t=r.coordinates;return{type:"Point",flatCoordinates:t,layout:lr(t.length)}}function Ox(r){const t=r.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:lr(t[0]?.length||2)}}function Nx(r){const t=r.coordinates,e=t[0]?.[0]?.length||2,n=[],o=Fo(n,0,t,e);return{type:"MultiLineString",flatCoordinates:n,ends:o,layout:lr(e)}}function Px(r){const t=r.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:lr(t[0]?.length||2)}}function Dx(r){const t=r.coordinates,e=[],n=t[0]?.[0]?.[0].length||2,o=h0(e,0,t,n);return{type:"MultiPolygon",flatCoordinates:e,ends:o,layout:lr(n)}}function Lx(r){const t=r.coordinates,e=[],n=t[0]?.[0]?.length,o=Fo(e,0,t,n);return{type:"Polygon",flatCoordinates:e,ends:o,layout:lr(n)}}function Ch(r,t){r=us(r,!0,t);const e=r.getType();let n;switch(e){case"Point":{n=zx(r);break}case"LineString":{n=Bx(r);break}case"Polygon":{n=Wx(r,t);break}case"MultiPoint":{n=Gx(r);break}case"MultiLineString":{n=kx(r);break}case"MultiPolygon":{n=Ux(r,t);break}case"GeometryCollection":{n=Fx(r,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function Fx(r,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(n){return Ch(n,t)})}}function Bx(r,t){return{type:"LineString",coordinates:r.getCoordinates()}}function kx(r,t){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function Gx(r,t){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function Ux(r,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(e)}}function zx(r,t){return{type:"Point",coordinates:r.getCoordinates()}}function Wx(r,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(e)}}var Mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function C1(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var A1={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(Mn,function(){function e(f,p){if(f[p])return f[p];for(var y,b=Object.keys(f),I=p.toLowerCase().replace(Se,""),v=-1;++v<b.length;)if(y=b[v],y.toLowerCase().replace(Se,"")===I)return f[y]}function n(f){if(typeof f!="string")throw new Error("not a string");this.text=f.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Ye}function o(f){return new n(f).output()}function l(f,p,y){Array.isArray(p)&&(y.unshift(p),p=null);var b=p?{}:f,I=y.reduce(function(v,N){return u(N,v),v},b);p&&(f[p]=I)}function u(f,p){if(Array.isArray(f)){var y=f.shift();if(y==="PARAMETER"&&(y=f.shift()),f.length===1)return Array.isArray(f[0])?(p[y]={},void u(f[0],p[y])):void(p[y]=f[0]);if(f.length)if(y!=="TOWGS84"){if(y==="AXIS")return y in p||(p[y]=[]),void p[y].push(f);Array.isArray(y)||(p[y]={});var b;switch(y){case"UNIT":case"PRIMEM":case"VERT_DATUM":return p[y]={name:f[0].toLowerCase(),convert:f[1]},void(f.length===3&&u(f[2],p[y]));case"SPHEROID":case"ELLIPSOID":return p[y]={name:f[0],a:f[1],rf:f[2]},void(f.length===4&&u(f[3],p[y]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return f[0]=["name",f[0]],void l(p,y,f);default:for(b=-1;++b<f.length;)if(!Array.isArray(f[b]))return u(f,p[y]);return l(p,y,f)}}else p[y]=f;else p[y]=!0}else p[f]=!0}function g(f,p){var y=p[0],b=p[1];!(y in f)&&b in f&&(f[y]=f[b],p.length===3&&(f[y]=p[2](f[y])))}function x(f){return f*gs}function E(f){function p(O){return O*(f.to_meter||1)}if(f.type==="GEOGCS"?f.projName="longlat":f.type==="LOCAL_CS"?(f.projName="identity",f.local=!0):typeof f.PROJECTION=="object"?f.projName=Object.keys(f.PROJECTION)[0]:f.projName=f.PROJECTION,f.AXIS){for(var y="",b=0,I=f.AXIS.length;b<I;++b){var v=[f.AXIS[b][0].toLowerCase(),f.AXIS[b][1].toLowerCase()];v[0].indexOf("north")!==-1||(v[0]==="y"||v[0]==="lat")&&v[1]==="north"?y+="n":v[0].indexOf("south")!==-1||(v[0]==="y"||v[0]==="lat")&&v[1]==="south"?y+="s":v[0].indexOf("east")!==-1||(v[0]==="x"||v[0]==="lon")&&v[1]==="east"?y+="e":v[0].indexOf("west")===-1&&(v[0]!=="x"&&v[0]!=="lon"||v[1]!=="west")||(y+="w")}y.length===2&&(y+="u"),y.length===3&&(f.axis=y)}f.UNIT&&(f.units=f.UNIT.name.toLowerCase(),f.units==="metre"&&(f.units="meter"),f.UNIT.convert&&(f.type==="GEOGCS"?f.DATUM&&f.DATUM.SPHEROID&&(f.to_meter=f.UNIT.convert*f.DATUM.SPHEROID.a):f.to_meter=f.UNIT.convert));var N=f.GEOGCS;f.type==="GEOGCS"&&(N=f),N&&(N.DATUM?f.datumCode=N.DATUM.name.toLowerCase():f.datumCode=N.name.toLowerCase(),f.datumCode.slice(0,2)==="d_"&&(f.datumCode=f.datumCode.slice(2)),f.datumCode!=="new_zealand_geodetic_datum_1949"&&f.datumCode!=="new_zealand_1949"||(f.datumCode="nzgd49"),f.datumCode!=="wgs_1984"&&f.datumCode!=="world_geodetic_system_1984"||(f.PROJECTION==="Mercator_Auxiliary_Sphere"&&(f.sphere=!0),f.datumCode="wgs84"),f.datumCode.slice(-6)==="_ferro"&&(f.datumCode=f.datumCode.slice(0,-6)),f.datumCode.slice(-8)==="_jakarta"&&(f.datumCode=f.datumCode.slice(0,-8)),~f.datumCode.indexOf("belge")&&(f.datumCode="rnb72"),N.DATUM&&N.DATUM.SPHEROID&&(f.ellps=N.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),f.ellps.toLowerCase().slice(0,13)==="international"&&(f.ellps="intl"),f.a=N.DATUM.SPHEROID.a,f.rf=parseFloat(N.DATUM.SPHEROID.rf,10)),N.DATUM&&N.DATUM.TOWGS84&&(f.datum_params=N.DATUM.TOWGS84),~f.datumCode.indexOf("osgb_1936")&&(f.datumCode="osgb36"),~f.datumCode.indexOf("osni_1952")&&(f.datumCode="osni52"),(~f.datumCode.indexOf("tm65")||~f.datumCode.indexOf("geodetic_datum_of_1965"))&&(f.datumCode="ire65"),f.datumCode==="ch1903+"&&(f.datumCode="ch1903"),~f.datumCode.indexOf("israel")&&(f.datumCode="isr93")),f.b&&!isFinite(f.b)&&(f.b=f.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",x],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",x],["x0","false_easting",p],["y0","false_northing",p],["long0","central_meridian",x],["lat0","latitude_of_origin",x],["lat0","standard_parallel_1",x],["lat1","standard_parallel_1",x],["lat2","standard_parallel_2",x],["azimuth","Azimuth"],["alpha","azimuth",x],["srsCode","name"]].forEach(function(O){return g(f,O)}),f.long0||!f.longc||f.projName!=="Albers_Conic_Equal_Area"&&f.projName!=="Lambert_Azimuthal_Equal_Area"||(f.long0=f.longc),f.lat_ts||!f.lat1||f.projName!=="Stereographic_South_Pole"&&f.projName!=="Polar Stereographic (variant B)"?!f.lat_ts&&f.lat0&&f.projName==="Polar_Stereographic"&&(f.lat_ts=f.lat0,f.lat0=x(f.lat0>0?90:-90)):(f.lat0=x(f.lat1>0?90:-90),f.lat_ts=f.lat1)}function w(f){var p=this;if(arguments.length===2){var y=arguments[1];typeof y=="string"?y.charAt(0)==="+"?w[f]=de(arguments[1]):w[f]=ks(arguments[1]):w[f]=y}else if(arguments.length===1){if(Array.isArray(f))return f.map(function(b){Array.isArray(b)?w.apply(p,b):w(b)});if(typeof f=="string"){if(f in w)return w[f]}else"EPSG"in f?w["EPSG:"+f.EPSG]=f:"ESRI"in f?w["ESRI:"+f.ESRI]=f:"IAU2000"in f?w["IAU2000:"+f.IAU2000]=f:console.log(f);return}}function A(f){return typeof f=="string"}function S(f){return f in w}function P(f){return ur.some(function(p){return f.indexOf(p)>-1})}function L(f){var p=e(f,"authority");if(p){var y=e(p,"epsg");return y&&ln.indexOf(y)>-1}}function F(f){var p=e(f,"extension");if(p)return e(p,"proj4")}function V(f){return f[0]==="+"}function z(f){if(!A(f))return f;if(S(f))return w[f];if(P(f)){var p=ks(f);if(L(p))return w["EPSG:3857"];var y=F(p);return y?de(y):p}return V(f)?de(f):void 0}function U(f){return f}function Y(f,p){var y=dt.length;return f.names?(dt[y]=f,f.names.forEach(function(b){xs[b.toLowerCase()]=y}),this):(console.log(p),!0)}function Z(f,p,y,b){var I=f*f,v=p*p,N=(I-v)/I,O=0;return b?(I=(f*=1-N*(Gi+N*(On+N*Bs)))*f,N=0):O=Math.sqrt(N),{es:N,e:O,ep2:(I-v)/v}}function $(f,p,y,b,I){if(!f){var v=e(Ot,b);v||(v=_s),f=v.a,p=v.b,y=v.rf}return y&&!p&&(p=(1-1/y)*f),(y===0||Math.abs(f-p)<Ct)&&(I=!0,p=f),{a:f,b:p,rf:y,sphere:I}}function ot(f,p,y,b,I,v,N){var O={};return O.datum_type=f===void 0||f==="none"?vn:xn,p&&(O.datum_params=p.map(parseFloat),O.datum_params[0]===0&&O.datum_params[1]===0&&O.datum_params[2]===0||(O.datum_type=Te),O.datum_params.length>3&&(O.datum_params[3]===0&&O.datum_params[4]===0&&O.datum_params[5]===0&&O.datum_params[6]===0||(O.datum_type=se,O.datum_params[3]*=an,O.datum_params[4]*=an,O.datum_params[5]*=an,O.datum_params[6]=O.datum_params[6]/1e6+1))),N&&(O.datum_type=we,O.grids=N),O.a=y,O.b=b,O.es=I,O.ep2=v,O}function X(f){return f===void 0?null:f.split(",").map(J)}function J(f){if(f.length===0)return null;var p=f[0]==="@";return p&&(f=f.slice(1)),f==="null"?{name:"null",mandatory:!p,grid:null,isNull:!0}:{name:f,mandatory:!p,grid:me[f]||null,isNull:!1}}function H(f){return f/3600*Math.PI/180}function _t(f){var p=f.getInt32(8,!1);return p!==11&&((p=f.getInt32(8,!0))!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function xt(f,p){return{nFields:f.getInt32(8,p),nSubgridFields:f.getInt32(24,p),nSubgrids:f.getInt32(40,p),shiftType:at(f,56,64).trim(),fromSemiMajorAxis:f.getFloat64(120,p),fromSemiMinorAxis:f.getFloat64(136,p),toSemiMajorAxis:f.getFloat64(152,p),toSemiMinorAxis:f.getFloat64(168,p)}}function at(f,p,y){return String.fromCharCode.apply(null,new Uint8Array(f.buffer.slice(p,y)))}function ut(f,p,y){for(var b=176,I=[],v=0;v<p.nSubgrids;v++){var N=q(f,b,y),O=lt(f,b,N,y),G=Math.round(1+(N.upperLongitude-N.lowerLongitude)/N.longitudeInterval),W=Math.round(1+(N.upperLatitude-N.lowerLatitude)/N.latitudeInterval);I.push({ll:[H(N.lowerLongitude),H(N.lowerLatitude)],del:[H(N.longitudeInterval),H(N.latitudeInterval)],lim:[G,W],count:N.gridNodeCount,cvs:pt(O)}),b+=176+16*N.gridNodeCount}return I}function pt(f){return f.map(function(p){return[H(p.longitudeShift),H(p.latitudeShift)]})}function q(f,p,y){return{name:at(f,p+8,p+16).trim(),parent:at(f,p+24,p+24+8).trim(),lowerLatitude:f.getFloat64(p+72,y),upperLatitude:f.getFloat64(p+88,y),lowerLongitude:f.getFloat64(p+104,y),upperLongitude:f.getFloat64(p+120,y),latitudeInterval:f.getFloat64(p+136,y),longitudeInterval:f.getFloat64(p+152,y),gridNodeCount:f.getInt32(p+168,y)}}function lt(f,p,y,b){for(var I=p+176,v=[],N=0;N<y.gridNodeCount;N++){var O={latitudeShift:f.getFloat32(I+16*N,b),longitudeShift:f.getFloat32(I+16*N+4,b),latitudeAccuracy:f.getFloat32(I+16*N+8,b),longitudeAccuracy:f.getFloat32(I+16*N+12,b)};v.push(O)}return v}function yt(f,p){if(!(this instanceof yt))return new yt(f);p=p||function(W){if(W)throw W};var y=z(f);if(typeof y=="object"){var b=yt.projections.get(y.projName);if(b){if(y.datumCode&&y.datumCode!=="none"){var I=e(ri,y.datumCode);I&&(y.datum_params=y.datum_params||(I.towgs84?I.towgs84.split(","):null),y.ellps=I.ellipse,y.datumName=I.datumName?I.datumName:y.datumCode)}y.k0=y.k0||1,y.axis=y.axis||"enu",y.ellps=y.ellps||"wgs84",y.lat1=y.lat1||y.lat0;var v=$(y.a,y.b,y.rf,y.ellps,y.sphere),N=Z(v.a,v.b,v.rf,y.R_A),O=X(y.nadgrids),G=y.datum||ot(y.datumCode,y.datum_params,v.a,v.b,N.es,N.ep2,O);Yo(this,y),Yo(this,b),this.a=v.a,this.b=v.b,this.rf=v.rf,this.sphere=v.sphere,this.es=N.es,this.e=N.e,this.ep2=N.ep2,this.datum=G,this.init(),p(null,this)}else p(f)}else p(f)}function Lt(f,p){return f.datum_type===p.datum_type&&!(f.a!==p.a||Math.abs(f.es-p.es)>5e-11)&&(f.datum_type===Te?f.datum_params[0]===p.datum_params[0]&&f.datum_params[1]===p.datum_params[1]&&f.datum_params[2]===p.datum_params[2]:f.datum_type!==se||f.datum_params[0]===p.datum_params[0]&&f.datum_params[1]===p.datum_params[1]&&f.datum_params[2]===p.datum_params[2]&&f.datum_params[3]===p.datum_params[3]&&f.datum_params[4]===p.datum_params[4]&&f.datum_params[5]===p.datum_params[5]&&f.datum_params[6]===p.datum_params[6])}function oe(f,p,y){var b,I,v,N,O=f.x,G=f.y,W=f.z?f.z:0;if(G<-ht&&G>-1.001*ht)G=-ht;else if(G>ht&&G<1.001*ht)G=ht;else{if(G<-ht)return{x:-1/0,y:-1/0,z:f.z};if(G>ht)return{x:1/0,y:1/0,z:f.z}}return O>Math.PI&&(O-=2*Math.PI),I=Math.sin(G),N=Math.cos(G),v=I*I,b=y/Math.sqrt(1-p*v),{x:(b+W)*N*Math.cos(O),y:(b+W)*N*Math.sin(O),z:(b*(1-p)+W)*I}}function Gt(f,p,y,b){var I,v,N,O,G,W,Q,it,ct,wt,rt,Mt,T,i,s,a,h=f.x,c=f.y,d=f.z?f.z:0;if(I=Math.sqrt(h*h+c*c),v=Math.sqrt(h*h+c*c+d*d),I/y<1e-12){if(i=0,v/y<1e-12)return s=ht,a=-b,{x:f.x,y:f.y,z:f.z}}else i=Math.atan2(c,h);N=d/v,it=(O=I/v)*(1-p)*(G=1/Math.sqrt(1-p*(2-p)*O*O)),ct=N*G,T=0;do T++,W=p*(Q=y/Math.sqrt(1-p*ct*ct))/(Q+(a=I*it+d*ct-Q*(1-p*ct*ct))),Mt=(rt=N*(G=1/Math.sqrt(1-W*(2-W)*O*O)))*it-(wt=O*(1-W)*G)*ct,it=wt,ct=rt;while(Mt*Mt>1e-24&&T<30);return s=Math.atan(rt/Math.abs(wt)),{x:i,y:s,z:a}}function $t(f,p,y){if(p===Te)return{x:f.x+y[0],y:f.y+y[1],z:f.z+y[2]};if(p===se){var b=y[0],I=y[1],v=y[2],N=y[3],O=y[4],G=y[5],W=y[6];return{x:W*(f.x-G*f.y+O*f.z)+b,y:W*(G*f.x+f.y-N*f.z)+I,z:W*(-O*f.x+N*f.y+f.z)+v}}}function Ft(f,p,y){if(p===Te)return{x:f.x-y[0],y:f.y-y[1],z:f.z-y[2]};if(p===se){var b=y[0],I=y[1],v=y[2],N=y[3],O=y[4],G=y[5],W=y[6],Q=(f.x-b)/W,it=(f.y-I)/W,ct=(f.z-v)/W;return{x:Q+G*it-O*ct,y:-G*Q+it+N*ct,z:O*Q-N*it+ct}}}function te(f){return f===Te||f===se}function gt(f,p,y){if(f.grids===null||f.grids.length===0)return console.log("Grid shift grids not found"),-1;var b={x:-y.x,y:y.y},I={x:Number.NaN,y:Number.NaN},v=[];t:for(var N=0;N<f.grids.length;N++){var O=f.grids[N];if(v.push(O.name),O.isNull){I=b;break}if(O.grid!==null)for(var G=O.grid.subgrids,W=0,Q=G.length;W<Q;W++){var it=G[W],ct=(Math.abs(it.del[1])+Math.abs(it.del[0]))/1e4,wt=it.ll[0]-ct,rt=it.ll[1]-ct,Mt=it.ll[0]+(it.lim[0]-1)*it.del[0]+ct,T=it.ll[1]+(it.lim[1]-1)*it.del[1]+ct;if(!(rt>b.y||wt>b.x||T<b.y||Mt<b.x)&&(I=ii(b,p,it),!isNaN(I.x)))break t}else if(O.mandatory)return console.log("Unable to find mandatory grid '"+O.name+"'"),-1}return isNaN(I.x)?(console.log("Failed to find a grid shift table for location '"+-b.x*ue+" "+b.y*ue+" tried: '"+v+"'"),-1):(y.x=-I.x,y.y=I.y,0)}function ii(f,p,y){var b={x:Number.NaN,y:Number.NaN};if(isNaN(f.x))return b;var I={x:f.x,y:f.y};I.x-=y.ll[0],I.y-=y.ll[1],I.x=Tt(I.x-Math.PI)+Math.PI;var v=Rt(I,y);if(p){if(isNaN(v.x))return b;v.x=I.x-v.x,v.y=I.y-v.y;var N,O,G=9;do{if(O=Rt(v,y),isNaN(O.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}N={x:I.x-(O.x+v.x),y:I.y-(O.y+v.y)},v.x+=N.x,v.y+=N.y}while(G--&&Math.abs(N.x)>1e-12&&Math.abs(N.y)>1e-12);if(G<0)return console.log("Inverse grid shift iterator failed to converge."),b;b.x=Tt(v.x+y.ll[0]),b.y=v.y+y.ll[1]}else isNaN(v.x)||(b.x=f.x+v.x,b.y=f.y+v.y);return b}function Rt(f,p){var y,b={x:f.x/p.del[0],y:f.y/p.del[1]},I={x:Math.floor(b.x),y:Math.floor(b.y)},v={x:b.x-1*I.x,y:b.y-1*I.y},N={x:Number.NaN,y:Number.NaN};if(I.x<0||I.x>=p.lim[0]||I.y<0||I.y>=p.lim[1])return N;y=I.y*p.lim[0]+I.x;var O={x:p.cvs[y][0],y:p.cvs[y][1]};y++;var G={x:p.cvs[y][0],y:p.cvs[y][1]};y+=p.lim[0];var W={x:p.cvs[y][0],y:p.cvs[y][1]};y--;var Q={x:p.cvs[y][0],y:p.cvs[y][1]},it=v.x*v.y,ct=v.x*(1-v.y),wt=(1-v.x)*(1-v.y),rt=(1-v.x)*v.y;return N.x=wt*O.x+ct*G.x+rt*Q.x+it*W.x,N.y=wt*O.y+ct*G.y+rt*Q.y+it*W.y,N}function Ne(f){if(typeof Number.isFinite=="function"){if(Number.isFinite(f))return;throw new TypeError("coordinates must be finite numbers")}if(typeof f!="number"||f!==f||!isFinite(f))throw new TypeError("coordinates must be finite numbers")}function ye(f,p){return(f.datum.datum_type===Te||f.datum.datum_type===se||f.datum.datum_type===we)&&p.datumCode!=="WGS84"||(p.datum.datum_type===Te||p.datum.datum_type===se||p.datum.datum_type===we)&&f.datumCode!=="WGS84"}function mi(f,p,y,b){var I,v=(y=Array.isArray(y)?fr(y):{x:y.x,y:y.y,z:y.z,m:y.m}).z!==void 0;if(Hr(y),f.datum&&p.datum&&ye(f,p)&&(y=mi(f,I=new yt("WGS84"),y,b),f=I),b&&f.axis!=="enu"&&(y=re(f,!1,y)),f.projName==="longlat")y={x:y.x*fe,y:y.y*fe,z:y.z||0};else if(f.to_meter&&(y={x:y.x*f.to_meter,y:y.y*f.to_meter,z:y.z||0}),!(y=f.inverse(y)))return;if(f.from_greenwich&&(y.x+=f.from_greenwich),y=xe(f.datum,p.datum,y))return p.from_greenwich&&(y={x:y.x-p.from_greenwich,y:y.y,z:y.z||0}),p.projName==="longlat"?y={x:y.x*ue,y:y.y*ue,z:y.z||0}:(y=p.forward(y),p.to_meter&&(y={x:y.x/p.to_meter,y:y.y/p.to_meter,z:y.z||0})),b&&p.axis!=="enu"?re(p,!0,y):(y&&!v&&delete y.z,y)}function ke(f,p,y,b){var I,v,N;return Array.isArray(y)?(I=mi(f,p,y,b)||{x:NaN,y:NaN},y.length>2?f.name!==void 0&&f.name==="geocent"||p.name!==void 0&&p.name==="geocent"?typeof I.z=="number"?[I.x,I.y,I.z].concat(y.splice(3)):[I.x,I.y,y[2]].concat(y.splice(3)):[I.x,I.y].concat(y.splice(2)):[I.x,I.y]):(v=mi(f,p,y,b),(N=Object.keys(y)).length===2||N.forEach(function(O){if(f.name!==void 0&&f.name==="geocent"||p.name!==void 0&&p.name==="geocent"){if(O==="x"||O==="y"||O==="z")return}else if(O==="x"||O==="y")return;v[O]=y[O]}),v)}function Ke(f){return f instanceof yt?f:f.oProj?f.oProj:yt(f)}function ze(f,p,y){f=Ke(f);var b,I=!1;return p===void 0?(p=f,f=dr,I=!0):(p.x!==void 0||Array.isArray(p))&&(y=p,p=f,f=dr,I=!0),p=Ke(p),y?ke(f,p,y):(b={forward:function(v,N){return ke(f,p,v,N)},inverse:function(v,N){return ke(p,f,v,N)}},I&&(b.oProj=p),b)}function ne(f,p){return p=p||5,_i(Ge({lat:f[1],lon:f[0]}),p)}function xi(f){var p=he(ci(f.toUpperCase()));return p.lat&&p.lon?[p.lon,p.lat]:[(p.left+p.right)/2,(p.top+p.bottom)/2]}function hi(f){return f*(Math.PI/180)}function Ei(f){return f/Math.PI*180}function Ge(f){var p,y,b,I,v,N,O=f.lat,G=f.lon,W=6378137,Q=hi(O),it=hi(G);N=Math.floor((G+180)/6)+1,G===180&&(N=60),O>=56&&O<64&&G>=3&&G<12&&(N=32),O>=72&&O<84&&(G>=0&&G<9?N=31:G>=9&&G<21?N=33:G>=21&&G<33?N=35:G>=33&&G<42&&(N=37)),v=hi(6*(N-1)-180+3),p=W/Math.sqrt(1-.00669438*Math.sin(Q)*Math.sin(Q)),y=Math.tan(Q)*Math.tan(Q),b=.006739496752268451*Math.cos(Q)*Math.cos(Q);var ct=.9996*p*((I=Math.cos(Q)*(it-v))+(1-y+b)*I*I*I/6+(5-18*y+y*y+72*b-.39089081163157013)*I*I*I*I*I/120)+5e5,wt=.9996*(W*(.9983242984503243*Q-.002514607064228144*Math.sin(2*Q)+2639046602129982e-21*Math.sin(4*Q)-3418046101696858e-24*Math.sin(6*Q))+p*Math.tan(Q)*(I*I/2+(5-y+9*b+4*b*b)*I*I*I*I/24+(61-58*y+y*y+600*b-2.2240339282485886)*I*I*I*I*I*I/720));return O<0&&(wt+=1e7),{northing:Math.round(wt),easting:Math.round(ct),zoneNumber:N,zoneLetter:ee(O)}}function he(f){var p=f.northing,y=f.easting,b=f.zoneLetter,I=f.zoneNumber;if(I<0||I>60)return null;var v,N,O,G,W,Q,it,ct,wt=6378137,rt=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),Mt=y-5e5,T=p;b<"N"&&(T-=1e7),Q=6*(I-1)-180+3,ct=(it=T/.9996/6367449145945056e-9)+(3*rt/2-27*rt*rt*rt/32)*Math.sin(2*it)+(21*rt*rt/16-55*rt*rt*rt*rt/32)*Math.sin(4*it)+151*rt*rt*rt/96*Math.sin(6*it),v=wt/Math.sqrt(1-.00669438*Math.sin(ct)*Math.sin(ct)),N=Math.tan(ct)*Math.tan(ct),O=.006739496752268451*Math.cos(ct)*Math.cos(ct),G=.99330562*wt/Math.pow(1-.00669438*Math.sin(ct)*Math.sin(ct),1.5),W=Mt/(.9996*v);var i=ct-v*Math.tan(ct)/G*(W*W/2-(5+3*N+10*O-4*O*O-.06065547077041606)*W*W*W*W/24+(61+90*N+298*O+45*N*N-1.6983531815716497-3*O*O)*W*W*W*W*W*W/720);i=Ei(i);var s=(W-(1+2*N+O)*W*W*W/6+(5-2*O+28*N-3*O*O+.05391597401814761+24*N*N)*W*W*W*W*W/120)/Math.cos(ct);s=Q+Ei(s);var a;if(f.accuracy){var h=he({northing:f.northing+f.accuracy,easting:f.easting+f.accuracy,zoneLetter:f.zoneLetter,zoneNumber:f.zoneNumber});a={top:h.lat,right:h.lon,bottom:i,left:s}}else a={lat:i,lon:s};return a}function ee(f){var p="Z";return 84>=f&&f>=72?p="X":72>f&&f>=64?p="W":64>f&&f>=56?p="V":56>f&&f>=48?p="U":48>f&&f>=40?p="T":40>f&&f>=32?p="S":32>f&&f>=24?p="R":24>f&&f>=16?p="Q":16>f&&f>=8?p="P":8>f&&f>=0?p="N":0>f&&f>=-8?p="M":-8>f&&f>=-16?p="L":-16>f&&f>=-24?p="K":-24>f&&f>=-32?p="J":-32>f&&f>=-40?p="H":-40>f&&f>=-48?p="G":-48>f&&f>=-56?p="F":-56>f&&f>=-64?p="E":-64>f&&f>=-72?p="D":-72>f&&f>=-80&&(p="C"),p}function _i(f,p){var y="00000"+f.easting,b="00000"+f.northing;return f.zoneNumber+f.zoneLetter+St(f.easting,f.northing,f.zoneNumber)+y.substr(y.length-5,p)+b.substr(b.length-5,p)}function St(f,p,y){var b=Ci(y);return on(Math.floor(f/1e5),Math.floor(p/1e5)%20,b)}function Ci(f){var p=f%Je;return p===0&&(p=Je),p}function on(f,p,y){var b=y-1,I=_n.charCodeAt(b),v=Ho.charCodeAt(b),N=I+f-1,O=v+p,G=!1;return N>Ee&&(N=N-Ee+Oe-1,G=!0),(N===He||I<He&&N>He||(N>He||I<He)&&G)&&N++,(N===zi||I<zi&&N>zi||(N>zi||I<zi)&&G)&&++N===He&&N++,N>Ee&&(N=N-Ee+Oe-1),O>cn?(O=O-cn+Oe-1,G=!0):G=!1,(O===He||v<He&&O>He||(O>He||v<He)&&G)&&O++,(O===zi||v<zi&&O>zi||(O>zi||v<zi)&&G)&&++O===He&&O++,O>cn&&(O=O-cn+Oe-1),String.fromCharCode(N)+String.fromCharCode(O)}function ci(f){if(f&&f.length===0)throw"MGRSPoint coverting from nothing";for(var p,y=f.length,b=null,I="",v=0;!/[A-Z]/.test(p=f.charAt(v));){if(v>=2)throw"MGRSPoint bad conversion from: "+f;I+=p,v++}var N=parseInt(I,10);if(v===0||v+3>y)throw"MGRSPoint bad conversion from: "+f;var O=f.charAt(v++);if(O<="A"||O==="B"||O==="Y"||O>="Z"||O==="I"||O==="O")throw"MGRSPoint zone letter "+O+" not handled: "+f;b=f.substring(v,v+=2);for(var G=Ci(N),W=Ui(b.charAt(0),G),Q=ni(b.charAt(1),G);Q<qi(O);)Q+=2e6;var it=y-v;if(it%2!=0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+f;var ct,wt,rt,Mt,T,i=it/2,s=0,a=0;return i>0&&(ct=1e5/Math.pow(10,i),wt=f.substring(v,v+i),s=parseFloat(wt)*ct,rt=f.substring(v+i),a=parseFloat(rt)*ct),Mt=s+W,T=a+Q,{easting:Mt,northing:T,zoneLetter:O,zoneNumber:N,accuracy:ct}}function Ui(f,p){for(var y=_n.charCodeAt(p-1),b=1e5,I=!1;y!==f.charCodeAt(0);){if(++y===He&&y++,y===zi&&y++,y>Ee){if(I)throw"Bad character: "+f;y=Oe,I=!0}b+=1e5}return b}function ni(f,p){if(f>"V")throw"MGRSPoint given invalid Northing "+f;for(var y=Ho.charCodeAt(p-1),b=0,I=!1;y!==f.charCodeAt(0);){if(++y===He&&y++,y===zi&&y++,y>cn){if(I)throw"Bad character: "+f;y=Oe,I=!0}b+=1e5}return b}function qi(f){var p;switch(f){case"C":p=11e5;break;case"D":p=2e6;break;case"E":p=28e5;break;case"F":p=37e5;break;case"G":p=46e5;break;case"H":p=55e5;break;case"J":p=64e5;break;case"K":p=73e5;break;case"L":p=82e5;break;case"M":p=91e5;break;case"N":p=0;break;case"P":p=8e5;break;case"Q":p=17e5;break;case"R":p=26e5;break;case"S":p=35e5;break;case"T":p=44e5;break;case"U":p=53e5;break;case"V":p=62e5;break;case"W":p=7e6;break;case"X":p=79e5;break;default:p=-1}if(p>=0)return p;throw"Invalid zone letter: "+f}function qe(f,p,y){if(!(this instanceof qe))return new qe(f,p,y);if(Array.isArray(f))this.x=f[0],this.y=f[1],this.z=f[2]||0;else if(typeof f=="object")this.x=f.x,this.y=f.y,this.z=f.z||0;else if(typeof f=="string"&&p===void 0){var b=f.split(",");this.x=parseFloat(b[0],10),this.y=parseFloat(b[1],10),this.z=parseFloat(b[2],10)||0}else this.x=f,this.y=p,this.z=y||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}function ce(f){var p=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],y=typeof f.PROJECTION=="object"?Object.keys(f.PROJECTION)[0]:f.PROJECTION;return"no_uoff"in f||"no_off"in f||p.indexOf(y)!==-1}function cr(f){var p,y=[];return y[0]=f*qo,p=f*f,y[0]+=p*Jo,y[1]=p*Cl,p*=f,y[0]+=p*El,y[1]+=p*Al,y[2]=p*Ie,y}function Xn(f,p){var y=f+f;return f+p[0]*Math.sin(y)+p[1]*Math.sin(y+y)+p[2]*Math.sin(y+y+y)}function Vn(f,p,y,b){var I;return f<Ct?(b.value=bt.AREA_0,I=0):(I=Math.atan2(p,y),Math.abs(I)<=Wt?b.value=bt.AREA_0:I>Wt&&I<=ht+Wt?(b.value=bt.AREA_1,I-=ht):I>ht+Wt||I<=-(ht+Wt)?(b.value=bt.AREA_2,I=I>=0?I-Vt:I+Vt):(b.value=bt.AREA_3,I+=ht)),I}function Ae(f,p){var y=f+p;return y<-Vt?y+=si:y>+Vt&&(y-=si),y}function It(f,p,y,b){for(var I=p;b;--b){var v=f(I);if(I-=v,Math.abs(v)<y)break}return I}var Te=1,se=2,we=3,xn=4,vn=5,an=484813681109536e-20,ht=Math.PI/2,Gi=.16666666666666666,On=.04722222222222222,Bs=.022156084656084655,Ct=1e-10,fe=.017453292519943295,ue=57.29577951308232,Wt=Math.PI/4,si=2*Math.PI,Vt=3.14159265359,Le={};Le.greenwich=0,Le.lisbon=-9.131906111111,Le.paris=2.337229166667,Le.bogota=-74.080916666667,Le.madrid=-3.687938888889,Le.rome=12.452333333333,Le.bern=7.439583333333,Le.jakarta=106.807719444444,Le.ferro=-17.666666666667,Le.brussels=4.367975,Le.stockholm=18.058277777778,Le.athens=23.7163375,Le.oslo=10.722916666667;var ui={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Se=/[\s_\-\/\(\)]/g,de=function(f){var p,y,b,I={},v=f.split("+").map(function(O){return O.trim()}).filter(function(O){return O}).reduce(function(O,G){var W=G.split("=");return W.push(!0),O[W[0].toLowerCase()]=W[1],O},{}),N={proj:"projName",datum:"datumCode",rf:function(O){I.rf=parseFloat(O)},lat_0:function(O){I.lat0=O*fe},lat_1:function(O){I.lat1=O*fe},lat_2:function(O){I.lat2=O*fe},lat_ts:function(O){I.lat_ts=O*fe},lon_0:function(O){I.long0=O*fe},lon_1:function(O){I.long1=O*fe},lon_2:function(O){I.long2=O*fe},alpha:function(O){I.alpha=parseFloat(O)*fe},gamma:function(O){I.rectified_grid_angle=parseFloat(O)},lonc:function(O){I.longc=O*fe},x_0:function(O){I.x0=parseFloat(O)},y_0:function(O){I.y0=parseFloat(O)},k_0:function(O){I.k0=parseFloat(O)},k:function(O){I.k0=parseFloat(O)},a:function(O){I.a=parseFloat(O)},b:function(O){I.b=parseFloat(O)},r_a:function(){I.R_A=!0},zone:function(O){I.zone=parseInt(O,10)},south:function(){I.utmSouth=!0},towgs84:function(O){I.datum_params=O.split(",").map(function(G){return parseFloat(G)})},to_meter:function(O){I.to_meter=parseFloat(O)},units:function(O){I.units=O;var G=e(ui,O);G&&(I.to_meter=G.to_meter)},from_greenwich:function(O){I.from_greenwich=O*fe},pm:function(O){var G=e(Le,O);I.from_greenwich=(G||parseFloat(O))*fe},nadgrids:function(O){O==="@null"?I.datumCode="none":I.nadgrids=O},axis:function(O){O.length===3&&"ewnsud".indexOf(O.substr(0,1))!==-1&&"ewnsud".indexOf(O.substr(1,1))!==-1&&"ewnsud".indexOf(O.substr(2,1))!==-1&&(I.axis=O)},approx:function(){I.approx=!0}};for(p in v)y=v[p],p in N?typeof(b=N[p])=="function"?b(y):I[b]=y:I[p]=y;return typeof I.datumCode=="string"&&I.datumCode!=="WGS84"&&(I.datumCode=I.datumCode.toLowerCase()),I},Ye=1,Ri=/\s/,vt=/[A-Za-z]/,fs=/[A-Za-z84_]/,ds=/[,\]]/,Ai=/[\d\.E\-\+]/;n.prototype.readCharicter=function(){var f=this.text[this.place++];if(this.state!==4)for(;Ri.test(f);){if(this.place>=this.text.length)return;f=this.text[this.place++]}switch(this.state){case Ye:return this.neutral(f);case 2:return this.keyword(f);case 4:return this.quoted(f);case 5:return this.afterquote(f);case 3:return this.number(f);case-1:return}},n.prototype.afterquote=function(f){if(f==='"')return this.word+='"',void(this.state=4);if(ds.test(f))return this.word=this.word.trim(),void this.afterItem(f);throw new Error(`havn't handled "`+f+'" in afterquote yet, index '+this.place)},n.prototype.afterItem=function(f){return f===","?(this.word!==null&&this.currentObject.push(this.word),this.word=null,void(this.state=Ye)):f==="]"?(this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Ye,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},n.prototype.number=function(f){if(!Ai.test(f)){if(ds.test(f))return this.word=parseFloat(this.word),void this.afterItem(f);throw new Error(`havn't handled "`+f+'" in number yet, index '+this.place)}this.word+=f},n.prototype.quoted=function(f){f!=='"'?this.word+=f:this.state=5},n.prototype.keyword=function(f){if(fs.test(f))this.word+=f;else{if(f==="["){var p=[];return p.push(this.word),this.level++,this.root===null?this.root=p:this.currentObject.push(p),this.stack.push(this.currentObject),this.currentObject=p,void(this.state=Ye)}if(!ds.test(f))throw new Error(`havn't handled "`+f+'" in keyword yet, index '+this.place);this.afterItem(f)}},n.prototype.neutral=function(f){if(vt.test(f))return this.word=f,void(this.state=2);if(f==='"')return this.word="",void(this.state=4);if(Ai.test(f))return this.word=f,void(this.state=3);{if(!ds.test(f))throw new Error(`havn't handled "`+f+'" in neutral yet, index '+this.place);this.afterItem(f)}},n.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===-1)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var gs=.017453292519943295,ks=function(f){var p=o(f),y=p.shift(),b=p.shift();p.unshift(["name",b]),p.unshift(["type",y]);var I={};return u(p,I),E(I),I};(function(f){f("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),f("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),f("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),f.WGS84=f["EPSG:4326"],f["EPSG:3785"]=f["EPSG:3857"],f.GOOGLE=f["EPSG:3857"],f["EPSG:900913"]=f["EPSG:3857"],f["EPSG:102113"]=f["EPSG:3857"]})(w);var ur=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],ln=["3857","900913","3785","102113"],Yo=function(f,p){f=f||{};var y,b;if(!p)return f;for(b in p)(y=p[b])!==void 0&&(f[b]=y);return f},hn=function(f,p,y){var b=f*p;return y/Math.sqrt(1-b*b)},vi=function(f){return f<0?-1:1},Tt=function(f){return Math.abs(f)<=Vt?f:f-vi(f)*si},ae=function(f,p,y){var b=f*y,I=.5*f;return b=Math.pow((1-b)/(1+b),I),Math.tan(.5*(ht-p))/b},ms=function(f,p){for(var y,b,I=.5*f,v=ht-2*Math.atan(p),N=0;N<=15;N++)if(y=f*Math.sin(v),b=ht-2*Math.atan(p*Math.pow((1-y)/(1+y),I))-v,v+=b,Math.abs(b)<=1e-10)return v;return-9999},Nn=[{init:function(){var f=this.b/this.a;this.es=1-f*f,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=hn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(f){var p=f.x,y=f.y;if(y*ue>90&&y*ue<-90&&p*ue>180&&p*ue<-180)return null;var b,I;if(Math.abs(Math.abs(y)-ht)<=Ct)return null;if(this.sphere)b=this.x0+this.a*this.k0*Tt(p-this.long0),I=this.y0+this.a*this.k0*Math.log(Math.tan(Wt+.5*y));else{var v=Math.sin(y),N=ae(this.e,y,v);b=this.x0+this.a*this.k0*Tt(p-this.long0),I=this.y0-this.a*this.k0*Math.log(N)}return f.x=b,f.y=I,f},inverse:function(f){var p,y,b=f.x-this.x0,I=f.y-this.y0;if(this.sphere)y=ht-2*Math.atan(Math.exp(-I/(this.a*this.k0)));else{var v=Math.exp(-I/(this.a*this.k0));if((y=ms(this.e,v))===-9999)return null}return p=Tt(this.long0+b/(this.a*this.k0)),f.x=p,f.y=y,f},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:U,inverse:U,names:["longlat","identity"]}],xs={},dt=[],xl={start:function(){Nn.forEach(Y)},add:Y,get:function(f){if(!f)return!1;var p=f.toLowerCase();return xs[p]!==void 0&&dt[xs[p]]?dt[xs[p]]:void 0}},Ot={};Ot.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},Ot.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},Ot.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},Ot.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},Ot.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},Ot.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},Ot.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},Ot.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},Ot.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},Ot.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},Ot.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},Ot.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},Ot.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},Ot.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},Ot.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},Ot.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},Ot.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},Ot.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},Ot.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},Ot.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},Ot.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},Ot.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},Ot.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},Ot.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},Ot.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},Ot.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},Ot.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},Ot.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},Ot.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},Ot.hough={a:6378270,rf:297,ellipseName:"Hough"},Ot.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},Ot.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},Ot.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},Ot.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},Ot.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},Ot.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},Ot.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},Ot.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},Ot.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},Ot.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},Ot.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},Ot.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var _s=Ot.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Ot.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var ri={};ri.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ri.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ri.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},ri.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},ri.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},ri.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},ri.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},ri.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},ri.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},ri.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ri.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},ri.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},ri.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},ri.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},ri.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},ri.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},ri.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},ri.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var me={};yt.projections=xl,yt.projections.start();var xe=function(f,p,y){if(Lt(f,p)||f.datum_type===vn||p.datum_type===vn)return y;var b=f.a,I=f.es;if(f.datum_type===we){if(gt(f,!1,y)!==0)return;b=6378137,I=.0066943799901413165}var v=p.a,N=p.b,O=p.es;return p.datum_type===we&&(v=6378137,N=6356752314e-3,O=.0066943799901413165),I!==O||b!==v||te(f.datum_type)||te(p.datum_type)?(y=oe(y,I,b),te(f.datum_type)&&(y=$t(y,f.datum_type,f.datum_params)),te(p.datum_type)&&(y=Ft(y,p.datum_type,p.datum_params)),y=Gt(y,O,v,N),p.datum_type!==we||gt(p,!0,y)===0?y:void 0):y},re=function(f,p,y){var b,I,v,N=y.x,O=y.y,G=y.z||0,W={};for(v=0;v<3;v++)if(!p||v!==2||y.z!==void 0)switch(v===0?(b=N,I="ew".indexOf(f.axis[v])!==-1?"x":"y"):v===1?(b=O,I="ns".indexOf(f.axis[v])!==-1?"y":"x"):(b=G,I="z"),f.axis[v]){case"e":W[I]=b;break;case"w":W[I]=-b;break;case"n":W[I]=b;break;case"s":W[I]=-b;break;case"u":y[I]!==void 0&&(W.z=b);break;case"d":y[I]!==void 0&&(W.z=-b);break;default:return null}return W},fr=function(f){var p={x:f[0],y:f[1]};return f.length>2&&(p.z=f[2]),f.length>3&&(p.m=f[3]),p},Hr=function(f){Ne(f.x),Ne(f.y)},dr=yt("WGS84"),Je=6,_n="AJSAJS",Ho="AFAFAF",Oe=65,He=73,zi=79,cn=86,Ee=90,pi={forward:ne,inverse:function(f){var p=he(ci(f.toUpperCase()));return p.lat&&p.lon?[p.lon,p.lat,p.lon,p.lat]:[p.left,p.bottom,p.right,p.top]},toPoint:xi};qe.fromMGRS=function(f){return new qe(xi(f))},qe.prototype.toMGRS=function(f){return ne([this.x,this.y],f)};var et=.01068115234375,B=function(f){var p=[];p[0]=1-f*(.25+f*(.046875+f*(.01953125+f*et))),p[1]=f*(.75-f*(.046875+f*(.01953125+f*et)));var y=f*f;return p[2]=y*(.46875-f*(.013020833333333334+.007120768229166667*f)),y*=f,p[3]=y*(.3645833333333333-.005696614583333333*f),p[4]=y*f*.3076171875,p},Nt=function(f,p,y,b){return y*=p,p*=p,b[0]*f-y*(b[1]+p*(b[2]+p*(b[3]+p*b[4])))},oi=function(f,p,y){for(var b=1/(1-p),I=f,v=20;v;--v){var N=Math.sin(I),O=1-p*N*N;if(O=(Nt(I,N,Math.cos(I),y)-f)*(O*Math.sqrt(O))*b,I-=O,Math.abs(O)<Ct)return I}return I},Ii={init:function(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=B(this.es),this.ml0=Nt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(f){var p,y,b,I=f.x,v=f.y,N=Tt(I-this.long0),O=Math.sin(v),G=Math.cos(v);if(this.es){var W=G*N,Q=Math.pow(W,2),it=this.ep2*Math.pow(G,2),ct=Math.pow(it,2),wt=Math.abs(G)>Ct?Math.tan(v):0,rt=Math.pow(wt,2),Mt=Math.pow(rt,2);p=1-this.es*Math.pow(O,2),W/=Math.sqrt(p);var T=Nt(v,O,G,this.en);y=this.a*(this.k0*W*(1+Q/6*(1-rt+it+Q/20*(5-18*rt+Mt+14*it-58*rt*it+Q/42*(61+179*Mt-Mt*rt-479*rt)))))+this.x0,b=this.a*(this.k0*(T-this.ml0+O*N*W/2*(1+Q/12*(5-rt+9*it+4*ct+Q/30*(61+Mt-58*rt+270*it-330*rt*it+Q/56*(1385+543*Mt-Mt*rt-3111*rt))))))+this.y0}else{var i=G*Math.sin(N);if(Math.abs(Math.abs(i)-1)<Ct)return 93;if(y=.5*this.a*this.k0*Math.log((1+i)/(1-i))+this.x0,b=G*Math.cos(N)/Math.sqrt(1-Math.pow(i,2)),(i=Math.abs(b))>=1){if(i-1>Ct)return 93;b=0}else b=Math.acos(b);v<0&&(b=-b),b=this.a*this.k0*(b-this.lat0)+this.y0}return f.x=y,f.y=b,f},inverse:function(f){var p,y,b,I,v=(f.x-this.x0)*(1/this.a),N=(f.y-this.y0)*(1/this.a);if(this.es)if(p=this.ml0+N/this.k0,y=oi(p,this.es,this.en),Math.abs(y)<ht){var O=Math.sin(y),G=Math.cos(y),W=Math.abs(G)>Ct?Math.tan(y):0,Q=this.ep2*Math.pow(G,2),it=Math.pow(Q,2),ct=Math.pow(W,2),wt=Math.pow(ct,2);p=1-this.es*Math.pow(O,2);var rt=v*Math.sqrt(p)/this.k0,Mt=Math.pow(rt,2);b=y-(p*=W)*Mt/(1-this.es)*.5*(1-Mt/12*(5+3*ct-9*Q*ct+Q-4*it-Mt/30*(61+90*ct-252*Q*ct+45*wt+46*Q-Mt/56*(1385+3633*ct+4095*wt+1574*wt*ct)))),I=Tt(this.long0+rt*(1-Mt/6*(1+2*ct+Q-Mt/20*(5+28*ct+24*wt+8*Q*ct+6*Q-Mt/42*(61+662*ct+1320*wt+720*wt*ct))))/G)}else b=ht*vi(N),I=0;else{var T=Math.exp(v/this.k0),i=.5*(T-1/T),s=this.lat0+N/this.k0,a=Math.cos(s);p=Math.sqrt((1-Math.pow(a,2))/(1+Math.pow(i,2))),b=Math.asin(p),N<0&&(b=-b),I=i===0&&a===0?0:Tt(Math.atan2(i,a)+this.long0)}return f.x=I,f.y=b,f},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]},jo=function(f){var p=Math.exp(f);return p=(p-1/p)/2},Oi=function(f,p){f=Math.abs(f),p=Math.abs(p);var y=Math.max(f,p),b=Math.min(f,p)/(y||1);return y*Math.sqrt(1+Math.pow(b,2))},Wi=function(f){var p=1+f,y=p-1;return y===0?f:f*Math.log(p)/y},Dt=function(f){var p=Math.abs(f);return p=Wi(p*(1+p/(Oi(1,p)+1))),f<0?-p:p},Pe=function(f,p){for(var y,b=2*Math.cos(2*p),I=f.length-1,v=f[I],N=0;--I>=0;)y=b*v-N+f[I],N=v,v=y;return p+y*Math.sin(2*p)},Zo=function(f,p){for(var y,b=2*Math.cos(p),I=f.length-1,v=f[I],N=0;--I>=0;)y=b*v-N+f[I],N=v,v=y;return Math.sin(p)*y},_l=function(f){var p=Math.exp(f);return p=(p+1/p)/2},gr=function(f,p,y){for(var b,I,v=Math.sin(p),N=Math.cos(p),O=jo(y),G=_l(y),W=2*N*G,Q=-2*v*O,it=f.length-1,ct=f[it],wt=0,rt=0,Mt=0;--it>=0;)b=rt,I=wt,ct=W*(rt=ct)-b-Q*(wt=Mt)+f[it],Mt=Q*rt-I+W*wt;return W=v*G,Q=N*O,[W*ct-Q*Mt,W*Mt+Q*ct]},Yn={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ii.init.apply(this),this.forward=Ii.forward,this.inverse=Ii.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var f=this.es/(1+Math.sqrt(1-this.es)),p=f/(2-f),y=p;this.cgb[0]=p*(2+p*(-2/3+p*(p*(116/45+p*(26/45+p*(-2854/675)))-2))),this.cbg[0]=p*(p*(2/3+p*(4/3+p*(-82/45+p*(32/45+p*(4642/4725)))))-2),y*=p,this.cgb[1]=y*(7/3+p*(p*(-227/45+p*(2704/315+p*(2323/945)))-1.6)),this.cbg[1]=y*(5/3+p*(-16/15+p*(-13/9+p*(904/315+p*(-1522/945))))),y*=p,this.cgb[2]=y*(56/15+p*(-136/35+p*(-1262/105+p*(73814/2835)))),this.cbg[2]=y*(-26/15+p*(34/21+p*(1.6+p*(-12686/2835)))),y*=p,this.cgb[3]=y*(4279/630+p*(-332/35+p*(-399572/14175))),this.cbg[3]=y*(1237/630+p*(p*(-24832/14175)-2.4)),y*=p,this.cgb[4]=y*(4174/315+p*(-144838/6237)),this.cbg[4]=y*(-734/315+p*(109598/31185)),y*=p,this.cgb[5]=y*(601676/22275),this.cbg[5]=y*(444337/155925),y=Math.pow(p,2),this.Qn=this.k0/(1+p)*(1+y*(.25+y*(1/64+y/256))),this.utg[0]=p*(p*(2/3+p*(-37/96+p*(1/360+p*(81/512+p*(-96199/604800)))))-.5),this.gtu[0]=p*(.5+p*(-2/3+p*(5/16+p*(41/180+p*(-127/288+p*(7891/37800)))))),this.utg[1]=y*(-1/48+p*(-1/15+p*(437/1440+p*(-46/105+p*(1118711/3870720))))),this.gtu[1]=y*(13/48+p*(p*(557/1440+p*(281/630+p*(-1983433/1935360)))-.6)),y*=p,this.utg[2]=y*(-17/480+p*(37/840+p*(209/4480+p*(-5569/90720)))),this.gtu[2]=y*(61/240+p*(-103/140+p*(15061/26880+p*(167603/181440)))),y*=p,this.utg[3]=y*(-4397/161280+p*(11/504+p*(830251/7257600))),this.gtu[3]=y*(49561/161280+p*(-179/168+p*(6601661/7257600))),y*=p,this.utg[4]=y*(-4583/161280+p*(108847/3991680)),this.gtu[4]=y*(34729/80640+p*(-3418889/1995840)),y*=p,this.utg[5]=-.03233083094085698*y,this.gtu[5]=.6650675310896665*y;var b=Pe(this.cbg,this.lat0);this.Zb=-this.Qn*(b+Zo(this.gtu,2*b))},forward:function(f){var p=Tt(f.x-this.long0),y=f.y;y=Pe(this.cbg,y);var b=Math.sin(y),I=Math.cos(y),v=Math.sin(p),N=Math.cos(p);y=Math.atan2(b,N*I),p=Math.atan2(v*I,Oi(b,I*N)),p=Dt(Math.tan(p));var O=gr(this.gtu,2*y,2*p);y+=O[0],p+=O[1];var G,W;return Math.abs(p)<=2.623395162778?(G=this.a*(this.Qn*p)+this.x0,W=this.a*(this.Qn*y+this.Zb)+this.y0):(G=1/0,W=1/0),f.x=G,f.y=W,f},inverse:function(f){var p=(f.x-this.x0)*(1/this.a),y=(f.y-this.y0)*(1/this.a);y=(y-this.Zb)/this.Qn,p/=this.Qn;var b,I;if(Math.abs(p)<=2.623395162778){var v=gr(this.utg,2*y,2*p);y+=v[0],p+=v[1],p=Math.atan(jo(p));var N=Math.sin(y),O=Math.cos(y),G=Math.sin(p),W=Math.cos(p);y=Math.atan2(N*W,Oi(G,W*O)),p=Math.atan2(G,W*O),b=Tt(p+this.long0),I=Pe(this.cgb,y)}else b=1/0,I=1/0;return f.x=b,f.y=I,f},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]},jr=function(f,p){if(f===void 0){if((f=Math.floor(30*(Tt(p)+Math.PI)/Math.PI)+1)<0)return 0;if(f>60)return 60}return f},pl={init:function(){var f=jr(this.zone,this.long0);if(f===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(f)-183)*fe,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Yn.init.apply(this),this.forward=Yn.forward,this.inverse=Yn.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},Qe=function(f,p){return Math.pow((1-f)/(1+f),p)},Gs=20,un={init:function(){var f=Math.sin(this.lat0),p=Math.cos(this.lat0);p*=p,this.rc=Math.sqrt(1-this.es)/(1-this.es*f*f),this.C=Math.sqrt(1+this.es*p*p/(1-this.es)),this.phic0=Math.asin(f/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Wt)/(Math.pow(Math.tan(.5*this.lat0+Wt),this.C)*Qe(this.e*f,this.ratexp))},forward:function(f){var p=f.x,y=f.y;return f.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*y+Wt),this.C)*Qe(this.e*Math.sin(y),this.ratexp))-ht,f.x=this.C*p,f},inverse:function(f){for(var p=f.x/this.C,y=f.y,b=Math.pow(Math.tan(.5*y+Wt)/this.K,1/this.C),I=Gs;I>0&&(y=2*Math.atan(b*Qe(this.e*Math.sin(f.y),-.5*this.e))-ht,!(Math.abs(y-f.y)<1e-14));--I)f.y=y;return I?(f.x=p,f.y=y,f):null},names:["gauss"]},Ut={init:function(){un.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(f){var p,y,b,I;return f.x=Tt(f.x-this.long0),un.forward.apply(this,[f]),p=Math.sin(f.y),y=Math.cos(f.y),b=Math.cos(f.x),I=this.k0*this.R2/(1+this.sinc0*p+this.cosc0*y*b),f.x=I*y*Math.sin(f.x),f.y=I*(this.cosc0*p-this.sinc0*y*b),f.x=this.a*f.x+this.x0,f.y=this.a*f.y+this.y0,f},inverse:function(f){var p,y,b,I,v;if(f.x=(f.x-this.x0)/this.a,f.y=(f.y-this.y0)/this.a,f.x/=this.k0,f.y/=this.k0,v=Oi(f.x,f.y)){var N=2*Math.atan2(v,this.R2);p=Math.sin(N),y=Math.cos(N),I=Math.asin(y*this.sinc0+f.y*p*this.cosc0/v),b=Math.atan2(f.x*p,v*this.cosc0*y-f.y*this.sinc0*p)}else I=this.phic0,b=0;return f.x=b,f.y=I,un.inverse.apply(this,[f]),f.x=Tt(f.x+this.long0),f},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},yl={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Ct&&(this.k0=.5*(1+vi(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Ct&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Ct&&Math.abs(Math.cos(this.lat_ts))>Ct&&(this.k0=.5*this.cons*hn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/ae(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=hn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-ht,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(f){var p,y,b,I,v,N,O=f.x,G=f.y,W=Math.sin(G),Q=Math.cos(G),it=Tt(O-this.long0);return Math.abs(Math.abs(O-this.long0)-Math.PI)<=Ct&&Math.abs(G+this.lat0)<=Ct?(f.x=NaN,f.y=NaN,f):this.sphere?(p=2*this.k0/(1+this.sinlat0*W+this.coslat0*Q*Math.cos(it)),f.x=this.a*p*Q*Math.sin(it)+this.x0,f.y=this.a*p*(this.coslat0*W-this.sinlat0*Q*Math.cos(it))+this.y0,f):(y=2*Math.atan(this.ssfn_(G,W,this.e))-ht,I=Math.cos(y),b=Math.sin(y),Math.abs(this.coslat0)<=Ct?(v=ae(this.e,G*this.con,this.con*W),N=2*this.a*this.k0*v/this.cons,f.x=this.x0+N*Math.sin(O-this.long0),f.y=this.y0-this.con*N*Math.cos(O-this.long0),f):(Math.abs(this.sinlat0)<Ct?(p=2*this.a*this.k0/(1+I*Math.cos(it)),f.y=p*b):(p=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*b+this.cosX0*I*Math.cos(it))),f.y=p*(this.cosX0*b-this.sinX0*I*Math.cos(it))+this.y0),f.x=p*I*Math.sin(it)+this.x0,f))},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var p,y,b,I,v,N=Math.sqrt(f.x*f.x+f.y*f.y);if(this.sphere){var O=2*Math.atan(N/(2*this.a*this.k0));return p=this.long0,y=this.lat0,N<=Ct?(f.x=p,f.y=y,f):(y=Math.asin(Math.cos(O)*this.sinlat0+f.y*Math.sin(O)*this.coslat0/N),p=Tt(Math.abs(this.coslat0)<Ct?this.lat0>0?this.long0+Math.atan2(f.x,-1*f.y):this.long0+Math.atan2(f.x,f.y):this.long0+Math.atan2(f.x*Math.sin(O),N*this.coslat0*Math.cos(O)-f.y*this.sinlat0*Math.sin(O))),f.x=p,f.y=y,f)}if(Math.abs(this.coslat0)<=Ct){if(N<=Ct)return y=this.lat0,p=this.long0,f.x=p,f.y=y,f;f.x*=this.con,f.y*=this.con,b=N*this.cons/(2*this.a*this.k0),y=this.con*ms(this.e,b),p=this.con*Tt(this.con*this.long0+Math.atan2(f.x,-1*f.y))}else I=2*Math.atan(N*this.cosX0/(2*this.a*this.k0*this.ms1)),p=this.long0,N<=Ct?v=this.X0:(v=Math.asin(Math.cos(I)*this.sinX0+f.y*Math.sin(I)*this.cosX0/N),p=Tt(this.long0+Math.atan2(f.x*Math.sin(I),N*this.cosX0*Math.cos(I)-f.y*this.sinX0*Math.sin(I)))),y=-1*ms(this.e,Math.tan(.5*(ht+v)));return f.x=p,f.y=y,f},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],ssfn_:function(f,p,y){return p*=y,Math.tan(.5*(ht+f))*Math.pow((1-p)/(1+p),.5*y)}},Zt={init:function(){var f=this.lat0;this.lambda0=this.long0;var p=Math.sin(f),y=this.a,b=1/this.rf,I=2*b-Math.pow(b,2),v=this.e=Math.sqrt(I);this.R=this.k0*y*Math.sqrt(1-I)/(1-I*Math.pow(p,2)),this.alpha=Math.sqrt(1+I/(1-I)*Math.pow(Math.cos(f),4)),this.b0=Math.asin(p/this.alpha);var N=Math.log(Math.tan(Math.PI/4+this.b0/2)),O=Math.log(Math.tan(Math.PI/4+f/2)),G=Math.log((1+v*p)/(1-v*p));this.K=N-this.alpha*O+this.alpha*v/2*G},forward:function(f){var p=Math.log(Math.tan(Math.PI/4-f.y/2)),y=this.e/2*Math.log((1+this.e*Math.sin(f.y))/(1-this.e*Math.sin(f.y))),b=-this.alpha*(p+y)+this.K,I=2*(Math.atan(Math.exp(b))-Math.PI/4),v=this.alpha*(f.x-this.lambda0),N=Math.atan(Math.sin(v)/(Math.sin(this.b0)*Math.tan(I)+Math.cos(this.b0)*Math.cos(v))),O=Math.asin(Math.cos(this.b0)*Math.sin(I)-Math.sin(this.b0)*Math.cos(I)*Math.cos(v));return f.y=this.R/2*Math.log((1+Math.sin(O))/(1-Math.sin(O)))+this.y0,f.x=this.R*N+this.x0,f},inverse:function(f){for(var p=f.x-this.x0,y=f.y-this.y0,b=p/this.R,I=2*(Math.atan(Math.exp(y/this.R))-Math.PI/4),v=Math.asin(Math.cos(this.b0)*Math.sin(I)+Math.sin(this.b0)*Math.cos(I)*Math.cos(b)),N=Math.atan(Math.sin(b)/(Math.cos(this.b0)*Math.cos(b)-Math.sin(this.b0)*Math.tan(I))),O=this.lambda0+N/this.alpha,G=0,W=v,Q=-1e3,it=0;Math.abs(W-Q)>1e-7;){if(++it>20)return;G=1/this.alpha*(Math.log(Math.tan(Math.PI/4+v/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(W))/2)),Q=W,W=2*Math.atan(Math.exp(G))-Math.PI/2}return f.x=O,f.y=W,f},names:["somerc"]},We=1e-7,wl={init:function(){var f,p,y,b,I,v,N,O,G,W,Q,it=0,ct=0,wt=0,rt=0,Mt=0,T=0,i=0;this.no_off=ce(this),this.no_rot="no_rot"in this;var s=!1;"alpha"in this&&(s=!0);var a=!1;if("rectified_grid_angle"in this&&(a=!0),s&&(i=this.alpha),a&&(it=this.rectified_grid_angle*fe),s||a)ct=this.longc;else if(wt=this.long1,Mt=this.lat1,rt=this.long2,T=this.lat2,Math.abs(Mt-T)<=We||(f=Math.abs(Mt))<=We||Math.abs(f-ht)<=We||Math.abs(Math.abs(this.lat0)-ht)<=We||Math.abs(Math.abs(T)-ht)<=We)throw new Error;var h=1-this.es;p=Math.sqrt(h),Math.abs(this.lat0)>Ct?(O=Math.sin(this.lat0),y=Math.cos(this.lat0),f=1-this.es*O*O,this.B=y*y,this.B=Math.sqrt(1+this.es*this.B*this.B/h),this.A=this.B*this.k0*p/f,(I=(b=this.B*p/(y*Math.sqrt(f)))*b-1)<=0?I=0:(I=Math.sqrt(I),this.lat0<0&&(I=-I)),this.E=I+=b,this.E*=Math.pow(ae(this.e,this.lat0,O),this.B)):(this.B=1/p,this.A=this.k0,this.E=b=I=1),s||a?(s?(Q=Math.asin(Math.sin(i)/b),a||(it=i)):(Q=it,i=Math.asin(b*Math.sin(Q))),this.lam0=ct-Math.asin(.5*(I-1/I)*Math.tan(Q))/this.B):(v=Math.pow(ae(this.e,Mt,Math.sin(Mt)),this.B),N=Math.pow(ae(this.e,T,Math.sin(T)),this.B),I=this.E/v,G=(N-v)/(N+v),W=((W=this.E*this.E)-N*v)/(W+N*v),(f=wt-rt)<-Math.pi?rt-=si:f>Math.pi&&(rt+=si),this.lam0=Tt(.5*(wt+rt)-Math.atan(W*Math.tan(.5*this.B*(wt-rt))/G)/this.B),Q=Math.atan(2*Math.sin(this.B*Tt(wt-this.lam0))/(I-1/I)),it=i=Math.asin(b*Math.sin(Q))),this.singam=Math.sin(Q),this.cosgam=Math.cos(Q),this.sinrot=Math.sin(it),this.cosrot=Math.cos(it),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(b*b-1)/Math.cos(i))),this.lat0<0&&(this.u_0=-this.u_0)),I=.5*Q,this.v_pole_n=this.ArB*Math.log(Math.tan(Wt-I)),this.v_pole_s=this.ArB*Math.log(Math.tan(Wt+I))},forward:function(f){var p,y,b,I,v,N,O,G,W={};if(f.x=f.x-this.lam0,Math.abs(Math.abs(f.y)-ht)>Ct){if(v=this.E/Math.pow(ae(this.e,f.y,Math.sin(f.y)),this.B),N=1/v,p=.5*(v-N),y=.5*(v+N),I=Math.sin(this.B*f.x),b=(p*this.singam-I*this.cosgam)/y,Math.abs(Math.abs(b)-1)<Ct)throw new Error;G=.5*this.ArB*Math.log((1-b)/(1+b)),N=Math.cos(this.B*f.x),O=Math.abs(N)<We?this.A*f.x:this.ArB*Math.atan2(p*this.cosgam+I*this.singam,N)}else G=f.y>0?this.v_pole_n:this.v_pole_s,O=this.ArB*f.y;return this.no_rot?(W.x=O,W.y=G):(O-=this.u_0,W.x=G*this.cosrot+O*this.sinrot,W.y=O*this.cosrot-G*this.sinrot),W.x=this.a*W.x+this.x0,W.y=this.a*W.y+this.y0,W},inverse:function(f){var p,y,b,I,v,N,O,G={};if(f.x=(f.x-this.x0)*(1/this.a),f.y=(f.y-this.y0)*(1/this.a),this.no_rot?(y=f.y,p=f.x):(y=f.x*this.cosrot-f.y*this.sinrot,p=f.y*this.cosrot+f.x*this.sinrot+this.u_0),b=Math.exp(-this.BrA*y),I=.5*(b-1/b),v=.5*(b+1/b),N=Math.sin(this.BrA*p),O=(N*this.cosgam+I*this.singam)/v,Math.abs(Math.abs(O)-1)<Ct)G.x=0,G.y=O<0?-ht:ht;else{if(G.y=this.E/Math.sqrt((1+O)/(1-O)),G.y=ms(this.e,Math.pow(G.y,1/this.B)),G.y===1/0)throw new Error;G.x=-this.rB*Math.atan2(I*this.cosgam-N*this.singam,Math.cos(this.BrA*p))}return G.x+=this.lam0,G},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},Zr={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Ct)){var f=this.b/this.a;this.e=Math.sqrt(1-f*f);var p=Math.sin(this.lat1),y=Math.cos(this.lat1),b=hn(this.e,p,y),I=ae(this.e,this.lat1,p),v=Math.sin(this.lat2),N=Math.cos(this.lat2),O=hn(this.e,v,N),G=ae(this.e,this.lat2,v),W=ae(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Ct?this.ns=Math.log(b/O)/Math.log(I/G):this.ns=p,isNaN(this.ns)&&(this.ns=p),this.f0=b/(this.ns*Math.pow(I,this.ns)),this.rh=this.a*this.f0*Math.pow(W,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(f){var p=f.x,y=f.y;Math.abs(2*Math.abs(y)-Math.PI)<=Ct&&(y=vi(y)*(ht-2*Ct));var b,I,v=Math.abs(Math.abs(y)-ht);if(v>Ct)b=ae(this.e,y,Math.sin(y)),I=this.a*this.f0*Math.pow(b,this.ns);else{if((v=y*this.ns)<=0)return null;I=0}var N=this.ns*Tt(p-this.long0);return f.x=this.k0*(I*Math.sin(N))+this.x0,f.y=this.k0*(this.rh-I*Math.cos(N))+this.y0,f},inverse:function(f){var p,y,b,I,v,N=(f.x-this.x0)/this.k0,O=this.rh-(f.y-this.y0)/this.k0;this.ns>0?(p=Math.sqrt(N*N+O*O),y=1):(p=-Math.sqrt(N*N+O*O),y=-1);var G=0;if(p!==0&&(G=Math.atan2(y*N,y*O)),p!==0||this.ns>0){if(y=1/this.ns,b=Math.pow(p/(this.a*this.f0),y),(I=ms(this.e,b))===-9999)return null}else I=-ht;return v=Tt(G/this.ns+this.long0),f.x=v,f.y=I,f},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},Ko={init:function(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(f){var p,y,b,I,v,N,O,G=f.x,W=f.y,Q=Tt(G-this.long0);return p=Math.pow((1+this.e*Math.sin(W))/(1-this.e*Math.sin(W)),this.alfa*this.e/2),y=2*(Math.atan(this.k*Math.pow(Math.tan(W/2+this.s45),this.alfa)/p)-this.s45),b=-Q*this.alfa,I=Math.asin(Math.cos(this.ad)*Math.sin(y)+Math.sin(this.ad)*Math.cos(y)*Math.cos(b)),v=Math.asin(Math.cos(y)*Math.sin(b)/Math.cos(I)),N=this.n*v,O=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(I/2+this.s45),this.n),f.y=O*Math.cos(N)/1,f.x=O*Math.sin(N)/1,this.czech||(f.y*=-1,f.x*=-1),f},inverse:function(f){var p,y,b,I,v,N,O,G=f.x;f.x=f.y,f.y=G,this.czech||(f.y*=-1,f.x*=-1),v=Math.sqrt(f.x*f.x+f.y*f.y),I=Math.atan2(f.y,f.x)/Math.sin(this.s0),b=2*(Math.atan(Math.pow(this.ro0/v,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),p=Math.asin(Math.cos(this.ad)*Math.sin(b)-Math.sin(this.ad)*Math.cos(b)*Math.cos(I)),y=Math.asin(Math.cos(b)*Math.sin(I)/Math.cos(p)),f.x=this.long0-y/this.alfa,N=p,O=0;var W=0;do f.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(p/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(N))/(1-this.e*Math.sin(N)),this.e/2))-this.s45),Math.abs(N-f.y)<1e-10&&(O=1),N=f.y,W+=1;while(O===0&&W<15);return W>=15?null:f},names:["Krovak","krovak"]},je=function(f,p,y,b,I){return f*I-p*Math.sin(2*I)+y*Math.sin(4*I)-b*Math.sin(6*I)},Us=function(f){return 1-.25*f*(1+f/16*(3+1.25*f))},pn=function(f){return .375*f*(1+.25*f*(1+.46875*f))},yn=function(f){return .05859375*f*f*(1+.75*f)},wn=function(f){return f*f*f*(35/3072)},Hn=function(f,p,y){var b=p*y;return f/Math.sqrt(1-b*b)},fn=function(f){return Math.abs(f)<ht?f:f-vi(f)*Math.PI},Pn=function(f,p,y,b,I){var v,N;v=f/p;for(var O=0;O<15;O++)if(N=(f-(p*v-y*Math.sin(2*v)+b*Math.sin(4*v)-I*Math.sin(6*v)))/(p-2*y*Math.cos(2*v)+4*b*Math.cos(4*v)-6*I*Math.cos(6*v)),v+=N,Math.abs(N)<=1e-10)return v;return NaN},Ni={init:function(){this.sphere||(this.e0=Us(this.es),this.e1=pn(this.es),this.e2=yn(this.es),this.e3=wn(this.es),this.ml0=this.a*je(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(f){var p,y,b=f.x,I=f.y;if(b=Tt(b-this.long0),this.sphere)p=this.a*Math.asin(Math.cos(I)*Math.sin(b)),y=this.a*(Math.atan2(Math.tan(I),Math.cos(b))-this.lat0);else{var v=Math.sin(I),N=Math.cos(I),O=Hn(this.a,this.e,v),G=Math.tan(I)*Math.tan(I),W=b*Math.cos(I),Q=W*W,it=this.es*N*N/(1-this.es);p=O*W*(1-Q*G*(1/6-(8-G+8*it)*Q/120)),y=this.a*je(this.e0,this.e1,this.e2,this.e3,I)-this.ml0+O*v/N*Q*(.5+(5-G+6*it)*Q/24)}return f.x=p+this.x0,f.y=y+this.y0,f},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var p,y,b=f.x/this.a,I=f.y/this.a;if(this.sphere){var v=I+this.lat0;p=Math.asin(Math.sin(v)*Math.cos(b)),y=Math.atan2(Math.tan(b),Math.cos(v))}else{var N=this.ml0/this.a+I,O=Pn(N,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(O)-ht)<=Ct)return f.x=this.long0,f.y=ht,I<0&&(f.y*=-1),f;var G=Hn(this.a,this.e,Math.sin(O)),W=G*G*G/this.a/this.a*(1-this.es),Q=Math.pow(Math.tan(O),2),it=b*this.a/G,ct=it*it;p=O-G*Math.tan(O)/W*it*it*(.5-(1+3*Q)*it*it/24),y=it*(1-ct*(Q/3+(1+3*Q)*Q*ct/15))/Math.cos(O)}return f.x=Tt(y+this.long0),f.y=fn(p),f},names:["Cassini","Cassini_Soldner","cass"]},En=function(f,p){var y;return f>1e-7?(y=f*p,(1-f*f)*(p/(1-y*y)-.5/f*Math.log((1-y)/(1+y)))):2*p},qo=.3333333333333333,Jo=.17222222222222222,El=.10257936507936508,Cl=.06388888888888888,Al=.0664021164021164,Ie=.016415012942191543,Qo={init:function(){var f=Math.abs(this.lat0);if(Math.abs(f-ht)<Ct?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(f)<Ct?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var p;switch(this.qp=En(this.e,1),this.mmf=.5/(1-this.es),this.apa=cr(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),p=Math.sin(this.lat0),this.sinb1=En(this.e,p)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*p*p)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(f){var p,y,b,I,v,N,O,G,W,Q,it=f.x,ct=f.y;if(it=Tt(it-this.long0),this.sphere){if(v=Math.sin(ct),Q=Math.cos(ct),b=Math.cos(it),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((y=this.mode===this.EQUIT?1+Q*b:1+this.sinph0*v+this.cosph0*Q*b)<=Ct)return null;p=(y=Math.sqrt(2/y))*Q*Math.sin(it),y*=this.mode===this.EQUIT?v:this.cosph0*v-this.sinph0*Q*b}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(b=-b),Math.abs(ct+this.lat0)<Ct)return null;y=Wt-.5*ct,p=(y=2*(this.mode===this.S_POLE?Math.cos(y):Math.sin(y)))*Math.sin(it),y*=b}}else{switch(O=0,G=0,W=0,b=Math.cos(it),I=Math.sin(it),v=Math.sin(ct),N=En(this.e,v),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(O=N/this.qp,G=Math.sqrt(1-O*O)),this.mode){case this.OBLIQ:W=1+this.sinb1*O+this.cosb1*G*b;break;case this.EQUIT:W=1+G*b;break;case this.N_POLE:W=ht+ct,N=this.qp-N;break;case this.S_POLE:W=ct-ht,N=this.qp+N}if(Math.abs(W)<Ct)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:W=Math.sqrt(2/W),y=this.mode===this.OBLIQ?this.ymf*W*(this.cosb1*O-this.sinb1*G*b):(W=Math.sqrt(2/(1+G*b)))*O*this.ymf,p=this.xmf*W*G*I;break;case this.N_POLE:case this.S_POLE:N>=0?(p=(W=Math.sqrt(N))*I,y=b*(this.mode===this.S_POLE?W:-W)):p=y=0}}return f.x=this.a*p+this.x0,f.y=this.a*y+this.y0,f},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var p,y,b,I,v,N,O,G=f.x/this.a,W=f.y/this.a;if(this.sphere){var Q,it=0,ct=0;if(Q=Math.sqrt(G*G+W*W),(y=.5*Q)>1)return null;switch(y=2*Math.asin(y),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(ct=Math.sin(y),it=Math.cos(y)),this.mode){case this.EQUIT:y=Math.abs(Q)<=Ct?0:Math.asin(W*ct/Q),G*=ct,W=it*Q;break;case this.OBLIQ:y=Math.abs(Q)<=Ct?this.lat0:Math.asin(it*this.sinph0+W*ct*this.cosph0/Q),G*=ct*this.cosph0,W=(it-Math.sin(y)*this.sinph0)*Q;break;case this.N_POLE:W=-W,y=ht-y;break;case this.S_POLE:y-=ht}p=W!==0||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(G,W):0}else{if(O=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(G/=this.dd,W*=this.dd,(N=Math.sqrt(G*G+W*W))<Ct)return f.x=this.long0,f.y=this.lat0,f;I=2*Math.asin(.5*N/this.rq),b=Math.cos(I),G*=I=Math.sin(I),this.mode===this.OBLIQ?(O=b*this.sinb1+W*I*this.cosb1/N,v=this.qp*O,W=N*this.cosb1*b-W*this.sinb1*I):(O=W*I/N,v=this.qp*O,W=N*b)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(W=-W),!(v=G*G+W*W))return f.x=this.long0,f.y=this.lat0,f;O=1-v/this.qp,this.mode===this.S_POLE&&(O=-O)}p=Math.atan2(G,W),y=Xn(Math.asin(O),this.apa)}return f.x=Tt(this.long0+p),f.y=y,f},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},Ji=function(f){return Math.abs(f)>1&&(f=f>1?1:-1),Math.asin(f)},Dn={init:function(){Math.abs(this.lat1+this.lat2)<Ct||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=hn(this.e3,this.sin_po,this.cos_po),this.qs1=En(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=hn(this.e3,this.sin_po,this.cos_po),this.qs2=En(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=En(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Ct?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(f){var p=f.x,y=f.y;this.sin_phi=Math.sin(y),this.cos_phi=Math.cos(y);var b=En(this.e3,this.sin_phi),I=this.a*Math.sqrt(this.c-this.ns0*b)/this.ns0,v=this.ns0*Tt(p-this.long0),N=I*Math.sin(v)+this.x0,O=this.rh-I*Math.cos(v)+this.y0;return f.x=N,f.y=O,f},inverse:function(f){var p,y,b,I,v,N;return f.x-=this.x0,f.y=this.rh-f.y+this.y0,this.ns0>=0?(p=Math.sqrt(f.x*f.x+f.y*f.y),b=1):(p=-Math.sqrt(f.x*f.x+f.y*f.y),b=-1),I=0,p!==0&&(I=Math.atan2(b*f.x,b*f.y)),b=p*this.ns0/this.a,this.sphere?N=Math.asin((this.c-b*b)/(2*this.ns0)):(y=(this.c-b*b)/this.ns0,N=this.phi1z(this.e3,y)),v=Tt(I/this.ns0+this.long0),f.x=v,f.y=N,f},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(f,p){var y,b,I,v,N,O=Ji(.5*p);if(f<Ct)return O;for(var G=f*f,W=1;W<=25;W++)if(y=Math.sin(O),b=Math.cos(O),I=f*y,v=1-I*I,N=.5*v*v/b*(p/(1-G)-y/v+.5/f*Math.log((1-I)/(1+I))),O+=N,Math.abs(N)<=1e-7)return O;return null}},Il={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(f){var p,y,b,I,v,N,O,G=f.x,W=f.y;return b=Tt(G-this.long0),p=Math.sin(W),y=Math.cos(W),I=Math.cos(b),(v=this.sin_p14*p+this.cos_p14*y*I)>0||Math.abs(v)<=Ct?(N=this.x0+1*this.a*y*Math.sin(b)/v,O=this.y0+1*this.a*(this.cos_p14*p-this.sin_p14*y*I)/v):(N=this.x0+this.infinity_dist*y*Math.sin(b),O=this.y0+this.infinity_dist*(this.cos_p14*p-this.sin_p14*y*I)),f.x=N,f.y=O,f},inverse:function(f){var p,y,b,I,v,N;return f.x=(f.x-this.x0)/this.a,f.y=(f.y-this.y0)/this.a,f.x/=this.k0,f.y/=this.k0,(p=Math.sqrt(f.x*f.x+f.y*f.y))?(I=Math.atan2(p,this.rc),y=Math.sin(I),b=Math.cos(I),N=Ji(b*this.sin_p14+f.y*y*this.cos_p14/p),v=Math.atan2(f.x*y,p*this.cos_p14*b-f.y*this.sin_p14*y),v=Tt(this.long0+v)):(N=this.phic0,v=0),f.x=v,f.y=N,f},names:["gnom"]},nt=function(f,p){var y=1-(1-f*f)/(2*f)*Math.log((1-f)/(1+f));if(Math.abs(Math.abs(p)-y)<1e-6)return p<0?-1*ht:ht;for(var b,I,v,N,O=Math.asin(.5*p),G=0;G<30;G++)if(I=Math.sin(O),v=Math.cos(O),N=f*I,b=Math.pow(1-N*N,2)/(2*v)*(p/(1-f*f)-I/(1-N*N)+.5/f*Math.log((1-N)/(1+N))),O+=b,Math.abs(b)<=1e-10)return O;return NaN},qt={init:function(){this.sphere||(this.k0=hn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(f){var p,y,b=f.x,I=f.y,v=Tt(b-this.long0);if(this.sphere)p=this.x0+this.a*v*Math.cos(this.lat_ts),y=this.y0+this.a*Math.sin(I)/Math.cos(this.lat_ts);else{var N=En(this.e,Math.sin(I));p=this.x0+this.a*this.k0*v,y=this.y0+this.a*N*.5/this.k0}return f.x=p,f.y=y,f},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var p,y;return this.sphere?(p=Tt(this.long0+f.x/this.a/Math.cos(this.lat_ts)),y=Math.asin(f.y/this.a*Math.cos(this.lat_ts))):(y=nt(this.e,2*f.y*this.k0/this.a),p=Tt(this.long0+f.x/(this.a*this.k0))),f.x=p,f.y=y,f},names:["cea"]},fi={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(f){var p=f.x,y=f.y,b=Tt(p-this.long0),I=fn(y-this.lat0);return f.x=this.x0+this.a*b*this.rc,f.y=this.y0+this.a*I,f},inverse:function(f){var p=f.x,y=f.y;return f.x=Tt(this.long0+(p-this.x0)/(this.a*this.rc)),f.y=fn(this.lat0+(y-this.y0)/this.a),f},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},zs=20,$o={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Us(this.es),this.e1=pn(this.es),this.e2=yn(this.es),this.e3=wn(this.es),this.ml0=this.a*je(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(f){var p,y,b,I=f.x,v=f.y,N=Tt(I-this.long0);if(b=N*Math.sin(v),this.sphere)Math.abs(v)<=Ct?(p=this.a*N,y=-1*this.a*this.lat0):(p=this.a*Math.sin(b)/Math.tan(v),y=this.a*(fn(v-this.lat0)+(1-Math.cos(b))/Math.tan(v)));else if(Math.abs(v)<=Ct)p=this.a*N,y=-1*this.ml0;else{var O=Hn(this.a,this.e,Math.sin(v))/Math.tan(v);p=O*Math.sin(b),y=this.a*je(this.e0,this.e1,this.e2,this.e3,v)-this.ml0+O*(1-Math.cos(b))}return f.x=p+this.x0,f.y=y+this.y0,f},inverse:function(f){var p,y,b,I,v,N,O,G,W;if(b=f.x-this.x0,I=f.y-this.y0,this.sphere)if(Math.abs(I+this.a*this.lat0)<=Ct)p=Tt(b/this.a+this.long0),y=0;else{N=this.lat0+I/this.a,O=b*b/this.a/this.a+N*N,G=N;var Q;for(v=zs;v;--v)if(Q=Math.tan(G),W=-1*(N*(G*Q+1)-G-.5*(G*G+O)*Q)/((G-N)/Q-1),G+=W,Math.abs(W)<=Ct){y=G;break}p=Tt(this.long0+Math.asin(b*Math.tan(G)/this.a)/Math.sin(y))}else if(Math.abs(I+this.ml0)<=Ct)y=0,p=Tt(this.long0+b/this.a);else{N=(this.ml0+I)/this.a,O=b*b/this.a/this.a+N*N,G=N;var it,ct,wt,rt,Mt;for(v=zs;v;--v)if(Mt=this.e*Math.sin(G),it=Math.sqrt(1-Mt*Mt)*Math.tan(G),ct=this.a*je(this.e0,this.e1,this.e2,this.e3,G),wt=this.e0-2*this.e1*Math.cos(2*G)+4*this.e2*Math.cos(4*G)-6*this.e3*Math.cos(6*G),rt=ct/this.a,W=(N*(it*rt+1)-rt-.5*it*(rt*rt+O))/(this.es*Math.sin(2*G)*(rt*rt+O-2*N*rt)/(4*it)+(N-rt)*(it*wt-2/Math.sin(2*G))-wt),G-=W,Math.abs(W)<=Ct){y=G;break}it=Math.sqrt(1-this.es*Math.pow(Math.sin(y),2))*Math.tan(y),p=Tt(this.long0+Math.asin(b*it/this.a)/Math.sin(y))}return f.x=p,f.y=y,f},names:["Polyconic","poly"]},Ml={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(f){var p,y=f.x,b=f.y-this.lat0,I=y-this.long0,v=b/an*1e-5,N=I,O=1,G=0;for(p=1;p<=10;p++)O*=v,G+=this.A[p]*O;var W,Q=G,it=N,ct=1,wt=0,rt=0,Mt=0;for(p=1;p<=6;p++)W=wt*Q+ct*it,ct=ct*Q-wt*it,wt=W,rt=rt+this.B_re[p]*ct-this.B_im[p]*wt,Mt=Mt+this.B_im[p]*ct+this.B_re[p]*wt;return f.x=Mt*this.a+this.x0,f.y=rt*this.a+this.y0,f},inverse:function(f){var p,y,b=f.x,I=f.y,v=b-this.x0,N=(I-this.y0)/this.a,O=v/this.a,G=1,W=0,Q=0,it=0;for(p=1;p<=6;p++)y=W*N+G*O,G=G*N-W*O,W=y,Q=Q+this.C_re[p]*G-this.C_im[p]*W,it=it+this.C_im[p]*G+this.C_re[p]*W;for(var ct=0;ct<this.iterations;ct++){var wt,rt=Q,Mt=it,T=N,i=O;for(p=2;p<=6;p++)wt=Mt*Q+rt*it,rt=rt*Q-Mt*it,Mt=wt,T+=(p-1)*(this.B_re[p]*rt-this.B_im[p]*Mt),i+=(p-1)*(this.B_im[p]*rt+this.B_re[p]*Mt);rt=1,Mt=0;var s=this.B_re[1],a=this.B_im[1];for(p=2;p<=6;p++)wt=Mt*Q+rt*it,rt=rt*Q-Mt*it,Mt=wt,s+=p*(this.B_re[p]*rt-this.B_im[p]*Mt),a+=p*(this.B_im[p]*rt+this.B_re[p]*Mt);var h=s*s+a*a;Q=(T*s+i*a)/h,it=(i*s-T*a)/h}var c=Q,d=it,m=1,_=0;for(p=1;p<=9;p++)m*=c,_+=this.D[p]*m;var C=this.lat0+_*an*1e5,M=this.long0+d;return f.x=M,f.y=C,f},names:["New_Zealand_Map_Grid","nzmg"]},bl={init:function(){},forward:function(f){var p=f.x,y=f.y,b=Tt(p-this.long0),I=this.x0+this.a*b,v=this.y0+this.a*Math.log(Math.tan(Math.PI/4+y/2.5))*1.25;return f.x=I,f.y=v,f},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var p=Tt(this.long0+f.x/this.a),y=2.5*(Math.atan(Math.exp(.8*f.y/this.a))-Math.PI/4);return f.x=p,f.y=y,f},names:["Miller_Cylindrical","mill"]},Tl=20,Kr={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=B(this.es)},forward:function(f){var p,y,b=f.x,I=f.y;if(b=Tt(b-this.long0),this.sphere){if(this.m)for(var v=this.n*Math.sin(I),N=Tl;N;--N){var O=(this.m*I+Math.sin(I)-v)/(this.m+Math.cos(I));if(I-=O,Math.abs(O)<Ct)break}else I=this.n!==1?Math.asin(this.n*Math.sin(I)):I;p=this.a*this.C_x*b*(this.m+Math.cos(I)),y=this.a*this.C_y*I}else{var G=Math.sin(I),W=Math.cos(I);y=this.a*Nt(I,G,W,this.en),p=this.a*b*W/Math.sqrt(1-this.es*G*G)}return f.x=p,f.y=y,f},inverse:function(f){var p,y,b,I;return f.x-=this.x0,b=f.x/this.a,f.y-=this.y0,p=f.y/this.a,this.sphere?(p/=this.C_y,b/=this.C_x*(this.m+Math.cos(p)),this.m?p=Ji((this.m*p+Math.sin(p))/this.n):this.n!==1&&(p=Ji(Math.sin(p)/this.n)),b=Tt(b+this.long0),p=fn(p)):(p=oi(f.y/this.a,this.es,this.en),(I=Math.abs(p))<ht?(I=Math.sin(p),y=this.long0+f.x*Math.sqrt(1-this.es*I*I)/(this.a*Math.cos(p)),b=Tt(y)):I-Ct<ht&&(b=this.long0)),f.x=b,f.y=p,f},names:["Sinusoidal","sinu"]},ai={init:function(){},forward:function(f){for(var p=f.x,y=f.y,b=Tt(p-this.long0),I=y,v=Math.PI*Math.sin(y);;){var N=-(I+Math.sin(I)-v)/(1+Math.cos(I));if(I+=N,Math.abs(N)<Ct)break}I/=2,Math.PI/2-Math.abs(y)<Ct&&(b=0);var O=.900316316158*this.a*b*Math.cos(I)+this.x0,G=1.4142135623731*this.a*Math.sin(I)+this.y0;return f.x=O,f.y=G,f},inverse:function(f){var p,y;f.x-=this.x0,f.y-=this.y0,y=f.y/(1.4142135623731*this.a),Math.abs(y)>.999999999999&&(y=.999999999999),p=Math.asin(y);var b=Tt(this.long0+f.x/(.900316316158*this.a*Math.cos(p)));b<-Math.PI&&(b=-Math.PI),b>Math.PI&&(b=Math.PI),y=(2*p+Math.sin(2*p))/Math.PI,Math.abs(y)>1&&(y=1);var I=Math.asin(y);return f.x=b,f.y=I,f},names:["Mollweide","moll"]},qr={init:function(){Math.abs(this.lat1+this.lat2)<Ct||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Us(this.es),this.e1=pn(this.es),this.e2=yn(this.es),this.e3=wn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=hn(this.e,this.sinphi,this.cosphi),this.ml1=je(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Ct?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=hn(this.e,this.sinphi,this.cosphi),this.ml2=je(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=je(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(f){var p,y=f.x,b=f.y;if(this.sphere)p=this.a*(this.g-b);else{var I=je(this.e0,this.e1,this.e2,this.e3,b);p=this.a*(this.g-I)}var v=this.ns*Tt(y-this.long0),N=this.x0+p*Math.sin(v),O=this.y0+this.rh-p*Math.cos(v);return f.x=N,f.y=O,f},inverse:function(f){f.x-=this.x0,f.y=this.rh-f.y+this.y0;var p,y,b,I;this.ns>=0?(y=Math.sqrt(f.x*f.x+f.y*f.y),p=1):(y=-Math.sqrt(f.x*f.x+f.y*f.y),p=-1);var v=0;if(y!==0&&(v=Math.atan2(p*f.x,p*f.y)),this.sphere)return I=Tt(this.long0+v/this.ns),b=fn(this.g-y/this.a),f.x=I,f.y=b,f;var N=this.g-y/this.a;return b=Pn(N,this.e0,this.e1,this.e2,this.e3),I=Tt(this.long0+v/this.ns),f.x=I,f.y=b,f},names:["Equidistant_Conic","eqdc"]},Xe={init:function(){this.R=this.a},forward:function(f){var p,y,b=f.x,I=f.y,v=Tt(b-this.long0);Math.abs(I)<=Ct&&(p=this.x0+this.R*v,y=this.y0);var N=Ji(2*Math.abs(I/Math.PI));(Math.abs(v)<=Ct||Math.abs(Math.abs(I)-ht)<=Ct)&&(p=this.x0,y=I>=0?this.y0+Math.PI*this.R*Math.tan(.5*N):this.y0+Math.PI*this.R*-Math.tan(.5*N));var O=.5*Math.abs(Math.PI/v-v/Math.PI),G=O*O,W=Math.sin(N),Q=Math.cos(N),it=Q/(W+Q-1),ct=it*it,wt=it*(2/W-1),rt=wt*wt,Mt=Math.PI*this.R*(O*(it-rt)+Math.sqrt(G*(it-rt)*(it-rt)-(rt+G)*(ct-rt)))/(rt+G);v<0&&(Mt=-Mt),p=this.x0+Mt;var T=G+it;return Mt=Math.PI*this.R*(wt*T-O*Math.sqrt((rt+G)*(G+1)-T*T))/(rt+G),y=I>=0?this.y0+Mt:this.y0-Mt,f.x=p,f.y=y,f},inverse:function(f){var p,y,b,I,v,N,O,G,W,Q,it,ct,wt;return f.x-=this.x0,f.y-=this.y0,it=Math.PI*this.R,b=f.x/it,I=f.y/it,v=b*b+I*I,N=-Math.abs(I)*(1+v),O=N-2*I*I+b*b,G=-2*N+1+2*I*I+v*v,wt=I*I/G+(2*O*O*O/G/G/G-9*N*O/G/G)/27,W=(N-O*O/3/G)/G,Q=2*Math.sqrt(-W/3),it=3*wt/W/Q,Math.abs(it)>1&&(it=it>=0?1:-1),ct=Math.acos(it)/3,y=f.y>=0?(-Q*Math.cos(ct+Math.PI/3)-O/3/G)*Math.PI:-(-Q*Math.cos(ct+Math.PI/3)-O/3/G)*Math.PI,p=Math.abs(b)<Ct?this.long0:Tt(this.long0+Math.PI*(v-1+Math.sqrt(1+2*(b*b-I*I)+v*v))/2/b),f.x=p,f.y=y,f},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},mr={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(f){var p,y,b,I,v,N,O,G,W,Q,it,ct,wt,rt,Mt,T,i,s,a,h,c,d,m,_=f.x,C=f.y,M=Math.sin(f.y),R=Math.cos(f.y),D=Tt(_-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=Ct?(f.x=this.x0+this.a*(ht-C)*Math.sin(D),f.y=this.y0-this.a*(ht-C)*Math.cos(D),f):Math.abs(this.sin_p12+1)<=Ct?(f.x=this.x0+this.a*(ht+C)*Math.sin(D),f.y=this.y0+this.a*(ht+C)*Math.cos(D),f):(s=this.sin_p12*M+this.cos_p12*R*Math.cos(D),T=Math.acos(s),i=T?T/Math.sin(T):1,f.x=this.x0+this.a*i*R*Math.sin(D),f.y=this.y0+this.a*i*(this.cos_p12*M-this.sin_p12*R*Math.cos(D)),f):(p=Us(this.es),y=pn(this.es),b=yn(this.es),I=wn(this.es),Math.abs(this.sin_p12-1)<=Ct?(v=this.a*je(p,y,b,I,ht),N=this.a*je(p,y,b,I,C),f.x=this.x0+(v-N)*Math.sin(D),f.y=this.y0-(v-N)*Math.cos(D),f):Math.abs(this.sin_p12+1)<=Ct?(v=this.a*je(p,y,b,I,ht),N=this.a*je(p,y,b,I,C),f.x=this.x0+(v+N)*Math.sin(D),f.y=this.y0+(v+N)*Math.cos(D),f):(O=M/R,G=Hn(this.a,this.e,this.sin_p12),W=Hn(this.a,this.e,M),Q=Math.atan((1-this.es)*O+this.es*G*this.sin_p12/(W*R)),it=Math.atan2(Math.sin(D),this.cos_p12*Math.tan(Q)-this.sin_p12*Math.cos(D)),a=it===0?Math.asin(this.cos_p12*Math.sin(Q)-this.sin_p12*Math.cos(Q)):Math.abs(Math.abs(it)-Math.PI)<=Ct?-Math.asin(this.cos_p12*Math.sin(Q)-this.sin_p12*Math.cos(Q)):Math.asin(Math.sin(D)*Math.cos(Q)/Math.sin(it)),ct=this.e*this.sin_p12/Math.sqrt(1-this.es),wt=this.e*this.cos_p12*Math.cos(it)/Math.sqrt(1-this.es),rt=ct*wt,Mt=wt*wt,h=a*a,c=h*a,d=c*a,m=d*a,T=G*a*(1-h*Mt*(1-Mt)/6+c/8*rt*(1-2*Mt)+d/120*(Mt*(4-7*Mt)-3*ct*ct*(1-7*Mt))-m/48*rt),f.x=this.x0+T*Math.sin(it),f.y=this.y0+T*Math.cos(it),f))},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var p,y,b,I,v,N,O,G,W,Q,it,ct,wt,rt,Mt,T,i,s,a,h,c,d,m,_;return this.sphere?(p=Math.sqrt(f.x*f.x+f.y*f.y))>2*ht*this.a?void 0:(y=p/this.a,b=Math.sin(y),I=Math.cos(y),v=this.long0,Math.abs(p)<=Ct?N=this.lat0:(N=Ji(I*this.sin_p12+f.y*b*this.cos_p12/p),O=Math.abs(this.lat0)-ht,v=Tt(Math.abs(O)<=Ct?this.lat0>=0?this.long0+Math.atan2(f.x,-f.y):this.long0-Math.atan2(-f.x,f.y):this.long0+Math.atan2(f.x*b,p*this.cos_p12*I-f.y*this.sin_p12*b))),f.x=v,f.y=N,f):(G=Us(this.es),W=pn(this.es),Q=yn(this.es),it=wn(this.es),Math.abs(this.sin_p12-1)<=Ct?(ct=this.a*je(G,W,Q,it,ht),p=Math.sqrt(f.x*f.x+f.y*f.y),wt=ct-p,N=Pn(wt/this.a,G,W,Q,it),v=Tt(this.long0+Math.atan2(f.x,-1*f.y)),f.x=v,f.y=N,f):Math.abs(this.sin_p12+1)<=Ct?(ct=this.a*je(G,W,Q,it,ht),p=Math.sqrt(f.x*f.x+f.y*f.y),wt=p-ct,N=Pn(wt/this.a,G,W,Q,it),v=Tt(this.long0+Math.atan2(f.x,f.y)),f.x=v,f.y=N,f):(p=Math.sqrt(f.x*f.x+f.y*f.y),T=Math.atan2(f.x,f.y),rt=Hn(this.a,this.e,this.sin_p12),i=Math.cos(T),s=this.e*this.cos_p12*i,a=-s*s/(1-this.es),h=3*this.es*(1-a)*this.sin_p12*this.cos_p12*i/(1-this.es),c=p/rt,d=c-a*(1+a)*Math.pow(c,3)/6-h*(1+3*a)*Math.pow(c,4)/24,m=1-a*d*d/2-c*d*d*d/6,Mt=Math.asin(this.sin_p12*Math.cos(d)+this.cos_p12*Math.sin(d)*i),v=Tt(this.long0+Math.asin(Math.sin(T)*Math.sin(d)/Math.cos(Mt))),_=Math.sin(Mt),N=Math.atan2((_-this.es*m*this.sin_p12)*Math.tan(Mt),_*(1-this.es)),f.x=v,f.y=N,f))},names:["Azimuthal_Equidistant","aeqd"]},jn={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(f){var p,y,b,I,v,N,O,G=f.x,W=f.y;return b=Tt(G-this.long0),p=Math.sin(W),y=Math.cos(W),I=Math.cos(b),((v=this.sin_p14*p+this.cos_p14*y*I)>0||Math.abs(v)<=Ct)&&(N=1*this.a*y*Math.sin(b),O=this.y0+1*this.a*(this.cos_p14*p-this.sin_p14*y*I)),f.x=N,f.y=O,f},inverse:function(f){var p,y,b,I,v,N,O;return f.x-=this.x0,f.y-=this.y0,p=Math.sqrt(f.x*f.x+f.y*f.y),y=Ji(p/this.a),b=Math.sin(y),I=Math.cos(y),N=this.long0,Math.abs(p)<=Ct?(O=this.lat0,f.x=N,f.y=O,f):(O=Ji(I*this.sin_p14+f.y*b*this.cos_p14/p),v=Math.abs(this.lat0)-ht,Math.abs(v)<=Ct?(N=Tt(this.lat0>=0?this.long0+Math.atan2(f.x,-f.y):this.long0-Math.atan2(-f.x,f.y)),f.x=N,f.y=O,f):(N=Tt(this.long0+Math.atan2(f.x*b,p*this.cos_p14*I-f.y*this.sin_p14*b)),f.x=N,f.y=O,f))},names:["ortho"]},zt={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},bt={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4},Sl={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=ht-Wt/2?this.face=zt.TOP:this.lat0<=-(ht-Wt/2)?this.face=zt.BOTTOM:Math.abs(this.long0)<=Wt?this.face=zt.FRONT:Math.abs(this.long0)<=ht+Wt?this.face=this.long0>0?zt.RIGHT:zt.LEFT:this.face=zt.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(f){var p,y,b,I,v,N,O={x:0,y:0},G={value:0};if(f.x-=this.long0,p=this.es!==0?Math.atan(this.one_minus_f_squared*Math.tan(f.y)):f.y,y=f.x,this.face===zt.TOP)I=ht-p,y>=Wt&&y<=ht+Wt?(G.value=bt.AREA_0,b=y-ht):y>ht+Wt||y<=-(ht+Wt)?(G.value=bt.AREA_1,b=y>0?y-Vt:y+Vt):y>-(ht+Wt)&&y<=-Wt?(G.value=bt.AREA_2,b=y+ht):(G.value=bt.AREA_3,b=y);else if(this.face===zt.BOTTOM)I=ht+p,y>=Wt&&y<=ht+Wt?(G.value=bt.AREA_0,b=-y+ht):y<Wt&&y>=-Wt?(G.value=bt.AREA_1,b=-y):y<-Wt&&y>=-(ht+Wt)?(G.value=bt.AREA_2,b=-y-ht):(G.value=bt.AREA_3,b=y>0?-y+Vt:-y-Vt);else{var W,Q,it,ct,wt,rt;this.face===zt.RIGHT?y=Ae(y,+ht):this.face===zt.BACK?y=Ae(y,+Vt):this.face===zt.LEFT&&(y=Ae(y,-ht)),ct=Math.sin(p),wt=Math.cos(p),rt=Math.sin(y),W=wt*Math.cos(y),Q=wt*rt,it=ct,this.face===zt.FRONT?b=Vn(I=Math.acos(W),it,Q,G):this.face===zt.RIGHT?b=Vn(I=Math.acos(Q),it,-W,G):this.face===zt.BACK?b=Vn(I=Math.acos(-W),it,-Q,G):this.face===zt.LEFT?b=Vn(I=Math.acos(-Q),it,W,G):(I=b=0,G.value=bt.AREA_0)}return N=Math.atan(12/Vt*(b+Math.acos(Math.sin(b)*Math.cos(Wt))-ht)),v=Math.sqrt((1-Math.cos(I))/(Math.cos(N)*Math.cos(N))/(1-Math.cos(Math.atan(1/Math.cos(b))))),G.value===bt.AREA_1?N+=ht:G.value===bt.AREA_2?N+=Vt:G.value===bt.AREA_3&&(N+=1.5*Vt),O.x=v*Math.cos(N),O.y=v*Math.sin(N),O.x=O.x*this.a+this.x0,O.y=O.y*this.a+this.y0,f.x=O.x,f.y=O.y,f},inverse:function(f){var p,y,b,I,v,N,O,G,W,Q={lam:0,phi:0},it={value:0};if(f.x=(f.x-this.x0)/this.a,f.y=(f.y-this.y0)/this.a,y=Math.atan(Math.sqrt(f.x*f.x+f.y*f.y)),p=Math.atan2(f.y,f.x),f.x>=0&&f.x>=Math.abs(f.y)?it.value=bt.AREA_0:f.y>=0&&f.y>=Math.abs(f.x)?(it.value=bt.AREA_1,p-=ht):f.x<0&&-f.x>=Math.abs(f.y)?(it.value=bt.AREA_2,p=p<0?p+Vt:p-Vt):(it.value=bt.AREA_3,p+=ht),W=Vt/12*Math.tan(p),v=Math.sin(W)/(Math.cos(W)-1/Math.sqrt(2)),N=Math.atan(v),b=Math.cos(p),I=Math.tan(y),(O=1-b*b*I*I*(1-Math.cos(Math.atan(1/Math.cos(N)))))<-1?O=-1:O>1&&(O=1),this.face===zt.TOP)G=Math.acos(O),Q.phi=ht-G,it.value===bt.AREA_0?Q.lam=N+ht:it.value===bt.AREA_1?Q.lam=N<0?N+Vt:N-Vt:it.value===bt.AREA_2?Q.lam=N-ht:Q.lam=N;else if(this.face===zt.BOTTOM)G=Math.acos(O),Q.phi=G-ht,it.value===bt.AREA_0?Q.lam=-N+ht:it.value===bt.AREA_1?Q.lam=-N:it.value===bt.AREA_2?Q.lam=-N-ht:Q.lam=N<0?-N-Vt:-N+Vt;else{var ct,wt,rt;W=(ct=O)*ct,wt=(W+=(rt=W>=1?0:Math.sqrt(1-W)*Math.sin(N))*rt)>=1?0:Math.sqrt(1-W),it.value===bt.AREA_1?(W=wt,wt=-rt,rt=W):it.value===bt.AREA_2?(wt=-wt,rt=-rt):it.value===bt.AREA_3&&(W=wt,wt=rt,rt=-W),this.face===zt.RIGHT?(W=ct,ct=-wt,wt=W):this.face===zt.BACK?(ct=-ct,wt=-wt):this.face===zt.LEFT&&(W=ct,ct=wt,wt=-W),Q.phi=Math.acos(-rt)-ht,Q.lam=Math.atan2(wt,ct),this.face===zt.RIGHT?Q.lam=Ae(Q.lam,-ht):this.face===zt.BACK?Q.lam=Ae(Q.lam,-Vt):this.face===zt.LEFT&&(Q.lam=Ae(Q.lam,+ht))}if(this.es!==0){var Mt,T,i;Mt=Q.phi<0?1:0,T=Math.tan(Q.phi),i=this.b/Math.sqrt(T*T+this.one_minus_f_squared),Q.phi=Math.atan(Math.sqrt(this.a*this.a-i*i)/(this.one_minus_f*i)),Mt&&(Q.phi=-Q.phi)}return Q.lam+=this.long0,f.x=Q.lam,f.y=Q.phi,f},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Re=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Qi=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Zn=.8487,ta=1.3523,$i=ue/5,Jr=1/$i,Kn=18,ps=function(f,p){return f[0]+p*(f[1]+p*(f[2]+p*f[3]))},ea=function(f,p){return f[1]+p*(2*f[2]+3*p*f[3])},ia={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(f){var p=Tt(f.x-this.long0),y=Math.abs(f.y),b=Math.floor(y*$i);b<0?b=0:b>=Kn&&(b=Kn-1),y=ue*(y-Jr*b);var I={x:ps(Re[b],y)*p,y:ps(Qi[b],y)};return f.y<0&&(I.y=-I.y),I.x=I.x*this.a*Zn+this.x0,I.y=I.y*this.a*ta+this.y0,I},inverse:function(f){var p={x:(f.x-this.x0)/(this.a*Zn),y:Math.abs(f.y-this.y0)/(this.a*ta)};if(p.y>=1)p.x/=Re[Kn][0],p.y=f.y<0?-ht:ht;else{var y=Math.floor(p.y*Kn);for(y<0?y=0:y>=Kn&&(y=Kn-1);;)if(Qi[y][0]>p.y)--y;else{if(!(Qi[y+1][0]<=p.y))break;++y}var b=Qi[y],I=5*(p.y-b[0])/(Qi[y+1][0]-b[0]);I=It(function(v){return(ps(b,v)-p.y)/ea(b,v)},I,Ct,100),p.x/=ps(Re[y],I),p.y=(5*y+I)*fe,f.y<0&&(p.y=-p.y)}return p.x=Tt(p.x+this.long0),p},names:["Robinson","robin"]},Rl={init:function(){this.name="geocent"},forward:function(f){return oe(f,this.es,this.a)},inverse:function(f){return Gt(f,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},Ze={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},qn={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}},vl={init:function(){if(Object.keys(qn).forEach(function(y){if(this[y]===void 0)this[y]=qn[y].def;else{if(qn[y].num&&isNaN(this[y]))throw new Error("Invalid parameter value, must be numeric "+y+" = "+this[y]);qn[y].num&&(this[y]=parseFloat(this[y]))}qn[y].degrees&&(this[y]=this[y]*fe)}.bind(this)),Math.abs(Math.abs(this.lat0)-ht)<Ct?this.mode=this.lat0<0?Ze.S_POLE:Ze.N_POLE:Math.abs(this.lat0)<Ct?this.mode=Ze.EQUIT:(this.mode=Ze.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var f=this.tilt,p=this.azi;this.cg=Math.cos(p),this.sg=Math.sin(p),this.cw=Math.cos(f),this.sw=Math.sin(f)},forward:function(f){f.x-=this.long0;var p,y,b=Math.sin(f.y),I=Math.cos(f.y),v=Math.cos(f.x);switch(this.mode){case Ze.OBLIQ:y=this.sinph0*b+this.cosph0*I*v;break;case Ze.EQUIT:y=I*v;break;case Ze.S_POLE:y=-b;break;case Ze.N_POLE:y=b}switch(y=this.pn1/(this.p-y),p=y*I*Math.sin(f.x),this.mode){case Ze.OBLIQ:y*=this.cosph0*b-this.sinph0*I*v;break;case Ze.EQUIT:y*=b;break;case Ze.N_POLE:y*=-I*v;break;case Ze.S_POLE:y*=I*v}var N,O;return N=y*this.cg+p*this.sg,O=1/(N*this.sw*this.h1+this.cw),p=(p*this.cg-y*this.sg)*this.cw*O,y=N*O,f.x=p*this.a,f.y=y*this.a,f},inverse:function(f){f.x/=this.a,f.y/=this.a;var p,y,b,I={x:f.x,y:f.y};b=1/(this.pn1-f.y*this.sw),p=this.pn1*f.x*b,y=this.pn1*f.y*this.cw*b,f.x=p*this.cg+y*this.sg,f.y=y*this.cg-p*this.sg;var v=Oi(f.x,f.y);if(Math.abs(v)<Ct)I.x=0,I.y=f.y;else{var N,O;switch(O=1-v*v*this.pfact,O=(this.p-Math.sqrt(O))/(this.pn1/v+v/this.pn1),N=Math.sqrt(1-O*O),this.mode){case Ze.OBLIQ:I.y=Math.asin(N*this.sinph0+f.y*O*this.cosph0/v),f.y=(N-this.sinph0*Math.sin(I.y))*v,f.x*=O*this.cosph0;break;case Ze.EQUIT:I.y=Math.asin(f.y*O/v),f.y=N*v,f.x*=O;break;case Ze.N_POLE:I.y=Math.asin(N),f.y=-f.y;break;case Ze.S_POLE:I.y=-Math.asin(N)}I.x=Math.atan2(f.x,f.y)}return f.x=I.x+this.long0,f.y=I.y,f},names:["Tilted_Perspective","tpers"]},Ws={init:function(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var f=1-this.es,p=1/f;this.radius_p=Math.sqrt(f),this.radius_p2=f,this.radius_p_inv2=p,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(f){var p,y,b,I,v=f.x,N=f.y;if(v-=this.long0,this.shape==="ellipse"){N=Math.atan(this.radius_p2*Math.tan(N));var O=this.radius_p/Oi(this.radius_p*Math.cos(N),Math.sin(N));if(y=O*Math.cos(v)*Math.cos(N),b=O*Math.sin(v)*Math.cos(N),I=O*Math.sin(N),(this.radius_g-y)*y-b*b-I*I*this.radius_p_inv2<0)return f.x=Number.NaN,f.y=Number.NaN,f;p=this.radius_g-y,this.flip_axis?(f.x=this.radius_g_1*Math.atan(b/Oi(I,p)),f.y=this.radius_g_1*Math.atan(I/p)):(f.x=this.radius_g_1*Math.atan(b/p),f.y=this.radius_g_1*Math.atan(I/Oi(b,p)))}else this.shape==="sphere"&&(p=Math.cos(N),y=Math.cos(v)*p,b=Math.sin(v)*p,I=Math.sin(N),p=this.radius_g-y,this.flip_axis?(f.x=this.radius_g_1*Math.atan(b/Oi(I,p)),f.y=this.radius_g_1*Math.atan(I/p)):(f.x=this.radius_g_1*Math.atan(b/p),f.y=this.radius_g_1*Math.atan(I/Oi(b,p))));return f.x=f.x*this.a,f.y=f.y*this.a,f},inverse:function(f){var p,y,b,I,v=-1,N=0,O=0;if(f.x=f.x/this.a,f.y=f.y/this.a,this.shape==="ellipse"){this.flip_axis?(O=Math.tan(f.y/this.radius_g_1),N=Math.tan(f.x/this.radius_g_1)*Oi(1,O)):(N=Math.tan(f.x/this.radius_g_1),O=Math.tan(f.y/this.radius_g_1)*Oi(1,N));var G=O/this.radius_p;if(p=N*N+G*G+v*v,y=2*this.radius_g*v,(b=y*y-4*p*this.C)<0)return f.x=Number.NaN,f.y=Number.NaN,f;I=(-y-Math.sqrt(b))/(2*p),v=this.radius_g+I*v,N*=I,O*=I,f.x=Math.atan2(N,v),f.y=Math.atan(O*Math.cos(f.x)/v),f.y=Math.atan(this.radius_p_inv2*Math.tan(f.y))}else if(this.shape==="sphere"){if(this.flip_axis?(O=Math.tan(f.y/this.radius_g_1),N=Math.tan(f.x/this.radius_g_1)*Math.sqrt(1+O*O)):(N=Math.tan(f.x/this.radius_g_1),O=Math.tan(f.y/this.radius_g_1)*Math.sqrt(1+N*N)),p=N*N+O*O+v*v,y=2*this.radius_g*v,(b=y*y-4*p*this.C)<0)return f.x=Number.NaN,f.y=Number.NaN,f;I=(-y-Math.sqrt(b))/(2*p),v=this.radius_g+I*v,N*=I,O*=I,f.x=Math.atan2(N,v),f.y=Math.atan(O*Math.cos(f.x)/v)}return f.x=f.x+this.long0,f},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};return ze.defaultDatum="WGS84",ze.Proj=yt,ze.WGS84=new ze.Proj("WGS84"),ze.Point=qe,ze.toPoint=fr,ze.defs=w,ze.nadgrid=function(f,p){var y=new DataView(p),b=_t(y),I=xt(y,b),v={header:I,subgrids:ut(y,I,b)};return me[f]=v,v},ze.transform=mi,ze.mgrs=pi,ze.version="2.10.0",function(f){f.Proj.projections.add(Ii),f.Proj.projections.add(Yn),f.Proj.projections.add(pl),f.Proj.projections.add(Ut),f.Proj.projections.add(yl),f.Proj.projections.add(Zt),f.Proj.projections.add(wl),f.Proj.projections.add(Zr),f.Proj.projections.add(Ko),f.Proj.projections.add(Ni),f.Proj.projections.add(Qo),f.Proj.projections.add(Dn),f.Proj.projections.add(Il),f.Proj.projections.add(qt),f.Proj.projections.add(fi),f.Proj.projections.add($o),f.Proj.projections.add(Ml),f.Proj.projections.add(bl),f.Proj.projections.add(Kr),f.Proj.projections.add(ai),f.Proj.projections.add(qr),f.Proj.projections.add(Xe),f.Proj.projections.add(mr),f.Proj.projections.add(jn),f.Proj.projections.add(Sl),f.Proj.projections.add(ia),f.Proj.projections.add(Rl),f.Proj.projections.add(vl),f.Proj.projections.add(Ws)}(ze),ze})})(A1);var Xx=A1.exports;const ma=C1(Xx);function Vx(r){const t=Object.keys(r.defs),e=t.length;let n,o;for(n=0;n<e;++n){const l=t[n];if(!Be(l)){const u=r.defs(l);let g=u.units;!g&&u.projName==="longlat"&&(g="degrees"),o0(new Bh({code:l,axisOrientation:u.axis,metersPerUnit:u.to_meter,units:g}))}}for(n=0;n<e;++n){const l=t[n],u=Be(l);for(o=0;o<e;++o){const g=t[o],x=Be(g);if(!e0(l,g))if(r.defs[l]===r.defs[g])ch([u,x]);else{const E=r(l,g);Mf(u,x,Xc(u,x,E.forward),Xc(x,u,E.inverse))}}}}var Yx=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},I1={},rn={};let Tc;const Hx=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];rn.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};rn.getSymbolTotalCodewords=function(t){return Hx[t]};rn.getBCHDigit=function(r){let t=0;for(;r!==0;)t++,r>>>=1;return t};rn.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');Tc=t};rn.isKanjiModeEnabled=function(){return typeof Tc<"u"};rn.toSJIS=function(t){return Tc(t)};var ul={};(function(r){r.L={bit:1},r.M={bit:0},r.Q={bit:3},r.H={bit:2};function t(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return r.L;case"m":case"medium":return r.M;case"q":case"quartile":return r.Q;case"h":case"high":return r.H;default:throw new Error("Unknown EC Level: "+e)}}r.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},r.from=function(n,o){if(r.isValid(n))return n;try{return t(n)}catch{return o}}})(ul);function M1(){this.buffer=[],this.length=0}M1.prototype={get:function(r){const t=Math.floor(r/8);return(this.buffer[t]>>>7-r%8&1)===1},put:function(r,t){for(let e=0;e<t;e++)this.putBit((r>>>t-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(r){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),r&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var jx=M1;function Vo(r){if(!r||r<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=r,this.data=new Uint8Array(r*r),this.reservedBit=new Uint8Array(r*r)}Vo.prototype.set=function(r,t,e,n){const o=r*this.size+t;this.data[o]=e,n&&(this.reservedBit[o]=!0)};Vo.prototype.get=function(r,t){return this.data[r*this.size+t]};Vo.prototype.xor=function(r,t,e){this.data[r*this.size+t]^=e};Vo.prototype.isReserved=function(r,t){return this.reservedBit[r*this.size+t]};var Zx=Vo,b1={};(function(r){const t=rn.getSymbolSize;r.getRowColCoords=function(n){if(n===1)return[];const o=Math.floor(n/7)+2,l=t(n),u=l===145?26:Math.ceil((l-13)/(2*o-2))*2,g=[l-7];for(let x=1;x<o-1;x++)g[x]=g[x-1]-u;return g.push(6),g.reverse()},r.getPositions=function(n){const o=[],l=r.getRowColCoords(n),u=l.length;for(let g=0;g<u;g++)for(let x=0;x<u;x++)g===0&&x===0||g===0&&x===u-1||g===u-1&&x===0||o.push([l[g],l[x]]);return o}})(b1);var T1={};const Kx=rn.getSymbolSize,Pu=7;T1.getPositions=function(t){const e=Kx(t);return[[0,0],[e-Pu,0],[0,e-Pu]]};var S1={};(function(r){r.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};r.isValid=function(o){return o!=null&&o!==""&&!isNaN(o)&&o>=0&&o<=7},r.from=function(o){return r.isValid(o)?parseInt(o,10):void 0},r.getPenaltyN1=function(o){const l=o.size;let u=0,g=0,x=0,E=null,w=null;for(let A=0;A<l;A++){g=x=0,E=w=null;for(let S=0;S<l;S++){let P=o.get(A,S);P===E?g++:(g>=5&&(u+=t.N1+(g-5)),E=P,g=1),P=o.get(S,A),P===w?x++:(x>=5&&(u+=t.N1+(x-5)),w=P,x=1)}g>=5&&(u+=t.N1+(g-5)),x>=5&&(u+=t.N1+(x-5))}return u},r.getPenaltyN2=function(o){const l=o.size;let u=0;for(let g=0;g<l-1;g++)for(let x=0;x<l-1;x++){const E=o.get(g,x)+o.get(g,x+1)+o.get(g+1,x)+o.get(g+1,x+1);(E===4||E===0)&&u++}return u*t.N2},r.getPenaltyN3=function(o){const l=o.size;let u=0,g=0,x=0;for(let E=0;E<l;E++){g=x=0;for(let w=0;w<l;w++)g=g<<1&2047|o.get(E,w),w>=10&&(g===1488||g===93)&&u++,x=x<<1&2047|o.get(w,E),w>=10&&(x===1488||x===93)&&u++}return u*t.N3},r.getPenaltyN4=function(o){let l=0;const u=o.data.length;for(let x=0;x<u;x++)l+=o.data[x];return Math.abs(Math.ceil(l*100/u/5)-10)*t.N4};function e(n,o,l){switch(n){case r.Patterns.PATTERN000:return(o+l)%2===0;case r.Patterns.PATTERN001:return o%2===0;case r.Patterns.PATTERN010:return l%3===0;case r.Patterns.PATTERN011:return(o+l)%3===0;case r.Patterns.PATTERN100:return(Math.floor(o/2)+Math.floor(l/3))%2===0;case r.Patterns.PATTERN101:return o*l%2+o*l%3===0;case r.Patterns.PATTERN110:return(o*l%2+o*l%3)%2===0;case r.Patterns.PATTERN111:return(o*l%3+(o+l)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}r.applyMask=function(o,l){const u=l.size;for(let g=0;g<u;g++)for(let x=0;x<u;x++)l.isReserved(x,g)||l.xor(x,g,e(o,x,g))},r.getBestMask=function(o,l){const u=Object.keys(r.Patterns).length;let g=0,x=1/0;for(let E=0;E<u;E++){l(E),r.applyMask(E,o);const w=r.getPenaltyN1(o)+r.getPenaltyN2(o)+r.getPenaltyN3(o)+r.getPenaltyN4(o);r.applyMask(E,o),w<x&&(x=w,g=E)}return g}})(S1);var fl={};const Rs=ul,xa=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],_a=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];fl.getBlocksCount=function(t,e){switch(e){case Rs.L:return xa[(t-1)*4+0];case Rs.M:return xa[(t-1)*4+1];case Rs.Q:return xa[(t-1)*4+2];case Rs.H:return xa[(t-1)*4+3];default:return}};fl.getTotalCodewordsCount=function(t,e){switch(e){case Rs.L:return _a[(t-1)*4+0];case Rs.M:return _a[(t-1)*4+1];case Rs.Q:return _a[(t-1)*4+2];case Rs.H:return _a[(t-1)*4+3];default:return}};var R1={},dl={};const fo=new Uint8Array(512),La=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)fo[e]=t,La[t]=e,t<<=1,t&256&&(t^=285);for(let e=255;e<512;e++)fo[e]=fo[e-255]})();dl.log=function(t){if(t<1)throw new Error("log("+t+")");return La[t]};dl.exp=function(t){return fo[t]};dl.mul=function(t,e){return t===0||e===0?0:fo[La[t]+La[e]]};(function(r){const t=dl;r.mul=function(n,o){const l=new Uint8Array(n.length+o.length-1);for(let u=0;u<n.length;u++)for(let g=0;g<o.length;g++)l[u+g]^=t.mul(n[u],o[g]);return l},r.mod=function(n,o){let l=new Uint8Array(n);for(;l.length-o.length>=0;){const u=l[0];for(let x=0;x<o.length;x++)l[x]^=t.mul(o[x],u);let g=0;for(;g<l.length&&l[g]===0;)g++;l=l.slice(g)}return l},r.generateECPolynomial=function(n){let o=new Uint8Array([1]);for(let l=0;l<n;l++)o=r.mul(o,new Uint8Array([1,t.exp(l)]));return o}})(R1);const v1=R1;function Sc(r){this.genPoly=void 0,this.degree=r,this.degree&&this.initialize(this.degree)}Sc.prototype.initialize=function(t){this.degree=t,this.genPoly=v1.generateECPolynomial(this.degree)};Sc.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(t.length+this.degree);e.set(t);const n=v1.mod(e,this.genPoly),o=this.degree-n.length;if(o>0){const l=new Uint8Array(this.degree);return l.set(n,o),l}return n};var qx=Sc,O1={},Fs={},Rc={};Rc.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var Wn={};const N1="[0-9]+",Jx="[A-Z $%*+\\-./:]+";let Oo="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";Oo=Oo.replace(/u/g,"\\u");const Qx="(?:(?![A-Z0-9 $%*+\\-./:]|"+Oo+`)(?:.|[\r
]))+`;Wn.KANJI=new RegExp(Oo,"g");Wn.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Wn.BYTE=new RegExp(Qx,"g");Wn.NUMERIC=new RegExp(N1,"g");Wn.ALPHANUMERIC=new RegExp(Jx,"g");const $x=new RegExp("^"+Oo+"$"),t_=new RegExp("^"+N1+"$"),e_=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Wn.testKanji=function(t){return $x.test(t)};Wn.testNumeric=function(t){return t_.test(t)};Wn.testAlphanumeric=function(t){return e_.test(t)};(function(r){const t=Rc,e=Wn;r.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},r.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},r.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},r.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},r.MIXED={bit:-1},r.getCharCountIndicator=function(l,u){if(!l.ccBits)throw new Error("Invalid mode: "+l);if(!t.isValid(u))throw new Error("Invalid version: "+u);return u>=1&&u<10?l.ccBits[0]:u<27?l.ccBits[1]:l.ccBits[2]},r.getBestModeForData=function(l){return e.testNumeric(l)?r.NUMERIC:e.testAlphanumeric(l)?r.ALPHANUMERIC:e.testKanji(l)?r.KANJI:r.BYTE},r.toString=function(l){if(l&&l.id)return l.id;throw new Error("Invalid mode")},r.isValid=function(l){return l&&l.bit&&l.ccBits};function n(o){if(typeof o!="string")throw new Error("Param is not a string");switch(o.toLowerCase()){case"numeric":return r.NUMERIC;case"alphanumeric":return r.ALPHANUMERIC;case"kanji":return r.KANJI;case"byte":return r.BYTE;default:throw new Error("Unknown mode: "+o)}}r.from=function(l,u){if(r.isValid(l))return l;try{return n(l)}catch{return u}}})(Fs);(function(r){const t=rn,e=fl,n=ul,o=Fs,l=Rc,u=7973,g=t.getBCHDigit(u);function x(S,P,L){for(let F=1;F<=40;F++)if(P<=r.getCapacity(F,L,S))return F}function E(S,P){return o.getCharCountIndicator(S,P)+4}function w(S,P){let L=0;return S.forEach(function(F){const V=E(F.mode,P);L+=V+F.getBitsLength()}),L}function A(S,P){for(let L=1;L<=40;L++)if(w(S,L)<=r.getCapacity(L,P,o.MIXED))return L}r.from=function(P,L){return l.isValid(P)?parseInt(P,10):L},r.getCapacity=function(P,L,F){if(!l.isValid(P))throw new Error("Invalid QR Code version");typeof F>"u"&&(F=o.BYTE);const V=t.getSymbolTotalCodewords(P),z=e.getTotalCodewordsCount(P,L),U=(V-z)*8;if(F===o.MIXED)return U;const Y=U-E(F,P);switch(F){case o.NUMERIC:return Math.floor(Y/10*3);case o.ALPHANUMERIC:return Math.floor(Y/11*2);case o.KANJI:return Math.floor(Y/13);case o.BYTE:default:return Math.floor(Y/8)}},r.getBestVersionForData=function(P,L){let F;const V=n.from(L,n.M);if(Array.isArray(P)){if(P.length>1)return A(P,V);if(P.length===0)return 1;F=P[0]}else F=P;return x(F.mode,F.getLength(),V)},r.getEncodedBits=function(P){if(!l.isValid(P)||P<7)throw new Error("Invalid QR Code version");let L=P<<12;for(;t.getBCHDigit(L)-g>=0;)L^=u<<t.getBCHDigit(L)-g;return P<<12|L}})(O1);var P1={};const Ah=rn,D1=1335,i_=21522,Du=Ah.getBCHDigit(D1);P1.getEncodedBits=function(t,e){const n=t.bit<<3|e;let o=n<<10;for(;Ah.getBCHDigit(o)-Du>=0;)o^=D1<<Ah.getBCHDigit(o)-Du;return(n<<10|o)^i_};var L1={};const n_=Fs;function kr(r){this.mode=n_.NUMERIC,this.data=r.toString()}kr.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};kr.prototype.getLength=function(){return this.data.length};kr.prototype.getBitsLength=function(){return kr.getBitsLength(this.data.length)};kr.prototype.write=function(t){let e,n,o;for(e=0;e+3<=this.data.length;e+=3)n=this.data.substr(e,3),o=parseInt(n,10),t.put(o,10);const l=this.data.length-e;l>0&&(n=this.data.substr(e),o=parseInt(n,10),t.put(o,l*3+1))};var s_=kr;const r_=Fs,Jl=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Gr(r){this.mode=r_.ALPHANUMERIC,this.data=r}Gr.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};Gr.prototype.getLength=function(){return this.data.length};Gr.prototype.getBitsLength=function(){return Gr.getBitsLength(this.data.length)};Gr.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let n=Jl.indexOf(this.data[e])*45;n+=Jl.indexOf(this.data[e+1]),t.put(n,11)}this.data.length%2&&t.put(Jl.indexOf(this.data[e]),6)};var o_=Gr,a_=function(t){for(var e=[],n=t.length,o=0;o<n;o++){var l=t.charCodeAt(o);if(l>=55296&&l<=56319&&n>o+1){var u=t.charCodeAt(o+1);u>=56320&&u<=57343&&(l=(l-55296)*1024+u-56320+65536,o+=1)}if(l<128){e.push(l);continue}if(l<2048){e.push(l>>6|192),e.push(l&63|128);continue}if(l<55296||l>=57344&&l<65536){e.push(l>>12|224),e.push(l>>6&63|128),e.push(l&63|128);continue}if(l>=65536&&l<=1114111){e.push(l>>18|240),e.push(l>>12&63|128),e.push(l>>6&63|128),e.push(l&63|128);continue}e.push(239,191,189)}return new Uint8Array(e).buffer};const l_=a_,h_=Fs;function Ur(r){this.mode=h_.BYTE,typeof r=="string"&&(r=l_(r)),this.data=new Uint8Array(r)}Ur.getBitsLength=function(t){return t*8};Ur.prototype.getLength=function(){return this.data.length};Ur.prototype.getBitsLength=function(){return Ur.getBitsLength(this.data.length)};Ur.prototype.write=function(r){for(let t=0,e=this.data.length;t<e;t++)r.put(this.data[t],8)};var c_=Ur;const u_=Fs,f_=rn;function zr(r){this.mode=u_.KANJI,this.data=r}zr.getBitsLength=function(t){return t*13};zr.prototype.getLength=function(){return this.data.length};zr.prototype.getBitsLength=function(){return zr.getBitsLength(this.data.length)};zr.prototype.write=function(r){let t;for(t=0;t<this.data.length;t++){let e=f_.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),r.put(e,13)}};var d_=zr,F1={exports:{}};(function(r){var t={single_source_shortest_paths:function(e,n,o){var l={},u={};u[n]=0;var g=t.PriorityQueue.make();g.push(n,0);for(var x,E,w,A,S,P,L,F,V;!g.empty();){x=g.pop(),E=x.value,A=x.cost,S=e[E]||{};for(w in S)S.hasOwnProperty(w)&&(P=S[w],L=A+P,F=u[w],V=typeof u[w]>"u",(V||F>L)&&(u[w]=L,g.push(w,L),l[w]=E))}if(typeof o<"u"&&typeof u[o]>"u"){var z=["Could not find a path from ",n," to ",o,"."].join("");throw new Error(z)}return l},extract_shortest_path_from_predecessor_list:function(e,n){for(var o=[],l=n;l;)o.push(l),e[l],l=e[l];return o.reverse(),o},find_path:function(e,n,o){var l=t.single_source_shortest_paths(e,n,o);return t.extract_shortest_path_from_predecessor_list(l,o)},PriorityQueue:{make:function(e){var n=t.PriorityQueue,o={},l;e=e||{};for(l in n)n.hasOwnProperty(l)&&(o[l]=n[l]);return o.queue=[],o.sorter=e.sorter||n.default_sorter,o},default_sorter:function(e,n){return e.cost-n.cost},push:function(e,n){var o={value:e,cost:n};this.queue.push(o),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};r.exports=t})(F1);var g_=F1.exports;(function(r){const t=Fs,e=s_,n=o_,o=c_,l=d_,u=Wn,g=rn,x=g_;function E(z){return unescape(encodeURIComponent(z)).length}function w(z,U,Y){const Z=[];let $;for(;($=z.exec(Y))!==null;)Z.push({data:$[0],index:$.index,mode:U,length:$[0].length});return Z}function A(z){const U=w(u.NUMERIC,t.NUMERIC,z),Y=w(u.ALPHANUMERIC,t.ALPHANUMERIC,z);let Z,$;return g.isKanjiModeEnabled()?(Z=w(u.BYTE,t.BYTE,z),$=w(u.KANJI,t.KANJI,z)):(Z=w(u.BYTE_KANJI,t.BYTE,z),$=[]),U.concat(Y,Z,$).sort(function(X,J){return X.index-J.index}).map(function(X){return{data:X.data,mode:X.mode,length:X.length}})}function S(z,U){switch(U){case t.NUMERIC:return e.getBitsLength(z);case t.ALPHANUMERIC:return n.getBitsLength(z);case t.KANJI:return l.getBitsLength(z);case t.BYTE:return o.getBitsLength(z)}}function P(z){return z.reduce(function(U,Y){const Z=U.length-1>=0?U[U.length-1]:null;return Z&&Z.mode===Y.mode?(U[U.length-1].data+=Y.data,U):(U.push(Y),U)},[])}function L(z){const U=[];for(let Y=0;Y<z.length;Y++){const Z=z[Y];switch(Z.mode){case t.NUMERIC:U.push([Z,{data:Z.data,mode:t.ALPHANUMERIC,length:Z.length},{data:Z.data,mode:t.BYTE,length:Z.length}]);break;case t.ALPHANUMERIC:U.push([Z,{data:Z.data,mode:t.BYTE,length:Z.length}]);break;case t.KANJI:U.push([Z,{data:Z.data,mode:t.BYTE,length:E(Z.data)}]);break;case t.BYTE:U.push([{data:Z.data,mode:t.BYTE,length:E(Z.data)}])}}return U}function F(z,U){const Y={},Z={start:{}};let $=["start"];for(let ot=0;ot<z.length;ot++){const X=z[ot],J=[];for(let H=0;H<X.length;H++){const _t=X[H],xt=""+ot+H;J.push(xt),Y[xt]={node:_t,lastCount:0},Z[xt]={};for(let at=0;at<$.length;at++){const ut=$[at];Y[ut]&&Y[ut].node.mode===_t.mode?(Z[ut][xt]=S(Y[ut].lastCount+_t.length,_t.mode)-S(Y[ut].lastCount,_t.mode),Y[ut].lastCount+=_t.length):(Y[ut]&&(Y[ut].lastCount=_t.length),Z[ut][xt]=S(_t.length,_t.mode)+4+t.getCharCountIndicator(_t.mode,U))}}$=J}for(let ot=0;ot<$.length;ot++)Z[$[ot]].end=0;return{map:Z,table:Y}}function V(z,U){let Y;const Z=t.getBestModeForData(z);if(Y=t.from(U,Z),Y!==t.BYTE&&Y.bit<Z.bit)throw new Error('"'+z+'" cannot be encoded with mode '+t.toString(Y)+`.
 Suggested mode is: `+t.toString(Z));switch(Y===t.KANJI&&!g.isKanjiModeEnabled()&&(Y=t.BYTE),Y){case t.NUMERIC:return new e(z);case t.ALPHANUMERIC:return new n(z);case t.KANJI:return new l(z);case t.BYTE:return new o(z)}}r.fromArray=function(U){return U.reduce(function(Y,Z){return typeof Z=="string"?Y.push(V(Z,null)):Z.data&&Y.push(V(Z.data,Z.mode)),Y},[])},r.fromString=function(U,Y){const Z=A(U,g.isKanjiModeEnabled()),$=L(Z),ot=F($,Y),X=x.find_path(ot.map,"start","end"),J=[];for(let H=1;H<X.length-1;H++)J.push(ot.table[X[H]].node);return r.fromArray(P(J))},r.rawSplit=function(U){return r.fromArray(A(U,g.isKanjiModeEnabled()))}})(L1);const gl=rn,Ql=ul,m_=jx,x_=Zx,__=b1,p_=T1,Ih=S1,Mh=fl,y_=qx,Fa=O1,w_=P1,E_=Fs,$l=L1;function C_(r,t){const e=r.size,n=p_.getPositions(t);for(let o=0;o<n.length;o++){const l=n[o][0],u=n[o][1];for(let g=-1;g<=7;g++)if(!(l+g<=-1||e<=l+g))for(let x=-1;x<=7;x++)u+x<=-1||e<=u+x||(g>=0&&g<=6&&(x===0||x===6)||x>=0&&x<=6&&(g===0||g===6)||g>=2&&g<=4&&x>=2&&x<=4?r.set(l+g,u+x,!0,!0):r.set(l+g,u+x,!1,!0))}}function A_(r){const t=r.size;for(let e=8;e<t-8;e++){const n=e%2===0;r.set(e,6,n,!0),r.set(6,e,n,!0)}}function I_(r,t){const e=__.getPositions(t);for(let n=0;n<e.length;n++){const o=e[n][0],l=e[n][1];for(let u=-2;u<=2;u++)for(let g=-2;g<=2;g++)u===-2||u===2||g===-2||g===2||u===0&&g===0?r.set(o+u,l+g,!0,!0):r.set(o+u,l+g,!1,!0)}}function M_(r,t){const e=r.size,n=Fa.getEncodedBits(t);let o,l,u;for(let g=0;g<18;g++)o=Math.floor(g/3),l=g%3+e-8-3,u=(n>>g&1)===1,r.set(o,l,u,!0),r.set(l,o,u,!0)}function th(r,t,e){const n=r.size,o=w_.getEncodedBits(t,e);let l,u;for(l=0;l<15;l++)u=(o>>l&1)===1,l<6?r.set(l,8,u,!0):l<8?r.set(l+1,8,u,!0):r.set(n-15+l,8,u,!0),l<8?r.set(8,n-l-1,u,!0):l<9?r.set(8,15-l-1+1,u,!0):r.set(8,15-l-1,u,!0);r.set(n-8,8,1,!0)}function b_(r,t){const e=r.size;let n=-1,o=e-1,l=7,u=0;for(let g=e-1;g>0;g-=2)for(g===6&&g--;;){for(let x=0;x<2;x++)if(!r.isReserved(o,g-x)){let E=!1;u<t.length&&(E=(t[u]>>>l&1)===1),r.set(o,g-x,E),l--,l===-1&&(u++,l=7)}if(o+=n,o<0||e<=o){o-=n,n=-n;break}}}function T_(r,t,e){const n=new m_;e.forEach(function(x){n.put(x.mode.bit,4),n.put(x.getLength(),E_.getCharCountIndicator(x.mode,r)),x.write(n)});const o=gl.getSymbolTotalCodewords(r),l=Mh.getTotalCodewordsCount(r,t),u=(o-l)*8;for(n.getLengthInBits()+4<=u&&n.put(0,4);n.getLengthInBits()%8!==0;)n.putBit(0);const g=(u-n.getLengthInBits())/8;for(let x=0;x<g;x++)n.put(x%2?17:236,8);return S_(n,r,t)}function S_(r,t,e){const n=gl.getSymbolTotalCodewords(t),o=Mh.getTotalCodewordsCount(t,e),l=n-o,u=Mh.getBlocksCount(t,e),g=n%u,x=u-g,E=Math.floor(n/u),w=Math.floor(l/u),A=w+1,S=E-w,P=new y_(S);let L=0;const F=new Array(u),V=new Array(u);let z=0;const U=new Uint8Array(r.buffer);for(let X=0;X<u;X++){const J=X<x?w:A;F[X]=U.slice(L,L+J),V[X]=P.encode(F[X]),L+=J,z=Math.max(z,J)}const Y=new Uint8Array(n);let Z=0,$,ot;for($=0;$<z;$++)for(ot=0;ot<u;ot++)$<F[ot].length&&(Y[Z++]=F[ot][$]);for($=0;$<S;$++)for(ot=0;ot<u;ot++)Y[Z++]=V[ot][$];return Y}function R_(r,t,e,n){let o;if(Array.isArray(r))o=$l.fromArray(r);else if(typeof r=="string"){let E=t;if(!E){const w=$l.rawSplit(r);E=Fa.getBestVersionForData(w,e)}o=$l.fromString(r,E||40)}else throw new Error("Invalid data");const l=Fa.getBestVersionForData(o,e);if(!l)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=l;else if(t<l)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+l+`.
`);const u=T_(t,e,o),g=gl.getSymbolSize(t),x=new x_(g);return C_(x,t),A_(x),I_(x,t),th(x,e,0),t>=7&&M_(x,t),b_(x,u),isNaN(n)&&(n=Ih.getBestMask(x,th.bind(null,x,e))),Ih.applyMask(n,x),th(x,e,n),{modules:x,version:t,errorCorrectionLevel:e,maskPattern:n,segments:o}}I1.create=function(t,e){if(typeof t>"u"||t==="")throw new Error("No input text");let n=Ql.M,o,l;return typeof e<"u"&&(n=Ql.from(e.errorCorrectionLevel,Ql.M),o=Fa.from(e.version),l=Ih.from(e.maskPattern),e.toSJISFunc&&gl.setToSJISFunction(e.toSJISFunc)),R_(t,o,n,l)};var B1={},vc={};(function(r){function t(e){if(typeof e=="number"&&(e=e.toString()),typeof e!="string")throw new Error("Color should be defined as hex string");let n=e.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+e);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(l){return[l,l]}))),n.length===6&&n.push("F","F");const o=parseInt(n.join(""),16);return{r:o>>24&255,g:o>>16&255,b:o>>8&255,a:o&255,hex:"#"+n.slice(0,6).join("")}}r.getOptions=function(n){n||(n={}),n.color||(n.color={});const o=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,l=n.width&&n.width>=21?n.width:void 0,u=n.scale||4;return{width:l,scale:l?4:u,margin:o,color:{dark:t(n.color.dark||"#000000ff"),light:t(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},r.getScale=function(n,o){return o.width&&o.width>=n+o.margin*2?o.width/(n+o.margin*2):o.scale},r.getImageWidth=function(n,o){const l=r.getScale(n,o);return Math.floor((n+o.margin*2)*l)},r.qrToImageData=function(n,o,l){const u=o.modules.size,g=o.modules.data,x=r.getScale(u,l),E=Math.floor((u+l.margin*2)*x),w=l.margin*x,A=[l.color.light,l.color.dark];for(let S=0;S<E;S++)for(let P=0;P<E;P++){let L=(S*E+P)*4,F=l.color.light;if(S>=w&&P>=w&&S<E-w&&P<E-w){const V=Math.floor((S-w)/x),z=Math.floor((P-w)/x);F=A[g[V*u+z]?1:0]}n[L++]=F.r,n[L++]=F.g,n[L++]=F.b,n[L]=F.a}}})(vc);(function(r){const t=vc;function e(o,l,u){o.clearRect(0,0,l.width,l.height),l.style||(l.style={}),l.height=u,l.width=u,l.style.height=u+"px",l.style.width=u+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}r.render=function(l,u,g){let x=g,E=u;typeof x>"u"&&(!u||!u.getContext)&&(x=u,u=void 0),u||(E=n()),x=t.getOptions(x);const w=t.getImageWidth(l.modules.size,x),A=E.getContext("2d"),S=A.createImageData(w,w);return t.qrToImageData(S.data,l,x),e(A,E,w),A.putImageData(S,0,0),E},r.renderToDataURL=function(l,u,g){let x=g;typeof x>"u"&&(!u||!u.getContext)&&(x=u,u=void 0),x||(x={});const E=r.render(l,u,x),w=x.type||"image/png",A=x.rendererOpts||{};return E.toDataURL(w,A.quality)}})(B1);var k1={};const v_=vc;function Lu(r,t){const e=r.a/255,n=t+'="'+r.hex+'"';return e<1?n+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':n}function eh(r,t,e){let n=r+t;return typeof e<"u"&&(n+=" "+e),n}function O_(r,t,e){let n="",o=0,l=!1,u=0;for(let g=0;g<r.length;g++){const x=Math.floor(g%t),E=Math.floor(g/t);!x&&!l&&(l=!0),r[g]?(u++,g>0&&x>0&&r[g-1]||(n+=l?eh("M",x+e,.5+E+e):eh("m",o,0),o=0,l=!1),x+1<t&&r[g+1]||(n+=eh("h",u),u=0)):o++}return n}k1.render=function(t,e,n){const o=v_.getOptions(e),l=t.modules.size,u=t.modules.data,g=l+o.margin*2,x=o.color.light.a?"<path "+Lu(o.color.light,"fill")+' d="M0 0h'+g+"v"+g+'H0z"/>':"",E="<path "+Lu(o.color.dark,"stroke")+' d="'+O_(u,l,o.margin)+'"/>',w='viewBox="0 0 '+g+" "+g+'"',S='<svg xmlns="http://www.w3.org/2000/svg" '+(o.width?'width="'+o.width+'" height="'+o.width+'" ':"")+w+' shape-rendering="crispEdges">'+x+E+`</svg>
`;return typeof n=="function"&&n(null,S),S};const N_=Yx,bh=I1,G1=B1,P_=k1;function Oc(r,t,e,n,o){const l=[].slice.call(arguments,1),u=l.length,g=typeof l[u-1]=="function";if(!g&&!N_())throw new Error("Callback required as last argument");if(g){if(u<2)throw new Error("Too few arguments provided");u===2?(o=e,e=t,t=n=void 0):u===3&&(t.getContext&&typeof o>"u"?(o=n,n=void 0):(o=n,n=e,e=t,t=void 0))}else{if(u<1)throw new Error("Too few arguments provided");return u===1?(e=t,t=n=void 0):u===2&&!t.getContext&&(n=e,e=t,t=void 0),new Promise(function(x,E){try{const w=bh.create(e,n);x(r(w,t,n))}catch(w){E(w)}})}try{const x=bh.create(e,n);o(null,r(x,t,n))}catch(x){o(x)}}bh.create;Oc.bind(null,G1.render);Oc.bind(null,G1.renderToDataURL);Oc.bind(null,function(r,t,e){return P_.render(r,e)});var di;(function(r){r[r.QR_CODE=0]="QR_CODE",r[r.AZTEC=1]="AZTEC",r[r.CODABAR=2]="CODABAR",r[r.CODE_39=3]="CODE_39",r[r.CODE_93=4]="CODE_93",r[r.CODE_128=5]="CODE_128",r[r.DATA_MATRIX=6]="DATA_MATRIX",r[r.MAXICODE=7]="MAXICODE",r[r.ITF=8]="ITF",r[r.EAN_13=9]="EAN_13",r[r.EAN_8=10]="EAN_8",r[r.PDF_417=11]="PDF_417",r[r.RSS_14=12]="RSS_14",r[r.RSS_EXPANDED=13]="RSS_EXPANDED",r[r.UPC_A=14]="UPC_A",r[r.UPC_E=15]="UPC_E",r[r.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(di||(di={}));di.QR_CODE,di.AZTEC,di.CODABAR,di.CODE_39,di.CODE_93,di.CODE_128,di.DATA_MATRIX,di.MAXICODE,di.ITF,di.EAN_13,di.EAN_8,di.PDF_417,di.RSS_14,di.RSS_EXPANDED,di.UPC_A,di.UPC_E,di.UPC_EAN_EXTENSION;var Fu;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.URL=1]="URL"})(Fu||(Fu={}));var Ba;(function(r){r[r.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",r[r.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(Ba||(Ba={}));var D_=function(){function r(){}return r.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",r.SCAN_DEFAULT_FPS=2,r.DEFAULT_DISABLE_FLIP=!1,r.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,r.DEFAULT_SUPPORTED_SCAN_TYPE=[Ba.SCAN_TYPE_CAMERA,Ba.SCAN_TYPE_FILE],r}(),Bu;(function(r){r[r.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",r[r.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",r[r.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Bu||(Bu={}));var ku={exports:{}};(function(r,t){(function(e,n){n(t)})(Mn,function(e){function n(T){return T==null}var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,i){T.__proto__=i}||function(T,i){for(var s in i)i.hasOwnProperty(s)&&(T[s]=i[s])};function l(T,i){o(T,i);function s(){this.constructor=T}T.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}function u(T,i){var s=Object.setPrototypeOf;s?s(T,i):T.__proto__=i}function g(T,i){i===void 0&&(i=T.constructor);var s=Error.captureStackTrace;s&&s(T,i)}var x=function(T){l(i,T);function i(s){var a=this.constructor,h=T.call(this,s)||this;return Object.defineProperty(h,"name",{value:a.name,enumerable:!1}),u(h,a.prototype),g(h),h}return i}(Error);class E extends x{constructor(i=void 0){super(i),this.message=i}getKind(){return this.constructor.kind}}E.kind="Exception";class w extends E{}w.kind="ArgumentException";class A extends E{}A.kind="IllegalArgumentException";class S{constructor(i){if(this.binarizer=i,i===null)throw new A("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(i,s){return this.binarizer.getBlackRow(i,s)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(i,s,a,h){const c=this.binarizer.getLuminanceSource().crop(i,s,a,h);return new S(this.binarizer.createBinarizer(c))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const i=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new S(this.binarizer.createBinarizer(i))}rotateCounterClockwise45(){const i=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new S(this.binarizer.createBinarizer(i))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class P extends E{static getChecksumInstance(){return new P}}P.kind="ChecksumException";class L{constructor(i){this.source=i}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class F{static arraycopy(i,s,a,h,c){for(;c--;)a[h++]=i[s++]}static currentTimeMillis(){return Date.now()}}class V extends E{}V.kind="IndexOutOfBoundsException";class z extends V{constructor(i=void 0,s=void 0){super(s),this.index=i,this.message=s}}z.kind="ArrayIndexOutOfBoundsException";class U{static fill(i,s){for(let a=0,h=i.length;a<h;a++)i[a]=s}static fillWithin(i,s,a,h){U.rangeCheck(i.length,s,a);for(let c=s;c<a;c++)i[c]=h}static rangeCheck(i,s,a){if(s>a)throw new A("fromIndex("+s+") > toIndex("+a+")");if(s<0)throw new z(s);if(a>i)throw new z(a)}static asList(...i){return i}static create(i,s,a){return Array.from({length:i}).map(c=>Array.from({length:s}).fill(a))}static createInt32Array(i,s,a){return Array.from({length:i}).map(c=>Int32Array.from({length:s}).fill(a))}static equals(i,s){if(!i||!s||!i.length||!s.length||i.length!==s.length)return!1;for(let a=0,h=i.length;a<h;a++)if(i[a]!==s[a])return!1;return!0}static hashCode(i){if(i===null)return 0;let s=1;for(const a of i)s=31*s+a;return s}static fillUint8Array(i,s){for(let a=0;a!==i.length;a++)i[a]=s}static copyOf(i,s){return i.slice(0,s)}static copyOfUint8Array(i,s){if(i.length<=s){const a=new Uint8Array(s);return a.set(i),a}return i.slice(0,s)}static copyOfRange(i,s,a){const h=a-s,c=new Int32Array(h);return F.arraycopy(i,s,c,0,h),c}static binarySearch(i,s,a){a===void 0&&(a=U.numberComparator);let h=0,c=i.length-1;for(;h<=c;){const d=c+h>>1,m=a(s,i[d]);if(m>0)h=d+1;else if(m<0)c=d-1;else return d}return-h-1}static numberComparator(i,s){return i-s}}class Y{static numberOfTrailingZeros(i){let s;if(i===0)return 32;let a=31;return s=i<<16,s!==0&&(a-=16,i=s),s=i<<8,s!==0&&(a-=8,i=s),s=i<<4,s!==0&&(a-=4,i=s),s=i<<2,s!==0&&(a-=2,i=s),a-(i<<1>>>31)}static numberOfLeadingZeros(i){if(i===0)return 32;let s=1;return i>>>16||(s+=16,i<<=16),i>>>24||(s+=8,i<<=8),i>>>28||(s+=4,i<<=4),i>>>30||(s+=2,i<<=2),s-=i>>>31,s}static toHexString(i){return i.toString(16)}static toBinaryString(i){return String(parseInt(String(i),2))}static bitCount(i){return i=i-(i>>>1&1431655765),i=(i&858993459)+(i>>>2&858993459),i=i+(i>>>4)&252645135,i=i+(i>>>8),i=i+(i>>>16),i&63}static truncDivision(i,s){return Math.trunc(i/s)}static parseInt(i,s=void 0){return parseInt(i,s)}}Y.MIN_VALUE_32_BITS=-2147483648,Y.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Z{constructor(i,s){i===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=i,s==null?this.bits=Z.makeArray(i):this.bits=s)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(i){if(i>this.bits.length*32){const s=Z.makeArray(i);F.arraycopy(this.bits,0,s,0,this.bits.length),this.bits=s}}get(i){return(this.bits[Math.floor(i/32)]&1<<(i&31))!==0}set(i){this.bits[Math.floor(i/32)]|=1<<(i&31)}flip(i){this.bits[Math.floor(i/32)]^=1<<(i&31)}getNextSet(i){const s=this.size;if(i>=s)return s;const a=this.bits;let h=Math.floor(i/32),c=a[h];c&=~((1<<(i&31))-1);const d=a.length;for(;c===0;){if(++h===d)return s;c=a[h]}const m=h*32+Y.numberOfTrailingZeros(c);return m>s?s:m}getNextUnset(i){const s=this.size;if(i>=s)return s;const a=this.bits;let h=Math.floor(i/32),c=~a[h];c&=~((1<<(i&31))-1);const d=a.length;for(;c===0;){if(++h===d)return s;c=~a[h]}const m=h*32+Y.numberOfTrailingZeros(c);return m>s?s:m}setBulk(i,s){this.bits[Math.floor(i/32)]=s}setRange(i,s){if(s<i||i<0||s>this.size)throw new A;if(s===i)return;s--;const a=Math.floor(i/32),h=Math.floor(s/32),c=this.bits;for(let d=a;d<=h;d++){const m=d>a?0:i&31,C=(2<<(d<h?31:s&31))-(1<<m);c[d]|=C}}clear(){const i=this.bits.length,s=this.bits;for(let a=0;a<i;a++)s[a]=0}isRange(i,s,a){if(s<i||i<0||s>this.size)throw new A;if(s===i)return!0;s--;const h=Math.floor(i/32),c=Math.floor(s/32),d=this.bits;for(let m=h;m<=c;m++){const _=m>h?0:i&31,M=(2<<(m<c?31:s&31))-(1<<_)&4294967295;if((d[m]&M)!==(a?M:0))return!1}return!0}appendBit(i){this.ensureCapacity(this.size+1),i&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(i,s){if(s<0||s>32)throw new A("Num bits must be between 0 and 32");this.ensureCapacity(this.size+s);for(let a=s;a>0;a--)this.appendBit((i>>a-1&1)===1)}appendBitArray(i){const s=i.size;this.ensureCapacity(this.size+s);for(let a=0;a<s;a++)this.appendBit(i.get(a))}xor(i){if(this.size!==i.size)throw new A("Sizes don't match");const s=this.bits;for(let a=0,h=s.length;a<h;a++)s[a]^=i.bits[a]}toBytes(i,s,a,h){for(let c=0;c<h;c++){let d=0;for(let m=0;m<8;m++)this.get(i)&&(d|=1<<7-m),i++;s[a+c]=d}}getBitArray(){return this.bits}reverse(){const i=new Int32Array(this.bits.length),s=Math.floor((this.size-1)/32),a=s+1,h=this.bits;for(let c=0;c<a;c++){let d=h[c];d=d>>1&1431655765|(d&1431655765)<<1,d=d>>2&858993459|(d&858993459)<<2,d=d>>4&252645135|(d&252645135)<<4,d=d>>8&16711935|(d&16711935)<<8,d=d>>16&65535|(d&65535)<<16,i[s-c]=d}if(this.size!==a*32){const c=a*32-this.size;let d=i[0]>>>c;for(let m=1;m<a;m++){const _=i[m];d|=_<<32-c,i[m-1]=d,d=_>>>c}i[a-1]=d}this.bits=i}static makeArray(i){return new Int32Array(Math.floor((i+31)/32))}equals(i){if(!(i instanceof Z))return!1;const s=i;return this.size===s.size&&U.equals(this.bits,s.bits)}hashCode(){return 31*this.size+U.hashCode(this.bits)}toString(){let i="";for(let s=0,a=this.size;s<a;s++)s&7||(i+=" "),i+=this.get(s)?"X":".";return i}clone(){return new Z(this.size,this.bits.slice())}}var $;(function(T){T[T.OTHER=0]="OTHER",T[T.PURE_BARCODE=1]="PURE_BARCODE",T[T.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",T[T.TRY_HARDER=3]="TRY_HARDER",T[T.CHARACTER_SET=4]="CHARACTER_SET",T[T.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",T[T.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",T[T.ASSUME_GS1=7]="ASSUME_GS1",T[T.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",T[T.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",T[T.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})($||($={}));var ot=$;class X extends E{static getFormatInstance(){return new X}}X.kind="FormatException";var J;(function(T){T[T.Cp437=0]="Cp437",T[T.ISO8859_1=1]="ISO8859_1",T[T.ISO8859_2=2]="ISO8859_2",T[T.ISO8859_3=3]="ISO8859_3",T[T.ISO8859_4=4]="ISO8859_4",T[T.ISO8859_5=5]="ISO8859_5",T[T.ISO8859_6=6]="ISO8859_6",T[T.ISO8859_7=7]="ISO8859_7",T[T.ISO8859_8=8]="ISO8859_8",T[T.ISO8859_9=9]="ISO8859_9",T[T.ISO8859_10=10]="ISO8859_10",T[T.ISO8859_11=11]="ISO8859_11",T[T.ISO8859_13=12]="ISO8859_13",T[T.ISO8859_14=13]="ISO8859_14",T[T.ISO8859_15=14]="ISO8859_15",T[T.ISO8859_16=15]="ISO8859_16",T[T.SJIS=16]="SJIS",T[T.Cp1250=17]="Cp1250",T[T.Cp1251=18]="Cp1251",T[T.Cp1252=19]="Cp1252",T[T.Cp1256=20]="Cp1256",T[T.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",T[T.UTF8=22]="UTF8",T[T.ASCII=23]="ASCII",T[T.Big5=24]="Big5",T[T.GB18030=25]="GB18030",T[T.EUC_KR=26]="EUC_KR"})(J||(J={}));class H{constructor(i,s,a,...h){this.valueIdentifier=i,this.name=a,typeof s=="number"?this.values=Int32Array.from([s]):this.values=s,this.otherEncodingNames=h,H.VALUE_IDENTIFIER_TO_ECI.set(i,this),H.NAME_TO_ECI.set(a,this);const c=this.values;for(let d=0,m=c.length;d!==m;d++){const _=c[d];H.VALUES_TO_ECI.set(_,this)}for(const d of h)H.NAME_TO_ECI.set(d,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(i){if(i<0||i>=900)throw new X("incorect value");const s=H.VALUES_TO_ECI.get(i);if(s===void 0)throw new X("incorect value");return s}static getCharacterSetECIByName(i){const s=H.NAME_TO_ECI.get(i);if(s===void 0)throw new X("incorect value");return s}equals(i){if(!(i instanceof H))return!1;const s=i;return this.getName()===s.getName()}}H.VALUE_IDENTIFIER_TO_ECI=new Map,H.VALUES_TO_ECI=new Map,H.NAME_TO_ECI=new Map,H.Cp437=new H(J.Cp437,Int32Array.from([0,2]),"Cp437"),H.ISO8859_1=new H(J.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),H.ISO8859_2=new H(J.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),H.ISO8859_3=new H(J.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),H.ISO8859_4=new H(J.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),H.ISO8859_5=new H(J.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),H.ISO8859_6=new H(J.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),H.ISO8859_7=new H(J.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),H.ISO8859_8=new H(J.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),H.ISO8859_9=new H(J.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),H.ISO8859_10=new H(J.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),H.ISO8859_11=new H(J.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),H.ISO8859_13=new H(J.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),H.ISO8859_14=new H(J.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),H.ISO8859_15=new H(J.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),H.ISO8859_16=new H(J.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),H.SJIS=new H(J.SJIS,20,"SJIS","Shift_JIS"),H.Cp1250=new H(J.Cp1250,21,"Cp1250","windows-1250"),H.Cp1251=new H(J.Cp1251,22,"Cp1251","windows-1251"),H.Cp1252=new H(J.Cp1252,23,"Cp1252","windows-1252"),H.Cp1256=new H(J.Cp1256,24,"Cp1256","windows-1256"),H.UnicodeBigUnmarked=new H(J.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),H.UTF8=new H(J.UTF8,26,"UTF8","UTF-8"),H.ASCII=new H(J.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),H.Big5=new H(J.Big5,28,"Big5"),H.GB18030=new H(J.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),H.EUC_KR=new H(J.EUC_KR,30,"EUC_KR","EUC-KR");class _t extends E{}_t.kind="UnsupportedOperationException";class xt{static decode(i,s){const a=this.encodingName(s);return this.customDecoder?this.customDecoder(i,a):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(a)?this.decodeFallback(i,a):new TextDecoder(a).decode(i)}static shouldDecodeOnFallback(i){return!xt.isBrowser()&&i==="ISO-8859-1"}static encode(i,s){const a=this.encodingName(s);return this.customEncoder?this.customEncoder(i,a):typeof TextEncoder>"u"?this.encodeFallback(i):new TextEncoder().encode(i)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(i){return typeof i=="string"?i:i.getName()}static encodingCharacterSet(i){return i instanceof H?i:H.getCharacterSetECIByName(i)}static decodeFallback(i,s){const a=this.encodingCharacterSet(s);if(xt.isDecodeFallbackSupported(a)){let h="";for(let c=0,d=i.length;c<d;c++){let m=i[c].toString(16);m.length<2&&(m="0"+m),h+="%"+m}return decodeURIComponent(h)}if(a.equals(H.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(i.buffer));throw new _t(`Encoding ${this.encodingName(s)} not supported by fallback.`)}static isDecodeFallbackSupported(i){return i.equals(H.UTF8)||i.equals(H.ISO8859_1)||i.equals(H.ASCII)}static encodeFallback(i){const a=btoa(unescape(encodeURIComponent(i))).split(""),h=[];for(let c=0;c<a.length;c++)h.push(a[c].charCodeAt(0));return new Uint8Array(h)}}class at{static castAsNonUtf8Char(i,s=null){const a=s?s.getName():this.ISO88591;return xt.decode(new Uint8Array([i]),a)}static guessEncoding(i,s){if(s!=null&&s.get(ot.CHARACTER_SET)!==void 0)return s.get(ot.CHARACTER_SET).toString();const a=i.length;let h=!0,c=!0,d=!0,m=0,_=0,C=0,M=0,R=0,D=0,k=0,j=0,K=0,tt=0,st=0;const Et=i.length>3&&i[0]===239&&i[1]===187&&i[2]===191;for(let At=0;At<a&&(h||c||d);At++){const mt=i[At]&255;d&&(m>0?mt&128?m--:d=!1:mt&128&&(mt&64?(m++,mt&32?(m++,mt&16?(m++,mt&8?d=!1:M++):C++):_++):d=!1)),h&&(mt>127&&mt<160?h=!1:mt>159&&(mt<192||mt===215||mt===247)&&st++),c&&(R>0?mt<64||mt===127||mt>252?c=!1:R--:mt===128||mt===160||mt>239?c=!1:mt>160&&mt<224?(D++,j=0,k++,k>K&&(K=k)):mt>127?(R++,k=0,j++,j>tt&&(tt=j)):(k=0,j=0))}return d&&m>0&&(d=!1),c&&R>0&&(c=!1),d&&(Et||_+C+M>0)?at.UTF8:c&&(at.ASSUME_SHIFT_JIS||K>=3||tt>=3)?at.SHIFT_JIS:h&&c?K===2&&D===2||st*10>=a?at.SHIFT_JIS:at.ISO88591:h?at.ISO88591:c?at.SHIFT_JIS:d?at.UTF8:at.PLATFORM_DEFAULT_ENCODING}static format(i,...s){let a=-1;function h(d,m,_,C,M,R){if(d==="%%")return"%";if(s[++a]===void 0)return;d=C?parseInt(C.substr(1)):void 0;let D=M?parseInt(M.substr(1)):void 0,k;switch(R){case"s":k=s[a];break;case"c":k=s[a][0];break;case"f":k=parseFloat(s[a]).toFixed(d);break;case"p":k=parseFloat(s[a]).toPrecision(d);break;case"e":k=parseFloat(s[a]).toExponential(d);break;case"x":k=parseInt(s[a]).toString(D||16);break;case"d":k=parseFloat(parseInt(s[a],D||10).toPrecision(d)).toFixed(0);break}k=typeof k=="object"?JSON.stringify(k):(+k).toString(D);let j=parseInt(_),K=_&&_[0]+""=="0"?"0":" ";for(;k.length<j;)k=m!==void 0?k+K:K+k;return k}let c=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return i.replace(c,h)}static getBytes(i,s){return xt.encode(i,s)}static getCharCode(i,s=0){return i.charCodeAt(s)}static getCharAt(i){return String.fromCharCode(i)}}at.SHIFT_JIS=H.SJIS.getName(),at.GB2312="GB2312",at.ISO88591=H.ISO8859_1.getName(),at.EUC_JP="EUC_JP",at.UTF8=H.UTF8.getName(),at.PLATFORM_DEFAULT_ENCODING=at.UTF8,at.ASSUME_SHIFT_JIS=!1;class ut{constructor(i=""){this.value=i}enableDecoding(i){return this.encoding=i,this}append(i){return typeof i=="string"?this.value+=i.toString():this.encoding?this.value+=at.castAsNonUtf8Char(i,this.encoding):this.value+=String.fromCharCode(i),this}appendChars(i,s,a){for(let h=s;s<s+a;h++)this.append(i[h]);return this}length(){return this.value.length}charAt(i){return this.value.charAt(i)}deleteCharAt(i){this.value=this.value.substr(0,i)+this.value.substring(i+1)}setCharAt(i,s){this.value=this.value.substr(0,i)+s+this.value.substr(i+1)}substring(i,s){return this.value.substring(i,s)}setLengthToZero(){this.value=""}toString(){return this.value}insert(i,s){this.value=this.value.substr(0,i)+s+this.value.substr(i+s.length)}}class pt{constructor(i,s,a,h){if(this.width=i,this.height=s,this.rowSize=a,this.bits=h,s==null&&(s=i),this.height=s,i<1||s<1)throw new A("Both dimensions must be greater than 0");a==null&&(a=Math.floor((i+31)/32)),this.rowSize=a,h==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(i){const s=i.length,a=i[0].length,h=new pt(a,s);for(let c=0;c<s;c++){const d=i[c];for(let m=0;m<a;m++)d[m]&&h.set(m,c)}return h}static parseFromString(i,s,a){if(i===null)throw new A("stringRepresentation cannot be null");const h=new Array(i.length);let c=0,d=0,m=-1,_=0,C=0;for(;C<i.length;)if(i.charAt(C)===`
`||i.charAt(C)==="\r"){if(c>d){if(m===-1)m=c-d;else if(c-d!==m)throw new A("row lengths do not match");d=c,_++}C++}else if(i.substring(C,C+s.length)===s)C+=s.length,h[c]=!0,c++;else if(i.substring(C,C+a.length)===a)C+=a.length,h[c]=!1,c++;else throw new A("illegal character encountered: "+i.substring(C));if(c>d){if(m===-1)m=c-d;else if(c-d!==m)throw new A("row lengths do not match");_++}const M=new pt(m,_);for(let R=0;R<c;R++)h[R]&&M.set(Math.floor(R%m),Math.floor(R/m));return M}get(i,s){const a=s*this.rowSize+Math.floor(i/32);return(this.bits[a]>>>(i&31)&1)!==0}set(i,s){const a=s*this.rowSize+Math.floor(i/32);this.bits[a]|=1<<(i&31)&4294967295}unset(i,s){const a=s*this.rowSize+Math.floor(i/32);this.bits[a]&=~(1<<(i&31)&4294967295)}flip(i,s){const a=s*this.rowSize+Math.floor(i/32);this.bits[a]^=1<<(i&31)&4294967295}xor(i){if(this.width!==i.getWidth()||this.height!==i.getHeight()||this.rowSize!==i.getRowSize())throw new A("input matrix dimensions do not match");const s=new Z(Math.floor(this.width/32)+1),a=this.rowSize,h=this.bits;for(let c=0,d=this.height;c<d;c++){const m=c*a,_=i.getRow(c,s).getBitArray();for(let C=0;C<a;C++)h[m+C]^=_[C]}}clear(){const i=this.bits,s=i.length;for(let a=0;a<s;a++)i[a]=0}setRegion(i,s,a,h){if(s<0||i<0)throw new A("Left and top must be nonnegative");if(h<1||a<1)throw new A("Height and width must be at least 1");const c=i+a,d=s+h;if(d>this.height||c>this.width)throw new A("The region must fit inside the matrix");const m=this.rowSize,_=this.bits;for(let C=s;C<d;C++){const M=C*m;for(let R=i;R<c;R++)_[M+Math.floor(R/32)]|=1<<(R&31)&4294967295}}getRow(i,s){s==null||s.getSize()<this.width?s=new Z(this.width):s.clear();const a=this.rowSize,h=this.bits,c=i*a;for(let d=0;d<a;d++)s.setBulk(d*32,h[c+d]);return s}setRow(i,s){F.arraycopy(s.getBitArray(),0,this.bits,i*this.rowSize,this.rowSize)}rotate180(){const i=this.getWidth(),s=this.getHeight();let a=new Z(i),h=new Z(i);for(let c=0,d=Math.floor((s+1)/2);c<d;c++)a=this.getRow(c,a),h=this.getRow(s-1-c,h),a.reverse(),h.reverse(),this.setRow(c,h),this.setRow(s-1-c,a)}getEnclosingRectangle(){const i=this.width,s=this.height,a=this.rowSize,h=this.bits;let c=i,d=s,m=-1,_=-1;for(let C=0;C<s;C++)for(let M=0;M<a;M++){const R=h[C*a+M];if(R!==0){if(C<d&&(d=C),C>_&&(_=C),M*32<c){let D=0;for(;!(R<<31-D&4294967295);)D++;M*32+D<c&&(c=M*32+D)}if(M*32+31>m){let D=31;for(;!(R>>>D);)D--;M*32+D>m&&(m=M*32+D)}}}return m<c||_<d?null:Int32Array.from([c,d,m-c+1,_-d+1])}getTopLeftOnBit(){const i=this.rowSize,s=this.bits;let a=0;for(;a<s.length&&s[a]===0;)a++;if(a===s.length)return null;const h=a/i;let c=a%i*32;const d=s[a];let m=0;for(;!(d<<31-m&4294967295);)m++;return c+=m,Int32Array.from([c,h])}getBottomRightOnBit(){const i=this.rowSize,s=this.bits;let a=s.length-1;for(;a>=0&&s[a]===0;)a--;if(a<0)return null;const h=Math.floor(a/i);let c=Math.floor(a%i)*32;const d=s[a];let m=31;for(;!(d>>>m);)m--;return c+=m,Int32Array.from([c,h])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(i){if(!(i instanceof pt))return!1;const s=i;return this.width===s.width&&this.height===s.height&&this.rowSize===s.rowSize&&U.equals(this.bits,s.bits)}hashCode(){let i=this.width;return i=31*i+this.width,i=31*i+this.height,i=31*i+this.rowSize,i=31*i+U.hashCode(this.bits),i}toString(i="X ",s="  ",a=`
`){return this.buildToString(i,s,a)}buildToString(i,s,a){let h=new ut;for(let c=0,d=this.height;c<d;c++){for(let m=0,_=this.width;m<_;m++)h.append(this.get(m,c)?i:s);h.append(a)}return h.toString()}clone(){return new pt(this.width,this.height,this.rowSize,this.bits.slice())}}class q extends E{static getNotFoundInstance(){return new q}}q.kind="NotFoundException";class lt extends L{constructor(i){super(i),this.luminances=lt.EMPTY,this.buckets=new Int32Array(lt.LUMINANCE_BUCKETS)}getBlackRow(i,s){const a=this.getLuminanceSource(),h=a.getWidth();s==null||s.getSize()<h?s=new Z(h):s.clear(),this.initArrays(h);const c=a.getRow(i,this.luminances),d=this.buckets;for(let _=0;_<h;_++)d[(c[_]&255)>>lt.LUMINANCE_SHIFT]++;const m=lt.estimateBlackPoint(d);if(h<3)for(let _=0;_<h;_++)(c[_]&255)<m&&s.set(_);else{let _=c[0]&255,C=c[1]&255;for(let M=1;M<h-1;M++){const R=c[M+1]&255;(C*4-_-R)/2<m&&s.set(M),_=C,C=R}}return s}getBlackMatrix(){const i=this.getLuminanceSource(),s=i.getWidth(),a=i.getHeight(),h=new pt(s,a);this.initArrays(s);const c=this.buckets;for(let _=1;_<5;_++){const C=Math.floor(a*_/5),M=i.getRow(C,this.luminances),R=Math.floor(s*4/5);for(let D=Math.floor(s/5);D<R;D++){const k=M[D]&255;c[k>>lt.LUMINANCE_SHIFT]++}}const d=lt.estimateBlackPoint(c),m=i.getMatrix();for(let _=0;_<a;_++){const C=_*s;for(let M=0;M<s;M++)(m[C+M]&255)<d&&h.set(M,_)}return h}createBinarizer(i){return new lt(i)}initArrays(i){this.luminances.length<i&&(this.luminances=new Uint8ClampedArray(i));const s=this.buckets;for(let a=0;a<lt.LUMINANCE_BUCKETS;a++)s[a]=0}static estimateBlackPoint(i){const s=i.length;let a=0,h=0,c=0;for(let M=0;M<s;M++)i[M]>c&&(h=M,c=i[M]),i[M]>a&&(a=i[M]);let d=0,m=0;for(let M=0;M<s;M++){const R=M-h,D=i[M]*R*R;D>m&&(d=M,m=D)}if(h>d){const M=h;h=d,d=M}if(d-h<=s/16)throw new q;let _=d-1,C=-1;for(let M=d-1;M>h;M--){const R=M-h,D=R*R*(d-M)*(a-i[M]);D>C&&(_=M,C=D)}return _<<lt.LUMINANCE_SHIFT}}lt.LUMINANCE_BITS=5,lt.LUMINANCE_SHIFT=8-lt.LUMINANCE_BITS,lt.LUMINANCE_BUCKETS=1<<lt.LUMINANCE_BITS,lt.EMPTY=Uint8ClampedArray.from([0]);class yt extends lt{constructor(i){super(i),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const i=this.getLuminanceSource(),s=i.getWidth(),a=i.getHeight();if(s>=yt.MINIMUM_DIMENSION&&a>=yt.MINIMUM_DIMENSION){const h=i.getMatrix();let c=s>>yt.BLOCK_SIZE_POWER;s&yt.BLOCK_SIZE_MASK&&c++;let d=a>>yt.BLOCK_SIZE_POWER;a&yt.BLOCK_SIZE_MASK&&d++;const m=yt.calculateBlackPoints(h,c,d,s,a),_=new pt(s,a);yt.calculateThresholdForBlock(h,c,d,s,a,m,_),this.matrix=_}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(i){return new yt(i)}static calculateThresholdForBlock(i,s,a,h,c,d,m){const _=c-yt.BLOCK_SIZE,C=h-yt.BLOCK_SIZE;for(let M=0;M<a;M++){let R=M<<yt.BLOCK_SIZE_POWER;R>_&&(R=_);const D=yt.cap(M,2,a-3);for(let k=0;k<s;k++){let j=k<<yt.BLOCK_SIZE_POWER;j>C&&(j=C);const K=yt.cap(k,2,s-3);let tt=0;for(let Et=-2;Et<=2;Et++){const At=d[D+Et];tt+=At[K-2]+At[K-1]+At[K]+At[K+1]+At[K+2]}const st=tt/25;yt.thresholdBlock(i,j,R,st,h,m)}}}static cap(i,s,a){return i<s?s:i>a?a:i}static thresholdBlock(i,s,a,h,c,d){for(let m=0,_=a*c+s;m<yt.BLOCK_SIZE;m++,_+=c)for(let C=0;C<yt.BLOCK_SIZE;C++)(i[_+C]&255)<=h&&d.set(s+C,a+m)}static calculateBlackPoints(i,s,a,h,c){const d=c-yt.BLOCK_SIZE,m=h-yt.BLOCK_SIZE,_=new Array(a);for(let C=0;C<a;C++){_[C]=new Int32Array(s);let M=C<<yt.BLOCK_SIZE_POWER;M>d&&(M=d);for(let R=0;R<s;R++){let D=R<<yt.BLOCK_SIZE_POWER;D>m&&(D=m);let k=0,j=255,K=0;for(let st=0,Et=M*h+D;st<yt.BLOCK_SIZE;st++,Et+=h){for(let At=0;At<yt.BLOCK_SIZE;At++){const mt=i[Et+At]&255;k+=mt,mt<j&&(j=mt),mt>K&&(K=mt)}if(K-j>yt.MIN_DYNAMIC_RANGE)for(st++,Et+=h;st<yt.BLOCK_SIZE;st++,Et+=h)for(let At=0;At<yt.BLOCK_SIZE;At++)k+=i[Et+At]&255}let tt=k>>yt.BLOCK_SIZE_POWER*2;if(K-j<=yt.MIN_DYNAMIC_RANGE&&(tt=j/2,C>0&&R>0)){const st=(_[C-1][R]+2*_[C][R-1]+_[C-1][R-1])/4;j<st&&(tt=st)}_[C][R]=tt}}return _}}yt.BLOCK_SIZE_POWER=3,yt.BLOCK_SIZE=1<<yt.BLOCK_SIZE_POWER,yt.BLOCK_SIZE_MASK=yt.BLOCK_SIZE-1,yt.MINIMUM_DIMENSION=yt.BLOCK_SIZE*5,yt.MIN_DYNAMIC_RANGE=24;class Lt{constructor(i,s){this.width=i,this.height=s}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(i,s,a,h){throw new _t("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new _t("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new _t("This luminance source does not support rotation by 45 degrees.")}toString(){const i=new Uint8ClampedArray(this.width);let s=new ut;for(let a=0;a<this.height;a++){const h=this.getRow(a,i);for(let c=0;c<this.width;c++){const d=h[c]&255;let m;d<64?m="#":d<128?m="+":d<192?m=".":m=" ",s.append(m)}s.append(`
`)}return s.toString()}}class oe extends Lt{constructor(i){super(i.getWidth(),i.getHeight()),this.delegate=i}getRow(i,s){const a=this.delegate.getRow(i,s),h=this.getWidth();for(let c=0;c<h;c++)a[c]=255-(a[c]&255);return a}getMatrix(){const i=this.delegate.getMatrix(),s=this.getWidth()*this.getHeight(),a=new Uint8ClampedArray(s);for(let h=0;h<s;h++)a[h]=255-(i[h]&255);return a}isCropSupported(){return this.delegate.isCropSupported()}crop(i,s,a,h){return new oe(this.delegate.crop(i,s,a,h))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new oe(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new oe(this.delegate.rotateCounterClockwise45())}}class Gt extends Lt{constructor(i){super(i.width,i.height),this.canvas=i,this.tempCanvasElement=null,this.buffer=Gt.makeBufferFromCanvasImageData(i)}static makeBufferFromCanvasImageData(i){const s=i.getContext("2d").getImageData(0,0,i.width,i.height);return Gt.toGrayscaleBuffer(s.data,i.width,i.height)}static toGrayscaleBuffer(i,s,a){const h=new Uint8ClampedArray(s*a);for(let c=0,d=0,m=i.length;c<m;c+=4,d++){let _;if(i[c+3]===0)_=255;else{const M=i[c],R=i[c+1],D=i[c+2];_=306*M+601*R+117*D+512>>10}h[d]=_}return h}getRow(i,s){if(i<0||i>=this.getHeight())throw new A("Requested row is outside the image: "+i);const a=this.getWidth(),h=i*a;return s===null?s=this.buffer.slice(h,h+a):(s.length<a&&(s=new Uint8ClampedArray(a)),s.set(this.buffer.slice(h,h+a))),s}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(i,s,a,h){return super.crop(i,s,a,h),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const i=this.canvas.ownerDocument.createElement("canvas");i.width=this.canvas.width,i.height=this.canvas.height,this.tempCanvasElement=i}return this.tempCanvasElement}rotate(i){const s=this.getTempCanvasElement(),a=s.getContext("2d"),h=i*Gt.DEGREE_TO_RADIANS,c=this.canvas.width,d=this.canvas.height,m=Math.ceil(Math.abs(Math.cos(h))*c+Math.abs(Math.sin(h))*d),_=Math.ceil(Math.abs(Math.sin(h))*c+Math.abs(Math.cos(h))*d);return s.width=m,s.height=_,a.translate(m/2,_/2),a.rotate(h),a.drawImage(this.canvas,c/-2,d/-2),this.buffer=Gt.makeBufferFromCanvasImageData(s),this}invert(){return new oe(this)}}Gt.DEGREE_TO_RADIANS=Math.PI/180;class $t{constructor(i,s,a){this.deviceId=i,this.label=s,this.kind="videoinput",this.groupId=a||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var Ft=(globalThis||Mn||self||window||void 0)&&(globalThis||Mn||self||window||void 0).__awaiter||function(T,i,s,a){function h(c){return c instanceof s?c:new s(function(d){d(c)})}return new(s||(s=Promise))(function(c,d){function m(M){try{C(a.next(M))}catch(R){d(R)}}function _(M){try{C(a.throw(M))}catch(R){d(R)}}function C(M){M.done?c(M.value):h(M.value).then(m,_)}C((a=a.apply(T,i||[])).next())})};class te{constructor(i,s=500,a){this.reader=i,this.timeBetweenScansMillis=s,this._hints=a,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(i){this._timeBetweenDecodingAttempts=i<0?0:i}set hints(i){this._hints=i||null}get hints(){return this._hints}listVideoInputDevices(){return Ft(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const i=yield navigator.mediaDevices.enumerateDevices(),s=[];for(const a of i){const h=a.kind==="video"?"videoinput":a.kind;if(h!=="videoinput")continue;const c=a.deviceId||a.id,d=a.label||`Video device ${s.length+1}`,m=a.groupId,_={deviceId:c,label:d,kind:h,groupId:m};s.push(_)}return s})}getVideoInputDevices(){return Ft(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(s=>new $t(s.deviceId,s.label))})}findDeviceById(i){return Ft(this,void 0,void 0,function*(){const s=yield this.listVideoInputDevices();return s?s.find(a=>a.deviceId===i):null})}decodeFromInputVideoDevice(i,s){return Ft(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(i,s)})}decodeOnceFromVideoDevice(i,s){return Ft(this,void 0,void 0,function*(){this.reset();let a;i?a={deviceId:{exact:i}}:a={facingMode:"environment"};const h={video:a};return yield this.decodeOnceFromConstraints(h,s)})}decodeOnceFromConstraints(i,s){return Ft(this,void 0,void 0,function*(){const a=yield navigator.mediaDevices.getUserMedia(i);return yield this.decodeOnceFromStream(a,s)})}decodeOnceFromStream(i,s){return Ft(this,void 0,void 0,function*(){this.reset();const a=yield this.attachStreamToVideo(i,s);return yield this.decodeOnce(a)})}decodeFromInputVideoDeviceContinuously(i,s,a){return Ft(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(i,s,a)})}decodeFromVideoDevice(i,s,a){return Ft(this,void 0,void 0,function*(){let h;i?h={deviceId:{exact:i}}:h={facingMode:"environment"};const c={video:h};return yield this.decodeFromConstraints(c,s,a)})}decodeFromConstraints(i,s,a){return Ft(this,void 0,void 0,function*(){const h=yield navigator.mediaDevices.getUserMedia(i);return yield this.decodeFromStream(h,s,a)})}decodeFromStream(i,s,a){return Ft(this,void 0,void 0,function*(){this.reset();const h=yield this.attachStreamToVideo(i,s);return yield this.decodeContinuously(h,a)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(i,s){return Ft(this,void 0,void 0,function*(){const a=this.prepareVideoElement(s);return this.addVideoSource(a,i),this.videoElement=a,this.stream=i,yield this.playVideoOnLoadAsync(a),a})}playVideoOnLoadAsync(i){return new Promise((s,a)=>this.playVideoOnLoad(i,()=>s()))}playVideoOnLoad(i,s){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(i),i.addEventListener("ended",this.videoEndedListener),i.addEventListener("canplay",this.videoCanPlayListener),i.addEventListener("playing",s),this.tryPlayVideo(i)}isVideoPlaying(i){return i.currentTime>0&&!i.paused&&!i.ended&&i.readyState>2}tryPlayVideo(i){return Ft(this,void 0,void 0,function*(){if(this.isVideoPlaying(i)){console.warn("Trying to play video that is already playing.");return}try{yield i.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(i,s){const a=document.getElementById(i);if(!a)throw new w(`element with id '${i}' not found`);if(a.nodeName.toLowerCase()!==s.toLowerCase())throw new w(`element with id '${i}' must be an ${s} element`);return a}decodeFromImage(i,s){if(!i&&!s)throw new w("either imageElement with a src set or an url must be provided");return s&&!i?this.decodeFromImageUrl(s):this.decodeFromImageElement(i)}decodeFromVideo(i,s){if(!i&&!s)throw new w("Either an element with a src set or an URL must be provided");return s&&!i?this.decodeFromVideoUrl(s):this.decodeFromVideoElement(i)}decodeFromVideoContinuously(i,s,a){if(i===void 0&&s===void 0)throw new w("Either an element with a src set or an URL must be provided");return s&&!i?this.decodeFromVideoUrlContinuously(s,a):this.decodeFromVideoElementContinuously(i,a)}decodeFromImageElement(i){if(!i)throw new w("An image element must be provided.");this.reset();const s=this.prepareImageElement(i);this.imageElement=s;let a;return this.isImageLoaded(s)?a=this.decodeOnce(s,!1,!0):a=this._decodeOnLoadImage(s),a}decodeFromVideoElement(i){const s=this._decodeFromVideoElementSetup(i);return this._decodeOnLoadVideo(s)}decodeFromVideoElementContinuously(i,s){const a=this._decodeFromVideoElementSetup(i);return this._decodeOnLoadVideoContinuously(a,s)}_decodeFromVideoElementSetup(i){if(!i)throw new w("A video element must be provided.");this.reset();const s=this.prepareVideoElement(i);return this.videoElement=s,s}decodeFromImageUrl(i){if(!i)throw new w("An URL must be provided.");this.reset();const s=this.prepareImageElement();this.imageElement=s;const a=this._decodeOnLoadImage(s);return s.src=i,a}decodeFromVideoUrl(i){if(!i)throw new w("An URL must be provided.");this.reset();const s=this.prepareVideoElement(),a=this.decodeFromVideoElement(s);return s.src=i,a}decodeFromVideoUrlContinuously(i,s){if(!i)throw new w("An URL must be provided.");this.reset();const a=this.prepareVideoElement(),h=this.decodeFromVideoElementContinuously(a,s);return a.src=i,h}_decodeOnLoadImage(i){return new Promise((s,a)=>{this.imageLoadedListener=()=>this.decodeOnce(i,!1,!0).then(s,a),i.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(i){return Ft(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(i),yield this.decodeOnce(i)})}_decodeOnLoadVideoContinuously(i,s){return Ft(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(i),this.decodeContinuously(i,s)})}isImageLoaded(i){return!(!i.complete||i.naturalWidth===0)}prepareImageElement(i){let s;return typeof i>"u"&&(s=document.createElement("img"),s.width=200,s.height=200),typeof i=="string"&&(s=this.getMediaElement(i,"img")),i instanceof HTMLImageElement&&(s=i),s}prepareVideoElement(i){let s;return!i&&typeof document<"u"&&(s=document.createElement("video"),s.width=200,s.height=200),typeof i=="string"&&(s=this.getMediaElement(i,"video")),i instanceof HTMLVideoElement&&(s=i),s.setAttribute("autoplay","true"),s.setAttribute("muted","true"),s.setAttribute("playsinline","true"),s}decodeOnce(i,s=!0,a=!0){this._stopAsyncDecode=!1;const h=(c,d)=>{if(this._stopAsyncDecode){d(new q("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const m=this.decode(i);c(m)}catch(m){const _=s&&m instanceof q,M=(m instanceof P||m instanceof X)&&a;if(_||M)return setTimeout(h,this._timeBetweenDecodingAttempts,c,d);d(m)}};return new Promise((c,d)=>h(c,d))}decodeContinuously(i,s){this._stopContinuousDecode=!1;const a=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const h=this.decode(i);s(h,null),setTimeout(a,this.timeBetweenScansMillis)}catch(h){s(null,h);const c=h instanceof P||h instanceof X,d=h instanceof q;(c||d)&&setTimeout(a,this._timeBetweenDecodingAttempts)}};a()}decode(i){const s=this.createBinaryBitmap(i);return this.decodeBitmap(s)}_isHTMLVideoElement(i){return i.videoWidth!==0}drawFrameOnCanvas(i,s,a){s||(s={sx:0,sy:0,sWidth:i.videoWidth,sHeight:i.videoHeight,dx:0,dy:0,dWidth:i.videoWidth,dHeight:i.videoHeight}),a||(a=this.captureCanvasContext),a.drawImage(i,s.sx,s.sy,s.sWidth,s.sHeight,s.dx,s.dy,s.dWidth,s.dHeight)}drawImageOnCanvas(i,s,a=this.captureCanvasContext){s||(s={sx:0,sy:0,sWidth:i.naturalWidth,sHeight:i.naturalHeight,dx:0,dy:0,dWidth:i.naturalWidth,dHeight:i.naturalHeight}),a||(a=this.captureCanvasContext),a.drawImage(i,s.sx,s.sy,s.sWidth,s.sHeight,s.dx,s.dy,s.dWidth,s.dHeight)}createBinaryBitmap(i){this.getCaptureCanvasContext(i),this._isHTMLVideoElement(i)?this.drawFrameOnCanvas(i):this.drawImageOnCanvas(i);const s=this.getCaptureCanvas(i),a=new Gt(s),h=new yt(a);return new S(h)}getCaptureCanvasContext(i){if(!this.captureCanvasContext){const a=this.getCaptureCanvas(i).getContext("2d");this.captureCanvasContext=a}return this.captureCanvasContext}getCaptureCanvas(i){if(!this.captureCanvas){const s=this.createCaptureCanvas(i);this.captureCanvas=s}return this.captureCanvas}decodeBitmap(i){return this.reader.decode(i,this._hints)}createCaptureCanvas(i){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const s=document.createElement("canvas");let a,h;return typeof i<"u"&&(i instanceof HTMLVideoElement?(a=i.videoWidth,h=i.videoHeight):i instanceof HTMLImageElement&&(a=i.naturalWidth||i.width,h=i.naturalHeight||i.height)),s.style.width=a+"px",s.style.height=h+"px",s.width=a,s.height=h,s}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(i=>i.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(i,s){try{i.srcObject=s}catch{i.src=URL.createObjectURL(s)}}cleanVideoSource(i){try{i.srcObject=null}catch{i.src=""}this.videoElement.removeAttribute("src")}}class gt{constructor(i,s,a=s==null?0:8*s.length,h,c,d=F.currentTimeMillis()){this.text=i,this.rawBytes=s,this.numBits=a,this.resultPoints=h,this.format=c,this.timestamp=d,this.text=i,this.rawBytes=s,a==null?this.numBits=s==null?0:8*s.length:this.numBits=a,this.resultPoints=h,this.format=c,this.resultMetadata=null,d==null?this.timestamp=F.currentTimeMillis():this.timestamp=d}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(i,s){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(i,s)}putAllMetadata(i){i!==null&&(this.resultMetadata===null?this.resultMetadata=i:this.resultMetadata=new Map(i))}addResultPoints(i){const s=this.resultPoints;if(s===null)this.resultPoints=i;else if(i!==null&&i.length>0){const a=new Array(s.length+i.length);F.arraycopy(s,0,a,0,s.length),F.arraycopy(i,0,a,s.length,i.length),this.resultPoints=a}}getTimestamp(){return this.timestamp}toString(){return this.text}}var ii;(function(T){T[T.AZTEC=0]="AZTEC",T[T.CODABAR=1]="CODABAR",T[T.CODE_39=2]="CODE_39",T[T.CODE_93=3]="CODE_93",T[T.CODE_128=4]="CODE_128",T[T.DATA_MATRIX=5]="DATA_MATRIX",T[T.EAN_8=6]="EAN_8",T[T.EAN_13=7]="EAN_13",T[T.ITF=8]="ITF",T[T.MAXICODE=9]="MAXICODE",T[T.PDF_417=10]="PDF_417",T[T.QR_CODE=11]="QR_CODE",T[T.RSS_14=12]="RSS_14",T[T.RSS_EXPANDED=13]="RSS_EXPANDED",T[T.UPC_A=14]="UPC_A",T[T.UPC_E=15]="UPC_E",T[T.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(ii||(ii={}));var Rt=ii,Ne;(function(T){T[T.OTHER=0]="OTHER",T[T.ORIENTATION=1]="ORIENTATION",T[T.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",T[T.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",T[T.ISSUE_NUMBER=4]="ISSUE_NUMBER",T[T.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",T[T.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",T[T.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",T[T.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",T[T.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",T[T.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(Ne||(Ne={}));var ye=Ne;class mi{constructor(i,s,a,h,c=-1,d=-1){this.rawBytes=i,this.text=s,this.byteSegments=a,this.ecLevel=h,this.structuredAppendSequenceNumber=c,this.structuredAppendParity=d,this.numBits=i==null?0:8*i.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(i){this.numBits=i}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(i){this.errorsCorrected=i}getErasures(){return this.erasures}setErasures(i){this.erasures=i}getOther(){return this.other}setOther(i){this.other=i}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class ke{exp(i){return this.expTable[i]}log(i){if(i===0)throw new A;return this.logTable[i]}static addOrSubtract(i,s){return i^s}}class Ke{constructor(i,s){if(s.length===0)throw new A;this.field=i;const a=s.length;if(a>1&&s[0]===0){let h=1;for(;h<a&&s[h]===0;)h++;h===a?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(a-h),F.arraycopy(s,h,this.coefficients,0,this.coefficients.length))}else this.coefficients=s}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(i){return this.coefficients[this.coefficients.length-1-i]}evaluateAt(i){if(i===0)return this.getCoefficient(0);const s=this.coefficients;let a;if(i===1){a=0;for(let d=0,m=s.length;d!==m;d++){const _=s[d];a=ke.addOrSubtract(a,_)}return a}a=s[0];const h=s.length,c=this.field;for(let d=1;d<h;d++)a=ke.addOrSubtract(c.multiply(i,a),s[d]);return a}addOrSubtract(i){if(!this.field.equals(i.field))throw new A("GenericGFPolys do not have same GenericGF field");if(this.isZero())return i;if(i.isZero())return this;let s=this.coefficients,a=i.coefficients;if(s.length>a.length){const d=s;s=a,a=d}let h=new Int32Array(a.length);const c=a.length-s.length;F.arraycopy(a,0,h,0,c);for(let d=c;d<a.length;d++)h[d]=ke.addOrSubtract(s[d-c],a[d]);return new Ke(this.field,h)}multiply(i){if(!this.field.equals(i.field))throw new A("GenericGFPolys do not have same GenericGF field");if(this.isZero()||i.isZero())return this.field.getZero();const s=this.coefficients,a=s.length,h=i.coefficients,c=h.length,d=new Int32Array(a+c-1),m=this.field;for(let _=0;_<a;_++){const C=s[_];for(let M=0;M<c;M++)d[_+M]=ke.addOrSubtract(d[_+M],m.multiply(C,h[M]))}return new Ke(m,d)}multiplyScalar(i){if(i===0)return this.field.getZero();if(i===1)return this;const s=this.coefficients.length,a=this.field,h=new Int32Array(s),c=this.coefficients;for(let d=0;d<s;d++)h[d]=a.multiply(c[d],i);return new Ke(a,h)}multiplyByMonomial(i,s){if(i<0)throw new A;if(s===0)return this.field.getZero();const a=this.coefficients,h=a.length,c=new Int32Array(h+i),d=this.field;for(let m=0;m<h;m++)c[m]=d.multiply(a[m],s);return new Ke(d,c)}divide(i){if(!this.field.equals(i.field))throw new A("GenericGFPolys do not have same GenericGF field");if(i.isZero())throw new A("Divide by 0");const s=this.field;let a=s.getZero(),h=this;const c=i.getCoefficient(i.getDegree()),d=s.inverse(c);for(;h.getDegree()>=i.getDegree()&&!h.isZero();){const m=h.getDegree()-i.getDegree(),_=s.multiply(h.getCoefficient(h.getDegree()),d),C=i.multiplyByMonomial(m,_),M=s.buildMonomial(m,_);a=a.addOrSubtract(M),h=h.addOrSubtract(C)}return[a,h]}toString(){let i="";for(let s=this.getDegree();s>=0;s--){let a=this.getCoefficient(s);if(a!==0){if(a<0?(i+=" - ",a=-a):i.length>0&&(i+=" + "),s===0||a!==1){const h=this.field.log(a);h===0?i+="1":h===1?i+="a":(i+="a^",i+=h)}s!==0&&(s===1?i+="x":(i+="x^",i+=s))}}return i}}class ze extends E{}ze.kind="ArithmeticException";class ne extends ke{constructor(i,s,a){super(),this.primitive=i,this.size=s,this.generatorBase=a;const h=new Int32Array(s);let c=1;for(let m=0;m<s;m++)h[m]=c,c*=2,c>=s&&(c^=i,c&=s-1);this.expTable=h;const d=new Int32Array(s);for(let m=0;m<s-1;m++)d[h[m]]=m;this.logTable=d,this.zero=new Ke(this,Int32Array.from([0])),this.one=new Ke(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(i,s){if(i<0)throw new A;if(s===0)return this.zero;const a=new Int32Array(i+1);return a[0]=s,new Ke(this,a)}inverse(i){if(i===0)throw new ze;return this.expTable[this.size-this.logTable[i]-1]}multiply(i,s){return i===0||s===0?0:this.expTable[(this.logTable[i]+this.logTable[s])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+Y.toHexString(this.primitive)+","+this.size+")"}equals(i){return i===this}}ne.AZTEC_DATA_12=new ne(4201,4096,1),ne.AZTEC_DATA_10=new ne(1033,1024,1),ne.AZTEC_DATA_6=new ne(67,64,1),ne.AZTEC_PARAM=new ne(19,16,1),ne.QR_CODE_FIELD_256=new ne(285,256,0),ne.DATA_MATRIX_FIELD_256=new ne(301,256,1),ne.AZTEC_DATA_8=ne.DATA_MATRIX_FIELD_256,ne.MAXICODE_FIELD_64=ne.AZTEC_DATA_6;class xi extends E{}xi.kind="ReedSolomonException";class hi extends E{}hi.kind="IllegalStateException";class Ei{constructor(i){this.field=i}decode(i,s){const a=this.field,h=new Ke(a,i),c=new Int32Array(s);let d=!0;for(let k=0;k<s;k++){const j=h.evaluateAt(a.exp(k+a.getGeneratorBase()));c[c.length-1-k]=j,j!==0&&(d=!1)}if(d)return;const m=new Ke(a,c),_=this.runEuclideanAlgorithm(a.buildMonomial(s,1),m,s),C=_[0],M=_[1],R=this.findErrorLocations(C),D=this.findErrorMagnitudes(M,R);for(let k=0;k<R.length;k++){const j=i.length-1-a.log(R[k]);if(j<0)throw new xi("Bad error location");i[j]=ne.addOrSubtract(i[j],D[k])}}runEuclideanAlgorithm(i,s,a){if(i.getDegree()<s.getDegree()){const k=i;i=s,s=k}const h=this.field;let c=i,d=s,m=h.getZero(),_=h.getOne();for(;d.getDegree()>=(a/2|0);){let k=c,j=m;if(c=d,m=_,c.isZero())throw new xi("r_{i-1} was zero");d=k;let K=h.getZero();const tt=c.getCoefficient(c.getDegree()),st=h.inverse(tt);for(;d.getDegree()>=c.getDegree()&&!d.isZero();){const Et=d.getDegree()-c.getDegree(),At=h.multiply(d.getCoefficient(d.getDegree()),st);K=K.addOrSubtract(h.buildMonomial(Et,At)),d=d.addOrSubtract(c.multiplyByMonomial(Et,At))}if(_=K.multiply(m).addOrSubtract(j),d.getDegree()>=c.getDegree())throw new hi("Division algorithm failed to reduce polynomial?")}const C=_.getCoefficient(0);if(C===0)throw new xi("sigmaTilde(0) was zero");const M=h.inverse(C),R=_.multiplyScalar(M),D=d.multiplyScalar(M);return[R,D]}findErrorLocations(i){const s=i.getDegree();if(s===1)return Int32Array.from([i.getCoefficient(1)]);const a=new Int32Array(s);let h=0;const c=this.field;for(let d=1;d<c.getSize()&&h<s;d++)i.evaluateAt(d)===0&&(a[h]=c.inverse(d),h++);if(h!==s)throw new xi("Error locator degree does not match number of roots");return a}findErrorMagnitudes(i,s){const a=s.length,h=new Int32Array(a),c=this.field;for(let d=0;d<a;d++){const m=c.inverse(s[d]);let _=1;for(let C=0;C<a;C++)if(d!==C){const M=c.multiply(s[C],m),R=M&1?M&-2:M|1;_=c.multiply(_,R)}h[d]=c.multiply(i.evaluateAt(m),c.inverse(_)),c.getGeneratorBase()!==0&&(h[d]=c.multiply(h[d],m))}return h}}var Ge;(function(T){T[T.UPPER=0]="UPPER",T[T.LOWER=1]="LOWER",T[T.MIXED=2]="MIXED",T[T.DIGIT=3]="DIGIT",T[T.PUNCT=4]="PUNCT",T[T.BINARY=5]="BINARY"})(Ge||(Ge={}));class he{decode(i){this.ddata=i;let s=i.getBits(),a=this.extractBits(s),h=this.correctBits(a),c=he.convertBoolArrayToByteArray(h),d=he.getEncodedData(h),m=new mi(c,d,null,null);return m.setNumBits(h.length),m}static highLevelDecode(i){return this.getEncodedData(i)}static getEncodedData(i){let s=i.length,a=Ge.UPPER,h=Ge.UPPER,c="",d=0;for(;d<s;)if(h===Ge.BINARY){if(s-d<5)break;let m=he.readCode(i,d,5);if(d+=5,m===0){if(s-d<11)break;m=he.readCode(i,d,11)+31,d+=11}for(let _=0;_<m;_++){if(s-d<8){d=s;break}const C=he.readCode(i,d,8);c+=at.castAsNonUtf8Char(C),d+=8}h=a}else{let m=h===Ge.DIGIT?4:5;if(s-d<m)break;let _=he.readCode(i,d,m);d+=m;let C=he.getCharacter(h,_);C.startsWith("CTRL_")?(a=h,h=he.getTable(C.charAt(5)),C.charAt(6)==="L"&&(a=h)):(c+=C,h=a)}return c}static getTable(i){switch(i){case"L":return Ge.LOWER;case"P":return Ge.PUNCT;case"M":return Ge.MIXED;case"D":return Ge.DIGIT;case"B":return Ge.BINARY;case"U":default:return Ge.UPPER}}static getCharacter(i,s){switch(i){case Ge.UPPER:return he.UPPER_TABLE[s];case Ge.LOWER:return he.LOWER_TABLE[s];case Ge.MIXED:return he.MIXED_TABLE[s];case Ge.PUNCT:return he.PUNCT_TABLE[s];case Ge.DIGIT:return he.DIGIT_TABLE[s];default:throw new hi("Bad table")}}correctBits(i){let s,a;this.ddata.getNbLayers()<=2?(a=6,s=ne.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(a=8,s=ne.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(a=10,s=ne.AZTEC_DATA_10):(a=12,s=ne.AZTEC_DATA_12);let h=this.ddata.getNbDatablocks(),c=i.length/a;if(c<h)throw new X;let d=i.length%a,m=new Int32Array(c);for(let D=0;D<c;D++,d+=a)m[D]=he.readCode(i,d,a);try{new Ei(s).decode(m,c-h)}catch(D){throw new X(D)}let _=(1<<a)-1,C=0;for(let D=0;D<h;D++){let k=m[D];if(k===0||k===_)throw new X;(k===1||k===_-1)&&C++}let M=new Array(h*a-C),R=0;for(let D=0;D<h;D++){let k=m[D];if(k===1||k===_-1)M.fill(k>1,R,R+a-1),R+=a-1;else for(let j=a-1;j>=0;--j)M[R++]=(k&1<<j)!==0}return M}extractBits(i){let s=this.ddata.isCompact(),a=this.ddata.getNbLayers(),h=(s?11:14)+a*4,c=new Int32Array(h),d=new Array(this.totalBitsInLayer(a,s));if(s)for(let m=0;m<c.length;m++)c[m]=m;else{let m=h+1+2*Y.truncDivision(Y.truncDivision(h,2)-1,15),_=h/2,C=Y.truncDivision(m,2);for(let M=0;M<_;M++){let R=M+Y.truncDivision(M,15);c[_-M-1]=C-R-1,c[_+M]=C+R+1}}for(let m=0,_=0;m<a;m++){let C=(a-m)*4+(s?9:12),M=m*2,R=h-1-M;for(let D=0;D<C;D++){let k=D*2;for(let j=0;j<2;j++)d[_+k+j]=i.get(c[M+j],c[M+D]),d[_+2*C+k+j]=i.get(c[M+D],c[R-j]),d[_+4*C+k+j]=i.get(c[R-j],c[R-D]),d[_+6*C+k+j]=i.get(c[R-D],c[M+j])}_+=C*8}return d}static readCode(i,s,a){let h=0;for(let c=s;c<s+a;c++)h<<=1,i[c]&&(h|=1);return h}static readByte(i,s){let a=i.length-s;return a>=8?he.readCode(i,s,8):he.readCode(i,s,a)<<8-a}static convertBoolArrayToByteArray(i){let s=new Uint8Array((i.length+7)/8);for(let a=0;a<s.length;a++)s[a]=he.readByte(i,8*a);return s}totalBitsInLayer(i,s){return((s?88:112)+16*i)*i}}he.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],he.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],he.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],he.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],he.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class ee{constructor(){}static round(i){return i===NaN?0:i<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:i>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:i+(i<0?-.5:.5)|0}static distance(i,s,a,h){const c=i-a,d=s-h;return Math.sqrt(c*c+d*d)}static sum(i){let s=0;for(let a=0,h=i.length;a!==h;a++){const c=i[a];s+=c}return s}}class _i{static floatToIntBits(i){return i}}_i.MAX_VALUE=Number.MAX_SAFE_INTEGER;class St{constructor(i,s){this.x=i,this.y=s}getX(){return this.x}getY(){return this.y}equals(i){if(i instanceof St){const s=i;return this.x===s.x&&this.y===s.y}return!1}hashCode(){return 31*_i.floatToIntBits(this.x)+_i.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(i){const s=this.distance(i[0],i[1]),a=this.distance(i[1],i[2]),h=this.distance(i[0],i[2]);let c,d,m;if(a>=s&&a>=h?(d=i[0],c=i[1],m=i[2]):h>=a&&h>=s?(d=i[1],c=i[0],m=i[2]):(d=i[2],c=i[0],m=i[1]),this.crossProductZ(c,d,m)<0){const _=c;c=m,m=_}i[0]=c,i[1]=d,i[2]=m}static distance(i,s){return ee.distance(i.x,i.y,s.x,s.y)}static crossProductZ(i,s,a){const h=s.x,c=s.y;return(a.x-h)*(i.y-c)-(a.y-c)*(i.x-h)}}class Ci{constructor(i,s){this.bits=i,this.points=s}getBits(){return this.bits}getPoints(){return this.points}}class on extends Ci{constructor(i,s,a,h,c){super(i,s),this.compact=a,this.nbDatablocks=h,this.nbLayers=c}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class ci{constructor(i,s,a,h){this.image=i,this.height=i.getHeight(),this.width=i.getWidth(),s==null&&(s=ci.INIT_SIZE),a==null&&(a=i.getWidth()/2|0),h==null&&(h=i.getHeight()/2|0);const c=s/2|0;if(this.leftInit=a-c,this.rightInit=a+c,this.upInit=h-c,this.downInit=h+c,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new q}detect(){let i=this.leftInit,s=this.rightInit,a=this.upInit,h=this.downInit,c=!1,d=!0,m=!1,_=!1,C=!1,M=!1,R=!1;const D=this.width,k=this.height;for(;d;){d=!1;let j=!0;for(;(j||!_)&&s<D;)j=this.containsBlackPoint(a,h,s,!1),j?(s++,d=!0,_=!0):_||s++;if(s>=D){c=!0;break}let K=!0;for(;(K||!C)&&h<k;)K=this.containsBlackPoint(i,s,h,!0),K?(h++,d=!0,C=!0):C||h++;if(h>=k){c=!0;break}let tt=!0;for(;(tt||!M)&&i>=0;)tt=this.containsBlackPoint(a,h,i,!1),tt?(i--,d=!0,M=!0):M||i--;if(i<0){c=!0;break}let st=!0;for(;(st||!R)&&a>=0;)st=this.containsBlackPoint(i,s,a,!0),st?(a--,d=!0,R=!0):R||a--;if(a<0){c=!0;break}d&&(m=!0)}if(!c&&m){const j=s-i;let K=null;for(let At=1;K===null&&At<j;At++)K=this.getBlackPointOnSegment(i,h-At,i+At,h);if(K==null)throw new q;let tt=null;for(let At=1;tt===null&&At<j;At++)tt=this.getBlackPointOnSegment(i,a+At,i+At,a);if(tt==null)throw new q;let st=null;for(let At=1;st===null&&At<j;At++)st=this.getBlackPointOnSegment(s,a+At,s-At,a);if(st==null)throw new q;let Et=null;for(let At=1;Et===null&&At<j;At++)Et=this.getBlackPointOnSegment(s,h-At,s-At,h);if(Et==null)throw new q;return this.centerEdges(Et,K,st,tt)}else throw new q}getBlackPointOnSegment(i,s,a,h){const c=ee.round(ee.distance(i,s,a,h)),d=(a-i)/c,m=(h-s)/c,_=this.image;for(let C=0;C<c;C++){const M=ee.round(i+C*d),R=ee.round(s+C*m);if(_.get(M,R))return new St(M,R)}return null}centerEdges(i,s,a,h){const c=i.getX(),d=i.getY(),m=s.getX(),_=s.getY(),C=a.getX(),M=a.getY(),R=h.getX(),D=h.getY(),k=ci.CORR;return c<this.width/2?[new St(R-k,D+k),new St(m+k,_+k),new St(C-k,M-k),new St(c+k,d-k)]:[new St(R+k,D+k),new St(m+k,_-k),new St(C-k,M+k),new St(c-k,d-k)]}containsBlackPoint(i,s,a,h){const c=this.image;if(h){for(let d=i;d<=s;d++)if(c.get(d,a))return!0}else for(let d=i;d<=s;d++)if(c.get(a,d))return!0;return!1}}ci.INIT_SIZE=10,ci.CORR=1;class Ui{static checkAndNudgePoints(i,s){const a=i.getWidth(),h=i.getHeight();let c=!0;for(let d=0;d<s.length&&c;d+=2){const m=Math.floor(s[d]),_=Math.floor(s[d+1]);if(m<-1||m>a||_<-1||_>h)throw new q;c=!1,m===-1?(s[d]=0,c=!0):m===a&&(s[d]=a-1,c=!0),_===-1?(s[d+1]=0,c=!0):_===h&&(s[d+1]=h-1,c=!0)}c=!0;for(let d=s.length-2;d>=0&&c;d-=2){const m=Math.floor(s[d]),_=Math.floor(s[d+1]);if(m<-1||m>a||_<-1||_>h)throw new q;c=!1,m===-1?(s[d]=0,c=!0):m===a&&(s[d]=a-1,c=!0),_===-1?(s[d+1]=0,c=!0):_===h&&(s[d+1]=h-1,c=!0)}}}class ni{constructor(i,s,a,h,c,d,m,_,C){this.a11=i,this.a21=s,this.a31=a,this.a12=h,this.a22=c,this.a32=d,this.a13=m,this.a23=_,this.a33=C}static quadrilateralToQuadrilateral(i,s,a,h,c,d,m,_,C,M,R,D,k,j,K,tt){const st=ni.quadrilateralToSquare(i,s,a,h,c,d,m,_);return ni.squareToQuadrilateral(C,M,R,D,k,j,K,tt).times(st)}transformPoints(i){const s=i.length,a=this.a11,h=this.a12,c=this.a13,d=this.a21,m=this.a22,_=this.a23,C=this.a31,M=this.a32,R=this.a33;for(let D=0;D<s;D+=2){const k=i[D],j=i[D+1],K=c*k+_*j+R;i[D]=(a*k+d*j+C)/K,i[D+1]=(h*k+m*j+M)/K}}transformPointsWithValues(i,s){const a=this.a11,h=this.a12,c=this.a13,d=this.a21,m=this.a22,_=this.a23,C=this.a31,M=this.a32,R=this.a33,D=i.length;for(let k=0;k<D;k++){const j=i[k],K=s[k],tt=c*j+_*K+R;i[k]=(a*j+d*K+C)/tt,s[k]=(h*j+m*K+M)/tt}}static squareToQuadrilateral(i,s,a,h,c,d,m,_){const C=i-a+c-m,M=s-h+d-_;if(C===0&&M===0)return new ni(a-i,c-a,i,h-s,d-h,s,0,0,1);{const R=a-c,D=m-c,k=h-d,j=_-d,K=R*j-D*k,tt=(C*j-D*M)/K,st=(R*M-C*k)/K;return new ni(a-i+tt*a,m-i+st*m,i,h-s+tt*h,_-s+st*_,s,tt,st,1)}}static quadrilateralToSquare(i,s,a,h,c,d,m,_){return ni.squareToQuadrilateral(i,s,a,h,c,d,m,_).buildAdjoint()}buildAdjoint(){return new ni(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(i){return new ni(this.a11*i.a11+this.a21*i.a12+this.a31*i.a13,this.a11*i.a21+this.a21*i.a22+this.a31*i.a23,this.a11*i.a31+this.a21*i.a32+this.a31*i.a33,this.a12*i.a11+this.a22*i.a12+this.a32*i.a13,this.a12*i.a21+this.a22*i.a22+this.a32*i.a23,this.a12*i.a31+this.a22*i.a32+this.a32*i.a33,this.a13*i.a11+this.a23*i.a12+this.a33*i.a13,this.a13*i.a21+this.a23*i.a22+this.a33*i.a23,this.a13*i.a31+this.a23*i.a32+this.a33*i.a33)}}class qi extends Ui{sampleGrid(i,s,a,h,c,d,m,_,C,M,R,D,k,j,K,tt,st,Et,At){const mt=ni.quadrilateralToQuadrilateral(h,c,d,m,_,C,M,R,D,k,j,K,tt,st,Et,At);return this.sampleGridWithTransform(i,s,a,mt)}sampleGridWithTransform(i,s,a,h){if(s<=0||a<=0)throw new q;const c=new pt(s,a),d=new Float32Array(2*s);for(let m=0;m<a;m++){const _=d.length,C=m+.5;for(let M=0;M<_;M+=2)d[M]=M/2+.5,d[M+1]=C;h.transformPoints(d),Ui.checkAndNudgePoints(i,d);try{for(let M=0;M<_;M+=2)i.get(Math.floor(d[M]),Math.floor(d[M+1]))&&c.set(M/2,m)}catch{throw new q}}return c}}class qe{static setGridSampler(i){qe.gridSampler=i}static getInstance(){return qe.gridSampler}}qe.gridSampler=new qi;class ce{constructor(i,s){this.x=i,this.y=s}toResultPoint(){return new St(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class cr{constructor(i){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=i}detect(){return this.detectMirror(!1)}detectMirror(i){let s=this.getMatrixCenter(),a=this.getBullsEyeCorners(s);if(i){let d=a[0];a[0]=a[2],a[2]=d}this.extractParameters(a);let h=this.sampleGrid(this.image,a[this.shift%4],a[(this.shift+1)%4],a[(this.shift+2)%4],a[(this.shift+3)%4]),c=this.getMatrixCornerPoints(a);return new on(h,c,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(i){if(!this.isValidPoint(i[0])||!this.isValidPoint(i[1])||!this.isValidPoint(i[2])||!this.isValidPoint(i[3]))throw new q;let s=2*this.nbCenterLayers,a=new Int32Array([this.sampleLine(i[0],i[1],s),this.sampleLine(i[1],i[2],s),this.sampleLine(i[2],i[3],s),this.sampleLine(i[3],i[0],s)]);this.shift=this.getRotation(a,s);let h=0;for(let d=0;d<4;d++){let m=a[(this.shift+d)%4];this.compact?(h<<=7,h+=m>>1&127):(h<<=10,h+=(m>>2&992)+(m>>1&31))}let c=this.getCorrectedParameterData(h,this.compact);this.compact?(this.nbLayers=(c>>6)+1,this.nbDataBlocks=(c&63)+1):(this.nbLayers=(c>>11)+1,this.nbDataBlocks=(c&2047)+1)}getRotation(i,s){let a=0;i.forEach((h,c,d)=>{let m=(h>>s-2<<1)+(h&1);a=(a<<3)+m}),a=((a&1)<<11)+(a>>1);for(let h=0;h<4;h++)if(Y.bitCount(a^this.EXPECTED_CORNER_BITS[h])<=2)return h;throw new q}getCorrectedParameterData(i,s){let a,h;s?(a=7,h=2):(a=10,h=4);let c=a-h,d=new Int32Array(a);for(let _=a-1;_>=0;--_)d[_]=i&15,i>>=4;try{new Ei(ne.AZTEC_PARAM).decode(d,c)}catch{throw new q}let m=0;for(let _=0;_<h;_++)m=(m<<4)+d[_];return m}getBullsEyeCorners(i){let s=i,a=i,h=i,c=i,d=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let R=this.getFirstDifferent(s,d,1,-1),D=this.getFirstDifferent(a,d,1,1),k=this.getFirstDifferent(h,d,-1,1),j=this.getFirstDifferent(c,d,-1,-1);if(this.nbCenterLayers>2){let K=this.distancePoint(j,R)*this.nbCenterLayers/(this.distancePoint(c,s)*(this.nbCenterLayers+2));if(K<.75||K>1.25||!this.isWhiteOrBlackRectangle(R,D,k,j))break}s=R,a=D,h=k,c=j,d=!d}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new q;this.compact=this.nbCenterLayers===5;let m=new St(s.getX()+.5,s.getY()-.5),_=new St(a.getX()+.5,a.getY()+.5),C=new St(h.getX()-.5,h.getY()+.5),M=new St(c.getX()-.5,c.getY()-.5);return this.expandSquare([m,_,C,M],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let i,s,a,h;try{let m=new ci(this.image).detect();i=m[0],s=m[1],a=m[2],h=m[3]}catch{let _=this.image.getWidth()/2,C=this.image.getHeight()/2;i=this.getFirstDifferent(new ce(_+7,C-7),!1,1,-1).toResultPoint(),s=this.getFirstDifferent(new ce(_+7,C+7),!1,1,1).toResultPoint(),a=this.getFirstDifferent(new ce(_-7,C+7),!1,-1,1).toResultPoint(),h=this.getFirstDifferent(new ce(_-7,C-7),!1,-1,-1).toResultPoint()}let c=ee.round((i.getX()+h.getX()+s.getX()+a.getX())/4),d=ee.round((i.getY()+h.getY()+s.getY()+a.getY())/4);try{let m=new ci(this.image,15,c,d).detect();i=m[0],s=m[1],a=m[2],h=m[3]}catch{i=this.getFirstDifferent(new ce(c+7,d-7),!1,1,-1).toResultPoint(),s=this.getFirstDifferent(new ce(c+7,d+7),!1,1,1).toResultPoint(),a=this.getFirstDifferent(new ce(c-7,d+7),!1,-1,1).toResultPoint(),h=this.getFirstDifferent(new ce(c-7,d-7),!1,-1,-1).toResultPoint()}return c=ee.round((i.getX()+h.getX()+s.getX()+a.getX())/4),d=ee.round((i.getY()+h.getY()+s.getY()+a.getY())/4),new ce(c,d)}getMatrixCornerPoints(i){return this.expandSquare(i,2*this.nbCenterLayers,this.getDimension())}sampleGrid(i,s,a,h,c){let d=qe.getInstance(),m=this.getDimension(),_=m/2-this.nbCenterLayers,C=m/2+this.nbCenterLayers;return d.sampleGrid(i,m,m,_,_,C,_,C,C,_,C,s.getX(),s.getY(),a.getX(),a.getY(),h.getX(),h.getY(),c.getX(),c.getY())}sampleLine(i,s,a){let h=0,c=this.distanceResultPoint(i,s),d=c/a,m=i.getX(),_=i.getY(),C=d*(s.getX()-i.getX())/c,M=d*(s.getY()-i.getY())/c;for(let R=0;R<a;R++)this.image.get(ee.round(m+R*C),ee.round(_+R*M))&&(h|=1<<a-R-1);return h}isWhiteOrBlackRectangle(i,s,a,h){let c=3;i=new ce(i.getX()-c,i.getY()+c),s=new ce(s.getX()-c,s.getY()-c),a=new ce(a.getX()+c,a.getY()-c),h=new ce(h.getX()+c,h.getY()+c);let d=this.getColor(h,i);if(d===0)return!1;let m=this.getColor(i,s);return m!==d||(m=this.getColor(s,a),m!==d)?!1:(m=this.getColor(a,h),m===d)}getColor(i,s){let a=this.distancePoint(i,s),h=(s.getX()-i.getX())/a,c=(s.getY()-i.getY())/a,d=0,m=i.getX(),_=i.getY(),C=this.image.get(i.getX(),i.getY()),M=Math.ceil(a);for(let D=0;D<M;D++)m+=h,_+=c,this.image.get(ee.round(m),ee.round(_))!==C&&d++;let R=d/a;return R>.1&&R<.9?0:R<=.1===C?1:-1}getFirstDifferent(i,s,a,h){let c=i.getX()+a,d=i.getY()+h;for(;this.isValid(c,d)&&this.image.get(c,d)===s;)c+=a,d+=h;for(c-=a,d-=h;this.isValid(c,d)&&this.image.get(c,d)===s;)c+=a;for(c-=a;this.isValid(c,d)&&this.image.get(c,d)===s;)d+=h;return d-=h,new ce(c,d)}expandSquare(i,s,a){let h=a/(2*s),c=i[0].getX()-i[2].getX(),d=i[0].getY()-i[2].getY(),m=(i[0].getX()+i[2].getX())/2,_=(i[0].getY()+i[2].getY())/2,C=new St(m+h*c,_+h*d),M=new St(m-h*c,_-h*d);c=i[1].getX()-i[3].getX(),d=i[1].getY()-i[3].getY(),m=(i[1].getX()+i[3].getX())/2,_=(i[1].getY()+i[3].getY())/2;let R=new St(m+h*c,_+h*d),D=new St(m-h*c,_-h*d);return[C,R,M,D]}isValid(i,s){return i>=0&&i<this.image.getWidth()&&s>0&&s<this.image.getHeight()}isValidPoint(i){let s=ee.round(i.getX()),a=ee.round(i.getY());return this.isValid(s,a)}distancePoint(i,s){return ee.distance(i.getX(),i.getY(),s.getX(),s.getY())}distanceResultPoint(i,s){return ee.distance(i.getX(),i.getY(),s.getX(),s.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(Y.truncDivision(this.nbLayers-4,8)+1)+15}}class Xn{decode(i,s=null){let a=null,h=new cr(i.getBlackMatrix()),c=null,d=null;try{let M=h.detectMirror(!1);c=M.getPoints(),this.reportFoundResultPoints(s,c),d=new he().decode(M)}catch(M){a=M}if(d==null)try{let M=h.detectMirror(!0);c=M.getPoints(),this.reportFoundResultPoints(s,c),d=new he().decode(M)}catch(M){throw a??M}let m=new gt(d.getText(),d.getRawBytes(),d.getNumBits(),c,Rt.AZTEC,F.currentTimeMillis()),_=d.getByteSegments();_!=null&&m.putMetadata(ye.BYTE_SEGMENTS,_);let C=d.getECLevel();return C!=null&&m.putMetadata(ye.ERROR_CORRECTION_LEVEL,C),m}reportFoundResultPoints(i,s){if(i!=null){let a=i.get(ot.NEED_RESULT_POINT_CALLBACK);a!=null&&s.forEach((h,c,d)=>{a.foundPossibleResultPoint(h)})}}reset(){}}class Vn extends te{constructor(i=500){super(new Xn,i)}}class Ae{decode(i,s){try{return this.doDecode(i,s)}catch{if(s&&s.get(ot.TRY_HARDER)===!0&&i.isRotateSupported()){const c=i.rotateCounterClockwise(),d=this.doDecode(c,s),m=d.getResultMetadata();let _=270;m!==null&&m.get(ye.ORIENTATION)===!0&&(_=_+m.get(ye.ORIENTATION)%360),d.putMetadata(ye.ORIENTATION,_);const C=d.getResultPoints();if(C!==null){const M=c.getHeight();for(let R=0;R<C.length;R++)C[R]=new St(M-C[R].getY()-1,C[R].getX())}return d}else throw new q}}reset(){}doDecode(i,s){const a=i.getWidth(),h=i.getHeight();let c=new Z(a);const d=s&&s.get(ot.TRY_HARDER)===!0,m=Math.max(1,h>>(d?8:5));let _;d?_=h:_=15;const C=Math.trunc(h/2);for(let M=0;M<_;M++){const R=Math.trunc((M+1)/2),D=(M&1)===0,k=C+m*(D?R:-R);if(k<0||k>=h)break;try{c=i.getBlackRow(k,c)}catch{continue}for(let j=0;j<2;j++){if(j===1&&(c.reverse(),s&&s.get(ot.NEED_RESULT_POINT_CALLBACK)===!0)){const K=new Map;s.forEach((tt,st)=>K.set(st,tt)),K.delete(ot.NEED_RESULT_POINT_CALLBACK),s=K}try{const K=this.decodeRow(k,c,s);if(j===1){K.putMetadata(ye.ORIENTATION,180);const tt=K.getResultPoints();tt!==null&&(tt[0]=new St(a-tt[0].getX()-1,tt[0].getY()),tt[1]=new St(a-tt[1].getX()-1,tt[1].getY()))}return K}catch{}}}throw new q}static recordPattern(i,s,a){const h=a.length;for(let C=0;C<h;C++)a[C]=0;const c=i.getSize();if(s>=c)throw new q;let d=!i.get(s),m=0,_=s;for(;_<c;){if(i.get(_)!==d)a[m]++;else{if(++m===h)break;a[m]=1,d=!d}_++}if(!(m===h||m===h-1&&_===c))throw new q}static recordPatternInReverse(i,s,a){let h=a.length,c=i.get(s);for(;s>0&&h>=0;)i.get(--s)!==c&&(h--,c=!c);if(h>=0)throw new q;Ae.recordPattern(i,s+1,a)}static patternMatchVariance(i,s,a){const h=i.length;let c=0,d=0;for(let C=0;C<h;C++)c+=i[C],d+=s[C];if(c<d)return Number.POSITIVE_INFINITY;const m=c/d;a*=m;let _=0;for(let C=0;C<h;C++){const M=i[C],R=s[C]*m,D=M>R?M-R:R-M;if(D>a)return Number.POSITIVE_INFINITY;_+=D}return _/c}}class It extends Ae{static findStartPattern(i){const s=i.getSize(),a=i.getNextSet(0);let h=0,c=Int32Array.from([0,0,0,0,0,0]),d=a,m=!1;const _=6;for(let C=a;C<s;C++)if(i.get(C)!==m)c[h]++;else{if(h===_-1){let M=It.MAX_AVG_VARIANCE,R=-1;for(let D=It.CODE_START_A;D<=It.CODE_START_C;D++){const k=Ae.patternMatchVariance(c,It.CODE_PATTERNS[D],It.MAX_INDIVIDUAL_VARIANCE);k<M&&(M=k,R=D)}if(R>=0&&i.isRange(Math.max(0,d-(C-d)/2),d,!1))return Int32Array.from([d,C,R]);d+=c[0]+c[1],c=c.slice(2,c.length-1),c[h-1]=0,c[h]=0,h--}else h++;c[h]=1,m=!m}throw new q}static decodeCode(i,s,a){Ae.recordPattern(i,a,s);let h=It.MAX_AVG_VARIANCE,c=-1;for(let d=0;d<It.CODE_PATTERNS.length;d++){const m=It.CODE_PATTERNS[d],_=this.patternMatchVariance(s,m,It.MAX_INDIVIDUAL_VARIANCE);_<h&&(h=_,c=d)}if(c>=0)return c;throw new q}decodeRow(i,s,a){const h=a&&a.get(ot.ASSUME_GS1)===!0,c=It.findStartPattern(s),d=c[2];let m=0;const _=new Uint8Array(20);_[m++]=d;let C;switch(d){case It.CODE_START_A:C=It.CODE_CODE_A;break;case It.CODE_START_B:C=It.CODE_CODE_B;break;case It.CODE_START_C:C=It.CODE_CODE_C;break;default:throw new X}let M=!1,R=!1,D="",k=c[0],j=c[1];const K=Int32Array.from([0,0,0,0,0,0]);let tt=0,st=0,Et=d,At=0,mt=!0,le=!1,Kt=!1;for(;!M;){const _r=R;switch(R=!1,tt=st,st=It.decodeCode(s,K,j),_[m++]=st,st!==It.CODE_STOP&&(mt=!0),st!==It.CODE_STOP&&(At++,Et+=At*st),k=j,j+=K.reduce((Y1,H1)=>Y1+H1,0),st){case It.CODE_START_A:case It.CODE_START_B:case It.CODE_START_C:throw new X}switch(C){case It.CODE_CODE_A:if(st<64)Kt===le?D+=String.fromCharCode(32+st):D+=String.fromCharCode(32+st+128),Kt=!1;else if(st<96)Kt===le?D+=String.fromCharCode(st-64):D+=String.fromCharCode(st+64),Kt=!1;else switch(st!==It.CODE_STOP&&(mt=!1),st){case It.CODE_FNC_1:h&&(D.length===0?D+="]C1":D+="");break;case It.CODE_FNC_2:case It.CODE_FNC_3:break;case It.CODE_FNC_4_A:!le&&Kt?(le=!0,Kt=!1):le&&Kt?(le=!1,Kt=!1):Kt=!0;break;case It.CODE_SHIFT:R=!0,C=It.CODE_CODE_B;break;case It.CODE_CODE_B:C=It.CODE_CODE_B;break;case It.CODE_CODE_C:C=It.CODE_CODE_C;break;case It.CODE_STOP:M=!0;break}break;case It.CODE_CODE_B:if(st<96)Kt===le?D+=String.fromCharCode(32+st):D+=String.fromCharCode(32+st+128),Kt=!1;else switch(st!==It.CODE_STOP&&(mt=!1),st){case It.CODE_FNC_1:h&&(D.length===0?D+="]C1":D+="");break;case It.CODE_FNC_2:case It.CODE_FNC_3:break;case It.CODE_FNC_4_B:!le&&Kt?(le=!0,Kt=!1):le&&Kt?(le=!1,Kt=!1):Kt=!0;break;case It.CODE_SHIFT:R=!0,C=It.CODE_CODE_A;break;case It.CODE_CODE_A:C=It.CODE_CODE_A;break;case It.CODE_CODE_C:C=It.CODE_CODE_C;break;case It.CODE_STOP:M=!0;break}break;case It.CODE_CODE_C:if(st<100)st<10&&(D+="0"),D+=st;else switch(st!==It.CODE_STOP&&(mt=!1),st){case It.CODE_FNC_1:h&&(D.length===0?D+="]C1":D+="");break;case It.CODE_CODE_A:C=It.CODE_CODE_A;break;case It.CODE_CODE_B:C=It.CODE_CODE_B;break;case It.CODE_STOP:M=!0;break}break}_r&&(C=C===It.CODE_CODE_A?It.CODE_CODE_B:It.CODE_CODE_A)}const Xi=j-k;if(j=s.getNextUnset(j),!s.isRange(j,Math.min(s.getSize(),j+(j-k)/2),!1))throw new q;if(Et-=At*tt,Et%103!==tt)throw new P;const Cn=D.length;if(Cn===0)throw new q;Cn>0&&mt&&(C===It.CODE_CODE_C?D=D.substring(0,Cn-2):D=D.substring(0,Cn-1));const Vi=(c[1]+c[0])/2,De=k+Xi/2,Mi=_.length,tn=new Uint8Array(Mi);for(let _r=0;_r<Mi;_r++)tn[_r]=_[_r];const xr=[new St(Vi,i),new St(De,i)];return new gt(D,tn,0,xr,Rt.CODE_128,new Date().getTime())}}It.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],It.MAX_AVG_VARIANCE=.25,It.MAX_INDIVIDUAL_VARIANCE=.7,It.CODE_SHIFT=98,It.CODE_CODE_C=99,It.CODE_CODE_B=100,It.CODE_CODE_A=101,It.CODE_FNC_1=102,It.CODE_FNC_2=97,It.CODE_FNC_3=96,It.CODE_FNC_4_A=101,It.CODE_FNC_4_B=100,It.CODE_START_A=103,It.CODE_START_B=104,It.CODE_START_C=105,It.CODE_STOP=106;class Te extends Ae{constructor(i=!1,s=!1){super(),this.usingCheckDigit=i,this.extendedMode=s,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(i,s,a){let h=this.counters;h.fill(0),this.decodeRowResult="";let c=Te.findAsteriskPattern(s,h),d=s.getNextSet(c[1]),m=s.getSize(),_,C;do{Te.recordPattern(s,d,h);let K=Te.toNarrowWidePattern(h);if(K<0)throw new q;_=Te.patternToChar(K),this.decodeRowResult+=_,C=d;for(let tt of h)d+=tt;d=s.getNextSet(d)}while(_!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let M=0;for(let K of h)M+=K;let R=d-C-M;if(d!==m&&R*2<M)throw new q;if(this.usingCheckDigit){let K=this.decodeRowResult.length-1,tt=0;for(let st=0;st<K;st++)tt+=Te.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(st));if(this.decodeRowResult.charAt(K)!==Te.ALPHABET_STRING.charAt(tt%43))throw new P;this.decodeRowResult=this.decodeRowResult.substring(0,K)}if(this.decodeRowResult.length===0)throw new q;let D;this.extendedMode?D=Te.decodeExtended(this.decodeRowResult):D=this.decodeRowResult;let k=(c[1]+c[0])/2,j=C+M/2;return new gt(D,null,0,[new St(k,i),new St(j,i)],Rt.CODE_39,new Date().getTime())}static findAsteriskPattern(i,s){let a=i.getSize(),h=i.getNextSet(0),c=0,d=h,m=!1,_=s.length;for(let C=h;C<a;C++)if(i.get(C)!==m)s[c]++;else{if(c===_-1){if(this.toNarrowWidePattern(s)===Te.ASTERISK_ENCODING&&i.isRange(Math.max(0,d-Math.floor((C-d)/2)),d,!1))return[d,C];d+=s[0]+s[1],s.copyWithin(0,2,2+c-1),s[c-1]=0,s[c]=0,c--}else c++;s[c]=1,m=!m}throw new q}static toNarrowWidePattern(i){let s=i.length,a=0,h;do{let c=2147483647;for(let _ of i)_<c&&_>a&&(c=_);a=c,h=0;let d=0,m=0;for(let _=0;_<s;_++){let C=i[_];C>a&&(m|=1<<s-1-_,h++,d+=C)}if(h===3){for(let _=0;_<s&&h>0;_++){let C=i[_];if(C>a&&(h--,C*2>=d))return-1}return m}}while(h>3);return-1}static patternToChar(i){for(let s=0;s<Te.CHARACTER_ENCODINGS.length;s++)if(Te.CHARACTER_ENCODINGS[s]===i)return Te.ALPHABET_STRING.charAt(s);if(i===Te.ASTERISK_ENCODING)return"*";throw new q}static decodeExtended(i){let s=i.length,a="";for(let h=0;h<s;h++){let c=i.charAt(h);if(c==="+"||c==="$"||c==="%"||c==="/"){let d=i.charAt(h+1),m="\0";switch(c){case"+":if(d>="A"&&d<="Z")m=String.fromCharCode(d.charCodeAt(0)+32);else throw new X;break;case"$":if(d>="A"&&d<="Z")m=String.fromCharCode(d.charCodeAt(0)-64);else throw new X;break;case"%":if(d>="A"&&d<="E")m=String.fromCharCode(d.charCodeAt(0)-38);else if(d>="F"&&d<="J")m=String.fromCharCode(d.charCodeAt(0)-11);else if(d>="K"&&d<="O")m=String.fromCharCode(d.charCodeAt(0)+16);else if(d>="P"&&d<="T")m=String.fromCharCode(d.charCodeAt(0)+43);else if(d==="U")m="\0";else if(d==="V")m="@";else if(d==="W")m="`";else if(d==="X"||d==="Y"||d==="Z")m="";else throw new X;break;case"/":if(d>="A"&&d<="O")m=String.fromCharCode(d.charCodeAt(0)-32);else if(d==="Z")m=":";else throw new X;break}a+=m,h++}else a+=c}return a}}Te.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Te.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Te.ASTERISK_ENCODING=148;class se extends Ae{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(i,s,a){let h=this.decodeStart(s),c=this.decodeEnd(s),d=new ut;se.decodeMiddle(s,h[1],c[0],d);let m=d.toString(),_=null;a!=null&&(_=a.get(ot.ALLOWED_LENGTHS)),_==null&&(_=se.DEFAULT_ALLOWED_LENGTHS);let C=m.length,M=!1,R=0;for(let j of _){if(C===j){M=!0;break}j>R&&(R=j)}if(!M&&C>R&&(M=!0),!M)throw new X;const D=[new St(h[1],i),new St(c[0],i)];return new gt(m,null,0,D,Rt.ITF,new Date().getTime())}static decodeMiddle(i,s,a,h){let c=new Int32Array(10),d=new Int32Array(5),m=new Int32Array(5);for(c.fill(0),d.fill(0),m.fill(0);s<a;){Ae.recordPattern(i,s,c);for(let C=0;C<5;C++){let M=2*C;d[C]=c[M],m[C]=c[M+1]}let _=se.decodeDigit(d);h.append(_.toString()),_=this.decodeDigit(m),h.append(_.toString()),c.forEach(function(C){s+=C})}}decodeStart(i){let s=se.skipWhiteSpace(i),a=se.findGuardPattern(i,s,se.START_PATTERN);return this.narrowLineWidth=(a[1]-a[0])/4,this.validateQuietZone(i,a[0]),a}validateQuietZone(i,s){let a=this.narrowLineWidth*10;a=a<s?a:s;for(let h=s-1;a>0&&h>=0&&!i.get(h);h--)a--;if(a!==0)throw new q}static skipWhiteSpace(i){const s=i.getSize(),a=i.getNextSet(0);if(a===s)throw new q;return a}decodeEnd(i){i.reverse();try{let s=se.skipWhiteSpace(i),a;try{a=se.findGuardPattern(i,s,se.END_PATTERN_REVERSED[0])}catch(c){c instanceof q&&(a=se.findGuardPattern(i,s,se.END_PATTERN_REVERSED[1]))}this.validateQuietZone(i,a[0]);let h=a[0];return a[0]=i.getSize()-a[1],a[1]=i.getSize()-h,a}finally{i.reverse()}}static findGuardPattern(i,s,a){let h=a.length,c=new Int32Array(h),d=i.getSize(),m=!1,_=0,C=s;c.fill(0);for(let M=s;M<d;M++)if(i.get(M)!==m)c[_]++;else{if(_===h-1){if(Ae.patternMatchVariance(c,a,se.MAX_INDIVIDUAL_VARIANCE)<se.MAX_AVG_VARIANCE)return[C,M];C+=c[0]+c[1],F.arraycopy(c,2,c,0,_-1),c[_-1]=0,c[_]=0,_--}else _++;c[_]=1,m=!m}throw new q}static decodeDigit(i){let s=se.MAX_AVG_VARIANCE,a=-1,h=se.PATTERNS.length;for(let c=0;c<h;c++){let d=se.PATTERNS[c],m=Ae.patternMatchVariance(i,d,se.MAX_INDIVIDUAL_VARIANCE);m<s?(s=m,a=c):m===s&&(a=-1)}if(a>=0)return a%10;throw new q}}se.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],se.MAX_AVG_VARIANCE=.38,se.MAX_INDIVIDUAL_VARIANCE=.5,se.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],se.START_PATTERN=Int32Array.from([1,1,1,1]),se.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class we extends Ae{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(i){let s=!1,a,h=0,c=Int32Array.from([0,0,0]);for(;!s;){c=Int32Array.from([0,0,0]),a=we.findGuardPattern(i,h,!1,this.START_END_PATTERN,c);let d=a[0];h=a[1];let m=d-(h-d);m>=0&&(s=i.isRange(m,d,!1))}return a}static checkChecksum(i){return we.checkStandardUPCEANChecksum(i)}static checkStandardUPCEANChecksum(i){let s=i.length;if(s===0)return!1;let a=parseInt(i.charAt(s-1),10);return we.getStandardUPCEANChecksum(i.substring(0,s-1))===a}static getStandardUPCEANChecksum(i){let s=i.length,a=0;for(let h=s-1;h>=0;h-=2){let c=i.charAt(h).charCodeAt(0)-48;if(c<0||c>9)throw new X;a+=c}a*=3;for(let h=s-2;h>=0;h-=2){let c=i.charAt(h).charCodeAt(0)-48;if(c<0||c>9)throw new X;a+=c}return(1e3-a)%10}static decodeEnd(i,s){return we.findGuardPattern(i,s,!1,we.START_END_PATTERN,new Int32Array(we.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(i,s,a,h){return this.findGuardPattern(i,s,a,h,new Int32Array(h.length))}static findGuardPattern(i,s,a,h,c){let d=i.getSize();s=a?i.getNextUnset(s):i.getNextSet(s);let m=0,_=s,C=h.length,M=a;for(let R=s;R<d;R++)if(i.get(R)!==M)c[m]++;else{if(m===C-1){if(Ae.patternMatchVariance(c,h,we.MAX_INDIVIDUAL_VARIANCE)<we.MAX_AVG_VARIANCE)return Int32Array.from([_,R]);_+=c[0]+c[1];let D=c.slice(2,c.length-1);for(let k=0;k<m-1;k++)c[k]=D[k];c[m-1]=0,c[m]=0,m--}else m++;c[m]=1,M=!M}throw new q}static decodeDigit(i,s,a,h){this.recordPattern(i,a,s);let c=this.MAX_AVG_VARIANCE,d=-1,m=h.length;for(let _=0;_<m;_++){let C=h[_],M=Ae.patternMatchVariance(s,C,we.MAX_INDIVIDUAL_VARIANCE);M<c&&(c=M,d=_)}if(d>=0)return d;throw new q}}we.MAX_AVG_VARIANCE=.48,we.MAX_INDIVIDUAL_VARIANCE=.7,we.START_END_PATTERN=Int32Array.from([1,1,1]),we.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),we.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),we.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class xn{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(i,s,a){let h=this.decodeRowStringBuffer,c=this.decodeMiddle(s,a,h),d=h.toString(),m=xn.parseExtensionString(d),_=[new St((a[0]+a[1])/2,i),new St(c,i)],C=new gt(d,null,0,_,Rt.UPC_EAN_EXTENSION,new Date().getTime());return m!=null&&C.putAllMetadata(m),C}decodeMiddle(i,s,a){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let c=i.getSize(),d=s[1],m=0;for(let C=0;C<5&&d<c;C++){let M=we.decodeDigit(i,h,d,we.L_AND_G_PATTERNS);a+=String.fromCharCode(48+M%10);for(let R of h)d+=R;M>=10&&(m|=1<<4-C),C!==4&&(d=i.getNextSet(d),d=i.getNextUnset(d))}if(a.length!==5)throw new q;let _=this.determineCheckDigit(m);if(xn.extensionChecksum(a.toString())!==_)throw new q;return d}static extensionChecksum(i){let s=i.length,a=0;for(let h=s-2;h>=0;h-=2)a+=i.charAt(h).charCodeAt(0)-48;a*=3;for(let h=s-1;h>=0;h-=2)a+=i.charAt(h).charCodeAt(0)-48;return a*=3,a%10}determineCheckDigit(i){for(let s=0;s<10;s++)if(i===this.CHECK_DIGIT_ENCODINGS[s])return s;throw new q}static parseExtensionString(i){if(i.length!==5)return null;let s=xn.parseExtension5String(i);return s==null?null:new Map([[ye.SUGGESTED_PRICE,s]])}static parseExtension5String(i){let s;switch(i.charAt(0)){case"0":s="£";break;case"5":s="$";break;case"9":switch(i){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}s="";break;default:s="";break}let a=parseInt(i.substring(1)),h=(a/100).toString(),c=a%100,d=c<10?"0"+c:c.toString();return s+h+"."+d}}class vn{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(i,s,a){let h=this.decodeRowStringBuffer,c=this.decodeMiddle(s,a,h),d=h.toString(),m=vn.parseExtensionString(d),_=[new St((a[0]+a[1])/2,i),new St(c,i)],C=new gt(d,null,0,_,Rt.UPC_EAN_EXTENSION,new Date().getTime());return m!=null&&C.putAllMetadata(m),C}decodeMiddle(i,s,a){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let c=i.getSize(),d=s[1],m=0;for(let _=0;_<2&&d<c;_++){let C=we.decodeDigit(i,h,d,we.L_AND_G_PATTERNS);a+=String.fromCharCode(48+C%10);for(let M of h)d+=M;C>=10&&(m|=1<<1-_),_!==1&&(d=i.getNextSet(d),d=i.getNextUnset(d))}if(a.length!==2)throw new q;if(parseInt(a.toString())%4!==m)throw new q;return d}static parseExtensionString(i){return i.length!==2?null:new Map([[ye.ISSUE_NUMBER,parseInt(i)]])}}class an{static decodeRow(i,s,a){let h=we.findGuardPattern(s,a,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new xn().decodeRow(i,s,h)}catch{return new vn().decodeRow(i,s,h)}}}an.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class ht extends we{constructor(){super(),this.decodeRowStringBuffer="",ht.L_AND_G_PATTERNS=ht.L_PATTERNS.map(i=>Int32Array.from(i));for(let i=10;i<20;i++){let s=ht.L_PATTERNS[i-10],a=new Int32Array(s.length);for(let h=0;h<s.length;h++)a[h]=s[s.length-h-1];ht.L_AND_G_PATTERNS[i]=a}}decodeRow(i,s,a){let h=ht.findStartGuardPattern(s),c=a==null?null:a.get(ot.NEED_RESULT_POINT_CALLBACK);if(c!=null){const mt=new St((h[0]+h[1])/2,i);c.foundPossibleResultPoint(mt)}let d=this.decodeMiddle(s,h,this.decodeRowStringBuffer),m=d.rowOffset,_=d.resultString;if(c!=null){const mt=new St(m,i);c.foundPossibleResultPoint(mt)}let C=this.decodeEnd(s,m);if(c!=null){const mt=new St((C[0]+C[1])/2,i);c.foundPossibleResultPoint(mt)}let M=C[1],R=M+(M-C[0]);if(R>=s.getSize()||!s.isRange(M,R,!1))throw new q;let D=_.toString();if(D.length<8)throw new X;if(!ht.checkChecksum(D))throw new P;let k=(h[1]+h[0])/2,j=(C[1]+C[0])/2,K=this.getBarcodeFormat(),tt=[new St(k,i),new St(j,i)],st=new gt(D,null,0,tt,K,new Date().getTime()),Et=0;try{let mt=an.decodeRow(i,s,C[1]);st.putMetadata(ye.UPC_EAN_EXTENSION,mt.getText()),st.putAllMetadata(mt.getResultMetadata()),st.addResultPoints(mt.getResultPoints()),Et=mt.getText().length}catch{}let At=a==null?null:a.get(ot.ALLOWED_EAN_EXTENSIONS);if(At!=null){let mt=!1;for(let le in At)if(Et.toString()===le){mt=!0;break}if(!mt)throw new q}return st}decodeEnd(i,s){return ht.findGuardPattern(i,s,!1,ht.START_END_PATTERN,new Int32Array(ht.START_END_PATTERN.length).fill(0))}static checkChecksum(i){return ht.checkStandardUPCEANChecksum(i)}static checkStandardUPCEANChecksum(i){let s=i.length;if(s===0)return!1;let a=parseInt(i.charAt(s-1),10);return ht.getStandardUPCEANChecksum(i.substring(0,s-1))===a}static getStandardUPCEANChecksum(i){let s=i.length,a=0;for(let h=s-1;h>=0;h-=2){let c=i.charAt(h).charCodeAt(0)-48;if(c<0||c>9)throw new X;a+=c}a*=3;for(let h=s-2;h>=0;h-=2){let c=i.charAt(h).charCodeAt(0)-48;if(c<0||c>9)throw new X;a+=c}return(1e3-a)%10}}class Gi extends ht{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(i,s,a){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let c=i.getSize(),d=s[1],m=0;for(let C=0;C<6&&d<c;C++){let M=ht.decodeDigit(i,h,d,ht.L_AND_G_PATTERNS);a+=String.fromCharCode(48+M%10);for(let R of h)d+=R;M>=10&&(m|=1<<5-C)}a=Gi.determineFirstDigit(a,m),d=ht.findGuardPattern(i,d,!0,ht.MIDDLE_PATTERN,new Int32Array(ht.MIDDLE_PATTERN.length).fill(0))[1];for(let C=0;C<6&&d<c;C++){let M=ht.decodeDigit(i,h,d,ht.L_PATTERNS);a+=String.fromCharCode(48+M);for(let R of h)d+=R}return{rowOffset:d,resultString:a}}getBarcodeFormat(){return Rt.EAN_13}static determineFirstDigit(i,s){for(let a=0;a<10;a++)if(s===this.FIRST_DIGIT_ENCODINGS[a])return i=String.fromCharCode(48+a)+i,i;throw new q}}Gi.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class On extends ht{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(i,s,a){const h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let c=i.getSize(),d=s[1];for(let _=0;_<4&&d<c;_++){let C=ht.decodeDigit(i,h,d,ht.L_PATTERNS);a+=String.fromCharCode(48+C);for(let M of h)d+=M}d=ht.findGuardPattern(i,d,!0,ht.MIDDLE_PATTERN,new Int32Array(ht.MIDDLE_PATTERN.length).fill(0))[1];for(let _=0;_<4&&d<c;_++){let C=ht.decodeDigit(i,h,d,ht.L_PATTERNS);a+=String.fromCharCode(48+C);for(let M of h)d+=M}return{rowOffset:d,resultString:a}}getBarcodeFormat(){return Rt.EAN_8}}class Bs extends ht{constructor(){super(...arguments),this.ean13Reader=new Gi}getBarcodeFormat(){return Rt.UPC_A}decode(i,s){return this.maybeReturnResult(this.ean13Reader.decode(i))}decodeRow(i,s,a){return this.maybeReturnResult(this.ean13Reader.decodeRow(i,s,a))}decodeMiddle(i,s,a){return this.ean13Reader.decodeMiddle(i,s,a)}maybeReturnResult(i){let s=i.getText();if(s.charAt(0)==="0"){let a=new gt(s.substring(1),null,null,i.getResultPoints(),Rt.UPC_A);return i.getResultMetadata()!=null&&a.putAllMetadata(i.getResultMetadata()),a}else throw new q}reset(){this.ean13Reader.reset()}}class Ct extends ht{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(i,s,a){const h=this.decodeMiddleCounters.map(C=>C);h[0]=0,h[1]=0,h[2]=0,h[3]=0;const c=i.getSize();let d=s[1],m=0;for(let C=0;C<6&&d<c;C++){const M=Ct.decodeDigit(i,h,d,Ct.L_AND_G_PATTERNS);a+=String.fromCharCode(48+M%10);for(let R of h)d+=R;M>=10&&(m|=1<<5-C)}let _=Ct.determineNumSysAndCheckDigit(a,m);return{rowOffset:d,resultString:_}}decodeEnd(i,s){return Ct.findGuardPatternWithoutCounters(i,s,!0,Ct.MIDDLE_END_PATTERN)}checkChecksum(i){return ht.checkChecksum(Ct.convertUPCEtoUPCA(i))}static determineNumSysAndCheckDigit(i,s){for(let a=0;a<=1;a++)for(let h=0;h<10;h++)if(s===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[a][h]){let c=String.fromCharCode(48+a),d=String.fromCharCode(48+h);return c+i+d}throw q.getNotFoundInstance()}getBarcodeFormat(){return Rt.UPC_E}static convertUPCEtoUPCA(i){const s=i.slice(1,7).split("").map(c=>c.charCodeAt(0)),a=new ut;a.append(i.charAt(0));let h=s[5];switch(h){case 0:case 1:case 2:a.appendChars(s,0,2),a.append(h),a.append("0000"),a.appendChars(s,2,3);break;case 3:a.appendChars(s,0,3),a.append("00000"),a.appendChars(s,3,2);break;case 4:a.appendChars(s,0,4),a.append("00000"),a.append(s[4]);break;default:a.appendChars(s,0,5),a.append("0000"),a.append(h);break}return i.length>=8&&a.append(i.charAt(7)),a.toString()}}Ct.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Ct.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class fe extends Ae{constructor(i){super();let s=i==null?null:i.get(ot.POSSIBLE_FORMATS),a=[];n(s)?(a.push(new Gi),a.push(new Bs),a.push(new On),a.push(new Ct)):(s.indexOf(Rt.EAN_13)>-1&&a.push(new Gi),s.indexOf(Rt.UPC_A)>-1&&a.push(new Bs),s.indexOf(Rt.EAN_8)>-1&&a.push(new On),s.indexOf(Rt.UPC_E)>-1&&a.push(new Ct)),this.readers=a}decodeRow(i,s,a){for(let h of this.readers)try{const c=h.decodeRow(i,s,a),d=c.getBarcodeFormat()===Rt.EAN_13&&c.getText().charAt(0)==="0",m=a==null?null:a.get(ot.POSSIBLE_FORMATS),_=m==null||m.includes(Rt.UPC_A);if(d&&_){const C=c.getRawBytes(),M=new gt(c.getText().substring(1),C,C?C.length:null,c.getResultPoints(),Rt.UPC_A);return M.putAllMetadata(c.getResultMetadata()),M}return c}catch{}throw new q}reset(){for(let i of this.readers)i.reset()}}class ue extends Ae{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(i,s){for(let a=0;a<s.length;a++)if(Ae.patternMatchVariance(i,s[a],ue.MAX_INDIVIDUAL_VARIANCE)<ue.MAX_AVG_VARIANCE)return a;throw new q}static count(i){return ee.sum(new Int32Array(i))}static increment(i,s){let a=0,h=s[0];for(let c=1;c<i.length;c++)s[c]>h&&(h=s[c],a=c);i[a]++}static decrement(i,s){let a=0,h=s[0];for(let c=1;c<i.length;c++)s[c]<h&&(h=s[c],a=c);i[a]--}static isFinderPattern(i){let s=i[0]+i[1],a=s+i[2]+i[3],h=s/a;if(h>=ue.MIN_FINDER_PATTERN_RATIO&&h<=ue.MAX_FINDER_PATTERN_RATIO){let c=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER;for(let m of i)m>d&&(d=m),m<c&&(c=m);return d<10*c}return!1}}ue.MAX_AVG_VARIANCE=.2,ue.MAX_INDIVIDUAL_VARIANCE=.45,ue.MIN_FINDER_PATTERN_RATIO=9.5/12,ue.MAX_FINDER_PATTERN_RATIO=12.5/14;class Wt{constructor(i,s){this.value=i,this.checksumPortion=s}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(i){if(!(i instanceof Wt))return!1;const s=i;return this.value===s.value&&this.checksumPortion===s.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class si{constructor(i,s,a,h,c){this.value=i,this.startEnd=s,this.value=i,this.startEnd=s,this.resultPoints=new Array,this.resultPoints.push(new St(a,c)),this.resultPoints.push(new St(h,c))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(i){if(!(i instanceof si))return!1;const s=i;return this.value===s.value}hashCode(){return this.value}}class Vt{constructor(){}static getRSSvalue(i,s,a){let h=0;for(let _ of i)h+=_;let c=0,d=0,m=i.length;for(let _=0;_<m-1;_++){let C;for(C=1,d|=1<<_;C<i[_];C++,d&=~(1<<_)){let M=Vt.combins(h-C-1,m-_-2);if(a&&d===0&&h-C-(m-_-1)>=m-_-1&&(M-=Vt.combins(h-C-(m-_),m-_-2)),m-_-1>1){let R=0;for(let D=h-C-(m-_-2);D>s;D--)R+=Vt.combins(h-C-D-1,m-_-3);M-=R*(m-1-_)}else h-C>s&&M--;c+=M}h-=C}return c}static combins(i,s){let a,h;i-s>s?(h=s,a=i-s):(h=i-s,a=s);let c=1,d=1;for(let m=i;m>a;m--)c*=m,d<=h&&(c/=d,d++);for(;d<=h;)c/=d,d++;return c}}class Le{static buildBitArray(i){let s=i.length*2-1;i[i.length-1].getRightChar()==null&&(s-=1);let a=12*s,h=new Z(a),c=0,m=i[0].getRightChar().getValue();for(let _=11;_>=0;--_)m&1<<_&&h.set(c),c++;for(let _=1;_<i.length;++_){let C=i[_],M=C.getLeftChar().getValue();for(let R=11;R>=0;--R)M&1<<R&&h.set(c),c++;if(C.getRightChar()!=null){let R=C.getRightChar().getValue();for(let D=11;D>=0;--D)R&1<<D&&h.set(c),c++}}return h}}class ui{constructor(i,s){s?this.decodedInformation=null:(this.finished=i,this.decodedInformation=s)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Se{constructor(i){this.newPosition=i}getNewPosition(){return this.newPosition}}class de extends Se{constructor(i,s){super(i),this.value=s}getValue(){return this.value}isFNC1(){return this.value===de.FNC1}}de.FNC1="$";class Ye extends Se{constructor(i,s,a){super(i),a?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=s}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class Ri extends Se{constructor(i,s,a){if(super(i),s<0||s>10||a<0||a>10)throw new X;this.firstDigit=s,this.secondDigit=a}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===Ri.FNC1}isSecondDigitFNC1(){return this.secondDigit===Ri.FNC1}isAnyFNC1(){return this.firstDigit===Ri.FNC1||this.secondDigit===Ri.FNC1}}Ri.FNC1=10;class vt{constructor(){}static parseFieldsInGeneralPurpose(i){if(!i)return null;if(i.length<2)throw new q;let s=i.substring(0,2);for(let c of vt.TWO_DIGIT_DATA_LENGTH)if(c[0]===s)return c[1]===vt.VARIABLE_LENGTH?vt.processVariableAI(2,c[2],i):vt.processFixedAI(2,c[1],i);if(i.length<3)throw new q;let a=i.substring(0,3);for(let c of vt.THREE_DIGIT_DATA_LENGTH)if(c[0]===a)return c[1]===vt.VARIABLE_LENGTH?vt.processVariableAI(3,c[2],i):vt.processFixedAI(3,c[1],i);for(let c of vt.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(c[0]===a)return c[1]===vt.VARIABLE_LENGTH?vt.processVariableAI(4,c[2],i):vt.processFixedAI(4,c[1],i);if(i.length<4)throw new q;let h=i.substring(0,4);for(let c of vt.FOUR_DIGIT_DATA_LENGTH)if(c[0]===h)return c[1]===vt.VARIABLE_LENGTH?vt.processVariableAI(4,c[2],i):vt.processFixedAI(4,c[1],i);throw new q}static processFixedAI(i,s,a){if(a.length<i)throw new q;let h=a.substring(0,i);if(a.length<i+s)throw new q;let c=a.substring(i,i+s),d=a.substring(i+s),m="("+h+")"+c,_=vt.parseFieldsInGeneralPurpose(d);return _==null?m:m+_}static processVariableAI(i,s,a){let h=a.substring(0,i),c;a.length<i+s?c=a.length:c=i+s;let d=a.substring(i,c),m=a.substring(c),_="("+h+")"+d,C=vt.parseFieldsInGeneralPurpose(m);return C==null?_:_+C}}vt.VARIABLE_LENGTH=[],vt.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",vt.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",vt.VARIABLE_LENGTH,20],["22",vt.VARIABLE_LENGTH,29],["30",vt.VARIABLE_LENGTH,8],["37",vt.VARIABLE_LENGTH,8],["90",vt.VARIABLE_LENGTH,30],["91",vt.VARIABLE_LENGTH,30],["92",vt.VARIABLE_LENGTH,30],["93",vt.VARIABLE_LENGTH,30],["94",vt.VARIABLE_LENGTH,30],["95",vt.VARIABLE_LENGTH,30],["96",vt.VARIABLE_LENGTH,30],["97",vt.VARIABLE_LENGTH,3],["98",vt.VARIABLE_LENGTH,30],["99",vt.VARIABLE_LENGTH,30]],vt.THREE_DIGIT_DATA_LENGTH=[["240",vt.VARIABLE_LENGTH,30],["241",vt.VARIABLE_LENGTH,30],["242",vt.VARIABLE_LENGTH,6],["250",vt.VARIABLE_LENGTH,30],["251",vt.VARIABLE_LENGTH,30],["253",vt.VARIABLE_LENGTH,17],["254",vt.VARIABLE_LENGTH,20],["400",vt.VARIABLE_LENGTH,30],["401",vt.VARIABLE_LENGTH,30],["402",17],["403",vt.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",vt.VARIABLE_LENGTH,20],["421",vt.VARIABLE_LENGTH,15],["422",3],["423",vt.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],vt.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",vt.VARIABLE_LENGTH,15],["391",vt.VARIABLE_LENGTH,18],["392",vt.VARIABLE_LENGTH,15],["393",vt.VARIABLE_LENGTH,18],["703",vt.VARIABLE_LENGTH,30]],vt.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",vt.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",vt.VARIABLE_LENGTH,20],["8003",vt.VARIABLE_LENGTH,30],["8004",vt.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",vt.VARIABLE_LENGTH,30],["8008",vt.VARIABLE_LENGTH,12],["8018",18],["8020",vt.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",vt.VARIABLE_LENGTH,70],["8200",vt.VARIABLE_LENGTH,70]];class fs{constructor(i){this.buffer=new ut,this.information=i}decodeAllCodes(i,s){let a=s,h=null;do{let c=this.decodeGeneralPurposeField(a,h),d=vt.parseFieldsInGeneralPurpose(c.getNewString());if(d!=null&&i.append(d),c.isRemaining()?h=""+c.getRemainingValue():h=null,a===c.getNewPosition())break;a=c.getNewPosition()}while(!0);return i.toString()}isStillNumeric(i){if(i+7>this.information.getSize())return i+4<=this.information.getSize();for(let s=i;s<i+3;++s)if(this.information.get(s))return!0;return this.information.get(i+3)}decodeNumeric(i){if(i+7>this.information.getSize()){let c=this.extractNumericValueFromBitArray(i,4);return c===0?new Ri(this.information.getSize(),Ri.FNC1,Ri.FNC1):new Ri(this.information.getSize(),c-1,Ri.FNC1)}let s=this.extractNumericValueFromBitArray(i,7),a=(s-8)/11,h=(s-8)%11;return new Ri(i+7,a,h)}extractNumericValueFromBitArray(i,s){return fs.extractNumericValueFromBitArray(this.information,i,s)}static extractNumericValueFromBitArray(i,s,a){let h=0;for(let c=0;c<a;++c)i.get(s+c)&&(h|=1<<a-c-1);return h}decodeGeneralPurposeField(i,s){this.buffer.setLengthToZero(),s!=null&&this.buffer.append(s),this.current.setPosition(i);let a=this.parseBlocks();return a!=null&&a.isRemaining()?new Ye(this.current.getPosition(),this.buffer.toString(),a.getRemainingValue()):new Ye(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let i,s;do{let a=this.current.getPosition();if(this.current.isAlpha()?(s=this.parseAlphaBlock(),i=s.isFinished()):this.current.isIsoIec646()?(s=this.parseIsoIec646Block(),i=s.isFinished()):(s=this.parseNumericBlock(),i=s.isFinished()),!(a!==this.current.getPosition())&&!i)break}while(!i);return s.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let i=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(i.getNewPosition()),i.isFirstDigitFNC1()){let s;return i.isSecondDigitFNC1()?s=new Ye(this.current.getPosition(),this.buffer.toString()):s=new Ye(this.current.getPosition(),this.buffer.toString(),i.getSecondDigit()),new ui(!0,s)}if(this.buffer.append(i.getFirstDigit()),i.isSecondDigitFNC1()){let s=new Ye(this.current.getPosition(),this.buffer.toString());return new ui(!0,s)}this.buffer.append(i.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new ui(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let i=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(i.getNewPosition()),i.isFNC1()){let s=new Ye(this.current.getPosition(),this.buffer.toString());return new ui(!0,s)}this.buffer.append(i.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new ui(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let i=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(i.getNewPosition()),i.isFNC1()){let s=new Ye(this.current.getPosition(),this.buffer.toString());return new ui(!0,s)}this.buffer.append(i.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new ui(!1)}isStillIsoIec646(i){if(i+5>this.information.getSize())return!1;let s=this.extractNumericValueFromBitArray(i,5);if(s>=5&&s<16)return!0;if(i+7>this.information.getSize())return!1;let a=this.extractNumericValueFromBitArray(i,7);if(a>=64&&a<116)return!0;if(i+8>this.information.getSize())return!1;let h=this.extractNumericValueFromBitArray(i,8);return h>=232&&h<253}decodeIsoIec646(i){let s=this.extractNumericValueFromBitArray(i,5);if(s===15)return new de(i+5,de.FNC1);if(s>=5&&s<15)return new de(i+5,"0"+(s-5));let a=this.extractNumericValueFromBitArray(i,7);if(a>=64&&a<90)return new de(i+7,""+(a+1));if(a>=90&&a<116)return new de(i+7,""+(a+7));let h=this.extractNumericValueFromBitArray(i,8),c;switch(h){case 232:c="!";break;case 233:c='"';break;case 234:c="%";break;case 235:c="&";break;case 236:c="'";break;case 237:c="(";break;case 238:c=")";break;case 239:c="*";break;case 240:c="+";break;case 241:c=",";break;case 242:c="-";break;case 243:c=".";break;case 244:c="/";break;case 245:c=":";break;case 246:c=";";break;case 247:c="<";break;case 248:c="=";break;case 249:c=">";break;case 250:c="?";break;case 251:c="_";break;case 252:c=" ";break;default:throw new X}return new de(i+8,c)}isStillAlpha(i){if(i+5>this.information.getSize())return!1;let s=this.extractNumericValueFromBitArray(i,5);if(s>=5&&s<16)return!0;if(i+6>this.information.getSize())return!1;let a=this.extractNumericValueFromBitArray(i,6);return a>=16&&a<63}decodeAlphanumeric(i){let s=this.extractNumericValueFromBitArray(i,5);if(s===15)return new de(i+5,de.FNC1);if(s>=5&&s<15)return new de(i+5,"0"+(s-5));let a=this.extractNumericValueFromBitArray(i,6);if(a>=32&&a<58)return new de(i+6,""+(a+33));let h;switch(a){case 58:h="*";break;case 59:h=",";break;case 60:h="-";break;case 61:h=".";break;case 62:h="/";break;default:throw new hi("Decoding invalid alphanumeric value: "+a)}return new de(i+6,h)}isAlphaTo646ToAlphaLatch(i){if(i+1>this.information.getSize())return!1;for(let s=0;s<5&&s+i<this.information.getSize();++s)if(s===2){if(!this.information.get(i+2))return!1}else if(this.information.get(i+s))return!1;return!0}isAlphaOr646ToNumericLatch(i){if(i+3>this.information.getSize())return!1;for(let s=i;s<i+3;++s)if(this.information.get(s))return!1;return!0}isNumericToAlphaNumericLatch(i){if(i+1>this.information.getSize())return!1;for(let s=0;s<4&&s+i<this.information.getSize();++s)if(this.information.get(i+s))return!1;return!0}}class ds{constructor(i){this.information=i,this.generalDecoder=new fs(i)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class Ai extends ds{constructor(i){super(i)}encodeCompressedGtin(i,s){i.append("(01)");let a=i.length();i.append("9"),this.encodeCompressedGtinWithoutAI(i,s,a)}encodeCompressedGtinWithoutAI(i,s,a){for(let h=0;h<4;++h){let c=this.getGeneralDecoder().extractNumericValueFromBitArray(s+10*h,10);c/100===0&&i.append("0"),c/10===0&&i.append("0"),i.append(c)}Ai.appendCheckDigit(i,a)}static appendCheckDigit(i,s){let a=0;for(let h=0;h<13;h++){let c=i.charAt(h+s).charCodeAt(0)-48;a+=h&1?c:3*c}a=10-a%10,a===10&&(a=0),i.append(a)}}Ai.GTIN_SIZE=40;class gs extends Ai{constructor(i){super(i)}parseInformation(){let i=new ut;i.append("(01)");let s=i.length(),a=this.getGeneralDecoder().extractNumericValueFromBitArray(gs.HEADER_SIZE,4);return i.append(a),this.encodeCompressedGtinWithoutAI(i,gs.HEADER_SIZE+4,s),this.getGeneralDecoder().decodeAllCodes(i,gs.HEADER_SIZE+44)}}gs.HEADER_SIZE=4;class ks extends ds{constructor(i){super(i)}parseInformation(){let i=new ut;return this.getGeneralDecoder().decodeAllCodes(i,ks.HEADER_SIZE)}}ks.HEADER_SIZE=5;class ur extends Ai{constructor(i){super(i)}encodeCompressedWeight(i,s,a){let h=this.getGeneralDecoder().extractNumericValueFromBitArray(s,a);this.addWeightCode(i,h);let c=this.checkWeight(h),d=1e5;for(let m=0;m<5;++m)c/d===0&&i.append("0"),d/=10;i.append(c)}}class ln extends ur{constructor(i){super(i)}parseInformation(){if(this.getInformation().getSize()!=ln.HEADER_SIZE+ur.GTIN_SIZE+ln.WEIGHT_SIZE)throw new q;let i=new ut;return this.encodeCompressedGtin(i,ln.HEADER_SIZE),this.encodeCompressedWeight(i,ln.HEADER_SIZE+ur.GTIN_SIZE,ln.WEIGHT_SIZE),i.toString()}}ln.HEADER_SIZE=5,ln.WEIGHT_SIZE=15;class Yo extends ln{constructor(i){super(i)}addWeightCode(i,s){i.append("(3103)")}checkWeight(i){return i}}class hn extends ln{constructor(i){super(i)}addWeightCode(i,s){s<1e4?i.append("(3202)"):i.append("(3203)")}checkWeight(i){return i<1e4?i:i-1e4}}class vi extends Ai{constructor(i){super(i)}parseInformation(){if(this.getInformation().getSize()<vi.HEADER_SIZE+Ai.GTIN_SIZE)throw new q;let i=new ut;this.encodeCompressedGtin(i,vi.HEADER_SIZE);let s=this.getGeneralDecoder().extractNumericValueFromBitArray(vi.HEADER_SIZE+Ai.GTIN_SIZE,vi.LAST_DIGIT_SIZE);i.append("(392"),i.append(s),i.append(")");let a=this.getGeneralDecoder().decodeGeneralPurposeField(vi.HEADER_SIZE+Ai.GTIN_SIZE+vi.LAST_DIGIT_SIZE,null);return i.append(a.getNewString()),i.toString()}}vi.HEADER_SIZE=8,vi.LAST_DIGIT_SIZE=2;class Tt extends Ai{constructor(i){super(i)}parseInformation(){if(this.getInformation().getSize()<Tt.HEADER_SIZE+Ai.GTIN_SIZE)throw new q;let i=new ut;this.encodeCompressedGtin(i,Tt.HEADER_SIZE);let s=this.getGeneralDecoder().extractNumericValueFromBitArray(Tt.HEADER_SIZE+Ai.GTIN_SIZE,Tt.LAST_DIGIT_SIZE);i.append("(393"),i.append(s),i.append(")");let a=this.getGeneralDecoder().extractNumericValueFromBitArray(Tt.HEADER_SIZE+Ai.GTIN_SIZE+Tt.LAST_DIGIT_SIZE,Tt.FIRST_THREE_DIGITS_SIZE);a/100==0&&i.append("0"),a/10==0&&i.append("0"),i.append(a);let h=this.getGeneralDecoder().decodeGeneralPurposeField(Tt.HEADER_SIZE+Ai.GTIN_SIZE+Tt.LAST_DIGIT_SIZE+Tt.FIRST_THREE_DIGITS_SIZE,null);return i.append(h.getNewString()),i.toString()}}Tt.HEADER_SIZE=8,Tt.LAST_DIGIT_SIZE=2,Tt.FIRST_THREE_DIGITS_SIZE=10;class ae extends ur{constructor(i,s,a){super(i),this.dateCode=a,this.firstAIdigits=s}parseInformation(){if(this.getInformation().getSize()!=ae.HEADER_SIZE+ae.GTIN_SIZE+ae.WEIGHT_SIZE+ae.DATE_SIZE)throw new q;let i=new ut;return this.encodeCompressedGtin(i,ae.HEADER_SIZE),this.encodeCompressedWeight(i,ae.HEADER_SIZE+ae.GTIN_SIZE,ae.WEIGHT_SIZE),this.encodeCompressedDate(i,ae.HEADER_SIZE+ae.GTIN_SIZE+ae.WEIGHT_SIZE),i.toString()}encodeCompressedDate(i,s){let a=this.getGeneralDecoder().extractNumericValueFromBitArray(s,ae.DATE_SIZE);if(a==38400)return;i.append("("),i.append(this.dateCode),i.append(")");let h=a%32;a/=32;let c=a%12+1;a/=12;let d=a;d/10==0&&i.append("0"),i.append(d),c/10==0&&i.append("0"),i.append(c),h/10==0&&i.append("0"),i.append(h)}addWeightCode(i,s){i.append("("),i.append(this.firstAIdigits),i.append(s/1e5),i.append(")")}checkWeight(i){return i%1e5}}ae.HEADER_SIZE=8,ae.WEIGHT_SIZE=20,ae.DATE_SIZE=16;function ms(T){try{if(T.get(1))return new gs(T);if(!T.get(2))return new ks(T);switch(fs.extractNumericValueFromBitArray(T,1,4)){case 4:return new Yo(T);case 5:return new hn(T)}switch(fs.extractNumericValueFromBitArray(T,1,5)){case 12:return new vi(T);case 13:return new Tt(T)}switch(fs.extractNumericValueFromBitArray(T,1,7)){case 56:return new ae(T,"310","11");case 57:return new ae(T,"320","11");case 58:return new ae(T,"310","13");case 59:return new ae(T,"320","13");case 60:return new ae(T,"310","15");case 61:return new ae(T,"320","15");case 62:return new ae(T,"310","17");case 63:return new ae(T,"320","17")}}catch(i){throw console.log(i),new hi("unknown decoder: "+T)}}class Nn{constructor(i,s,a,h){this.leftchar=i,this.rightchar=s,this.finderpattern=a,this.maybeLast=h}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(i,s){return i instanceof Nn?Nn.equalsOrNull(i.leftchar,s.leftchar)&&Nn.equalsOrNull(i.rightchar,s.rightchar)&&Nn.equalsOrNull(i.finderpattern,s.finderpattern):!1}static equalsOrNull(i,s){return i===null?s===null:Nn.equals(i,s)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class xs{constructor(i,s,a){this.pairs=i,this.rowNumber=s,this.wasReversed=a}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(i){return this.checkEqualitity(this,i)}toString(){return"{ "+this.pairs+" }"}equals(i,s){return i instanceof xs?this.checkEqualitity(i,s)&&i.wasReversed===s.wasReversed:!1}checkEqualitity(i,s){if(!i||!s)return;let a;return i.forEach((h,c)=>{s.forEach(d=>{h.getLeftChar().getValue()===d.getLeftChar().getValue()&&h.getRightChar().getValue()===d.getRightChar().getValue()&&h.getFinderPatter().getValue()===d.getFinderPatter().getValue()&&(a=!0)})}),a}}class dt extends ue{constructor(i){super(...arguments),this.pairs=new Array(dt.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=i===!0}decodeRow(i,s,a){this.pairs.length=0,this.startFromEven=!1;try{return dt.constructResult(this.decodeRow2pairs(i,s))}catch(h){this.verbose&&console.log(h)}return this.pairs.length=0,this.startFromEven=!0,dt.constructResult(this.decodeRow2pairs(i,s))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(i,s){let a=!1;for(;!a;)try{this.pairs.push(this.retrieveNextPair(s,this.pairs,i))}catch(c){if(c instanceof q){if(!this.pairs.length)throw new q;a=!0}}if(this.checkChecksum())return this.pairs;let h;if(this.rows.length?h=!0:h=!1,this.storeRow(i,!1),h){let c=this.checkRowsBoolean(!1);if(c!=null||(c=this.checkRowsBoolean(!0),c!=null))return c}throw new q}checkRowsBoolean(i){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,i&&(this.rows=this.rows.reverse());let s=null;try{s=this.checkRows(new Array,0)}catch(a){this.verbose&&console.log(a)}return i&&(this.rows=this.rows.reverse()),s}checkRows(i,s){for(let a=s;a<this.rows.length;a++){let h=this.rows[a];this.pairs.length=0;for(let d of i)this.pairs.push(d.getPairs());if(this.pairs.push(h.getPairs()),!dt.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let c=new Array(i);c.push(h);try{return this.checkRows(c,a+1)}catch(d){this.verbose&&console.log(d)}}throw new q}static isValidSequence(i){for(let s of dt.FINDER_PATTERN_SEQUENCES){if(i.length>s.length)continue;let a=!0;for(let h=0;h<i.length;h++)if(i[h].getFinderPattern().getValue()!=s[h]){a=!1;break}if(a)return!0}return!1}storeRow(i,s){let a=0,h=!1,c=!1;for(;a<this.rows.length;){let d=this.rows[a];if(d.getRowNumber()>i){c=d.isEquivalent(this.pairs);break}h=d.isEquivalent(this.pairs),a++}c||h||dt.isPartialRow(this.pairs,this.rows)||(this.rows.push(a,new xs(this.pairs,i,s)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(i,s){for(let a of s)if(a.getPairs().length!==i.length){for(let h of a.getPairs())for(let c of i)if(Nn.equals(h,c))break}}static isPartialRow(i,s){for(let a of s){let h=!0;for(let c of i){let d=!1;for(let m of a.getPairs())if(c.equals(m)){d=!0;break}if(!d){h=!1;break}}if(h)return!0}return!1}getRows(){return this.rows}static constructResult(i){let s=Le.buildBitArray(i),h=ms(s).parseInformation(),c=i[0].getFinderPattern().getResultPoints(),d=i[i.length-1].getFinderPattern().getResultPoints(),m=[c[0],c[1],d[0],d[1]];return new gt(h,null,null,m,Rt.RSS_EXPANDED,null)}checkChecksum(){let i=this.pairs.get(0),s=i.getLeftChar(),a=i.getRightChar();if(a==null)return!1;let h=a.getChecksumPortion(),c=2;for(let m=1;m<this.pairs.size();++m){let _=this.pairs.get(m);h+=_.getLeftChar().getChecksumPortion(),c++;let C=_.getRightChar();C!=null&&(h+=C.getChecksumPortion(),c++)}return h%=211,211*(c-4)+h==s.getValue()}static getNextSecondBar(i,s){let a;return i.get(s)?(a=i.getNextUnset(s),a=i.getNextSet(a)):(a=i.getNextSet(s),a=i.getNextUnset(a)),a}retrieveNextPair(i,s,a){let h=s.length%2==0;this.startFromEven&&(h=!h);let c,d=!0,m=-1;do this.findNextPair(i,s,m),c=this.parseFoundFinderPattern(i,a,h),c==null?m=dt.getNextSecondBar(i,this.startEnd[0]):d=!1;while(d);let _=this.decodeDataCharacter(i,c,h,!0);if(!this.isEmptyPair(s)&&s[s.length-1].mustBeLast())throw new q;let C;try{C=this.decodeDataCharacter(i,c,h,!1)}catch(M){C=null,this.verbose&&console.log(M)}return new Nn(_,C,c,!0)}isEmptyPair(i){return i.length===0}findNextPair(i,s,a){let h=this.getDecodeFinderCounters();h[0]=0,h[1]=0,h[2]=0,h[3]=0;let c=i.getSize(),d;a>=0?d=a:this.isEmptyPair(s)?d=0:d=s[s.length-1].getFinderPattern().getStartEnd()[1];let m=s.length%2!=0;this.startFromEven&&(m=!m);let _=!1;for(;d<c&&(_=!i.get(d),!!_);)d++;let C=0,M=d;for(let R=d;R<c;R++)if(i.get(R)!=_)h[C]++;else{if(C==3){if(m&&dt.reverseCounters(h),dt.isFinderPattern(h)){this.startEnd[0]=M,this.startEnd[1]=R;return}m&&dt.reverseCounters(h),M+=h[0]+h[1],h[0]=h[2],h[1]=h[3],h[2]=0,h[3]=0,C--}else C++;h[C]=1,_=!_}throw new q}static reverseCounters(i){let s=i.length;for(let a=0;a<s/2;++a){let h=i[a];i[a]=i[s-a-1],i[s-a-1]=h}}parseFoundFinderPattern(i,s,a){let h,c,d;if(a){let C=this.startEnd[0]-1;for(;C>=0&&!i.get(C);)C--;C++,h=this.startEnd[0]-C,c=C,d=this.startEnd[1]}else c=this.startEnd[0],d=i.getNextUnset(this.startEnd[1]+1),h=d-this.startEnd[1];let m=this.getDecodeFinderCounters();F.arraycopy(m,0,m,1,m.length-1),m[0]=h;let _;try{_=this.parseFinderValue(m,dt.FINDER_PATTERNS)}catch{return null}return new si(_,[c,d],c,d,s)}decodeDataCharacter(i,s,a,h){let c=this.getDataCharacterCounters();for(let De=0;De<c.length;De++)c[De]=0;if(h)dt.recordPatternInReverse(i,s.getStartEnd()[0],c);else{dt.recordPattern(i,s.getStartEnd()[1],c);for(let De=0,Mi=c.length-1;De<Mi;De++,Mi--){let tn=c[De];c[De]=c[Mi],c[Mi]=tn}}let d=17,m=ee.sum(new Int32Array(c))/d,_=(s.getStartEnd()[1]-s.getStartEnd()[0])/15;if(Math.abs(m-_)/_>.3)throw new q;let C=this.getOddCounts(),M=this.getEvenCounts(),R=this.getOddRoundingErrors(),D=this.getEvenRoundingErrors();for(let De=0;De<c.length;De++){let Mi=1*c[De]/m,tn=Mi+.5;if(tn<1){if(Mi<.3)throw new q;tn=1}else if(tn>8){if(Mi>8.7)throw new q;tn=8}let xr=De/2;De&1?(M[xr]=tn,D[xr]=Mi-tn):(C[xr]=tn,R[xr]=Mi-tn)}this.adjustOddEvenCounts(d);let k=4*s.getValue()+(a?0:2)+(h?0:1)-1,j=0,K=0;for(let De=C.length-1;De>=0;De--){if(dt.isNotA1left(s,a,h)){let Mi=dt.WEIGHTS[k][2*De];K+=C[De]*Mi}j+=C[De]}let tt=0;for(let De=M.length-1;De>=0;De--)if(dt.isNotA1left(s,a,h)){let Mi=dt.WEIGHTS[k][2*De+1];tt+=M[De]*Mi}let st=K+tt;if(j&1||j>13||j<4)throw new q;let Et=(13-j)/2,At=dt.SYMBOL_WIDEST[Et],mt=9-At,le=Vt.getRSSvalue(C,At,!0),Kt=Vt.getRSSvalue(M,mt,!1),Xi=dt.EVEN_TOTAL_SUBSET[Et],Cn=dt.GSUM[Et],Vi=le*Xi+Kt+Cn;return new Wt(Vi,st)}static isNotA1left(i,s,a){return!(i.getValue()==0&&s&&a)}adjustOddEvenCounts(i){let s=ee.sum(new Int32Array(this.getOddCounts())),a=ee.sum(new Int32Array(this.getEvenCounts())),h=!1,c=!1;s>13?c=!0:s<4&&(h=!0);let d=!1,m=!1;a>13?m=!0:a<4&&(d=!0);let _=s+a-i,C=(s&1)==1,M=(a&1)==0;if(_==1)if(C){if(M)throw new q;c=!0}else{if(!M)throw new q;m=!0}else if(_==-1)if(C){if(M)throw new q;h=!0}else{if(!M)throw new q;d=!0}else if(_==0){if(C){if(!M)throw new q;s<a?(h=!0,m=!0):(c=!0,d=!0)}else if(M)throw new q}else throw new q;if(h){if(c)throw new q;dt.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(c&&dt.decrement(this.getOddCounts(),this.getOddRoundingErrors()),d){if(m)throw new q;dt.increment(this.getEvenCounts(),this.getOddRoundingErrors())}m&&dt.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}dt.SYMBOL_WIDEST=[7,5,4,3,1],dt.EVEN_TOTAL_SUBSET=[4,20,52,104,204],dt.GSUM=[0,348,1388,2948,3988],dt.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],dt.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],dt.FINDER_PAT_A=0,dt.FINDER_PAT_B=1,dt.FINDER_PAT_C=2,dt.FINDER_PAT_D=3,dt.FINDER_PAT_E=4,dt.FINDER_PAT_F=5,dt.FINDER_PATTERN_SEQUENCES=[[dt.FINDER_PAT_A,dt.FINDER_PAT_A],[dt.FINDER_PAT_A,dt.FINDER_PAT_B,dt.FINDER_PAT_B],[dt.FINDER_PAT_A,dt.FINDER_PAT_C,dt.FINDER_PAT_B,dt.FINDER_PAT_D],[dt.FINDER_PAT_A,dt.FINDER_PAT_E,dt.FINDER_PAT_B,dt.FINDER_PAT_D,dt.FINDER_PAT_C],[dt.FINDER_PAT_A,dt.FINDER_PAT_E,dt.FINDER_PAT_B,dt.FINDER_PAT_D,dt.FINDER_PAT_D,dt.FINDER_PAT_F],[dt.FINDER_PAT_A,dt.FINDER_PAT_E,dt.FINDER_PAT_B,dt.FINDER_PAT_D,dt.FINDER_PAT_E,dt.FINDER_PAT_F,dt.FINDER_PAT_F],[dt.FINDER_PAT_A,dt.FINDER_PAT_A,dt.FINDER_PAT_B,dt.FINDER_PAT_B,dt.FINDER_PAT_C,dt.FINDER_PAT_C,dt.FINDER_PAT_D,dt.FINDER_PAT_D],[dt.FINDER_PAT_A,dt.FINDER_PAT_A,dt.FINDER_PAT_B,dt.FINDER_PAT_B,dt.FINDER_PAT_C,dt.FINDER_PAT_C,dt.FINDER_PAT_D,dt.FINDER_PAT_E,dt.FINDER_PAT_E],[dt.FINDER_PAT_A,dt.FINDER_PAT_A,dt.FINDER_PAT_B,dt.FINDER_PAT_B,dt.FINDER_PAT_C,dt.FINDER_PAT_C,dt.FINDER_PAT_D,dt.FINDER_PAT_E,dt.FINDER_PAT_F,dt.FINDER_PAT_F],[dt.FINDER_PAT_A,dt.FINDER_PAT_A,dt.FINDER_PAT_B,dt.FINDER_PAT_B,dt.FINDER_PAT_C,dt.FINDER_PAT_D,dt.FINDER_PAT_D,dt.FINDER_PAT_E,dt.FINDER_PAT_E,dt.FINDER_PAT_F,dt.FINDER_PAT_F]],dt.MAX_PAIRS=11;class xl extends Wt{constructor(i,s,a){super(i,s),this.count=0,this.finderPattern=a}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class Ot extends ue{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(i,s,a){const h=this.decodePair(s,!1,i,a);Ot.addOrTally(this.possibleLeftPairs,h),s.reverse();let c=this.decodePair(s,!0,i,a);Ot.addOrTally(this.possibleRightPairs,c),s.reverse();for(let d of this.possibleLeftPairs)if(d.getCount()>1){for(let m of this.possibleRightPairs)if(m.getCount()>1&&Ot.checkChecksum(d,m))return Ot.constructResult(d,m)}throw new q}static addOrTally(i,s){if(s==null)return;let a=!1;for(let h of i)if(h.getValue()===s.getValue()){h.incrementCount(),a=!0;break}a||i.push(s)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(i,s){let a=4537077*i.getValue()+s.getValue(),h=new String(a).toString(),c=new ut;for(let C=13-h.length;C>0;C--)c.append("0");c.append(h);let d=0;for(let C=0;C<13;C++){let M=c.charAt(C).charCodeAt(0)-48;d+=C&1?M:3*M}d=10-d%10,d===10&&(d=0),c.append(d.toString());let m=i.getFinderPattern().getResultPoints(),_=s.getFinderPattern().getResultPoints();return new gt(c.toString(),null,0,[m[0],m[1],_[0],_[1]],Rt.RSS_14,new Date().getTime())}static checkChecksum(i,s){let a=(i.getChecksumPortion()+16*s.getChecksumPortion())%79,h=9*i.getFinderPattern().getValue()+s.getFinderPattern().getValue();return h>72&&h--,h>8&&h--,a===h}decodePair(i,s,a,h){try{let c=this.findFinderPattern(i,s),d=this.parseFoundFinderPattern(i,a,s,c),m=h==null?null:h.get(ot.NEED_RESULT_POINT_CALLBACK);if(m!=null){let M=(c[0]+c[1])/2;s&&(M=i.getSize()-1-M),m.foundPossibleResultPoint(new St(M,a))}let _=this.decodeDataCharacter(i,d,!0),C=this.decodeDataCharacter(i,d,!1);return new xl(1597*_.getValue()+C.getValue(),_.getChecksumPortion()+4*C.getChecksumPortion(),d)}catch{return null}}decodeDataCharacter(i,s,a){let h=this.getDataCharacterCounters();for(let tt=0;tt<h.length;tt++)h[tt]=0;if(a)Ae.recordPatternInReverse(i,s.getStartEnd()[0],h);else{Ae.recordPattern(i,s.getStartEnd()[1]+1,h);for(let tt=0,st=h.length-1;tt<st;tt++,st--){let Et=h[tt];h[tt]=h[st],h[st]=Et}}let c=a?16:15,d=ee.sum(new Int32Array(h))/c,m=this.getOddCounts(),_=this.getEvenCounts(),C=this.getOddRoundingErrors(),M=this.getEvenRoundingErrors();for(let tt=0;tt<h.length;tt++){let st=h[tt]/d,Et=Math.floor(st+.5);Et<1?Et=1:Et>8&&(Et=8);let At=Math.floor(tt/2);tt&1?(_[At]=Et,M[At]=st-Et):(m[At]=Et,C[At]=st-Et)}this.adjustOddEvenCounts(a,c);let R=0,D=0;for(let tt=m.length-1;tt>=0;tt--)D*=9,D+=m[tt],R+=m[tt];let k=0,j=0;for(let tt=_.length-1;tt>=0;tt--)k*=9,k+=_[tt],j+=_[tt];let K=D+3*k;if(a){if(R&1||R>12||R<4)throw new q;let tt=(12-R)/2,st=Ot.OUTSIDE_ODD_WIDEST[tt],Et=9-st,At=Vt.getRSSvalue(m,st,!1),mt=Vt.getRSSvalue(_,Et,!0),le=Ot.OUTSIDE_EVEN_TOTAL_SUBSET[tt],Kt=Ot.OUTSIDE_GSUM[tt];return new Wt(At*le+mt+Kt,K)}else{if(j&1||j>10||j<4)throw new q;let tt=(10-j)/2,st=Ot.INSIDE_ODD_WIDEST[tt],Et=9-st,At=Vt.getRSSvalue(m,st,!0),mt=Vt.getRSSvalue(_,Et,!1),le=Ot.INSIDE_ODD_TOTAL_SUBSET[tt],Kt=Ot.INSIDE_GSUM[tt];return new Wt(mt*le+At+Kt,K)}}findFinderPattern(i,s){let a=this.getDecodeFinderCounters();a[0]=0,a[1]=0,a[2]=0,a[3]=0;let h=i.getSize(),c=!1,d=0;for(;d<h&&(c=!i.get(d),s!==c);)d++;let m=0,_=d;for(let C=d;C<h;C++)if(i.get(C)!==c)a[m]++;else{if(m===3){if(ue.isFinderPattern(a))return[_,C];_+=a[0]+a[1],a[0]=a[2],a[1]=a[3],a[2]=0,a[3]=0,m--}else m++;a[m]=1,c=!c}throw new q}parseFoundFinderPattern(i,s,a,h){let c=i.get(h[0]),d=h[0]-1;for(;d>=0&&c!==i.get(d);)d--;d++;const m=h[0]-d,_=this.getDecodeFinderCounters(),C=new Int32Array(_.length);F.arraycopy(_,0,C,1,_.length-1),C[0]=m;const M=this.parseFinderValue(C,Ot.FINDER_PATTERNS);let R=d,D=h[1];return a&&(R=i.getSize()-1-R,D=i.getSize()-1-D),new si(M,[d,h[1]],R,D,s)}adjustOddEvenCounts(i,s){let a=ee.sum(new Int32Array(this.getOddCounts())),h=ee.sum(new Int32Array(this.getEvenCounts())),c=!1,d=!1,m=!1,_=!1;i?(a>12?d=!0:a<4&&(c=!0),h>12?_=!0:h<4&&(m=!0)):(a>11?d=!0:a<5&&(c=!0),h>10?_=!0:h<4&&(m=!0));let C=a+h-s,M=(a&1)===(i?1:0),R=(h&1)===1;if(C===1)if(M){if(R)throw new q;d=!0}else{if(!R)throw new q;_=!0}else if(C===-1)if(M){if(R)throw new q;c=!0}else{if(!R)throw new q;m=!0}else if(C===0){if(M){if(!R)throw new q;a<h?(c=!0,_=!0):(d=!0,m=!0)}else if(R)throw new q}else throw new q;if(c){if(d)throw new q;ue.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(d&&ue.decrement(this.getOddCounts(),this.getOddRoundingErrors()),m){if(_)throw new q;ue.increment(this.getEvenCounts(),this.getOddRoundingErrors())}_&&ue.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Ot.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],Ot.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],Ot.OUTSIDE_GSUM=[0,161,961,2015,2715],Ot.INSIDE_GSUM=[0,336,1036,1516],Ot.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],Ot.INSIDE_ODD_WIDEST=[2,4,6,8],Ot.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class _s extends Ae{constructor(i,s){super(),this.readers=[],this.verbose=s===!0;const a=i?i.get(ot.POSSIBLE_FORMATS):null,h=i&&i.get(ot.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;a?((a.includes(Rt.EAN_13)||a.includes(Rt.UPC_A)||a.includes(Rt.EAN_8)||a.includes(Rt.UPC_E))&&this.readers.push(new fe(i)),a.includes(Rt.CODE_39)&&this.readers.push(new Te(h)),a.includes(Rt.CODE_128)&&this.readers.push(new It),a.includes(Rt.ITF)&&this.readers.push(new se),a.includes(Rt.RSS_14)&&this.readers.push(new Ot),a.includes(Rt.RSS_EXPANDED)&&this.readers.push(new dt(this.verbose))):(this.readers.push(new fe(i)),this.readers.push(new Te),this.readers.push(new fe(i)),this.readers.push(new It),this.readers.push(new se),this.readers.push(new Ot),this.readers.push(new dt(this.verbose)))}decodeRow(i,s,a){for(let h=0;h<this.readers.length;h++)try{return this.readers[h].decodeRow(i,s,a)}catch{}throw new q}reset(){this.readers.forEach(i=>i.reset())}}class ri extends te{constructor(i=500,s){super(new _s(s),i,s)}}class me{constructor(i,s,a){this.ecCodewords=i,this.ecBlocks=[s],a&&this.ecBlocks.push(a)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class xe{constructor(i,s){this.count=i,this.dataCodewords=s}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class re{constructor(i,s,a,h,c,d){this.versionNumber=i,this.symbolSizeRows=s,this.symbolSizeColumns=a,this.dataRegionSizeRows=h,this.dataRegionSizeColumns=c,this.ecBlocks=d;let m=0;const _=d.getECCodewords(),C=d.getECBlocks();for(let M of C)m+=M.getCount()*(M.getDataCodewords()+_);this.totalCodewords=m}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(i,s){if(i&1||s&1)throw new X;for(let a of re.VERSIONS)if(a.symbolSizeRows===i&&a.symbolSizeColumns===s)return a;throw new X}toString(){return""+this.versionNumber}static buildVersions(){return[new re(1,10,10,8,8,new me(5,new xe(1,3))),new re(2,12,12,10,10,new me(7,new xe(1,5))),new re(3,14,14,12,12,new me(10,new xe(1,8))),new re(4,16,16,14,14,new me(12,new xe(1,12))),new re(5,18,18,16,16,new me(14,new xe(1,18))),new re(6,20,20,18,18,new me(18,new xe(1,22))),new re(7,22,22,20,20,new me(20,new xe(1,30))),new re(8,24,24,22,22,new me(24,new xe(1,36))),new re(9,26,26,24,24,new me(28,new xe(1,44))),new re(10,32,32,14,14,new me(36,new xe(1,62))),new re(11,36,36,16,16,new me(42,new xe(1,86))),new re(12,40,40,18,18,new me(48,new xe(1,114))),new re(13,44,44,20,20,new me(56,new xe(1,144))),new re(14,48,48,22,22,new me(68,new xe(1,174))),new re(15,52,52,24,24,new me(42,new xe(2,102))),new re(16,64,64,14,14,new me(56,new xe(2,140))),new re(17,72,72,16,16,new me(36,new xe(4,92))),new re(18,80,80,18,18,new me(48,new xe(4,114))),new re(19,88,88,20,20,new me(56,new xe(4,144))),new re(20,96,96,22,22,new me(68,new xe(4,174))),new re(21,104,104,24,24,new me(56,new xe(6,136))),new re(22,120,120,18,18,new me(68,new xe(6,175))),new re(23,132,132,20,20,new me(62,new xe(8,163))),new re(24,144,144,22,22,new me(62,new xe(8,156),new xe(2,155))),new re(25,8,18,6,16,new me(7,new xe(1,5))),new re(26,8,32,6,14,new me(11,new xe(1,10))),new re(27,12,26,10,24,new me(14,new xe(1,16))),new re(28,12,36,10,16,new me(18,new xe(1,22))),new re(29,16,36,14,16,new me(24,new xe(1,32))),new re(30,16,48,14,22,new me(28,new xe(1,49)))]}}re.VERSIONS=re.buildVersions();class fr{constructor(i){const s=i.getHeight();if(s<8||s>144||s&1)throw new X;this.version=fr.readVersion(i),this.mappingBitMatrix=this.extractDataRegion(i),this.readMappingMatrix=new pt(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(i){const s=i.getHeight(),a=i.getWidth();return re.getVersionForDimensions(s,a)}readCodewords(){const i=new Int8Array(this.version.getTotalCodewords());let s=0,a=4,h=0;const c=this.mappingBitMatrix.getHeight(),d=this.mappingBitMatrix.getWidth();let m=!1,_=!1,C=!1,M=!1;do if(a===c&&h===0&&!m)i[s++]=this.readCorner1(c,d)&255,a-=2,h+=2,m=!0;else if(a===c-2&&h===0&&d&3&&!_)i[s++]=this.readCorner2(c,d)&255,a-=2,h+=2,_=!0;else if(a===c+4&&h===2&&!(d&7)&&!C)i[s++]=this.readCorner3(c,d)&255,a-=2,h+=2,C=!0;else if(a===c-2&&h===0&&(d&7)===4&&!M)i[s++]=this.readCorner4(c,d)&255,a-=2,h+=2,M=!0;else{do a<c&&h>=0&&!this.readMappingMatrix.get(h,a)&&(i[s++]=this.readUtah(a,h,c,d)&255),a-=2,h+=2;while(a>=0&&h<d);a+=1,h+=3;do a>=0&&h<d&&!this.readMappingMatrix.get(h,a)&&(i[s++]=this.readUtah(a,h,c,d)&255),a+=2,h-=2;while(a<c&&h>=0);a+=3,h+=1}while(a<c||h<d);if(s!==this.version.getTotalCodewords())throw new X;return i}readModule(i,s,a,h){return i<0&&(i+=a,s+=4-(a+4&7)),s<0&&(s+=h,i+=4-(h+4&7)),this.readMappingMatrix.set(s,i),this.mappingBitMatrix.get(s,i)}readUtah(i,s,a,h){let c=0;return this.readModule(i-2,s-2,a,h)&&(c|=1),c<<=1,this.readModule(i-2,s-1,a,h)&&(c|=1),c<<=1,this.readModule(i-1,s-2,a,h)&&(c|=1),c<<=1,this.readModule(i-1,s-1,a,h)&&(c|=1),c<<=1,this.readModule(i-1,s,a,h)&&(c|=1),c<<=1,this.readModule(i,s-2,a,h)&&(c|=1),c<<=1,this.readModule(i,s-1,a,h)&&(c|=1),c<<=1,this.readModule(i,s,a,h)&&(c|=1),c}readCorner1(i,s){let a=0;return this.readModule(i-1,0,i,s)&&(a|=1),a<<=1,this.readModule(i-1,1,i,s)&&(a|=1),a<<=1,this.readModule(i-1,2,i,s)&&(a|=1),a<<=1,this.readModule(0,s-2,i,s)&&(a|=1),a<<=1,this.readModule(0,s-1,i,s)&&(a|=1),a<<=1,this.readModule(1,s-1,i,s)&&(a|=1),a<<=1,this.readModule(2,s-1,i,s)&&(a|=1),a<<=1,this.readModule(3,s-1,i,s)&&(a|=1),a}readCorner2(i,s){let a=0;return this.readModule(i-3,0,i,s)&&(a|=1),a<<=1,this.readModule(i-2,0,i,s)&&(a|=1),a<<=1,this.readModule(i-1,0,i,s)&&(a|=1),a<<=1,this.readModule(0,s-4,i,s)&&(a|=1),a<<=1,this.readModule(0,s-3,i,s)&&(a|=1),a<<=1,this.readModule(0,s-2,i,s)&&(a|=1),a<<=1,this.readModule(0,s-1,i,s)&&(a|=1),a<<=1,this.readModule(1,s-1,i,s)&&(a|=1),a}readCorner3(i,s){let a=0;return this.readModule(i-1,0,i,s)&&(a|=1),a<<=1,this.readModule(i-1,s-1,i,s)&&(a|=1),a<<=1,this.readModule(0,s-3,i,s)&&(a|=1),a<<=1,this.readModule(0,s-2,i,s)&&(a|=1),a<<=1,this.readModule(0,s-1,i,s)&&(a|=1),a<<=1,this.readModule(1,s-3,i,s)&&(a|=1),a<<=1,this.readModule(1,s-2,i,s)&&(a|=1),a<<=1,this.readModule(1,s-1,i,s)&&(a|=1),a}readCorner4(i,s){let a=0;return this.readModule(i-3,0,i,s)&&(a|=1),a<<=1,this.readModule(i-2,0,i,s)&&(a|=1),a<<=1,this.readModule(i-1,0,i,s)&&(a|=1),a<<=1,this.readModule(0,s-2,i,s)&&(a|=1),a<<=1,this.readModule(0,s-1,i,s)&&(a|=1),a<<=1,this.readModule(1,s-1,i,s)&&(a|=1),a<<=1,this.readModule(2,s-1,i,s)&&(a|=1),a<<=1,this.readModule(3,s-1,i,s)&&(a|=1),a}extractDataRegion(i){const s=this.version.getSymbolSizeRows(),a=this.version.getSymbolSizeColumns();if(i.getHeight()!==s)throw new A("Dimension of bitMatrix must match the version size");const h=this.version.getDataRegionSizeRows(),c=this.version.getDataRegionSizeColumns(),d=s/h|0,m=a/c|0,_=d*h,C=m*c,M=new pt(C,_);for(let R=0;R<d;++R){const D=R*h;for(let k=0;k<m;++k){const j=k*c;for(let K=0;K<h;++K){const tt=R*(h+2)+1+K,st=D+K;for(let Et=0;Et<c;++Et){const At=k*(c+2)+1+Et;if(i.get(At,tt)){const mt=j+Et;M.set(mt,st)}}}}}return M}}class Hr{constructor(i,s){this.numDataCodewords=i,this.codewords=s}static getDataBlocks(i,s){const a=s.getECBlocks();let h=0;const c=a.getECBlocks();for(let K of c)h+=K.getCount();const d=new Array(h);let m=0;for(let K of c)for(let tt=0;tt<K.getCount();tt++){const st=K.getDataCodewords(),Et=a.getECCodewords()+st;d[m++]=new Hr(st,new Uint8Array(Et))}const C=d[0].codewords.length-a.getECCodewords(),M=C-1;let R=0;for(let K=0;K<M;K++)for(let tt=0;tt<m;tt++)d[tt].codewords[K]=i[R++];const D=s.getVersionNumber()===24,k=D?8:m;for(let K=0;K<k;K++)d[K].codewords[C-1]=i[R++];const j=d[0].codewords.length;for(let K=C;K<j;K++)for(let tt=0;tt<m;tt++){const st=D?(tt+8)%m:tt,Et=D&&st>7?K-1:K;d[st].codewords[Et]=i[R++]}if(R!==i.length)throw new A;return d}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class dr{constructor(i){this.bytes=i,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(i){if(i<1||i>32||i>this.available())throw new A(""+i);let s=0,a=this.bitOffset,h=this.byteOffset;const c=this.bytes;if(a>0){const d=8-a,m=i<d?i:d,_=d-m,C=255>>8-m<<_;s=(c[h]&C)>>_,i-=m,a+=m,a===8&&(a=0,h++)}if(i>0){for(;i>=8;)s=s<<8|c[h]&255,h++,i-=8;if(i>0){const d=8-i,m=255>>d<<d;s=s<<i|(c[h]&m)>>d,a+=i}}return this.bitOffset=a,this.byteOffset=h,s}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Je;(function(T){T[T.PAD_ENCODE=0]="PAD_ENCODE",T[T.ASCII_ENCODE=1]="ASCII_ENCODE",T[T.C40_ENCODE=2]="C40_ENCODE",T[T.TEXT_ENCODE=3]="TEXT_ENCODE",T[T.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",T[T.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",T[T.BASE256_ENCODE=6]="BASE256_ENCODE"})(Je||(Je={}));class _n{static decode(i){const s=new dr(i),a=new ut,h=new ut,c=new Array;let d=Je.ASCII_ENCODE;do if(d===Je.ASCII_ENCODE)d=this.decodeAsciiSegment(s,a,h);else{switch(d){case Je.C40_ENCODE:this.decodeC40Segment(s,a);break;case Je.TEXT_ENCODE:this.decodeTextSegment(s,a);break;case Je.ANSIX12_ENCODE:this.decodeAnsiX12Segment(s,a);break;case Je.EDIFACT_ENCODE:this.decodeEdifactSegment(s,a);break;case Je.BASE256_ENCODE:this.decodeBase256Segment(s,a,c);break;default:throw new X}d=Je.ASCII_ENCODE}while(d!==Je.PAD_ENCODE&&s.available()>0);return h.length()>0&&a.append(h.toString()),new mi(i,a.toString(),c.length===0?null:c,null)}static decodeAsciiSegment(i,s,a){let h=!1;do{let c=i.readBits(8);if(c===0)throw new X;if(c<=128)return h&&(c+=128),s.append(String.fromCharCode(c-1)),Je.ASCII_ENCODE;if(c===129)return Je.PAD_ENCODE;if(c<=229){const d=c-130;d<10&&s.append("0"),s.append(""+d)}else switch(c){case 230:return Je.C40_ENCODE;case 231:return Je.BASE256_ENCODE;case 232:s.append("");break;case 233:case 234:break;case 235:h=!0;break;case 236:s.append("[)>05"),a.insert(0,"");break;case 237:s.append("[)>06"),a.insert(0,"");break;case 238:return Je.ANSIX12_ENCODE;case 239:return Je.TEXT_ENCODE;case 240:return Je.EDIFACT_ENCODE;case 241:break;default:if(c!==254||i.available()!==0)throw new X;break}}while(i.available()>0);return Je.ASCII_ENCODE}static decodeC40Segment(i,s){let a=!1;const h=[];let c=0;do{if(i.available()===8)return;const d=i.readBits(8);if(d===254)return;this.parseTwoBytes(d,i.readBits(8),h);for(let m=0;m<3;m++){const _=h[m];switch(c){case 0:if(_<3)c=_+1;else if(_<this.C40_BASIC_SET_CHARS.length){const C=this.C40_BASIC_SET_CHARS[_];a?(s.append(String.fromCharCode(C.charCodeAt(0)+128)),a=!1):s.append(C)}else throw new X;break;case 1:a?(s.append(String.fromCharCode(_+128)),a=!1):s.append(String.fromCharCode(_)),c=0;break;case 2:if(_<this.C40_SHIFT2_SET_CHARS.length){const C=this.C40_SHIFT2_SET_CHARS[_];a?(s.append(String.fromCharCode(C.charCodeAt(0)+128)),a=!1):s.append(C)}else switch(_){case 27:s.append("");break;case 30:a=!0;break;default:throw new X}c=0;break;case 3:a?(s.append(String.fromCharCode(_+224)),a=!1):s.append(String.fromCharCode(_+96)),c=0;break;default:throw new X}}}while(i.available()>0)}static decodeTextSegment(i,s){let a=!1,h=[],c=0;do{if(i.available()===8)return;const d=i.readBits(8);if(d===254)return;this.parseTwoBytes(d,i.readBits(8),h);for(let m=0;m<3;m++){const _=h[m];switch(c){case 0:if(_<3)c=_+1;else if(_<this.TEXT_BASIC_SET_CHARS.length){const C=this.TEXT_BASIC_SET_CHARS[_];a?(s.append(String.fromCharCode(C.charCodeAt(0)+128)),a=!1):s.append(C)}else throw new X;break;case 1:a?(s.append(String.fromCharCode(_+128)),a=!1):s.append(String.fromCharCode(_)),c=0;break;case 2:if(_<this.TEXT_SHIFT2_SET_CHARS.length){const C=this.TEXT_SHIFT2_SET_CHARS[_];a?(s.append(String.fromCharCode(C.charCodeAt(0)+128)),a=!1):s.append(C)}else switch(_){case 27:s.append("");break;case 30:a=!0;break;default:throw new X}c=0;break;case 3:if(_<this.TEXT_SHIFT3_SET_CHARS.length){const C=this.TEXT_SHIFT3_SET_CHARS[_];a?(s.append(String.fromCharCode(C.charCodeAt(0)+128)),a=!1):s.append(C),c=0}else throw new X;break;default:throw new X}}}while(i.available()>0)}static decodeAnsiX12Segment(i,s){const a=[];do{if(i.available()===8)return;const h=i.readBits(8);if(h===254)return;this.parseTwoBytes(h,i.readBits(8),a);for(let c=0;c<3;c++){const d=a[c];switch(d){case 0:s.append("\r");break;case 1:s.append("*");break;case 2:s.append(">");break;case 3:s.append(" ");break;default:if(d<14)s.append(String.fromCharCode(d+44));else if(d<40)s.append(String.fromCharCode(d+51));else throw new X;break}}}while(i.available()>0)}static parseTwoBytes(i,s,a){let h=(i<<8)+s-1,c=Math.floor(h/1600);a[0]=c,h-=c*1600,c=Math.floor(h/40),a[1]=c,a[2]=h-c*40}static decodeEdifactSegment(i,s){do{if(i.available()<=16)return;for(let a=0;a<4;a++){let h=i.readBits(6);if(h===31){const c=8-i.getBitOffset();c!==8&&i.readBits(c);return}h&32||(h|=64),s.append(String.fromCharCode(h))}}while(i.available()>0)}static decodeBase256Segment(i,s,a){let h=1+i.getByteOffset();const c=this.unrandomize255State(i.readBits(8),h++);let d;if(c===0?d=i.available()/8|0:c<250?d=c:d=250*(c-249)+this.unrandomize255State(i.readBits(8),h++),d<0)throw new X;const m=new Uint8Array(d);for(let _=0;_<d;_++){if(i.available()<8)throw new X;m[_]=this.unrandomize255State(i.readBits(8),h++)}a.push(m);try{s.append(xt.decode(m,at.ISO88591))}catch(_){throw new hi("Platform does not support required encoding: "+_.message)}}static unrandomize255State(i,s){const a=149*s%255+1,h=i-a;return h>=0?h:h+256}}_n.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],_n.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],_n.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],_n.TEXT_SHIFT2_SET_CHARS=_n.C40_SHIFT2_SET_CHARS,_n.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class Ho{constructor(){this.rsDecoder=new Ei(ne.DATA_MATRIX_FIELD_256)}decode(i){const s=new fr(i),a=s.getVersion(),h=s.readCodewords(),c=Hr.getDataBlocks(h,a);let d=0;for(let C of c)d+=C.getNumDataCodewords();const m=new Uint8Array(d),_=c.length;for(let C=0;C<_;C++){const M=c[C],R=M.getCodewords(),D=M.getNumDataCodewords();this.correctErrors(R,D);for(let k=0;k<D;k++)m[k*_+C]=R[k]}return _n.decode(m)}correctErrors(i,s){const a=new Int32Array(i);try{this.rsDecoder.decode(a,i.length-s)}catch{throw new P}for(let h=0;h<s;h++)i[h]=a[h]}}class Oe{constructor(i){this.image=i,this.rectangleDetector=new ci(this.image)}detect(){const i=this.rectangleDetector.detect();let s=this.detectSolid1(i);if(s=this.detectSolid2(s),s[3]=this.correctTopRight(s),!s[3])throw new q;s=this.shiftToModuleCenter(s);const a=s[0],h=s[1],c=s[2],d=s[3];let m=this.transitionsBetween(a,d)+1,_=this.transitionsBetween(c,d)+1;(m&1)===1&&(m+=1),(_&1)===1&&(_+=1),4*m<7*_&&4*_<7*m&&(m=_=Math.max(m,_));let C=Oe.sampleGrid(this.image,a,h,c,d,m,_);return new Ci(C,[a,h,c,d])}static shiftPoint(i,s,a){let h=(s.getX()-i.getX())/(a+1),c=(s.getY()-i.getY())/(a+1);return new St(i.getX()+h,i.getY()+c)}static moveAway(i,s,a){let h=i.getX(),c=i.getY();return h<s?h-=1:h+=1,c<a?c-=1:c+=1,new St(h,c)}detectSolid1(i){let s=i[0],a=i[1],h=i[3],c=i[2],d=this.transitionsBetween(s,a),m=this.transitionsBetween(a,h),_=this.transitionsBetween(h,c),C=this.transitionsBetween(c,s),M=d,R=[c,s,a,h];return M>m&&(M=m,R[0]=s,R[1]=a,R[2]=h,R[3]=c),M>_&&(M=_,R[0]=a,R[1]=h,R[2]=c,R[3]=s),M>C&&(R[0]=h,R[1]=c,R[2]=s,R[3]=a),R}detectSolid2(i){let s=i[0],a=i[1],h=i[2],c=i[3],d=this.transitionsBetween(s,c),m=Oe.shiftPoint(a,h,(d+1)*4),_=Oe.shiftPoint(h,a,(d+1)*4),C=this.transitionsBetween(m,s),M=this.transitionsBetween(_,c);return C<M?(i[0]=s,i[1]=a,i[2]=h,i[3]=c):(i[0]=a,i[1]=h,i[2]=c,i[3]=s),i}correctTopRight(i){let s=i[0],a=i[1],h=i[2],c=i[3],d=this.transitionsBetween(s,c),m=this.transitionsBetween(a,c),_=Oe.shiftPoint(s,a,(m+1)*4),C=Oe.shiftPoint(h,a,(d+1)*4);d=this.transitionsBetween(_,c),m=this.transitionsBetween(C,c);let M=new St(c.getX()+(h.getX()-a.getX())/(d+1),c.getY()+(h.getY()-a.getY())/(d+1)),R=new St(c.getX()+(s.getX()-a.getX())/(m+1),c.getY()+(s.getY()-a.getY())/(m+1));if(!this.isValid(M))return this.isValid(R)?R:null;if(!this.isValid(R))return M;let D=this.transitionsBetween(_,M)+this.transitionsBetween(C,M),k=this.transitionsBetween(_,R)+this.transitionsBetween(C,R);return D>k?M:R}shiftToModuleCenter(i){let s=i[0],a=i[1],h=i[2],c=i[3],d=this.transitionsBetween(s,c)+1,m=this.transitionsBetween(h,c)+1,_=Oe.shiftPoint(s,a,m*4),C=Oe.shiftPoint(h,a,d*4);d=this.transitionsBetween(_,c)+1,m=this.transitionsBetween(C,c)+1,(d&1)===1&&(d+=1),(m&1)===1&&(m+=1);let M=(s.getX()+a.getX()+h.getX()+c.getX())/4,R=(s.getY()+a.getY()+h.getY()+c.getY())/4;s=Oe.moveAway(s,M,R),a=Oe.moveAway(a,M,R),h=Oe.moveAway(h,M,R),c=Oe.moveAway(c,M,R);let D,k;return _=Oe.shiftPoint(s,a,m*4),_=Oe.shiftPoint(_,c,d*4),D=Oe.shiftPoint(a,s,m*4),D=Oe.shiftPoint(D,h,d*4),C=Oe.shiftPoint(h,c,m*4),C=Oe.shiftPoint(C,a,d*4),k=Oe.shiftPoint(c,h,m*4),k=Oe.shiftPoint(k,s,d*4),[_,D,C,k]}isValid(i){return i.getX()>=0&&i.getX()<this.image.getWidth()&&i.getY()>0&&i.getY()<this.image.getHeight()}static sampleGrid(i,s,a,h,c,d,m){return qe.getInstance().sampleGrid(i,d,m,.5,.5,d-.5,.5,d-.5,m-.5,.5,m-.5,s.getX(),s.getY(),c.getX(),c.getY(),h.getX(),h.getY(),a.getX(),a.getY())}transitionsBetween(i,s){let a=Math.trunc(i.getX()),h=Math.trunc(i.getY()),c=Math.trunc(s.getX()),d=Math.trunc(s.getY()),m=Math.abs(d-h)>Math.abs(c-a);if(m){let K=a;a=h,h=K,K=c,c=d,d=K}let _=Math.abs(c-a),C=Math.abs(d-h),M=-_/2,R=h<d?1:-1,D=a<c?1:-1,k=0,j=this.image.get(m?h:a,m?a:h);for(let K=a,tt=h;K!==c;K+=D){let st=this.image.get(m?tt:K,m?K:tt);if(st!==j&&(k++,j=st),M+=C,M>0){if(tt===d)break;tt+=R,M-=_}}return k}}class He{constructor(){this.decoder=new Ho}decode(i,s=null){let a,h;if(s!=null&&s.has(ot.PURE_BARCODE)){const C=He.extractPureBits(i.getBlackMatrix());a=this.decoder.decode(C),h=He.NO_POINTS}else{const C=new Oe(i.getBlackMatrix()).detect();a=this.decoder.decode(C.getBits()),h=C.getPoints()}const c=a.getRawBytes(),d=new gt(a.getText(),c,8*c.length,h,Rt.DATA_MATRIX,F.currentTimeMillis()),m=a.getByteSegments();m!=null&&d.putMetadata(ye.BYTE_SEGMENTS,m);const _=a.getECLevel();return _!=null&&d.putMetadata(ye.ERROR_CORRECTION_LEVEL,_),d}reset(){}static extractPureBits(i){const s=i.getTopLeftOnBit(),a=i.getBottomRightOnBit();if(s==null||a==null)throw new q;const h=this.moduleSize(s,i);let c=s[1];const d=a[1];let m=s[0];const C=(a[0]-m+1)/h,M=(d-c+1)/h;if(C<=0||M<=0)throw new q;const R=h/2;c+=R,m+=R;const D=new pt(C,M);for(let k=0;k<M;k++){const j=c+k*h;for(let K=0;K<C;K++)i.get(m+K*h,j)&&D.set(K,k)}return D}static moduleSize(i,s){const a=s.getWidth();let h=i[0];const c=i[1];for(;h<a&&s.get(h,c);)h++;if(h===a)throw new q;const d=h-i[0];if(d===0)throw new q;return d}}He.NO_POINTS=[];class zi extends te{constructor(i=500){super(new He,i)}}var cn;(function(T){T[T.L=0]="L",T[T.M=1]="M",T[T.Q=2]="Q",T[T.H=3]="H"})(cn||(cn={}));class Ee{constructor(i,s,a){this.value=i,this.stringValue=s,this.bits=a,Ee.FOR_BITS.set(a,this),Ee.FOR_VALUE.set(i,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(i){switch(i){case"L":return Ee.L;case"M":return Ee.M;case"Q":return Ee.Q;case"H":return Ee.H;default:throw new w(i+"not available")}}toString(){return this.stringValue}equals(i){if(!(i instanceof Ee))return!1;const s=i;return this.value===s.value}static forBits(i){if(i<0||i>=Ee.FOR_BITS.size)throw new A;return Ee.FOR_BITS.get(i)}}Ee.FOR_BITS=new Map,Ee.FOR_VALUE=new Map,Ee.L=new Ee(cn.L,"L",1),Ee.M=new Ee(cn.M,"M",0),Ee.Q=new Ee(cn.Q,"Q",3),Ee.H=new Ee(cn.H,"H",2);class pi{constructor(i){this.errorCorrectionLevel=Ee.forBits(i>>3&3),this.dataMask=i&7}static numBitsDiffering(i,s){return Y.bitCount(i^s)}static decodeFormatInformation(i,s){const a=pi.doDecodeFormatInformation(i,s);return a!==null?a:pi.doDecodeFormatInformation(i^pi.FORMAT_INFO_MASK_QR,s^pi.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(i,s){let a=Number.MAX_SAFE_INTEGER,h=0;for(const c of pi.FORMAT_INFO_DECODE_LOOKUP){const d=c[0];if(d===i||d===s)return new pi(c[1]);let m=pi.numBitsDiffering(i,d);m<a&&(h=c[1],a=m),i!==s&&(m=pi.numBitsDiffering(s,d),m<a&&(h=c[1],a=m))}return a<=3?new pi(h):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(i){if(!(i instanceof pi))return!1;const s=i;return this.errorCorrectionLevel===s.errorCorrectionLevel&&this.dataMask===s.dataMask}}pi.FORMAT_INFO_MASK_QR=21522,pi.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class et{constructor(i,...s){this.ecCodewordsPerBlock=i,this.ecBlocks=s}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let i=0;const s=this.ecBlocks;for(const a of s)i+=a.getCount();return i}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class B{constructor(i,s){this.count=i,this.dataCodewords=s}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Nt{constructor(i,s,...a){this.versionNumber=i,this.alignmentPatternCenters=s,this.ecBlocks=a;let h=0;const c=a[0].getECCodewordsPerBlock(),d=a[0].getECBlocks();for(const m of d)h+=m.getCount()*(m.getDataCodewords()+c);this.totalCodewords=h}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(i){return this.ecBlocks[i.getValue()]}static getProvisionalVersionForDimension(i){if(i%4!==1)throw new X;try{return this.getVersionForNumber((i-17)/4)}catch{throw new X}}static getVersionForNumber(i){if(i<1||i>40)throw new A;return Nt.VERSIONS[i-1]}static decodeVersionInformation(i){let s=Number.MAX_SAFE_INTEGER,a=0;for(let h=0;h<Nt.VERSION_DECODE_INFO.length;h++){const c=Nt.VERSION_DECODE_INFO[h];if(c===i)return Nt.getVersionForNumber(h+7);const d=pi.numBitsDiffering(i,c);d<s&&(a=h+7,s=d)}return s<=3?Nt.getVersionForNumber(a):null}buildFunctionPattern(){const i=this.getDimensionForVersion(),s=new pt(i);s.setRegion(0,0,9,9),s.setRegion(i-8,0,8,9),s.setRegion(0,i-8,9,8);const a=this.alignmentPatternCenters.length;for(let h=0;h<a;h++){const c=this.alignmentPatternCenters[h]-2;for(let d=0;d<a;d++)h===0&&(d===0||d===a-1)||h===a-1&&d===0||s.setRegion(this.alignmentPatternCenters[d]-2,c,5,5)}return s.setRegion(6,9,1,i-17),s.setRegion(9,6,i-17,1),this.versionNumber>6&&(s.setRegion(i-11,0,3,6),s.setRegion(0,i-11,6,3)),s}toString(){return""+this.versionNumber}}Nt.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Nt.VERSIONS=[new Nt(1,new Int32Array(0),new et(7,new B(1,19)),new et(10,new B(1,16)),new et(13,new B(1,13)),new et(17,new B(1,9))),new Nt(2,Int32Array.from([6,18]),new et(10,new B(1,34)),new et(16,new B(1,28)),new et(22,new B(1,22)),new et(28,new B(1,16))),new Nt(3,Int32Array.from([6,22]),new et(15,new B(1,55)),new et(26,new B(1,44)),new et(18,new B(2,17)),new et(22,new B(2,13))),new Nt(4,Int32Array.from([6,26]),new et(20,new B(1,80)),new et(18,new B(2,32)),new et(26,new B(2,24)),new et(16,new B(4,9))),new Nt(5,Int32Array.from([6,30]),new et(26,new B(1,108)),new et(24,new B(2,43)),new et(18,new B(2,15),new B(2,16)),new et(22,new B(2,11),new B(2,12))),new Nt(6,Int32Array.from([6,34]),new et(18,new B(2,68)),new et(16,new B(4,27)),new et(24,new B(4,19)),new et(28,new B(4,15))),new Nt(7,Int32Array.from([6,22,38]),new et(20,new B(2,78)),new et(18,new B(4,31)),new et(18,new B(2,14),new B(4,15)),new et(26,new B(4,13),new B(1,14))),new Nt(8,Int32Array.from([6,24,42]),new et(24,new B(2,97)),new et(22,new B(2,38),new B(2,39)),new et(22,new B(4,18),new B(2,19)),new et(26,new B(4,14),new B(2,15))),new Nt(9,Int32Array.from([6,26,46]),new et(30,new B(2,116)),new et(22,new B(3,36),new B(2,37)),new et(20,new B(4,16),new B(4,17)),new et(24,new B(4,12),new B(4,13))),new Nt(10,Int32Array.from([6,28,50]),new et(18,new B(2,68),new B(2,69)),new et(26,new B(4,43),new B(1,44)),new et(24,new B(6,19),new B(2,20)),new et(28,new B(6,15),new B(2,16))),new Nt(11,Int32Array.from([6,30,54]),new et(20,new B(4,81)),new et(30,new B(1,50),new B(4,51)),new et(28,new B(4,22),new B(4,23)),new et(24,new B(3,12),new B(8,13))),new Nt(12,Int32Array.from([6,32,58]),new et(24,new B(2,92),new B(2,93)),new et(22,new B(6,36),new B(2,37)),new et(26,new B(4,20),new B(6,21)),new et(28,new B(7,14),new B(4,15))),new Nt(13,Int32Array.from([6,34,62]),new et(26,new B(4,107)),new et(22,new B(8,37),new B(1,38)),new et(24,new B(8,20),new B(4,21)),new et(22,new B(12,11),new B(4,12))),new Nt(14,Int32Array.from([6,26,46,66]),new et(30,new B(3,115),new B(1,116)),new et(24,new B(4,40),new B(5,41)),new et(20,new B(11,16),new B(5,17)),new et(24,new B(11,12),new B(5,13))),new Nt(15,Int32Array.from([6,26,48,70]),new et(22,new B(5,87),new B(1,88)),new et(24,new B(5,41),new B(5,42)),new et(30,new B(5,24),new B(7,25)),new et(24,new B(11,12),new B(7,13))),new Nt(16,Int32Array.from([6,26,50,74]),new et(24,new B(5,98),new B(1,99)),new et(28,new B(7,45),new B(3,46)),new et(24,new B(15,19),new B(2,20)),new et(30,new B(3,15),new B(13,16))),new Nt(17,Int32Array.from([6,30,54,78]),new et(28,new B(1,107),new B(5,108)),new et(28,new B(10,46),new B(1,47)),new et(28,new B(1,22),new B(15,23)),new et(28,new B(2,14),new B(17,15))),new Nt(18,Int32Array.from([6,30,56,82]),new et(30,new B(5,120),new B(1,121)),new et(26,new B(9,43),new B(4,44)),new et(28,new B(17,22),new B(1,23)),new et(28,new B(2,14),new B(19,15))),new Nt(19,Int32Array.from([6,30,58,86]),new et(28,new B(3,113),new B(4,114)),new et(26,new B(3,44),new B(11,45)),new et(26,new B(17,21),new B(4,22)),new et(26,new B(9,13),new B(16,14))),new Nt(20,Int32Array.from([6,34,62,90]),new et(28,new B(3,107),new B(5,108)),new et(26,new B(3,41),new B(13,42)),new et(30,new B(15,24),new B(5,25)),new et(28,new B(15,15),new B(10,16))),new Nt(21,Int32Array.from([6,28,50,72,94]),new et(28,new B(4,116),new B(4,117)),new et(26,new B(17,42)),new et(28,new B(17,22),new B(6,23)),new et(30,new B(19,16),new B(6,17))),new Nt(22,Int32Array.from([6,26,50,74,98]),new et(28,new B(2,111),new B(7,112)),new et(28,new B(17,46)),new et(30,new B(7,24),new B(16,25)),new et(24,new B(34,13))),new Nt(23,Int32Array.from([6,30,54,78,102]),new et(30,new B(4,121),new B(5,122)),new et(28,new B(4,47),new B(14,48)),new et(30,new B(11,24),new B(14,25)),new et(30,new B(16,15),new B(14,16))),new Nt(24,Int32Array.from([6,28,54,80,106]),new et(30,new B(6,117),new B(4,118)),new et(28,new B(6,45),new B(14,46)),new et(30,new B(11,24),new B(16,25)),new et(30,new B(30,16),new B(2,17))),new Nt(25,Int32Array.from([6,32,58,84,110]),new et(26,new B(8,106),new B(4,107)),new et(28,new B(8,47),new B(13,48)),new et(30,new B(7,24),new B(22,25)),new et(30,new B(22,15),new B(13,16))),new Nt(26,Int32Array.from([6,30,58,86,114]),new et(28,new B(10,114),new B(2,115)),new et(28,new B(19,46),new B(4,47)),new et(28,new B(28,22),new B(6,23)),new et(30,new B(33,16),new B(4,17))),new Nt(27,Int32Array.from([6,34,62,90,118]),new et(30,new B(8,122),new B(4,123)),new et(28,new B(22,45),new B(3,46)),new et(30,new B(8,23),new B(26,24)),new et(30,new B(12,15),new B(28,16))),new Nt(28,Int32Array.from([6,26,50,74,98,122]),new et(30,new B(3,117),new B(10,118)),new et(28,new B(3,45),new B(23,46)),new et(30,new B(4,24),new B(31,25)),new et(30,new B(11,15),new B(31,16))),new Nt(29,Int32Array.from([6,30,54,78,102,126]),new et(30,new B(7,116),new B(7,117)),new et(28,new B(21,45),new B(7,46)),new et(30,new B(1,23),new B(37,24)),new et(30,new B(19,15),new B(26,16))),new Nt(30,Int32Array.from([6,26,52,78,104,130]),new et(30,new B(5,115),new B(10,116)),new et(28,new B(19,47),new B(10,48)),new et(30,new B(15,24),new B(25,25)),new et(30,new B(23,15),new B(25,16))),new Nt(31,Int32Array.from([6,30,56,82,108,134]),new et(30,new B(13,115),new B(3,116)),new et(28,new B(2,46),new B(29,47)),new et(30,new B(42,24),new B(1,25)),new et(30,new B(23,15),new B(28,16))),new Nt(32,Int32Array.from([6,34,60,86,112,138]),new et(30,new B(17,115)),new et(28,new B(10,46),new B(23,47)),new et(30,new B(10,24),new B(35,25)),new et(30,new B(19,15),new B(35,16))),new Nt(33,Int32Array.from([6,30,58,86,114,142]),new et(30,new B(17,115),new B(1,116)),new et(28,new B(14,46),new B(21,47)),new et(30,new B(29,24),new B(19,25)),new et(30,new B(11,15),new B(46,16))),new Nt(34,Int32Array.from([6,34,62,90,118,146]),new et(30,new B(13,115),new B(6,116)),new et(28,new B(14,46),new B(23,47)),new et(30,new B(44,24),new B(7,25)),new et(30,new B(59,16),new B(1,17))),new Nt(35,Int32Array.from([6,30,54,78,102,126,150]),new et(30,new B(12,121),new B(7,122)),new et(28,new B(12,47),new B(26,48)),new et(30,new B(39,24),new B(14,25)),new et(30,new B(22,15),new B(41,16))),new Nt(36,Int32Array.from([6,24,50,76,102,128,154]),new et(30,new B(6,121),new B(14,122)),new et(28,new B(6,47),new B(34,48)),new et(30,new B(46,24),new B(10,25)),new et(30,new B(2,15),new B(64,16))),new Nt(37,Int32Array.from([6,28,54,80,106,132,158]),new et(30,new B(17,122),new B(4,123)),new et(28,new B(29,46),new B(14,47)),new et(30,new B(49,24),new B(10,25)),new et(30,new B(24,15),new B(46,16))),new Nt(38,Int32Array.from([6,32,58,84,110,136,162]),new et(30,new B(4,122),new B(18,123)),new et(28,new B(13,46),new B(32,47)),new et(30,new B(48,24),new B(14,25)),new et(30,new B(42,15),new B(32,16))),new Nt(39,Int32Array.from([6,26,54,82,110,138,166]),new et(30,new B(20,117),new B(4,118)),new et(28,new B(40,47),new B(7,48)),new et(30,new B(43,24),new B(22,25)),new et(30,new B(10,15),new B(67,16))),new Nt(40,Int32Array.from([6,30,58,86,114,142,170]),new et(30,new B(19,118),new B(6,119)),new et(28,new B(18,47),new B(31,48)),new et(30,new B(34,24),new B(34,25)),new et(30,new B(20,15),new B(61,16)))];var oi;(function(T){T[T.DATA_MASK_000=0]="DATA_MASK_000",T[T.DATA_MASK_001=1]="DATA_MASK_001",T[T.DATA_MASK_010=2]="DATA_MASK_010",T[T.DATA_MASK_011=3]="DATA_MASK_011",T[T.DATA_MASK_100=4]="DATA_MASK_100",T[T.DATA_MASK_101=5]="DATA_MASK_101",T[T.DATA_MASK_110=6]="DATA_MASK_110",T[T.DATA_MASK_111=7]="DATA_MASK_111"})(oi||(oi={}));class Ii{constructor(i,s){this.value=i,this.isMasked=s}unmaskBitMatrix(i,s){for(let a=0;a<s;a++)for(let h=0;h<s;h++)this.isMasked(a,h)&&i.flip(h,a)}}Ii.values=new Map([[oi.DATA_MASK_000,new Ii(oi.DATA_MASK_000,(T,i)=>(T+i&1)===0)],[oi.DATA_MASK_001,new Ii(oi.DATA_MASK_001,(T,i)=>(T&1)===0)],[oi.DATA_MASK_010,new Ii(oi.DATA_MASK_010,(T,i)=>i%3===0)],[oi.DATA_MASK_011,new Ii(oi.DATA_MASK_011,(T,i)=>(T+i)%3===0)],[oi.DATA_MASK_100,new Ii(oi.DATA_MASK_100,(T,i)=>(Math.floor(T/2)+Math.floor(i/3)&1)===0)],[oi.DATA_MASK_101,new Ii(oi.DATA_MASK_101,(T,i)=>T*i%6===0)],[oi.DATA_MASK_110,new Ii(oi.DATA_MASK_110,(T,i)=>T*i%6<3)],[oi.DATA_MASK_111,new Ii(oi.DATA_MASK_111,(T,i)=>(T+i+T*i%3&1)===0)]]);class jo{constructor(i){const s=i.getHeight();if(s<21||(s&3)!==1)throw new X;this.bitMatrix=i}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let i=0;for(let c=0;c<6;c++)i=this.copyBit(c,8,i);i=this.copyBit(7,8,i),i=this.copyBit(8,8,i),i=this.copyBit(8,7,i);for(let c=5;c>=0;c--)i=this.copyBit(8,c,i);const s=this.bitMatrix.getHeight();let a=0;const h=s-7;for(let c=s-1;c>=h;c--)a=this.copyBit(8,c,a);for(let c=s-8;c<s;c++)a=this.copyBit(c,8,a);if(this.parsedFormatInfo=pi.decodeFormatInformation(i,a),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new X}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const i=this.bitMatrix.getHeight(),s=Math.floor((i-17)/4);if(s<=6)return Nt.getVersionForNumber(s);let a=0;const h=i-11;for(let d=5;d>=0;d--)for(let m=i-9;m>=h;m--)a=this.copyBit(m,d,a);let c=Nt.decodeVersionInformation(a);if(c!==null&&c.getDimensionForVersion()===i)return this.parsedVersion=c,c;a=0;for(let d=5;d>=0;d--)for(let m=i-9;m>=h;m--)a=this.copyBit(d,m,a);if(c=Nt.decodeVersionInformation(a),c!==null&&c.getDimensionForVersion()===i)return this.parsedVersion=c,c;throw new X}copyBit(i,s,a){return(this.isMirror?this.bitMatrix.get(s,i):this.bitMatrix.get(i,s))?a<<1|1:a<<1}readCodewords(){const i=this.readFormatInformation(),s=this.readVersion(),a=Ii.values.get(i.getDataMask()),h=this.bitMatrix.getHeight();a.unmaskBitMatrix(this.bitMatrix,h);const c=s.buildFunctionPattern();let d=!0;const m=new Uint8Array(s.getTotalCodewords());let _=0,C=0,M=0;for(let R=h-1;R>0;R-=2){R===6&&R--;for(let D=0;D<h;D++){const k=d?h-1-D:D;for(let j=0;j<2;j++)c.get(R-j,k)||(M++,C<<=1,this.bitMatrix.get(R-j,k)&&(C|=1),M===8&&(m[_++]=C,M=0,C=0))}d=!d}if(_!==s.getTotalCodewords())throw new X;return m}remask(){if(this.parsedFormatInfo===null)return;const i=Ii.values[this.parsedFormatInfo.getDataMask()],s=this.bitMatrix.getHeight();i.unmaskBitMatrix(this.bitMatrix,s)}setMirror(i){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=i}mirror(){const i=this.bitMatrix;for(let s=0,a=i.getWidth();s<a;s++)for(let h=s+1,c=i.getHeight();h<c;h++)i.get(s,h)!==i.get(h,s)&&(i.flip(h,s),i.flip(s,h))}}class Oi{constructor(i,s){this.numDataCodewords=i,this.codewords=s}static getDataBlocks(i,s,a){if(i.length!==s.getTotalCodewords())throw new A;const h=s.getECBlocksForLevel(a);let c=0;const d=h.getECBlocks();for(const j of d)c+=j.getCount();const m=new Array(c);let _=0;for(const j of d)for(let K=0;K<j.getCount();K++){const tt=j.getDataCodewords(),st=h.getECCodewordsPerBlock()+tt;m[_++]=new Oi(tt,new Uint8Array(st))}const C=m[0].codewords.length;let M=m.length-1;for(;M>=0&&m[M].codewords.length!==C;)M--;M++;const R=C-h.getECCodewordsPerBlock();let D=0;for(let j=0;j<R;j++)for(let K=0;K<_;K++)m[K].codewords[j]=i[D++];for(let j=M;j<_;j++)m[j].codewords[R]=i[D++];const k=m[0].codewords.length;for(let j=R;j<k;j++)for(let K=0;K<_;K++){const tt=K<M?j:j+1;m[K].codewords[tt]=i[D++]}return m}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var Wi;(function(T){T[T.TERMINATOR=0]="TERMINATOR",T[T.NUMERIC=1]="NUMERIC",T[T.ALPHANUMERIC=2]="ALPHANUMERIC",T[T.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",T[T.BYTE=4]="BYTE",T[T.ECI=5]="ECI",T[T.KANJI=6]="KANJI",T[T.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",T[T.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",T[T.HANZI=9]="HANZI"})(Wi||(Wi={}));class Dt{constructor(i,s,a,h){this.value=i,this.stringValue=s,this.characterCountBitsForVersions=a,this.bits=h,Dt.FOR_BITS.set(h,this),Dt.FOR_VALUE.set(i,this)}static forBits(i){const s=Dt.FOR_BITS.get(i);if(s===void 0)throw new A;return s}getCharacterCountBits(i){const s=i.getVersionNumber();let a;return s<=9?a=0:s<=26?a=1:a=2,this.characterCountBitsForVersions[a]}getValue(){return this.value}getBits(){return this.bits}equals(i){if(!(i instanceof Dt))return!1;const s=i;return this.value===s.value}toString(){return this.stringValue}}Dt.FOR_BITS=new Map,Dt.FOR_VALUE=new Map,Dt.TERMINATOR=new Dt(Wi.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Dt.NUMERIC=new Dt(Wi.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Dt.ALPHANUMERIC=new Dt(Wi.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Dt.STRUCTURED_APPEND=new Dt(Wi.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Dt.BYTE=new Dt(Wi.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Dt.ECI=new Dt(Wi.ECI,"ECI",Int32Array.from([0,0,0]),7),Dt.KANJI=new Dt(Wi.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Dt.FNC1_FIRST_POSITION=new Dt(Wi.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Dt.FNC1_SECOND_POSITION=new Dt(Wi.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Dt.HANZI=new Dt(Wi.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Pe{static decode(i,s,a,h){const c=new dr(i);let d=new ut;const m=new Array;let _=-1,C=-1;try{let M=null,R=!1,D;do{if(c.available()<4)D=Dt.TERMINATOR;else{const k=c.readBits(4);D=Dt.forBits(k)}switch(D){case Dt.TERMINATOR:break;case Dt.FNC1_FIRST_POSITION:case Dt.FNC1_SECOND_POSITION:R=!0;break;case Dt.STRUCTURED_APPEND:if(c.available()<16)throw new X;_=c.readBits(8),C=c.readBits(8);break;case Dt.ECI:const k=Pe.parseECIValue(c);if(M=H.getCharacterSetECIByValue(k),M===null)throw new X;break;case Dt.HANZI:const j=c.readBits(4),K=c.readBits(D.getCharacterCountBits(s));j===Pe.GB2312_SUBSET&&Pe.decodeHanziSegment(c,d,K);break;default:const tt=c.readBits(D.getCharacterCountBits(s));switch(D){case Dt.NUMERIC:Pe.decodeNumericSegment(c,d,tt);break;case Dt.ALPHANUMERIC:Pe.decodeAlphanumericSegment(c,d,tt,R);break;case Dt.BYTE:Pe.decodeByteSegment(c,d,tt,M,m,h);break;case Dt.KANJI:Pe.decodeKanjiSegment(c,d,tt);break;default:throw new X}break}}while(D!==Dt.TERMINATOR)}catch{throw new X}return new mi(i,d.toString(),m.length===0?null:m,a===null?null:a.toString(),_,C)}static decodeHanziSegment(i,s,a){if(a*13>i.available())throw new X;const h=new Uint8Array(2*a);let c=0;for(;a>0;){const d=i.readBits(13);let m=d/96<<8&4294967295|d%96;m<959?m+=41377:m+=42657,h[c]=m>>8&255,h[c+1]=m&255,c+=2,a--}try{s.append(xt.decode(h,at.GB2312))}catch(d){throw new X(d)}}static decodeKanjiSegment(i,s,a){if(a*13>i.available())throw new X;const h=new Uint8Array(2*a);let c=0;for(;a>0;){const d=i.readBits(13);let m=d/192<<8&4294967295|d%192;m<7936?m+=33088:m+=49472,h[c]=m>>8,h[c+1]=m,c+=2,a--}try{s.append(xt.decode(h,at.SHIFT_JIS))}catch(d){throw new X(d)}}static decodeByteSegment(i,s,a,h,c,d){if(8*a>i.available())throw new X;const m=new Uint8Array(a);for(let C=0;C<a;C++)m[C]=i.readBits(8);let _;h===null?_=at.guessEncoding(m,d):_=h.getName();try{s.append(xt.decode(m,_))}catch(C){throw new X(C)}c.push(m)}static toAlphaNumericChar(i){if(i>=Pe.ALPHANUMERIC_CHARS.length)throw new X;return Pe.ALPHANUMERIC_CHARS[i]}static decodeAlphanumericSegment(i,s,a,h){const c=s.length();for(;a>1;){if(i.available()<11)throw new X;const d=i.readBits(11);s.append(Pe.toAlphaNumericChar(Math.floor(d/45))),s.append(Pe.toAlphaNumericChar(d%45)),a-=2}if(a===1){if(i.available()<6)throw new X;s.append(Pe.toAlphaNumericChar(i.readBits(6)))}if(h)for(let d=c;d<s.length();d++)s.charAt(d)==="%"&&(d<s.length()-1&&s.charAt(d+1)==="%"?s.deleteCharAt(d+1):s.setCharAt(d,""))}static decodeNumericSegment(i,s,a){for(;a>=3;){if(i.available()<10)throw new X;const h=i.readBits(10);if(h>=1e3)throw new X;s.append(Pe.toAlphaNumericChar(Math.floor(h/100))),s.append(Pe.toAlphaNumericChar(Math.floor(h/10)%10)),s.append(Pe.toAlphaNumericChar(h%10)),a-=3}if(a===2){if(i.available()<7)throw new X;const h=i.readBits(7);if(h>=100)throw new X;s.append(Pe.toAlphaNumericChar(Math.floor(h/10))),s.append(Pe.toAlphaNumericChar(h%10))}else if(a===1){if(i.available()<4)throw new X;const h=i.readBits(4);if(h>=10)throw new X;s.append(Pe.toAlphaNumericChar(h))}}static parseECIValue(i){const s=i.readBits(8);if(!(s&128))return s&127;if((s&192)===128){const a=i.readBits(8);return(s&63)<<8&4294967295|a}if((s&224)===192){const a=i.readBits(16);return(s&31)<<16&4294967295|a}throw new X}}Pe.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Pe.GB2312_SUBSET=1;class Zo{constructor(i){this.mirrored=i}isMirrored(){return this.mirrored}applyMirroredCorrection(i){if(!this.mirrored||i===null||i.length<3)return;const s=i[0];i[0]=i[2],i[2]=s}}class _l{constructor(){this.rsDecoder=new Ei(ne.QR_CODE_FIELD_256)}decodeBooleanArray(i,s){return this.decodeBitMatrix(pt.parseFromBooleanArray(i),s)}decodeBitMatrix(i,s){const a=new jo(i);let h=null;try{return this.decodeBitMatrixParser(a,s)}catch(c){h=c}try{a.remask(),a.setMirror(!0),a.readVersion(),a.readFormatInformation(),a.mirror();const c=this.decodeBitMatrixParser(a,s);return c.setOther(new Zo(!0)),c}catch(c){throw h!==null?h:c}}decodeBitMatrixParser(i,s){const a=i.readVersion(),h=i.readFormatInformation().getErrorCorrectionLevel(),c=i.readCodewords(),d=Oi.getDataBlocks(c,a,h);let m=0;for(const M of d)m+=M.getNumDataCodewords();const _=new Uint8Array(m);let C=0;for(const M of d){const R=M.getCodewords(),D=M.getNumDataCodewords();this.correctErrors(R,D);for(let k=0;k<D;k++)_[C++]=R[k]}return Pe.decode(_,a,h,s)}correctErrors(i,s){const a=new Int32Array(i);try{this.rsDecoder.decode(a,i.length-s)}catch{throw new P}for(let h=0;h<s;h++)i[h]=a[h]}}class gr extends St{constructor(i,s,a){super(i,s),this.estimatedModuleSize=a}aboutEquals(i,s,a){if(Math.abs(s-this.getY())<=i&&Math.abs(a-this.getX())<=i){const h=Math.abs(i-this.estimatedModuleSize);return h<=1||h<=this.estimatedModuleSize}return!1}combineEstimate(i,s,a){const h=(this.getX()+s)/2,c=(this.getY()+i)/2,d=(this.estimatedModuleSize+a)/2;return new gr(h,c,d)}}class Yn{constructor(i,s,a,h,c,d,m){this.image=i,this.startX=s,this.startY=a,this.width=h,this.height=c,this.moduleSize=d,this.resultPointCallback=m,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const i=this.startX,s=this.height,a=this.width,h=i+a,c=this.startY+s/2,d=new Int32Array(3),m=this.image;for(let _=0;_<s;_++){const C=c+(_&1?-Math.floor((_+1)/2):Math.floor((_+1)/2));d[0]=0,d[1]=0,d[2]=0;let M=i;for(;M<h&&!m.get(M,C);)M++;let R=0;for(;M<h;){if(m.get(M,C))if(R===1)d[1]++;else if(R===2){if(this.foundPatternCross(d)){const D=this.handlePossibleCenter(d,C,M);if(D!==null)return D}d[0]=d[2],d[1]=1,d[2]=0,R=1}else d[++R]++;else R===1&&R++,d[R]++;M++}if(this.foundPatternCross(d)){const D=this.handlePossibleCenter(d,C,h);if(D!==null)return D}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new q}static centerFromEnd(i,s){return s-i[2]-i[1]/2}foundPatternCross(i){const s=this.moduleSize,a=s/2;for(let h=0;h<3;h++)if(Math.abs(s-i[h])>=a)return!1;return!0}crossCheckVertical(i,s,a,h){const c=this.image,d=c.getHeight(),m=this.crossCheckStateCount;m[0]=0,m[1]=0,m[2]=0;let _=i;for(;_>=0&&c.get(s,_)&&m[1]<=a;)m[1]++,_--;if(_<0||m[1]>a)return NaN;for(;_>=0&&!c.get(s,_)&&m[0]<=a;)m[0]++,_--;if(m[0]>a)return NaN;for(_=i+1;_<d&&c.get(s,_)&&m[1]<=a;)m[1]++,_++;if(_===d||m[1]>a)return NaN;for(;_<d&&!c.get(s,_)&&m[2]<=a;)m[2]++,_++;if(m[2]>a)return NaN;const C=m[0]+m[1]+m[2];return 5*Math.abs(C-h)>=2*h?NaN:this.foundPatternCross(m)?Yn.centerFromEnd(m,_):NaN}handlePossibleCenter(i,s,a){const h=i[0]+i[1]+i[2],c=Yn.centerFromEnd(i,a),d=this.crossCheckVertical(s,c,2*i[1],h);if(!isNaN(d)){const m=(i[0]+i[1]+i[2])/3;for(const C of this.possibleCenters)if(C.aboutEquals(m,d,c))return C.combineEstimate(d,c,m);const _=new gr(c,d,m);this.possibleCenters.push(_),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(_)}return null}}class jr extends St{constructor(i,s,a,h){super(i,s),this.estimatedModuleSize=a,this.count=h,h===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(i,s,a){if(Math.abs(s-this.getY())<=i&&Math.abs(a-this.getX())<=i){const h=Math.abs(i-this.estimatedModuleSize);return h<=1||h<=this.estimatedModuleSize}return!1}combineEstimate(i,s,a){const h=this.count+1,c=(this.count*this.getX()+s)/h,d=(this.count*this.getY()+i)/h,m=(this.count*this.estimatedModuleSize+a)/h;return new jr(c,d,m,h)}}class pl{constructor(i){this.bottomLeft=i[0],this.topLeft=i[1],this.topRight=i[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Qe{constructor(i,s){this.image=i,this.resultPointCallback=s,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=s}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(i){const s=i!=null&&i.get(ot.TRY_HARDER)!==void 0,a=i!=null&&i.get(ot.PURE_BARCODE)!==void 0,h=this.image,c=h.getHeight(),d=h.getWidth();let m=Math.floor(3*c/(4*Qe.MAX_MODULES));(m<Qe.MIN_SKIP||s)&&(m=Qe.MIN_SKIP);let _=!1;const C=new Int32Array(5);for(let R=m-1;R<c&&!_;R+=m){C[0]=0,C[1]=0,C[2]=0,C[3]=0,C[4]=0;let D=0;for(let k=0;k<d;k++)if(h.get(k,R))(D&1)===1&&D++,C[D]++;else if(D&1)C[D]++;else if(D===4)if(Qe.foundPatternCross(C)){if(this.handlePossibleCenter(C,R,k,a)===!0)if(m=2,this.hasSkipped===!0)_=this.haveMultiplyConfirmedCenters();else{const K=this.findRowSkip();K>C[2]&&(R+=K-C[2]-m,k=d-1)}else{C[0]=C[2],C[1]=C[3],C[2]=C[4],C[3]=1,C[4]=0,D=3;continue}D=0,C[0]=0,C[1]=0,C[2]=0,C[3]=0,C[4]=0}else C[0]=C[2],C[1]=C[3],C[2]=C[4],C[3]=1,C[4]=0,D=3;else C[++D]++;Qe.foundPatternCross(C)&&this.handlePossibleCenter(C,R,d,a)===!0&&(m=C[0],this.hasSkipped&&(_=this.haveMultiplyConfirmedCenters()))}const M=this.selectBestPatterns();return St.orderBestPatterns(M),new pl(M)}static centerFromEnd(i,s){return s-i[4]-i[3]-i[2]/2}static foundPatternCross(i){let s=0;for(let c=0;c<5;c++){const d=i[c];if(d===0)return!1;s+=d}if(s<7)return!1;const a=s/7,h=a/2;return Math.abs(a-i[0])<h&&Math.abs(a-i[1])<h&&Math.abs(3*a-i[2])<3*h&&Math.abs(a-i[3])<h&&Math.abs(a-i[4])<h}getCrossCheckStateCount(){const i=this.crossCheckStateCount;return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i}crossCheckDiagonal(i,s,a,h){const c=this.getCrossCheckStateCount();let d=0;const m=this.image;for(;i>=d&&s>=d&&m.get(s-d,i-d);)c[2]++,d++;if(i<d||s<d)return!1;for(;i>=d&&s>=d&&!m.get(s-d,i-d)&&c[1]<=a;)c[1]++,d++;if(i<d||s<d||c[1]>a)return!1;for(;i>=d&&s>=d&&m.get(s-d,i-d)&&c[0]<=a;)c[0]++,d++;if(c[0]>a)return!1;const _=m.getHeight(),C=m.getWidth();for(d=1;i+d<_&&s+d<C&&m.get(s+d,i+d);)c[2]++,d++;if(i+d>=_||s+d>=C)return!1;for(;i+d<_&&s+d<C&&!m.get(s+d,i+d)&&c[3]<a;)c[3]++,d++;if(i+d>=_||s+d>=C||c[3]>=a)return!1;for(;i+d<_&&s+d<C&&m.get(s+d,i+d)&&c[4]<a;)c[4]++,d++;if(c[4]>=a)return!1;const M=c[0]+c[1]+c[2]+c[3]+c[4];return Math.abs(M-h)<2*h&&Qe.foundPatternCross(c)}crossCheckVertical(i,s,a,h){const c=this.image,d=c.getHeight(),m=this.getCrossCheckStateCount();let _=i;for(;_>=0&&c.get(s,_);)m[2]++,_--;if(_<0)return NaN;for(;_>=0&&!c.get(s,_)&&m[1]<=a;)m[1]++,_--;if(_<0||m[1]>a)return NaN;for(;_>=0&&c.get(s,_)&&m[0]<=a;)m[0]++,_--;if(m[0]>a)return NaN;for(_=i+1;_<d&&c.get(s,_);)m[2]++,_++;if(_===d)return NaN;for(;_<d&&!c.get(s,_)&&m[3]<a;)m[3]++,_++;if(_===d||m[3]>=a)return NaN;for(;_<d&&c.get(s,_)&&m[4]<a;)m[4]++,_++;if(m[4]>=a)return NaN;const C=m[0]+m[1]+m[2]+m[3]+m[4];return 5*Math.abs(C-h)>=2*h?NaN:Qe.foundPatternCross(m)?Qe.centerFromEnd(m,_):NaN}crossCheckHorizontal(i,s,a,h){const c=this.image,d=c.getWidth(),m=this.getCrossCheckStateCount();let _=i;for(;_>=0&&c.get(_,s);)m[2]++,_--;if(_<0)return NaN;for(;_>=0&&!c.get(_,s)&&m[1]<=a;)m[1]++,_--;if(_<0||m[1]>a)return NaN;for(;_>=0&&c.get(_,s)&&m[0]<=a;)m[0]++,_--;if(m[0]>a)return NaN;for(_=i+1;_<d&&c.get(_,s);)m[2]++,_++;if(_===d)return NaN;for(;_<d&&!c.get(_,s)&&m[3]<a;)m[3]++,_++;if(_===d||m[3]>=a)return NaN;for(;_<d&&c.get(_,s)&&m[4]<a;)m[4]++,_++;if(m[4]>=a)return NaN;const C=m[0]+m[1]+m[2]+m[3]+m[4];return 5*Math.abs(C-h)>=h?NaN:Qe.foundPatternCross(m)?Qe.centerFromEnd(m,_):NaN}handlePossibleCenter(i,s,a,h){const c=i[0]+i[1]+i[2]+i[3]+i[4];let d=Qe.centerFromEnd(i,a),m=this.crossCheckVertical(s,Math.floor(d),i[2],c);if(!isNaN(m)&&(d=this.crossCheckHorizontal(Math.floor(d),Math.floor(m),i[2],c),!isNaN(d)&&(!h||this.crossCheckDiagonal(Math.floor(m),Math.floor(d),i[2],c)))){const _=c/7;let C=!1;const M=this.possibleCenters;for(let R=0,D=M.length;R<D;R++){const k=M[R];if(k.aboutEquals(_,m,d)){M[R]=k.combineEstimate(m,d,_),C=!0;break}}if(!C){const R=new jr(d,m,_);M.push(R),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(R)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let s=null;for(const a of this.possibleCenters)if(a.getCount()>=Qe.CENTER_QUORUM)if(s==null)s=a;else return this.hasSkipped=!0,Math.floor((Math.abs(s.getX()-a.getX())-Math.abs(s.getY()-a.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let i=0,s=0;const a=this.possibleCenters.length;for(const d of this.possibleCenters)d.getCount()>=Qe.CENTER_QUORUM&&(i++,s+=d.getEstimatedModuleSize());if(i<3)return!1;const h=s/a;let c=0;for(const d of this.possibleCenters)c+=Math.abs(d.getEstimatedModuleSize()-h);return c<=.05*s}selectBestPatterns(){const i=this.possibleCenters.length;if(i<3)throw new q;const s=this.possibleCenters;let a;if(i>3){let h=0,c=0;for(const _ of this.possibleCenters){const C=_.getEstimatedModuleSize();h+=C,c+=C*C}a=h/i;let d=Math.sqrt(c/i-a*a);s.sort((_,C)=>{const M=Math.abs(C.getEstimatedModuleSize()-a),R=Math.abs(_.getEstimatedModuleSize()-a);return M<R?-1:M>R?1:0});const m=Math.max(.2*a,d);for(let _=0;_<s.length&&s.length>3;_++){const C=s[_];Math.abs(C.getEstimatedModuleSize()-a)>m&&(s.splice(_,1),_--)}}if(s.length>3){let h=0;for(const c of s)h+=c.getEstimatedModuleSize();a=h/s.length,s.sort((c,d)=>{if(d.getCount()===c.getCount()){const m=Math.abs(d.getEstimatedModuleSize()-a),_=Math.abs(c.getEstimatedModuleSize()-a);return m<_?1:m>_?-1:0}else return d.getCount()-c.getCount()}),s.splice(3)}return[s[0],s[1],s[2]]}}Qe.CENTER_QUORUM=2,Qe.MIN_SKIP=3,Qe.MAX_MODULES=57;class Gs{constructor(i){this.image=i}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(i){this.resultPointCallback=i==null?null:i.get(ot.NEED_RESULT_POINT_CALLBACK);const a=new Qe(this.image,this.resultPointCallback).find(i);return this.processFinderPatternInfo(a)}processFinderPatternInfo(i){const s=i.getTopLeft(),a=i.getTopRight(),h=i.getBottomLeft(),c=this.calculateModuleSize(s,a,h);if(c<1)throw new q("No pattern found in proccess finder.");const d=Gs.computeDimension(s,a,h,c),m=Nt.getProvisionalVersionForDimension(d),_=m.getDimensionForVersion()-7;let C=null;if(m.getAlignmentPatternCenters().length>0){const k=a.getX()-s.getX()+h.getX(),j=a.getY()-s.getY()+h.getY(),K=1-3/_,tt=Math.floor(s.getX()+K*(k-s.getX())),st=Math.floor(s.getY()+K*(j-s.getY()));for(let Et=4;Et<=16;Et<<=1)try{C=this.findAlignmentInRegion(c,tt,st,Et);break}catch(At){if(!(At instanceof q))throw At}}const M=Gs.createTransform(s,a,h,C,d),R=Gs.sampleGrid(this.image,M,d);let D;return C===null?D=[h,s,a]:D=[h,s,a,C],new Ci(R,D)}static createTransform(i,s,a,h,c){const d=c-3.5;let m,_,C,M;return h!==null?(m=h.getX(),_=h.getY(),C=d-3,M=C):(m=s.getX()-i.getX()+a.getX(),_=s.getY()-i.getY()+a.getY(),C=d,M=d),ni.quadrilateralToQuadrilateral(3.5,3.5,d,3.5,C,M,3.5,d,i.getX(),i.getY(),s.getX(),s.getY(),m,_,a.getX(),a.getY())}static sampleGrid(i,s,a){return qe.getInstance().sampleGridWithTransform(i,a,a,s)}static computeDimension(i,s,a,h){const c=ee.round(St.distance(i,s)/h),d=ee.round(St.distance(i,a)/h);let m=Math.floor((c+d)/2)+7;switch(m&3){case 0:m++;break;case 2:m--;break;case 3:throw new q("Dimensions could be not found.")}return m}calculateModuleSize(i,s,a){return(this.calculateModuleSizeOneWay(i,s)+this.calculateModuleSizeOneWay(i,a))/2}calculateModuleSizeOneWay(i,s){const a=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(i.getX()),Math.floor(i.getY()),Math.floor(s.getX()),Math.floor(s.getY())),h=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(s.getX()),Math.floor(s.getY()),Math.floor(i.getX()),Math.floor(i.getY()));return isNaN(a)?h/7:isNaN(h)?a/7:(a+h)/14}sizeOfBlackWhiteBlackRunBothWays(i,s,a,h){let c=this.sizeOfBlackWhiteBlackRun(i,s,a,h),d=1,m=i-(a-i);m<0?(d=i/(i-m),m=0):m>=this.image.getWidth()&&(d=(this.image.getWidth()-1-i)/(m-i),m=this.image.getWidth()-1);let _=Math.floor(s-(h-s)*d);return d=1,_<0?(d=s/(s-_),_=0):_>=this.image.getHeight()&&(d=(this.image.getHeight()-1-s)/(_-s),_=this.image.getHeight()-1),m=Math.floor(i+(m-i)*d),c+=this.sizeOfBlackWhiteBlackRun(i,s,m,_),c-1}sizeOfBlackWhiteBlackRun(i,s,a,h){const c=Math.abs(h-s)>Math.abs(a-i);if(c){let k=i;i=s,s=k,k=a,a=h,h=k}const d=Math.abs(a-i),m=Math.abs(h-s);let _=-d/2;const C=i<a?1:-1,M=s<h?1:-1;let R=0;const D=a+C;for(let k=i,j=s;k!==D;k+=C){const K=c?j:k,tt=c?k:j;if(R===1===this.image.get(K,tt)){if(R===2)return ee.distance(k,j,i,s);R++}if(_+=m,_>0){if(j===h)break;j+=M,_-=d}}return R===2?ee.distance(a+C,h,i,s):NaN}findAlignmentInRegion(i,s,a,h){const c=Math.floor(h*i),d=Math.max(0,s-c),m=Math.min(this.image.getWidth()-1,s+c);if(m-d<i*3)throw new q("Alignment top exceeds estimated module size.");const _=Math.max(0,a-c),C=Math.min(this.image.getHeight()-1,a+c);if(C-_<i*3)throw new q("Alignment bottom exceeds estimated module size.");return new Yn(this.image,d,_,m-d,C-_,i,this.resultPointCallback).find()}}class un{constructor(){this.decoder=new _l}getDecoder(){return this.decoder}decode(i,s){let a,h;if(s!=null&&s.get(ot.PURE_BARCODE)!==void 0){const _=un.extractPureBits(i.getBlackMatrix());a=this.decoder.decodeBitMatrix(_,s),h=un.NO_POINTS}else{const _=new Gs(i.getBlackMatrix()).detect(s);a=this.decoder.decodeBitMatrix(_.getBits(),s),h=_.getPoints()}a.getOther()instanceof Zo&&a.getOther().applyMirroredCorrection(h);const c=new gt(a.getText(),a.getRawBytes(),void 0,h,Rt.QR_CODE,void 0),d=a.getByteSegments();d!==null&&c.putMetadata(ye.BYTE_SEGMENTS,d);const m=a.getECLevel();return m!==null&&c.putMetadata(ye.ERROR_CORRECTION_LEVEL,m),a.hasStructuredAppend()&&(c.putMetadata(ye.STRUCTURED_APPEND_SEQUENCE,a.getStructuredAppendSequenceNumber()),c.putMetadata(ye.STRUCTURED_APPEND_PARITY,a.getStructuredAppendParity())),c}reset(){}static extractPureBits(i){const s=i.getTopLeftOnBit(),a=i.getBottomRightOnBit();if(s===null||a===null)throw new q;const h=this.moduleSize(s,i);let c=s[1],d=a[1],m=s[0],_=a[0];if(m>=_||c>=d)throw new q;if(d-c!==_-m&&(_=m+(d-c),_>=i.getWidth()))throw new q;const C=Math.round((_-m+1)/h),M=Math.round((d-c+1)/h);if(C<=0||M<=0)throw new q;if(M!==C)throw new q;const R=Math.floor(h/2);c+=R,m+=R;const D=m+Math.floor((C-1)*h)-_;if(D>0){if(D>R)throw new q;m-=D}const k=c+Math.floor((M-1)*h)-d;if(k>0){if(k>R)throw new q;c-=k}const j=new pt(C,M);for(let K=0;K<M;K++){const tt=c+Math.floor(K*h);for(let st=0;st<C;st++)i.get(m+Math.floor(st*h),tt)&&j.set(st,K)}return j}static moduleSize(i,s){const a=s.getHeight(),h=s.getWidth();let c=i[0],d=i[1],m=!0,_=0;for(;c<h&&d<a;){if(m!==s.get(c,d)){if(++_===5)break;m=!m}c++,d++}if(c===h||d===a)throw new q;return(c-i[0])/7}}un.NO_POINTS=new Array;class Ut{PDF417Common(){}static getBitCountSum(i){return ee.sum(i)}static toIntArray(i){if(i==null||!i.length)return Ut.EMPTY_INT_ARRAY;const s=new Int32Array(i.length);let a=0;for(const h of i)s[a++]=h;return s}static getCodeword(i){const s=U.binarySearch(Ut.SYMBOL_TABLE,i&262143);return s<0?-1:(Ut.CODEWORD_TABLE[s]-1)%Ut.NUMBER_OF_CODEWORDS}}Ut.NUMBER_OF_CODEWORDS=929,Ut.MAX_CODEWORDS_IN_BARCODE=Ut.NUMBER_OF_CODEWORDS-1,Ut.MIN_ROWS_IN_BARCODE=3,Ut.MAX_ROWS_IN_BARCODE=90,Ut.MODULES_IN_CODEWORD=17,Ut.MODULES_IN_STOP_PATTERN=18,Ut.BARS_IN_MODULE=8,Ut.EMPTY_INT_ARRAY=new Int32Array([]),Ut.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Ut.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class yl{constructor(i,s){this.bits=i,this.points=s}getBits(){return this.bits}getPoints(){return this.points}}class Zt{static detectMultiple(i,s,a){let h=i.getBlackMatrix(),c=Zt.detect(a,h);return c.length||(h=h.clone(),h.rotate180(),c=Zt.detect(a,h)),new yl(h,c)}static detect(i,s){const a=new Array;let h=0,c=0,d=!1;for(;h<s.getHeight();){const m=Zt.findVertices(s,h,c);if(m[0]==null&&m[3]==null){if(!d)break;d=!1,c=0;for(const _ of a)_[1]!=null&&(h=Math.trunc(Math.max(h,_[1].getY()))),_[3]!=null&&(h=Math.max(h,Math.trunc(_[3].getY())));h+=Zt.ROW_STEP;continue}if(d=!0,a.push(m),!i)break;m[2]!=null?(c=Math.trunc(m[2].getX()),h=Math.trunc(m[2].getY())):(c=Math.trunc(m[4].getX()),h=Math.trunc(m[4].getY()))}return a}static findVertices(i,s,a){const h=i.getHeight(),c=i.getWidth(),d=new Array(8);return Zt.copyToResult(d,Zt.findRowsWithPattern(i,h,c,s,a,Zt.START_PATTERN),Zt.INDEXES_START_PATTERN),d[4]!=null&&(a=Math.trunc(d[4].getX()),s=Math.trunc(d[4].getY())),Zt.copyToResult(d,Zt.findRowsWithPattern(i,h,c,s,a,Zt.STOP_PATTERN),Zt.INDEXES_STOP_PATTERN),d}static copyToResult(i,s,a){for(let h=0;h<a.length;h++)i[a[h]]=s[h]}static findRowsWithPattern(i,s,a,h,c,d){const m=new Array(4);let _=!1;const C=new Int32Array(d.length);for(;h<s;h+=Zt.ROW_STEP){let R=Zt.findGuardPattern(i,c,h,a,!1,d,C);if(R!=null){for(;h>0;){const D=Zt.findGuardPattern(i,c,--h,a,!1,d,C);if(D!=null)R=D;else{h++;break}}m[0]=new St(R[0],h),m[1]=new St(R[1],h),_=!0;break}}let M=h+1;if(_){let R=0,D=Int32Array.from([Math.trunc(m[0].getX()),Math.trunc(m[1].getX())]);for(;M<s;M++){const k=Zt.findGuardPattern(i,D[0],M,a,!1,d,C);if(k!=null&&Math.abs(D[0]-k[0])<Zt.MAX_PATTERN_DRIFT&&Math.abs(D[1]-k[1])<Zt.MAX_PATTERN_DRIFT)D=k,R=0;else{if(R>Zt.SKIPPED_ROW_COUNT_MAX)break;R++}}M-=R+1,m[2]=new St(D[0],M),m[3]=new St(D[1],M)}return M-h<Zt.BARCODE_MIN_HEIGHT&&U.fill(m,null),m}static findGuardPattern(i,s,a,h,c,d,m){U.fillWithin(m,0,m.length,0);let _=s,C=0;for(;i.get(_,a)&&_>0&&C++<Zt.MAX_PIXEL_DRIFT;)_--;let M=_,R=0,D=d.length;for(let k=c;M<h;M++)if(i.get(M,a)!==k)m[R]++;else{if(R===D-1){if(Zt.patternMatchVariance(m,d,Zt.MAX_INDIVIDUAL_VARIANCE)<Zt.MAX_AVG_VARIANCE)return new Int32Array([_,M]);_+=m[0]+m[1],F.arraycopy(m,2,m,0,R-1),m[R-1]=0,m[R]=0,R--}else R++;m[R]=1,k=!k}return R===D-1&&Zt.patternMatchVariance(m,d,Zt.MAX_INDIVIDUAL_VARIANCE)<Zt.MAX_AVG_VARIANCE?new Int32Array([_,M-1]):null}static patternMatchVariance(i,s,a){let h=i.length,c=0,d=0;for(let C=0;C<h;C++)c+=i[C],d+=s[C];if(c<d)return 1/0;let m=c/d;a*=m;let _=0;for(let C=0;C<h;C++){let M=i[C],R=s[C]*m,D=M>R?M-R:R-M;if(D>a)return 1/0;_+=D}return _/c}}Zt.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Zt.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Zt.MAX_AVG_VARIANCE=.42,Zt.MAX_INDIVIDUAL_VARIANCE=.8,Zt.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Zt.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Zt.MAX_PIXEL_DRIFT=3,Zt.MAX_PATTERN_DRIFT=5,Zt.SKIPPED_ROW_COUNT_MAX=25,Zt.ROW_STEP=5,Zt.BARCODE_MIN_HEIGHT=10;class We{constructor(i,s){if(s.length===0)throw new A;this.field=i;let a=s.length;if(a>1&&s[0]===0){let h=1;for(;h<a&&s[h]===0;)h++;h===a?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(a-h),F.arraycopy(s,h,this.coefficients,0,this.coefficients.length))}else this.coefficients=s}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(i){return this.coefficients[this.coefficients.length-1-i]}evaluateAt(i){if(i===0)return this.getCoefficient(0);if(i===1){let h=0;for(let c of this.coefficients)h=this.field.add(h,c);return h}let s=this.coefficients[0],a=this.coefficients.length;for(let h=1;h<a;h++)s=this.field.add(this.field.multiply(i,s),this.coefficients[h]);return s}add(i){if(!this.field.equals(i.field))throw new A("ModulusPolys do not have same ModulusGF field");if(this.isZero())return i;if(i.isZero())return this;let s=this.coefficients,a=i.coefficients;if(s.length>a.length){let d=s;s=a,a=d}let h=new Int32Array(a.length),c=a.length-s.length;F.arraycopy(a,0,h,0,c);for(let d=c;d<a.length;d++)h[d]=this.field.add(s[d-c],a[d]);return new We(this.field,h)}subtract(i){if(!this.field.equals(i.field))throw new A("ModulusPolys do not have same ModulusGF field");return i.isZero()?this:this.add(i.negative())}multiply(i){return i instanceof We?this.multiplyOther(i):this.multiplyScalar(i)}multiplyOther(i){if(!this.field.equals(i.field))throw new A("ModulusPolys do not have same ModulusGF field");if(this.isZero()||i.isZero())return new We(this.field,new Int32Array([0]));let s=this.coefficients,a=s.length,h=i.coefficients,c=h.length,d=new Int32Array(a+c-1);for(let m=0;m<a;m++){let _=s[m];for(let C=0;C<c;C++)d[m+C]=this.field.add(d[m+C],this.field.multiply(_,h[C]))}return new We(this.field,d)}negative(){let i=this.coefficients.length,s=new Int32Array(i);for(let a=0;a<i;a++)s[a]=this.field.subtract(0,this.coefficients[a]);return new We(this.field,s)}multiplyScalar(i){if(i===0)return new We(this.field,new Int32Array([0]));if(i===1)return this;let s=this.coefficients.length,a=new Int32Array(s);for(let h=0;h<s;h++)a[h]=this.field.multiply(this.coefficients[h],i);return new We(this.field,a)}multiplyByMonomial(i,s){if(i<0)throw new A;if(s===0)return new We(this.field,new Int32Array([0]));let a=this.coefficients.length,h=new Int32Array(a+i);for(let c=0;c<a;c++)h[c]=this.field.multiply(this.coefficients[c],s);return new We(this.field,h)}toString(){let i=new ut;for(let s=this.getDegree();s>=0;s--){let a=this.getCoefficient(s);a!==0&&(a<0?(i.append(" - "),a=-a):i.length()>0&&i.append(" + "),(s===0||a!==1)&&i.append(a),s!==0&&(s===1?i.append("x"):(i.append("x^"),i.append(s))))}return i.toString()}}class wl{add(i,s){return(i+s)%this.modulus}subtract(i,s){return(this.modulus+i-s)%this.modulus}exp(i){return this.expTable[i]}log(i){if(i===0)throw new A;return this.logTable[i]}inverse(i){if(i===0)throw new ze;return this.expTable[this.modulus-this.logTable[i]-1]}multiply(i,s){return i===0||s===0?0:this.expTable[(this.logTable[i]+this.logTable[s])%(this.modulus-1)]}getSize(){return this.modulus}equals(i){return i===this}}class Zr extends wl{constructor(i,s){super(),this.modulus=i,this.expTable=new Int32Array(i),this.logTable=new Int32Array(i);let a=1;for(let h=0;h<i;h++)this.expTable[h]=a,a=a*s%i;for(let h=0;h<i-1;h++)this.logTable[this.expTable[h]]=h;this.zero=new We(this,new Int32Array([0])),this.one=new We(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(i,s){if(i<0)throw new A;if(s===0)return this.zero;let a=new Int32Array(i+1);return a[0]=s,new We(this,a)}}Zr.PDF417_GF=new Zr(Ut.NUMBER_OF_CODEWORDS,3);class Ko{constructor(){this.field=Zr.PDF417_GF}decode(i,s,a){let h=new We(this.field,i),c=new Int32Array(s),d=!1;for(let j=s;j>0;j--){let K=h.evaluateAt(this.field.exp(j));c[s-j]=K,K!==0&&(d=!0)}if(!d)return 0;let m=this.field.getOne();if(a!=null)for(const j of a){let K=this.field.exp(i.length-1-j),tt=new We(this.field,new Int32Array([this.field.subtract(0,K),1]));m=m.multiply(tt)}let _=new We(this.field,c),C=this.runEuclideanAlgorithm(this.field.buildMonomial(s,1),_,s),M=C[0],R=C[1],D=this.findErrorLocations(M),k=this.findErrorMagnitudes(R,M,D);for(let j=0;j<D.length;j++){let K=i.length-1-this.field.log(D[j]);if(K<0)throw P.getChecksumInstance();i[K]=this.field.subtract(i[K],k[j])}return D.length}runEuclideanAlgorithm(i,s,a){if(i.getDegree()<s.getDegree()){let D=i;i=s,s=D}let h=i,c=s,d=this.field.getZero(),m=this.field.getOne();for(;c.getDegree()>=Math.round(a/2);){let D=h,k=d;if(h=c,d=m,h.isZero())throw P.getChecksumInstance();c=D;let j=this.field.getZero(),K=h.getCoefficient(h.getDegree()),tt=this.field.inverse(K);for(;c.getDegree()>=h.getDegree()&&!c.isZero();){let st=c.getDegree()-h.getDegree(),Et=this.field.multiply(c.getCoefficient(c.getDegree()),tt);j=j.add(this.field.buildMonomial(st,Et)),c=c.subtract(h.multiplyByMonomial(st,Et))}m=j.multiply(d).subtract(k).negative()}let _=m.getCoefficient(0);if(_===0)throw P.getChecksumInstance();let C=this.field.inverse(_),M=m.multiply(C),R=c.multiply(C);return[M,R]}findErrorLocations(i){let s=i.getDegree(),a=new Int32Array(s),h=0;for(let c=1;c<this.field.getSize()&&h<s;c++)i.evaluateAt(c)===0&&(a[h]=this.field.inverse(c),h++);if(h!==s)throw P.getChecksumInstance();return a}findErrorMagnitudes(i,s,a){let h=s.getDegree(),c=new Int32Array(h);for(let C=1;C<=h;C++)c[h-C]=this.field.multiply(C,s.getCoefficient(C));let d=new We(this.field,c),m=a.length,_=new Int32Array(m);for(let C=0;C<m;C++){let M=this.field.inverse(a[C]),R=this.field.subtract(0,i.evaluateAt(M)),D=this.field.inverse(d.evaluateAt(M));_[C]=this.field.multiply(R,D)}return _}}class je{constructor(i,s,a,h,c){i instanceof je?this.constructor_2(i):this.constructor_1(i,s,a,h,c)}constructor_1(i,s,a,h,c){const d=s==null||a==null,m=h==null||c==null;if(d&&m)throw new q;d?(s=new St(0,h.getY()),a=new St(0,c.getY())):m&&(h=new St(i.getWidth()-1,s.getY()),c=new St(i.getWidth()-1,a.getY())),this.image=i,this.topLeft=s,this.bottomLeft=a,this.topRight=h,this.bottomRight=c,this.minX=Math.trunc(Math.min(s.getX(),a.getX())),this.maxX=Math.trunc(Math.max(h.getX(),c.getX())),this.minY=Math.trunc(Math.min(s.getY(),h.getY())),this.maxY=Math.trunc(Math.max(a.getY(),c.getY()))}constructor_2(i){this.image=i.image,this.topLeft=i.getTopLeft(),this.bottomLeft=i.getBottomLeft(),this.topRight=i.getTopRight(),this.bottomRight=i.getBottomRight(),this.minX=i.getMinX(),this.maxX=i.getMaxX(),this.minY=i.getMinY(),this.maxY=i.getMaxY()}static merge(i,s){return i==null?s:s==null?i:new je(i.image,i.topLeft,i.bottomLeft,s.topRight,s.bottomRight)}addMissingRows(i,s,a){let h=this.topLeft,c=this.bottomLeft,d=this.topRight,m=this.bottomRight;if(i>0){let _=a?this.topLeft:this.topRight,C=Math.trunc(_.getY()-i);C<0&&(C=0);let M=new St(_.getX(),C);a?h=M:d=M}if(s>0){let _=a?this.bottomLeft:this.bottomRight,C=Math.trunc(_.getY()+s);C>=this.image.getHeight()&&(C=this.image.getHeight()-1);let M=new St(_.getX(),C);a?c=M:m=M}return new je(this.image,h,c,d,m)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Us{constructor(i,s,a,h){this.columnCount=i,this.errorCorrectionLevel=h,this.rowCountUpperPart=s,this.rowCountLowerPart=a,this.rowCount=s+a}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class pn{constructor(){this.buffer=""}static form(i,s){let a=-1;function h(d,m,_,C,M,R){if(d==="%%")return"%";if(s[++a]===void 0)return;d=C?parseInt(C.substr(1)):void 0;let D=M?parseInt(M.substr(1)):void 0,k;switch(R){case"s":k=s[a];break;case"c":k=s[a][0];break;case"f":k=parseFloat(s[a]).toFixed(d);break;case"p":k=parseFloat(s[a]).toPrecision(d);break;case"e":k=parseFloat(s[a]).toExponential(d);break;case"x":k=parseInt(s[a]).toString(D||16);break;case"d":k=parseFloat(parseInt(s[a],D||10).toPrecision(d)).toFixed(0);break}k=typeof k=="object"?JSON.stringify(k):(+k).toString(D);let j=parseInt(_),K=_&&_[0]+""=="0"?"0":" ";for(;k.length<j;)k=m!==void 0?k+K:K+k;return k}let c=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return i.replace(c,h)}format(i,...s){this.buffer+=pn.form(i,s)}toString(){return this.buffer}}class yn{constructor(i){this.boundingBox=new je(i),this.codewords=new Array(i.getMaxY()-i.getMinY()+1)}getCodewordNearby(i){let s=this.getCodeword(i);if(s!=null)return s;for(let a=1;a<yn.MAX_NEARBY_DISTANCE;a++){let h=this.imageRowToCodewordIndex(i)-a;if(h>=0&&(s=this.codewords[h],s!=null)||(h=this.imageRowToCodewordIndex(i)+a,h<this.codewords.length&&(s=this.codewords[h],s!=null)))return s}return null}imageRowToCodewordIndex(i){return i-this.boundingBox.getMinY()}setCodeword(i,s){this.codewords[this.imageRowToCodewordIndex(i)]=s}getCodeword(i){return this.codewords[this.imageRowToCodewordIndex(i)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const i=new pn;let s=0;for(const a of this.codewords){if(a==null){i.format("%3d:    |   %n",s++);continue}i.format("%3d: %3d|%3d%n",s++,a.getRowNumber(),a.getValue())}return i.toString()}}yn.MAX_NEARBY_DISTANCE=5;class wn{constructor(){this.values=new Map}setValue(i){i=Math.trunc(i);let s=this.values.get(i);s==null&&(s=0),s++,this.values.set(i,s)}getValue(){let i=-1,s=new Array;for(const[a,h]of this.values.entries()){const c={getKey:()=>a,getValue:()=>h};c.getValue()>i?(i=c.getValue(),s=[],s.push(c.getKey())):c.getValue()===i&&s.push(c.getKey())}return Ut.toIntArray(s)}getConfidence(i){return this.values.get(i)}}class Hn extends yn{constructor(i,s){super(i),this._isLeft=s}setRowNumbers(){for(let i of this.getCodewords())i?.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(i){let s=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(s,i);let a=this.getBoundingBox(),h=this._isLeft?a.getTopLeft():a.getTopRight(),c=this._isLeft?a.getBottomLeft():a.getBottomRight(),d=this.imageRowToCodewordIndex(Math.trunc(h.getY())),m=this.imageRowToCodewordIndex(Math.trunc(c.getY())),_=-1,C=1,M=0;for(let R=d;R<m;R++){if(s[R]==null)continue;let D=s[R],k=D.getRowNumber()-_;if(k===0)M++;else if(k===1)C=Math.max(C,M),M=1,_=D.getRowNumber();else if(k<0||D.getRowNumber()>=i.getRowCount()||k>R)s[R]=null;else{let j;C>2?j=(C-2)*k:j=k;let K=j>=R;for(let tt=1;tt<=j&&!K;tt++)K=s[R-tt]!=null;K?s[R]=null:(_=D.getRowNumber(),M=1)}}}getRowHeights(){let i=this.getBarcodeMetadata();if(i==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(i);let s=new Int32Array(i.getRowCount());for(let a of this.getCodewords())if(a!=null){let h=a.getRowNumber();if(h>=s.length)continue;s[h]++}return s}adjustIncompleteIndicatorColumnRowNumbers(i){let s=this.getBoundingBox(),a=this._isLeft?s.getTopLeft():s.getTopRight(),h=this._isLeft?s.getBottomLeft():s.getBottomRight(),c=this.imageRowToCodewordIndex(Math.trunc(a.getY())),d=this.imageRowToCodewordIndex(Math.trunc(h.getY())),m=this.getCodewords(),_=-1;for(let C=c;C<d;C++){if(m[C]==null)continue;let M=m[C];M.setRowNumberAsRowIndicatorColumn();let R=M.getRowNumber()-_;R===0||(R===1?_=M.getRowNumber():M.getRowNumber()>=i.getRowCount()?m[C]=null:_=M.getRowNumber())}}getBarcodeMetadata(){let i=this.getCodewords(),s=new wn,a=new wn,h=new wn,c=new wn;for(let m of i){if(m==null)continue;m.setRowNumberAsRowIndicatorColumn();let _=m.getValue()%30,C=m.getRowNumber();switch(this._isLeft||(C+=2),C%3){case 0:a.setValue(_*3+1);break;case 1:c.setValue(_/3),h.setValue(_%3);break;case 2:s.setValue(_+1);break}}if(s.getValue().length===0||a.getValue().length===0||h.getValue().length===0||c.getValue().length===0||s.getValue()[0]<1||a.getValue()[0]+h.getValue()[0]<Ut.MIN_ROWS_IN_BARCODE||a.getValue()[0]+h.getValue()[0]>Ut.MAX_ROWS_IN_BARCODE)return null;let d=new Us(s.getValue()[0],a.getValue()[0],h.getValue()[0],c.getValue()[0]);return this.removeIncorrectCodewords(i,d),d}removeIncorrectCodewords(i,s){for(let a=0;a<i.length;a++){let h=i[a];if(i[a]==null)continue;let c=h.getValue()%30,d=h.getRowNumber();if(d>s.getRowCount()){i[a]=null;continue}switch(this._isLeft||(d+=2),d%3){case 0:c*3+1!==s.getRowCountUpperPart()&&(i[a]=null);break;case 1:(Math.trunc(c/3)!==s.getErrorCorrectionLevel()||c%3!==s.getRowCountLowerPart())&&(i[a]=null);break;case 2:c+1!==s.getColumnCount()&&(i[a]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class fn{constructor(i,s){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=i,this.barcodeColumnCount=i.getColumnCount(),this.boundingBox=s,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let i=Ut.MAX_CODEWORDS_IN_BARCODE,s;do s=i,i=this.adjustRowNumbersAndGetCount();while(i>0&&i<s);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(i){i?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let i=this.adjustRowNumbersByRow();if(i===0)return 0;for(let s=1;s<this.barcodeColumnCount+1;s++){let a=this.detectionResultColumns[s].getCodewords();for(let h=0;h<a.length;h++)a[h]!=null&&(a[h].hasValidRowNumber()||this.adjustRowNumbers(s,h,a))}return i}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let i=this.detectionResultColumns[0].getCodewords(),s=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let a=0;a<i.length;a++)if(i[a]!=null&&s[a]!=null&&i[a].getRowNumber()===s[a].getRowNumber())for(let h=1;h<=this.barcodeColumnCount;h++){let c=this.detectionResultColumns[h].getCodewords()[a];c!=null&&(c.setRowNumber(i[a].getRowNumber()),c.hasValidRowNumber()||(this.detectionResultColumns[h].getCodewords()[a]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let i=0,s=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let a=0;a<s.length;a++){if(s[a]==null)continue;let h=s[a].getRowNumber(),c=0;for(let d=this.barcodeColumnCount+1;d>0&&c<this.ADJUST_ROW_NUMBER_SKIP;d--){let m=this.detectionResultColumns[d].getCodewords()[a];m!=null&&(c=fn.adjustRowNumberIfValid(h,c,m),m.hasValidRowNumber()||i++)}}return i}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let i=0,s=this.detectionResultColumns[0].getCodewords();for(let a=0;a<s.length;a++){if(s[a]==null)continue;let h=s[a].getRowNumber(),c=0;for(let d=1;d<this.barcodeColumnCount+1&&c<this.ADJUST_ROW_NUMBER_SKIP;d++){let m=this.detectionResultColumns[d].getCodewords()[a];m!=null&&(c=fn.adjustRowNumberIfValid(h,c,m),m.hasValidRowNumber()||i++)}}return i}static adjustRowNumberIfValid(i,s,a){return a==null||a.hasValidRowNumber()||(a.isValidRowNumber(i)?(a.setRowNumber(i),s=0):++s),s}adjustRowNumbers(i,s,a){if(!this.detectionResultColumns[i-1])return;let h=a[s],c=this.detectionResultColumns[i-1].getCodewords(),d=c;this.detectionResultColumns[i+1]!=null&&(d=this.detectionResultColumns[i+1].getCodewords());let m=new Array(14);m[2]=c[s],m[3]=d[s],s>0&&(m[0]=a[s-1],m[4]=c[s-1],m[5]=d[s-1]),s>1&&(m[8]=a[s-2],m[10]=c[s-2],m[11]=d[s-2]),s<a.length-1&&(m[1]=a[s+1],m[6]=c[s+1],m[7]=d[s+1]),s<a.length-2&&(m[9]=a[s+2],m[12]=c[s+2],m[13]=d[s+2]);for(let _ of m)if(fn.adjustRowNumber(h,_))return}static adjustRowNumber(i,s){return s==null?!1:s.hasValidRowNumber()&&s.getBucket()===i.getBucket()?(i.setRowNumber(s.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(i){this.boundingBox=i}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(i,s){this.detectionResultColumns[i]=s}getDetectionResultColumn(i){return this.detectionResultColumns[i]}toString(){let i=this.detectionResultColumns[0];i==null&&(i=this.detectionResultColumns[this.barcodeColumnCount+1]);let s=new pn;for(let a=0;a<i.getCodewords().length;a++){s.format("CW %3d:",a);for(let h=0;h<this.barcodeColumnCount+2;h++){if(this.detectionResultColumns[h]==null){s.format("    |   ");continue}let c=this.detectionResultColumns[h].getCodewords()[a];if(c==null){s.format("    |   ");continue}s.format(" %3d|%3d",c.getRowNumber(),c.getValue())}s.format("%n")}return s.toString()}}class Pn{constructor(i,s,a,h){this.rowNumber=Pn.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(i),this.endX=Math.trunc(s),this.bucket=Math.trunc(a),this.value=Math.trunc(h)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(i){return i!==Pn.BARCODE_ROW_UNKNOWN&&this.bucket===i%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(i){this.rowNumber=i}toString(){return this.rowNumber+"|"+this.value}}Pn.BARCODE_ROW_UNKNOWN=-1;class Ni{static initialize(){for(let i=0;i<Ut.SYMBOL_TABLE.length;i++){let s=Ut.SYMBOL_TABLE[i],a=s&1;for(let h=0;h<Ut.BARS_IN_MODULE;h++){let c=0;for(;(s&1)===a;)c+=1,s>>=1;a=s&1,Ni.RATIOS_TABLE[i]||(Ni.RATIOS_TABLE[i]=new Array(Ut.BARS_IN_MODULE)),Ni.RATIOS_TABLE[i][Ut.BARS_IN_MODULE-h-1]=Math.fround(c/Ut.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(i){let s=Ni.getDecodedCodewordValue(Ni.sampleBitCounts(i));return s!==-1?s:Ni.getClosestDecodedValue(i)}static sampleBitCounts(i){let s=ee.sum(i),a=new Int32Array(Ut.BARS_IN_MODULE),h=0,c=0;for(let d=0;d<Ut.MODULES_IN_CODEWORD;d++){let m=s/(2*Ut.MODULES_IN_CODEWORD)+d*s/Ut.MODULES_IN_CODEWORD;c+i[h]<=m&&(c+=i[h],h++),a[h]++}return a}static getDecodedCodewordValue(i){let s=Ni.getBitValue(i);return Ut.getCodeword(s)===-1?-1:s}static getBitValue(i){let s=0;for(let a=0;a<i.length;a++)for(let h=0;h<i[a];h++)s=s<<1|(a%2===0?1:0);return Math.trunc(s)}static getClosestDecodedValue(i){let s=ee.sum(i),a=new Array(Ut.BARS_IN_MODULE);if(s>1)for(let d=0;d<a.length;d++)a[d]=Math.fround(i[d]/s);let h=_i.MAX_VALUE,c=-1;this.bSymbolTableReady||Ni.initialize();for(let d=0;d<Ni.RATIOS_TABLE.length;d++){let m=0,_=Ni.RATIOS_TABLE[d];for(let C=0;C<Ut.BARS_IN_MODULE;C++){let M=Math.fround(_[C]-a[C]);if(m+=Math.fround(M*M),m>=h)break}m<h&&(h=m,c=Ut.SYMBOL_TABLE[d])}return c}}Ni.bSymbolTableReady=!1,Ni.RATIOS_TABLE=new Array(Ut.SYMBOL_TABLE.length).map(T=>new Array(Ut.BARS_IN_MODULE));class En{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(i){this.segmentIndex=i}getFileId(){return this.fileId}setFileId(i){this.fileId=i}getOptionalData(){return this.optionalData}setOptionalData(i){this.optionalData=i}isLastSegment(){return this.lastSegment}setLastSegment(i){this.lastSegment=i}getSegmentCount(){return this.segmentCount}setSegmentCount(i){this.segmentCount=i}getSender(){return this.sender||null}setSender(i){this.sender=i}getAddressee(){return this.addressee||null}setAddressee(i){this.addressee=i}getFileName(){return this.fileName}setFileName(i){this.fileName=i}getFileSize(){return this.fileSize}setFileSize(i){this.fileSize=i}getChecksum(){return this.checksum}setChecksum(i){this.checksum=i}getTimestamp(){return this.timestamp}setTimestamp(i){this.timestamp=i}}class qo{static parseLong(i,s=void 0){return parseInt(i,s)}}class Jo extends E{}Jo.kind="NullPointerException";class El{writeBytes(i){this.writeBytesOffset(i,0,i.length)}writeBytesOffset(i,s,a){if(i==null)throw new Jo;if(s<0||s>i.length||a<0||s+a>i.length||s+a<0)throw new V;if(a===0)return;for(let h=0;h<a;h++)this.write(i[s+h])}flush(){}close(){}}class Cl extends E{}class Al extends El{constructor(i=32){if(super(),this.count=0,i<0)throw new A("Negative initial size: "+i);this.buf=new Uint8Array(i)}ensureCapacity(i){i-this.buf.length>0&&this.grow(i)}grow(i){let a=this.buf.length<<1;if(a-i<0&&(a=i),a<0){if(i<0)throw new Cl;a=Y.MAX_VALUE}this.buf=U.copyOfUint8Array(this.buf,a)}write(i){this.ensureCapacity(this.count+1),this.buf[this.count]=i,this.count+=1}writeBytesOffset(i,s,a){if(s<0||s>i.length||a<0||s+a-i.length>0)throw new V;this.ensureCapacity(this.count+a),F.arraycopy(i,s,this.buf,this.count,a),this.count+=a}writeTo(i){i.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return U.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(i){return i?typeof i=="string"?this.toString_string(i):this.toString_number(i):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(i){return new String(this.buf).toString()}toString_number(i){return new String(this.buf).toString()}close(){}}var Ie;(function(T){T[T.ALPHA=0]="ALPHA",T[T.LOWER=1]="LOWER",T[T.MIXED=2]="MIXED",T[T.PUNCT=3]="PUNCT",T[T.ALPHA_SHIFT=4]="ALPHA_SHIFT",T[T.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(Ie||(Ie={}));function Qo(){if(typeof window<"u")return window.BigInt||null;if(typeof Mn<"u")return Mn.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Ji;function Dn(T){if(typeof Ji>"u"&&(Ji=Qo()),Ji===null)throw new Error("BigInt is not supported!");return Ji(T)}function Il(){let T=[];T[0]=Dn(1);let i=Dn(900);T[1]=i;for(let s=2;s<16;s++)T[s]=T[s-1]*i;return T}class nt{static decode(i,s){let a=new ut(""),h=H.ISO8859_1;a.enableDecoding(h);let c=1,d=i[c++],m=new En;for(;c<i[0];){switch(d){case nt.TEXT_COMPACTION_MODE_LATCH:c=nt.textCompaction(i,c,a);break;case nt.BYTE_COMPACTION_MODE_LATCH:case nt.BYTE_COMPACTION_MODE_LATCH_6:c=nt.byteCompaction(d,i,h,c,a);break;case nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(i[c++]);break;case nt.NUMERIC_COMPACTION_MODE_LATCH:c=nt.numericCompaction(i,c,a);break;case nt.ECI_CHARSET:H.getCharacterSetECIByValue(i[c++]);break;case nt.ECI_GENERAL_PURPOSE:c+=2;break;case nt.ECI_USER_DEFINED:c++;break;case nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:c=nt.decodeMacroBlock(i,c,m);break;case nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case nt.MACRO_PDF417_TERMINATOR:throw new X;default:c--,c=nt.textCompaction(i,c,a);break}if(c<i.length)d=i[c++];else throw X.getFormatInstance()}if(a.length()===0)throw X.getFormatInstance();let _=new mi(null,a.toString(),null,s);return _.setOther(m),_}static decodeMacroBlock(i,s,a){if(s+nt.NUMBER_OF_SEQUENCE_CODEWORDS>i[0])throw X.getFormatInstance();let h=new Int32Array(nt.NUMBER_OF_SEQUENCE_CODEWORDS);for(let m=0;m<nt.NUMBER_OF_SEQUENCE_CODEWORDS;m++,s++)h[m]=i[s];a.setSegmentIndex(Y.parseInt(nt.decodeBase900toBase10(h,nt.NUMBER_OF_SEQUENCE_CODEWORDS)));let c=new ut;s=nt.textCompaction(i,s,c),a.setFileId(c.toString());let d=-1;for(i[s]===nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(d=s+1);s<i[0];)switch(i[s]){case nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(s++,i[s]){case nt.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let m=new ut;s=nt.textCompaction(i,s+1,m),a.setFileName(m.toString());break;case nt.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let _=new ut;s=nt.textCompaction(i,s+1,_),a.setSender(_.toString());break;case nt.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let C=new ut;s=nt.textCompaction(i,s+1,C),a.setAddressee(C.toString());break;case nt.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let M=new ut;s=nt.numericCompaction(i,s+1,M),a.setSegmentCount(Y.parseInt(M.toString()));break;case nt.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let R=new ut;s=nt.numericCompaction(i,s+1,R),a.setTimestamp(qo.parseLong(R.toString()));break;case nt.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let D=new ut;s=nt.numericCompaction(i,s+1,D),a.setChecksum(Y.parseInt(D.toString()));break;case nt.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let k=new ut;s=nt.numericCompaction(i,s+1,k),a.setFileSize(qo.parseLong(k.toString()));break;default:throw X.getFormatInstance()}break;case nt.MACRO_PDF417_TERMINATOR:s++,a.setLastSegment(!0);break;default:throw X.getFormatInstance()}if(d!==-1){let m=s-d;a.isLastSegment()&&m--,a.setOptionalData(U.copyOfRange(i,d,d+m))}return s}static textCompaction(i,s,a){let h=new Int32Array((i[0]-s)*2),c=new Int32Array((i[0]-s)*2),d=0,m=!1;for(;s<i[0]&&!m;){let _=i[s++];if(_<nt.TEXT_COMPACTION_MODE_LATCH)h[d]=_/30,h[d+1]=_%30,d+=2;else switch(_){case nt.TEXT_COMPACTION_MODE_LATCH:h[d++]=nt.TEXT_COMPACTION_MODE_LATCH;break;case nt.BYTE_COMPACTION_MODE_LATCH:case nt.BYTE_COMPACTION_MODE_LATCH_6:case nt.NUMERIC_COMPACTION_MODE_LATCH:case nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case nt.MACRO_PDF417_TERMINATOR:s--,m=!0;break;case nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h[d]=nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,_=i[s++],c[d]=_,d++;break}}return nt.decodeTextCompaction(h,c,d,a),s}static decodeTextCompaction(i,s,a,h){let c=Ie.ALPHA,d=Ie.ALPHA,m=0;for(;m<a;){let _=i[m],C="";switch(c){case Ie.ALPHA:if(_<26)C=String.fromCharCode(65+_);else switch(_){case 26:C=" ";break;case nt.LL:c=Ie.LOWER;break;case nt.ML:c=Ie.MIXED;break;case nt.PS:d=c,c=Ie.PUNCT_SHIFT;break;case nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(s[m]);break;case nt.TEXT_COMPACTION_MODE_LATCH:c=Ie.ALPHA;break}break;case Ie.LOWER:if(_<26)C=String.fromCharCode(97+_);else switch(_){case 26:C=" ";break;case nt.AS:d=c,c=Ie.ALPHA_SHIFT;break;case nt.ML:c=Ie.MIXED;break;case nt.PS:d=c,c=Ie.PUNCT_SHIFT;break;case nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(s[m]);break;case nt.TEXT_COMPACTION_MODE_LATCH:c=Ie.ALPHA;break}break;case Ie.MIXED:if(_<nt.PL)C=nt.MIXED_CHARS[_];else switch(_){case nt.PL:c=Ie.PUNCT;break;case 26:C=" ";break;case nt.LL:c=Ie.LOWER;break;case nt.AL:c=Ie.ALPHA;break;case nt.PS:d=c,c=Ie.PUNCT_SHIFT;break;case nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(s[m]);break;case nt.TEXT_COMPACTION_MODE_LATCH:c=Ie.ALPHA;break}break;case Ie.PUNCT:if(_<nt.PAL)C=nt.PUNCT_CHARS[_];else switch(_){case nt.PAL:c=Ie.ALPHA;break;case nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(s[m]);break;case nt.TEXT_COMPACTION_MODE_LATCH:c=Ie.ALPHA;break}break;case Ie.ALPHA_SHIFT:if(c=d,_<26)C=String.fromCharCode(65+_);else switch(_){case 26:C=" ";break;case nt.TEXT_COMPACTION_MODE_LATCH:c=Ie.ALPHA;break}break;case Ie.PUNCT_SHIFT:if(c=d,_<nt.PAL)C=nt.PUNCT_CHARS[_];else switch(_){case nt.PAL:c=Ie.ALPHA;break;case nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(s[m]);break;case nt.TEXT_COMPACTION_MODE_LATCH:c=Ie.ALPHA;break}break}C!==""&&h.append(C),m++}}static byteCompaction(i,s,a,h,c){let d=new Al,m=0,_=0,C=!1;switch(i){case nt.BYTE_COMPACTION_MODE_LATCH:let M=new Int32Array(6),R=s[h++];for(;h<s[0]&&!C;)switch(M[m++]=R,_=900*_+R,R=s[h++],R){case nt.TEXT_COMPACTION_MODE_LATCH:case nt.BYTE_COMPACTION_MODE_LATCH:case nt.NUMERIC_COMPACTION_MODE_LATCH:case nt.BYTE_COMPACTION_MODE_LATCH_6:case nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case nt.MACRO_PDF417_TERMINATOR:h--,C=!0;break;default:if(m%5===0&&m>0){for(let D=0;D<6;++D)d.write(Number(Dn(_)>>Dn(8*(5-D))));_=0,m=0}break}h===s[0]&&R<nt.TEXT_COMPACTION_MODE_LATCH&&(M[m++]=R);for(let D=0;D<m;D++)d.write(M[D]);break;case nt.BYTE_COMPACTION_MODE_LATCH_6:for(;h<s[0]&&!C;){let D=s[h++];if(D<nt.TEXT_COMPACTION_MODE_LATCH)m++,_=900*_+D;else switch(D){case nt.TEXT_COMPACTION_MODE_LATCH:case nt.BYTE_COMPACTION_MODE_LATCH:case nt.NUMERIC_COMPACTION_MODE_LATCH:case nt.BYTE_COMPACTION_MODE_LATCH_6:case nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case nt.MACRO_PDF417_TERMINATOR:h--,C=!0;break}if(m%5===0&&m>0){for(let k=0;k<6;++k)d.write(Number(Dn(_)>>Dn(8*(5-k))));_=0,m=0}}break}return c.append(xt.decode(d.toByteArray(),a)),h}static numericCompaction(i,s,a){let h=0,c=!1,d=new Int32Array(nt.MAX_NUMERIC_CODEWORDS);for(;s<i[0]&&!c;){let m=i[s++];if(s===i[0]&&(c=!0),m<nt.TEXT_COMPACTION_MODE_LATCH)d[h]=m,h++;else switch(m){case nt.TEXT_COMPACTION_MODE_LATCH:case nt.BYTE_COMPACTION_MODE_LATCH:case nt.BYTE_COMPACTION_MODE_LATCH_6:case nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case nt.MACRO_PDF417_TERMINATOR:s--,c=!0;break}(h%nt.MAX_NUMERIC_CODEWORDS===0||m===nt.NUMERIC_COMPACTION_MODE_LATCH||c)&&h>0&&(a.append(nt.decodeBase900toBase10(d,h)),h=0)}return s}static decodeBase900toBase10(i,s){let a=Dn(0);for(let c=0;c<s;c++)a+=nt.EXP900[s-c-1]*Dn(i[c]);let h=a.toString();if(h.charAt(0)!=="1")throw new X;return h.substring(1)}}nt.TEXT_COMPACTION_MODE_LATCH=900,nt.BYTE_COMPACTION_MODE_LATCH=901,nt.NUMERIC_COMPACTION_MODE_LATCH=902,nt.BYTE_COMPACTION_MODE_LATCH_6=924,nt.ECI_USER_DEFINED=925,nt.ECI_GENERAL_PURPOSE=926,nt.ECI_CHARSET=927,nt.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,nt.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,nt.MACRO_PDF417_TERMINATOR=922,nt.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,nt.MAX_NUMERIC_CODEWORDS=15,nt.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,nt.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,nt.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,nt.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,nt.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,nt.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,nt.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,nt.PL=25,nt.LL=27,nt.AS=27,nt.ML=28,nt.AL=28,nt.PS=29,nt.PAL=29,nt.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,nt.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",nt.EXP900=Qo()?Il():[],nt.NUMBER_OF_SEQUENCE_CODEWORDS=2;class qt{constructor(){}static decode(i,s,a,h,c,d,m){let _=new je(i,s,a,h,c),C=null,M=null,R;for(let j=!0;;j=!1){if(s!=null&&(C=qt.getRowIndicatorColumn(i,_,s,!0,d,m)),h!=null&&(M=qt.getRowIndicatorColumn(i,_,h,!1,d,m)),R=qt.merge(C,M),R==null)throw q.getNotFoundInstance();let K=R.getBoundingBox();if(j&&K!=null&&(K.getMinY()<_.getMinY()||K.getMaxY()>_.getMaxY()))_=K;else break}R.setBoundingBox(_);let D=R.getBarcodeColumnCount()+1;R.setDetectionResultColumn(0,C),R.setDetectionResultColumn(D,M);let k=C!=null;for(let j=1;j<=D;j++){let K=k?j:D-j;if(R.getDetectionResultColumn(K)!==void 0)continue;let tt;K===0||K===D?tt=new Hn(_,K===0):tt=new yn(_),R.setDetectionResultColumn(K,tt);let st=-1,Et=st;for(let At=_.getMinY();At<=_.getMaxY();At++){if(st=qt.getStartColumn(R,K,At,k),st<0||st>_.getMaxX()){if(Et===-1)continue;st=Et}let mt=qt.detectCodeword(i,_.getMinX(),_.getMaxX(),k,st,At,d,m);mt!=null&&(tt.setCodeword(At,mt),Et=st,d=Math.min(d,mt.getWidth()),m=Math.max(m,mt.getWidth()))}}return qt.createDecoderResult(R)}static merge(i,s){if(i==null&&s==null)return null;let a=qt.getBarcodeMetadata(i,s);if(a==null)return null;let h=je.merge(qt.adjustBoundingBox(i),qt.adjustBoundingBox(s));return new fn(a,h)}static adjustBoundingBox(i){if(i==null)return null;let s=i.getRowHeights();if(s==null)return null;let a=qt.getMax(s),h=0;for(let m of s)if(h+=a-m,m>0)break;let c=i.getCodewords();for(let m=0;h>0&&c[m]==null;m++)h--;let d=0;for(let m=s.length-1;m>=0&&(d+=a-s[m],!(s[m]>0));m--);for(let m=c.length-1;d>0&&c[m]==null;m--)d--;return i.getBoundingBox().addMissingRows(h,d,i.isLeft())}static getMax(i){let s=-1;for(let a of i)s=Math.max(s,a);return s}static getBarcodeMetadata(i,s){let a;if(i==null||(a=i.getBarcodeMetadata())==null)return s==null?null:s.getBarcodeMetadata();let h;return s==null||(h=s.getBarcodeMetadata())==null?a:a.getColumnCount()!==h.getColumnCount()&&a.getErrorCorrectionLevel()!==h.getErrorCorrectionLevel()&&a.getRowCount()!==h.getRowCount()?null:a}static getRowIndicatorColumn(i,s,a,h,c,d){let m=new Hn(s,h);for(let _=0;_<2;_++){let C=_===0?1:-1,M=Math.trunc(Math.trunc(a.getX()));for(let R=Math.trunc(Math.trunc(a.getY()));R<=s.getMaxY()&&R>=s.getMinY();R+=C){let D=qt.detectCodeword(i,0,i.getWidth(),h,M,R,c,d);D!=null&&(m.setCodeword(R,D),h?M=D.getStartX():M=D.getEndX())}}return m}static adjustCodewordCount(i,s){let a=s[0][1],h=a.getValue(),c=i.getBarcodeColumnCount()*i.getBarcodeRowCount()-qt.getNumberOfECCodeWords(i.getBarcodeECLevel());if(h.length===0){if(c<1||c>Ut.MAX_CODEWORDS_IN_BARCODE)throw q.getNotFoundInstance();a.setValue(c)}else h[0]!==c&&a.setValue(c)}static createDecoderResult(i){let s=qt.createBarcodeMatrix(i);qt.adjustCodewordCount(i,s);let a=new Array,h=new Int32Array(i.getBarcodeRowCount()*i.getBarcodeColumnCount()),c=[],d=new Array;for(let _=0;_<i.getBarcodeRowCount();_++)for(let C=0;C<i.getBarcodeColumnCount();C++){let M=s[_][C+1].getValue(),R=_*i.getBarcodeColumnCount()+C;M.length===0?a.push(R):M.length===1?h[R]=M[0]:(d.push(R),c.push(M))}let m=new Array(c.length);for(let _=0;_<m.length;_++)m[_]=c[_];return qt.createDecoderResultFromAmbiguousValues(i.getBarcodeECLevel(),h,Ut.toIntArray(a),Ut.toIntArray(d),m)}static createDecoderResultFromAmbiguousValues(i,s,a,h,c){let d=new Int32Array(h.length),m=100;for(;m-- >0;){for(let _=0;_<d.length;_++)s[h[_]]=c[_][d[_]];try{return qt.decodeCodewords(s,i,a)}catch(_){if(!(_ instanceof P))throw _}if(d.length===0)throw P.getChecksumInstance();for(let _=0;_<d.length;_++)if(d[_]<c[_].length-1){d[_]++;break}else if(d[_]=0,_===d.length-1)throw P.getChecksumInstance()}throw P.getChecksumInstance()}static createBarcodeMatrix(i){let s=Array.from({length:i.getBarcodeRowCount()},()=>new Array(i.getBarcodeColumnCount()+2));for(let h=0;h<s.length;h++)for(let c=0;c<s[h].length;c++)s[h][c]=new wn;let a=0;for(let h of i.getDetectionResultColumns()){if(h!=null){for(let c of h.getCodewords())if(c!=null){let d=c.getRowNumber();if(d>=0){if(d>=s.length)continue;s[d][a].setValue(c.getValue())}}}a++}return s}static isValidBarcodeColumn(i,s){return s>=0&&s<=i.getBarcodeColumnCount()+1}static getStartColumn(i,s,a,h){let c=h?1:-1,d=null;if(qt.isValidBarcodeColumn(i,s-c)&&(d=i.getDetectionResultColumn(s-c).getCodeword(a)),d!=null)return h?d.getEndX():d.getStartX();if(d=i.getDetectionResultColumn(s).getCodewordNearby(a),d!=null)return h?d.getStartX():d.getEndX();if(qt.isValidBarcodeColumn(i,s-c)&&(d=i.getDetectionResultColumn(s-c).getCodewordNearby(a)),d!=null)return h?d.getEndX():d.getStartX();let m=0;for(;qt.isValidBarcodeColumn(i,s-c);){s-=c;for(let _ of i.getDetectionResultColumn(s).getCodewords())if(_!=null)return(h?_.getEndX():_.getStartX())+c*m*(_.getEndX()-_.getStartX());m++}return h?i.getBoundingBox().getMinX():i.getBoundingBox().getMaxX()}static detectCodeword(i,s,a,h,c,d,m,_){c=qt.adjustCodewordStartColumn(i,s,a,h,c,d);let C=qt.getModuleBitCount(i,s,a,h,c,d);if(C==null)return null;let M,R=ee.sum(C);if(h)M=c+R;else{for(let j=0;j<C.length/2;j++){let K=C[j];C[j]=C[C.length-1-j],C[C.length-1-j]=K}M=c,c=M-R}if(!qt.checkCodewordSkew(R,m,_))return null;let D=Ni.getDecodedValue(C),k=Ut.getCodeword(D);return k===-1?null:new Pn(c,M,qt.getCodewordBucketNumber(D),k)}static getModuleBitCount(i,s,a,h,c,d){let m=c,_=new Int32Array(8),C=0,M=h?1:-1,R=h;for(;(h?m<a:m>=s)&&C<_.length;)i.get(m,d)===R?(_[C]++,m+=M):(C++,R=!R);return C===_.length||m===(h?a:s)&&C===_.length-1?_:null}static getNumberOfECCodeWords(i){return 2<<i}static adjustCodewordStartColumn(i,s,a,h,c,d){let m=c,_=h?-1:1;for(let C=0;C<2;C++){for(;(h?m>=s:m<a)&&h===i.get(m,d);){if(Math.abs(c-m)>qt.CODEWORD_SKEW_SIZE)return c;m+=_}_=-_,h=!h}return m}static checkCodewordSkew(i,s,a){return s-qt.CODEWORD_SKEW_SIZE<=i&&i<=a+qt.CODEWORD_SKEW_SIZE}static decodeCodewords(i,s,a){if(i.length===0)throw X.getFormatInstance();let h=1<<s+1,c=qt.correctErrors(i,a,h);qt.verifyCodewordCount(i,h);let d=nt.decode(i,""+s);return d.setErrorsCorrected(c),d.setErasures(a.length),d}static correctErrors(i,s,a){if(s!=null&&s.length>a/2+qt.MAX_ERRORS||a<0||a>qt.MAX_EC_CODEWORDS)throw P.getChecksumInstance();return qt.errorCorrection.decode(i,a,s)}static verifyCodewordCount(i,s){if(i.length<4)throw X.getFormatInstance();let a=i[0];if(a>i.length)throw X.getFormatInstance();if(a===0)if(s<i.length)i[0]=i.length-s;else throw X.getFormatInstance()}static getBitCountForCodeword(i){let s=new Int32Array(8),a=0,h=s.length-1;for(;!((i&1)!==a&&(a=i&1,h--,h<0));)s[h]++,i>>=1;return s}static getCodewordBucketNumber(i){return i instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(i):this.getCodewordBucketNumber_number(i)}static getCodewordBucketNumber_number(i){return qt.getCodewordBucketNumber(qt.getBitCountForCodeword(i))}static getCodewordBucketNumber_Int32Array(i){return(i[0]-i[2]+i[4]-i[6]+9)%9}static toString(i){let s=new pn;for(let a=0;a<i.length;a++){s.format("Row %2d: ",a);for(let h=0;h<i[a].length;h++){let c=i[a][h];c.getValue().length===0?s.format("        ",null):s.format("%4d(%2d)",c.getValue()[0],c.getConfidence(c.getValue()[0]))}s.format("%n")}return s.toString()}}qt.CODEWORD_SKEW_SIZE=2,qt.MAX_ERRORS=3,qt.MAX_EC_CODEWORDS=512,qt.errorCorrection=new Ko;class fi{decode(i,s=null){let a=fi.decode(i,s,!1);if(a==null||a.length===0||a[0]==null)throw q.getNotFoundInstance();return a[0]}decodeMultiple(i,s=null){try{return fi.decode(i,s,!0)}catch(a){throw a instanceof X||a instanceof P?q.getNotFoundInstance():a}}static decode(i,s,a){const h=new Array,c=Zt.detectMultiple(i,s,a);for(const d of c.getPoints()){const m=qt.decode(c.getBits(),d[4],d[5],d[6],d[7],fi.getMinCodewordWidth(d),fi.getMaxCodewordWidth(d)),_=new gt(m.getText(),m.getRawBytes(),void 0,d,Rt.PDF_417);_.putMetadata(ye.ERROR_CORRECTION_LEVEL,m.getECLevel());const C=m.getOther();C!=null&&_.putMetadata(ye.PDF417_EXTRA_METADATA,C),h.push(_)}return h.map(d=>d)}static getMaxWidth(i,s){return i==null||s==null?0:Math.trunc(Math.abs(i.getX()-s.getX()))}static getMinWidth(i,s){return i==null||s==null?Y.MAX_VALUE:Math.trunc(Math.abs(i.getX()-s.getX()))}static getMaxCodewordWidth(i){return Math.floor(Math.max(Math.max(fi.getMaxWidth(i[0],i[4]),fi.getMaxWidth(i[6],i[2])*Ut.MODULES_IN_CODEWORD/Ut.MODULES_IN_STOP_PATTERN),Math.max(fi.getMaxWidth(i[1],i[5]),fi.getMaxWidth(i[7],i[3])*Ut.MODULES_IN_CODEWORD/Ut.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(i){return Math.floor(Math.min(Math.min(fi.getMinWidth(i[0],i[4]),fi.getMinWidth(i[6],i[2])*Ut.MODULES_IN_CODEWORD/Ut.MODULES_IN_STOP_PATTERN),Math.min(fi.getMinWidth(i[1],i[5]),fi.getMinWidth(i[7],i[3])*Ut.MODULES_IN_CODEWORD/Ut.MODULES_IN_STOP_PATTERN)))}reset(){}}class zs extends E{}zs.kind="ReaderException";class $o{constructor(i,s){this.verbose=i===!0,s&&this.setHints(s)}decode(i,s){return s&&this.setHints(s),this.decodeInternal(i)}decodeWithState(i){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(i)}setHints(i){this.hints=i;const s=!n(i)&&i.get(ot.TRY_HARDER)===!0,a=n(i)?null:i.get(ot.POSSIBLE_FORMATS),h=new Array;if(!n(a)){const c=a.some(d=>d===Rt.UPC_A||d===Rt.UPC_E||d===Rt.EAN_13||d===Rt.EAN_8||d===Rt.CODABAR||d===Rt.CODE_39||d===Rt.CODE_93||d===Rt.CODE_128||d===Rt.ITF||d===Rt.RSS_14||d===Rt.RSS_EXPANDED);c&&!s&&h.push(new _s(i,this.verbose)),a.includes(Rt.QR_CODE)&&h.push(new un),a.includes(Rt.DATA_MATRIX)&&h.push(new He),a.includes(Rt.AZTEC)&&h.push(new Xn),a.includes(Rt.PDF_417)&&h.push(new fi),c&&s&&h.push(new _s(i,this.verbose))}h.length===0&&(s||h.push(new _s(i,this.verbose)),h.push(new un),h.push(new He),h.push(new Xn),h.push(new fi),s&&h.push(new _s(i,this.verbose))),this.readers=h}reset(){if(this.readers!==null)for(const i of this.readers)i.reset()}decodeInternal(i){if(this.readers===null)throw new zs("No readers where selected, nothing can be read.");for(const s of this.readers)try{return s.decode(i,this.hints)}catch(a){if(a instanceof zs)continue}throw new q("No MultiFormat Readers were able to detect the code.")}}class Ml extends te{constructor(i=null,s=500){const a=new $o;a.setHints(i),super(a,s)}decodeBitmap(i){return this.reader.decodeWithState(i)}}class bl extends te{constructor(i=500){super(new fi,i)}}class Tl extends te{constructor(i=500){super(new un,i)}}var Kr;(function(T){T[T.ERROR_CORRECTION=0]="ERROR_CORRECTION",T[T.CHARACTER_SET=1]="CHARACTER_SET",T[T.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",T[T.MIN_SIZE=3]="MIN_SIZE",T[T.MAX_SIZE=4]="MAX_SIZE",T[T.MARGIN=5]="MARGIN",T[T.PDF417_COMPACT=6]="PDF417_COMPACT",T[T.PDF417_COMPACTION=7]="PDF417_COMPACTION",T[T.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",T[T.AZTEC_LAYERS=9]="AZTEC_LAYERS",T[T.QR_VERSION=10]="QR_VERSION"})(Kr||(Kr={}));var ai=Kr;class qr{constructor(i){this.field=i,this.cachedGenerators=[],this.cachedGenerators.push(new Ke(i,Int32Array.from([1])))}buildGenerator(i){const s=this.cachedGenerators;if(i>=s.length){let a=s[s.length-1];const h=this.field;for(let c=s.length;c<=i;c++){const d=a.multiply(new Ke(h,Int32Array.from([1,h.exp(c-1+h.getGeneratorBase())])));s.push(d),a=d}}return s[i]}encode(i,s){if(s===0)throw new A("No error correction bytes");const a=i.length-s;if(a<=0)throw new A("No data bytes provided");const h=this.buildGenerator(s),c=new Int32Array(a);F.arraycopy(i,0,c,0,a);let d=new Ke(this.field,c);d=d.multiplyByMonomial(s,1);const _=d.divide(h)[1].getCoefficients(),C=s-_.length;for(let M=0;M<C;M++)i[a+M]=0;F.arraycopy(_,0,i,a+C,_.length)}}class Xe{constructor(){}static applyMaskPenaltyRule1(i){return Xe.applyMaskPenaltyRule1Internal(i,!0)+Xe.applyMaskPenaltyRule1Internal(i,!1)}static applyMaskPenaltyRule2(i){let s=0;const a=i.getArray(),h=i.getWidth(),c=i.getHeight();for(let d=0;d<c-1;d++){const m=a[d];for(let _=0;_<h-1;_++){const C=m[_];C===m[_+1]&&C===a[d+1][_]&&C===a[d+1][_+1]&&s++}}return Xe.N2*s}static applyMaskPenaltyRule3(i){let s=0;const a=i.getArray(),h=i.getWidth(),c=i.getHeight();for(let d=0;d<c;d++)for(let m=0;m<h;m++){const _=a[d];m+6<h&&_[m]===1&&_[m+1]===0&&_[m+2]===1&&_[m+3]===1&&_[m+4]===1&&_[m+5]===0&&_[m+6]===1&&(Xe.isWhiteHorizontal(_,m-4,m)||Xe.isWhiteHorizontal(_,m+7,m+11))&&s++,d+6<c&&a[d][m]===1&&a[d+1][m]===0&&a[d+2][m]===1&&a[d+3][m]===1&&a[d+4][m]===1&&a[d+5][m]===0&&a[d+6][m]===1&&(Xe.isWhiteVertical(a,m,d-4,d)||Xe.isWhiteVertical(a,m,d+7,d+11))&&s++}return s*Xe.N3}static isWhiteHorizontal(i,s,a){s=Math.max(s,0),a=Math.min(a,i.length);for(let h=s;h<a;h++)if(i[h]===1)return!1;return!0}static isWhiteVertical(i,s,a,h){a=Math.max(a,0),h=Math.min(h,i.length);for(let c=a;c<h;c++)if(i[c][s]===1)return!1;return!0}static applyMaskPenaltyRule4(i){let s=0;const a=i.getArray(),h=i.getWidth(),c=i.getHeight();for(let _=0;_<c;_++){const C=a[_];for(let M=0;M<h;M++)C[M]===1&&s++}const d=i.getHeight()*i.getWidth();return Math.floor(Math.abs(s*2-d)*10/d)*Xe.N4}static getDataMaskBit(i,s,a){let h,c;switch(i){case 0:h=a+s&1;break;case 1:h=a&1;break;case 2:h=s%3;break;case 3:h=(a+s)%3;break;case 4:h=Math.floor(a/2)+Math.floor(s/3)&1;break;case 5:c=a*s,h=(c&1)+c%3;break;case 6:c=a*s,h=(c&1)+c%3&1;break;case 7:c=a*s,h=c%3+(a+s&1)&1;break;default:throw new A("Invalid mask pattern: "+i)}return h===0}static applyMaskPenaltyRule1Internal(i,s){let a=0;const h=s?i.getHeight():i.getWidth(),c=s?i.getWidth():i.getHeight(),d=i.getArray();for(let m=0;m<h;m++){let _=0,C=-1;for(let M=0;M<c;M++){const R=s?d[m][M]:d[M][m];R===C?_++:(_>=5&&(a+=Xe.N1+(_-5)),_=1,C=R)}_>=5&&(a+=Xe.N1+(_-5))}return a}}Xe.N1=3,Xe.N2=3,Xe.N3=40,Xe.N4=10;class mr{constructor(i,s){this.width=i,this.height=s;const a=new Array(s);for(let h=0;h!==s;h++)a[h]=new Uint8Array(i);this.bytes=a}getHeight(){return this.height}getWidth(){return this.width}get(i,s){return this.bytes[s][i]}getArray(){return this.bytes}setNumber(i,s,a){this.bytes[s][i]=a}setBoolean(i,s,a){this.bytes[s][i]=a?1:0}clear(i){for(const s of this.bytes)U.fill(s,i)}equals(i){if(!(i instanceof mr))return!1;const s=i;if(this.width!==s.width||this.height!==s.height)return!1;for(let a=0,h=this.height;a<h;++a){const c=this.bytes[a],d=s.bytes[a];for(let m=0,_=this.width;m<_;++m)if(c[m]!==d[m])return!1}return!0}toString(){const i=new ut;for(let s=0,a=this.height;s<a;++s){const h=this.bytes[s];for(let c=0,d=this.width;c<d;++c)switch(h[c]){case 0:i.append(" 0");break;case 1:i.append(" 1");break;default:i.append("  ");break}i.append(`
`)}return i.toString()}}class jn{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const i=new ut;return i.append(`<<
`),i.append(" mode: "),i.append(this.mode?this.mode.toString():"null"),i.append(`
 ecLevel: `),i.append(this.ecLevel?this.ecLevel.toString():"null"),i.append(`
 version: `),i.append(this.version?this.version.toString():"null"),i.append(`
 maskPattern: `),i.append(this.maskPattern.toString()),this.matrix?(i.append(`
 matrix:
`),i.append(this.matrix.toString())):i.append(`
 matrix: null
`),i.append(`>>
`),i.toString()}setMode(i){this.mode=i}setECLevel(i){this.ecLevel=i}setVersion(i){this.version=i}setMaskPattern(i){this.maskPattern=i}setMatrix(i){this.matrix=i}static isValidMaskPattern(i){return i>=0&&i<jn.NUM_MASK_PATTERNS}}jn.NUM_MASK_PATTERNS=8;class zt extends E{}zt.kind="WriterException";class bt{constructor(){}static clearMatrix(i){i.clear(255)}static buildMatrix(i,s,a,h,c){bt.clearMatrix(c),bt.embedBasicPatterns(a,c),bt.embedTypeInfo(s,h,c),bt.maybeEmbedVersionInfo(a,c),bt.embedDataBits(i,h,c)}static embedBasicPatterns(i,s){bt.embedPositionDetectionPatternsAndSeparators(s),bt.embedDarkDotAtLeftBottomCorner(s),bt.maybeEmbedPositionAdjustmentPatterns(i,s),bt.embedTimingPatterns(s)}static embedTypeInfo(i,s,a){const h=new Z;bt.makeTypeInfoBits(i,s,h);for(let c=0,d=h.getSize();c<d;++c){const m=h.get(h.getSize()-1-c),_=bt.TYPE_INFO_COORDINATES[c],C=_[0],M=_[1];if(a.setBoolean(C,M,m),c<8){const R=a.getWidth()-c-1;a.setBoolean(R,8,m)}else{const D=a.getHeight()-7+(c-8);a.setBoolean(8,D,m)}}}static maybeEmbedVersionInfo(i,s){if(i.getVersionNumber()<7)return;const a=new Z;bt.makeVersionInfoBits(i,a);let h=6*3-1;for(let c=0;c<6;++c)for(let d=0;d<3;++d){const m=a.get(h);h--,s.setBoolean(c,s.getHeight()-11+d,m),s.setBoolean(s.getHeight()-11+d,c,m)}}static embedDataBits(i,s,a){let h=0,c=-1,d=a.getWidth()-1,m=a.getHeight()-1;for(;d>0;){for(d===6&&(d-=1);m>=0&&m<a.getHeight();){for(let _=0;_<2;++_){const C=d-_;if(!bt.isEmpty(a.get(C,m)))continue;let M;h<i.getSize()?(M=i.get(h),++h):M=!1,s!==255&&Xe.getDataMaskBit(s,C,m)&&(M=!M),a.setBoolean(C,m,M)}m+=c}c=-c,m+=c,d-=2}if(h!==i.getSize())throw new zt("Not all bits consumed: "+h+"/"+i.getSize())}static findMSBSet(i){return 32-Y.numberOfLeadingZeros(i)}static calculateBCHCode(i,s){if(s===0)throw new A("0 polynomial");const a=bt.findMSBSet(s);for(i<<=a-1;bt.findMSBSet(i)>=a;)i^=s<<bt.findMSBSet(i)-a;return i}static makeTypeInfoBits(i,s,a){if(!jn.isValidMaskPattern(s))throw new zt("Invalid mask pattern");const h=i.getBits()<<3|s;a.appendBits(h,5);const c=bt.calculateBCHCode(h,bt.TYPE_INFO_POLY);a.appendBits(c,10);const d=new Z;if(d.appendBits(bt.TYPE_INFO_MASK_PATTERN,15),a.xor(d),a.getSize()!==15)throw new zt("should not happen but we got: "+a.getSize())}static makeVersionInfoBits(i,s){s.appendBits(i.getVersionNumber(),6);const a=bt.calculateBCHCode(i.getVersionNumber(),bt.VERSION_INFO_POLY);if(s.appendBits(a,12),s.getSize()!==18)throw new zt("should not happen but we got: "+s.getSize())}static isEmpty(i){return i===255}static embedTimingPatterns(i){for(let s=8;s<i.getWidth()-8;++s){const a=(s+1)%2;bt.isEmpty(i.get(s,6))&&i.setNumber(s,6,a),bt.isEmpty(i.get(6,s))&&i.setNumber(6,s,a)}}static embedDarkDotAtLeftBottomCorner(i){if(i.get(8,i.getHeight()-8)===0)throw new zt;i.setNumber(8,i.getHeight()-8,1)}static embedHorizontalSeparationPattern(i,s,a){for(let h=0;h<8;++h){if(!bt.isEmpty(a.get(i+h,s)))throw new zt;a.setNumber(i+h,s,0)}}static embedVerticalSeparationPattern(i,s,a){for(let h=0;h<7;++h){if(!bt.isEmpty(a.get(i,s+h)))throw new zt;a.setNumber(i,s+h,0)}}static embedPositionAdjustmentPattern(i,s,a){for(let h=0;h<5;++h){const c=bt.POSITION_ADJUSTMENT_PATTERN[h];for(let d=0;d<5;++d)a.setNumber(i+d,s+h,c[d])}}static embedPositionDetectionPattern(i,s,a){for(let h=0;h<7;++h){const c=bt.POSITION_DETECTION_PATTERN[h];for(let d=0;d<7;++d)a.setNumber(i+d,s+h,c[d])}}static embedPositionDetectionPatternsAndSeparators(i){const s=bt.POSITION_DETECTION_PATTERN[0].length;bt.embedPositionDetectionPattern(0,0,i),bt.embedPositionDetectionPattern(i.getWidth()-s,0,i),bt.embedPositionDetectionPattern(0,i.getWidth()-s,i);const a=8;bt.embedHorizontalSeparationPattern(0,a-1,i),bt.embedHorizontalSeparationPattern(i.getWidth()-a,a-1,i),bt.embedHorizontalSeparationPattern(0,i.getWidth()-a,i);const h=7;bt.embedVerticalSeparationPattern(h,0,i),bt.embedVerticalSeparationPattern(i.getHeight()-h-1,0,i),bt.embedVerticalSeparationPattern(h,i.getHeight()-h,i)}static maybeEmbedPositionAdjustmentPatterns(i,s){if(i.getVersionNumber()<2)return;const a=i.getVersionNumber()-1,h=bt.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[a];for(let c=0,d=h.length;c!==d;c++){const m=h[c];if(m>=0)for(let _=0;_!==d;_++){const C=h[_];C>=0&&bt.isEmpty(s.get(C,m))&&bt.embedPositionAdjustmentPattern(C-2,m-2,s)}}}}bt.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),bt.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),bt.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),bt.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),bt.VERSION_INFO_POLY=7973,bt.TYPE_INFO_POLY=1335,bt.TYPE_INFO_MASK_PATTERN=21522;class Sl{constructor(i,s){this.dataBytes=i,this.errorCorrectionBytes=s}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Re{constructor(){}static calculateMaskPenalty(i){return Xe.applyMaskPenaltyRule1(i)+Xe.applyMaskPenaltyRule2(i)+Xe.applyMaskPenaltyRule3(i)+Xe.applyMaskPenaltyRule4(i)}static encode(i,s,a=null){let h=Re.DEFAULT_BYTE_MODE_ENCODING;const c=a!==null&&a.get(ai.CHARACTER_SET)!==void 0;c&&(h=a.get(ai.CHARACTER_SET).toString());const d=this.chooseMode(i,h),m=new Z;if(d===Dt.BYTE&&(c||Re.DEFAULT_BYTE_MODE_ENCODING!==h)){const At=H.getCharacterSetECIByName(h);At!==void 0&&this.appendECI(At,m)}this.appendModeInfo(d,m);const _=new Z;this.appendBytes(i,d,_,h);let C;if(a!==null&&a.get(ai.QR_VERSION)!==void 0){const At=Number.parseInt(a.get(ai.QR_VERSION).toString(),10);C=Nt.getVersionForNumber(At);const mt=this.calculateBitsNeeded(d,m,_,C);if(!this.willFit(mt,C,s))throw new zt("Data too big for requested version")}else C=this.recommendVersion(s,d,m,_);const M=new Z;M.appendBitArray(m);const R=d===Dt.BYTE?_.getSizeInBytes():i.length;this.appendLengthInfo(R,C,d,M),M.appendBitArray(_);const D=C.getECBlocksForLevel(s),k=C.getTotalCodewords()-D.getTotalECCodewords();this.terminateBits(k,M);const j=this.interleaveWithECBytes(M,C.getTotalCodewords(),k,D.getNumBlocks()),K=new jn;K.setECLevel(s),K.setMode(d),K.setVersion(C);const tt=C.getDimensionForVersion(),st=new mr(tt,tt),Et=this.chooseMaskPattern(j,s,C,st);return K.setMaskPattern(Et),bt.buildMatrix(j,s,C,Et,st),K.setMatrix(st),K}static recommendVersion(i,s,a,h){const c=this.calculateBitsNeeded(s,a,h,Nt.getVersionForNumber(1)),d=this.chooseVersion(c,i),m=this.calculateBitsNeeded(s,a,h,d);return this.chooseVersion(m,i)}static calculateBitsNeeded(i,s,a,h){return s.getSize()+i.getCharacterCountBits(h)+a.getSize()}static getAlphanumericCode(i){return i<Re.ALPHANUMERIC_TABLE.length?Re.ALPHANUMERIC_TABLE[i]:-1}static chooseMode(i,s=null){if(H.SJIS.getName()===s&&this.isOnlyDoubleByteKanji(i))return Dt.KANJI;let a=!1,h=!1;for(let c=0,d=i.length;c<d;++c){const m=i.charAt(c);if(Re.isDigit(m))a=!0;else if(this.getAlphanumericCode(m.charCodeAt(0))!==-1)h=!0;else return Dt.BYTE}return h?Dt.ALPHANUMERIC:a?Dt.NUMERIC:Dt.BYTE}static isOnlyDoubleByteKanji(i){let s;try{s=xt.encode(i,H.SJIS)}catch{return!1}const a=s.length;if(a%2!==0)return!1;for(let h=0;h<a;h+=2){const c=s[h]&255;if((c<129||c>159)&&(c<224||c>235))return!1}return!0}static chooseMaskPattern(i,s,a,h){let c=Number.MAX_SAFE_INTEGER,d=-1;for(let m=0;m<jn.NUM_MASK_PATTERNS;m++){bt.buildMatrix(i,s,a,m,h);let _=this.calculateMaskPenalty(h);_<c&&(c=_,d=m)}return d}static chooseVersion(i,s){for(let a=1;a<=40;a++){const h=Nt.getVersionForNumber(a);if(Re.willFit(i,h,s))return h}throw new zt("Data too big")}static willFit(i,s,a){const h=s.getTotalCodewords(),d=s.getECBlocksForLevel(a).getTotalECCodewords(),m=h-d,_=(i+7)/8;return m>=_}static terminateBits(i,s){const a=i*8;if(s.getSize()>a)throw new zt("data bits cannot fit in the QR Code"+s.getSize()+" > "+a);for(let d=0;d<4&&s.getSize()<a;++d)s.appendBit(!1);const h=s.getSize()&7;if(h>0)for(let d=h;d<8;d++)s.appendBit(!1);const c=i-s.getSizeInBytes();for(let d=0;d<c;++d)s.appendBits(d&1?17:236,8);if(s.getSize()!==a)throw new zt("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(i,s,a,h,c,d){if(h>=a)throw new zt("Block ID too large");const m=i%a,_=a-m,C=Math.floor(i/a),M=C+1,R=Math.floor(s/a),D=R+1,k=C-R,j=M-D;if(k!==j)throw new zt("EC bytes mismatch");if(a!==_+m)throw new zt("RS blocks mismatch");if(i!==(R+k)*_+(D+j)*m)throw new zt("Total bytes mismatch");h<_?(c[0]=R,d[0]=k):(c[0]=D,d[0]=j)}static interleaveWithECBytes(i,s,a,h){if(i.getSizeInBytes()!==a)throw new zt("Number of bits and data bytes does not match");let c=0,d=0,m=0;const _=new Array;for(let M=0;M<h;++M){const R=new Int32Array(1),D=new Int32Array(1);Re.getNumDataBytesAndNumECBytesForBlockID(s,a,h,M,R,D);const k=R[0],j=new Uint8Array(k);i.toBytes(8*c,j,0,k);const K=Re.generateECBytes(j,D[0]);_.push(new Sl(j,K)),d=Math.max(d,k),m=Math.max(m,K.length),c+=R[0]}if(a!==c)throw new zt("Data bytes does not match offset");const C=new Z;for(let M=0;M<d;++M)for(const R of _){const D=R.getDataBytes();M<D.length&&C.appendBits(D[M],8)}for(let M=0;M<m;++M)for(const R of _){const D=R.getErrorCorrectionBytes();M<D.length&&C.appendBits(D[M],8)}if(s!==C.getSizeInBytes())throw new zt("Interleaving error: "+s+" and "+C.getSizeInBytes()+" differ.");return C}static generateECBytes(i,s){const a=i.length,h=new Int32Array(a+s);for(let d=0;d<a;d++)h[d]=i[d]&255;new qr(ne.QR_CODE_FIELD_256).encode(h,s);const c=new Uint8Array(s);for(let d=0;d<s;d++)c[d]=h[a+d];return c}static appendModeInfo(i,s){s.appendBits(i.getBits(),4)}static appendLengthInfo(i,s,a,h){const c=a.getCharacterCountBits(s);if(i>=1<<c)throw new zt(i+" is bigger than "+((1<<c)-1));h.appendBits(i,c)}static appendBytes(i,s,a,h){switch(s){case Dt.NUMERIC:Re.appendNumericBytes(i,a);break;case Dt.ALPHANUMERIC:Re.appendAlphanumericBytes(i,a);break;case Dt.BYTE:Re.append8BitBytes(i,a,h);break;case Dt.KANJI:Re.appendKanjiBytes(i,a);break;default:throw new zt("Invalid mode: "+s)}}static getDigit(i){return i.charCodeAt(0)-48}static isDigit(i){const s=Re.getDigit(i);return s>=0&&s<=9}static appendNumericBytes(i,s){const a=i.length;let h=0;for(;h<a;){const c=Re.getDigit(i.charAt(h));if(h+2<a){const d=Re.getDigit(i.charAt(h+1)),m=Re.getDigit(i.charAt(h+2));s.appendBits(c*100+d*10+m,10),h+=3}else if(h+1<a){const d=Re.getDigit(i.charAt(h+1));s.appendBits(c*10+d,7),h+=2}else s.appendBits(c,4),h++}}static appendAlphanumericBytes(i,s){const a=i.length;let h=0;for(;h<a;){const c=Re.getAlphanumericCode(i.charCodeAt(h));if(c===-1)throw new zt;if(h+1<a){const d=Re.getAlphanumericCode(i.charCodeAt(h+1));if(d===-1)throw new zt;s.appendBits(c*45+d,11),h+=2}else s.appendBits(c,6),h++}}static append8BitBytes(i,s,a){let h;try{h=xt.encode(i,a)}catch(c){throw new zt(c)}for(let c=0,d=h.length;c!==d;c++){const m=h[c];s.appendBits(m,8)}}static appendKanjiBytes(i,s){let a;try{a=xt.encode(i,H.SJIS)}catch(c){throw new zt(c)}const h=a.length;for(let c=0;c<h;c+=2){const d=a[c]&255,m=a[c+1]&255,_=d<<8&4294967295|m;let C=-1;if(_>=33088&&_<=40956?C=_-33088:_>=57408&&_<=60351&&(C=_-49472),C===-1)throw new zt("Invalid byte sequence");const M=(C>>8)*192+(C&255);s.appendBits(M,13)}}static appendECI(i,s){s.appendBits(Dt.ECI.getBits(),4),s.appendBits(i.getValue(),8)}}Re.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Re.DEFAULT_BYTE_MODE_ENCODING=H.UTF8.getName();class Qi{write(i,s,a,h=null){if(i.length===0)throw new A("Found empty contents");if(s<0||a<0)throw new A("Requested dimensions are too small: "+s+"x"+a);let c=Ee.L,d=Qi.QUIET_ZONE_SIZE;h!==null&&(h.get(ai.ERROR_CORRECTION)!==void 0&&(c=Ee.fromString(h.get(ai.ERROR_CORRECTION).toString())),h.get(ai.MARGIN)!==void 0&&(d=Number.parseInt(h.get(ai.MARGIN).toString(),10)));const m=Re.encode(i,c,h);return this.renderResult(m,s,a,d)}writeToDom(i,s,a,h,c=null){typeof i=="string"&&(i=document.querySelector(i));const d=this.write(s,a,h,c);i&&i.appendChild(d)}renderResult(i,s,a,h){const c=i.getMatrix();if(c===null)throw new hi;const d=c.getWidth(),m=c.getHeight(),_=d+h*2,C=m+h*2,M=Math.max(s,_),R=Math.max(a,C),D=Math.min(Math.floor(M/_),Math.floor(R/C)),k=Math.floor((M-d*D)/2),j=Math.floor((R-m*D)/2),K=this.createSVGElement(M,R);for(let tt=0,st=j;tt<m;tt++,st+=D)for(let Et=0,At=k;Et<d;Et++,At+=D)if(c.get(Et,tt)===1){const mt=this.createSvgRectElement(At,st,D,D);K.appendChild(mt)}return K}createSVGElement(i,s){const a=document.createElementNS(Qi.SVG_NS,"svg");return a.setAttributeNS(null,"height",i.toString()),a.setAttributeNS(null,"width",s.toString()),a}createSvgRectElement(i,s,a,h){const c=document.createElementNS(Qi.SVG_NS,"rect");return c.setAttributeNS(null,"x",i.toString()),c.setAttributeNS(null,"y",s.toString()),c.setAttributeNS(null,"height",a.toString()),c.setAttributeNS(null,"width",h.toString()),c.setAttributeNS(null,"fill","#000000"),c}}Qi.QUIET_ZONE_SIZE=4,Qi.SVG_NS="http://www.w3.org/2000/svg";class Zn{encode(i,s,a,h,c){if(i.length===0)throw new A("Found empty contents");if(s!==Rt.QR_CODE)throw new A("Can only encode QR_CODE, but got "+s);if(a<0||h<0)throw new A(`Requested dimensions are too small: ${a}x${h}`);let d=Ee.L,m=Zn.QUIET_ZONE_SIZE;c!==null&&(c.get(ai.ERROR_CORRECTION)!==void 0&&(d=Ee.fromString(c.get(ai.ERROR_CORRECTION).toString())),c.get(ai.MARGIN)!==void 0&&(m=Number.parseInt(c.get(ai.MARGIN).toString(),10)));const _=Re.encode(i,d,c);return Zn.renderResult(_,a,h,m)}static renderResult(i,s,a,h){const c=i.getMatrix();if(c===null)throw new hi;const d=c.getWidth(),m=c.getHeight(),_=d+h*2,C=m+h*2,M=Math.max(s,_),R=Math.max(a,C),D=Math.min(Math.floor(M/_),Math.floor(R/C)),k=Math.floor((M-d*D)/2),j=Math.floor((R-m*D)/2),K=new pt(M,R);for(let tt=0,st=j;tt<m;tt++,st+=D)for(let Et=0,At=k;Et<d;Et++,At+=D)c.get(Et,tt)===1&&K.setRegion(At,st,D,D);return K}}Zn.QUIET_ZONE_SIZE=4;class ta{encode(i,s,a,h,c){let d;switch(s){case Rt.QR_CODE:d=new Zn;break;default:throw new A("No encoder available for format "+s)}return d.encode(i,s,a,h,c)}}class $i extends Lt{constructor(i,s,a,h,c,d,m,_){if(super(d,m),this.yuvData=i,this.dataWidth=s,this.dataHeight=a,this.left=h,this.top=c,h+d>s||c+m>a)throw new A("Crop rectangle does not fit within image data.");_&&this.reverseHorizontal(d,m)}getRow(i,s){if(i<0||i>=this.getHeight())throw new A("Requested row is outside the image: "+i);const a=this.getWidth();(s==null||s.length<a)&&(s=new Uint8ClampedArray(a));const h=(i+this.top)*this.dataWidth+this.left;return F.arraycopy(this.yuvData,h,s,0,a),s}getMatrix(){const i=this.getWidth(),s=this.getHeight();if(i===this.dataWidth&&s===this.dataHeight)return this.yuvData;const a=i*s,h=new Uint8ClampedArray(a);let c=this.top*this.dataWidth+this.left;if(i===this.dataWidth)return F.arraycopy(this.yuvData,c,h,0,a),h;for(let d=0;d<s;d++){const m=d*i;F.arraycopy(this.yuvData,c,h,m,i),c+=this.dataWidth}return h}isCropSupported(){return!0}crop(i,s,a,h){return new $i(this.yuvData,this.dataWidth,this.dataHeight,this.left+i,this.top+s,a,h,!1)}renderThumbnail(){const i=this.getWidth()/$i.THUMBNAIL_SCALE_FACTOR,s=this.getHeight()/$i.THUMBNAIL_SCALE_FACTOR,a=new Int32Array(i*s),h=this.yuvData;let c=this.top*this.dataWidth+this.left;for(let d=0;d<s;d++){const m=d*i;for(let _=0;_<i;_++){const C=h[c+_*$i.THUMBNAIL_SCALE_FACTOR]&255;a[m+_]=4278190080|C*65793}c+=this.dataWidth*$i.THUMBNAIL_SCALE_FACTOR}return a}getThumbnailWidth(){return this.getWidth()/$i.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/$i.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(i,s){const a=this.yuvData;for(let h=0,c=this.top*this.dataWidth+this.left;h<s;h++,c+=this.dataWidth){const d=c+i/2;for(let m=c,_=c+i-1;m<d;m++,_--){const C=a[m];a[m]=a[_],a[_]=C}}}invert(){return new oe(this)}}$i.THUMBNAIL_SCALE_FACTOR=2;class Jr extends Lt{constructor(i,s,a,h,c,d,m){if(super(s,a),this.dataWidth=h,this.dataHeight=c,this.left=d,this.top=m,i.BYTES_PER_ELEMENT===4){const _=s*a,C=new Uint8ClampedArray(_);for(let M=0;M<_;M++){const R=i[M],D=R>>16&255,k=R>>7&510,j=R&255;C[M]=(D+k+j)/4&255}this.luminances=C}else this.luminances=i;if(h===void 0&&(this.dataWidth=s),c===void 0&&(this.dataHeight=a),d===void 0&&(this.left=0),m===void 0&&(this.top=0),this.left+s>this.dataWidth||this.top+a>this.dataHeight)throw new A("Crop rectangle does not fit within image data.")}getRow(i,s){if(i<0||i>=this.getHeight())throw new A("Requested row is outside the image: "+i);const a=this.getWidth();(s==null||s.length<a)&&(s=new Uint8ClampedArray(a));const h=(i+this.top)*this.dataWidth+this.left;return F.arraycopy(this.luminances,h,s,0,a),s}getMatrix(){const i=this.getWidth(),s=this.getHeight();if(i===this.dataWidth&&s===this.dataHeight)return this.luminances;const a=i*s,h=new Uint8ClampedArray(a);let c=this.top*this.dataWidth+this.left;if(i===this.dataWidth)return F.arraycopy(this.luminances,c,h,0,a),h;for(let d=0;d<s;d++){const m=d*i;F.arraycopy(this.luminances,c,h,m,i),c+=this.dataWidth}return h}isCropSupported(){return!0}crop(i,s,a,h){return new Jr(this.luminances,a,h,this.dataWidth,this.dataHeight,this.left+i,this.top+s)}invert(){return new oe(this)}}class Kn extends H{static forName(i){return this.getCharacterSetECIByName(i)}}class ps{}ps.ISO_8859_1=H.ISO8859_1;class ea{isCompact(){return this.compact}setCompact(i){this.compact=i}getSize(){return this.size}setSize(i){this.size=i}getLayers(){return this.layers}setLayers(i){this.layers=i}getCodeWords(){return this.codeWords}setCodeWords(i){this.codeWords=i}getMatrix(){return this.matrix}setMatrix(i){this.matrix=i}}class ia{static singletonList(i){return[i]}static min(i,s){return i.sort(s)[0]}}class Rl{constructor(i){this.previous=i}getPrevious(){return this.previous}}class Ze extends Rl{constructor(i,s,a){super(i),this.value=s,this.bitCount=a}appendTo(i,s){i.appendBits(this.value,this.bitCount)}add(i,s){return new Ze(this,i,s)}addBinaryShift(i,s){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Ze(this,i,s)}toString(){let i=this.value&(1<<this.bitCount)-1;return i|=1<<this.bitCount,"<"+Y.toBinaryString(i|1<<this.bitCount).substring(1)+">"}}class qn extends Ze{constructor(i,s,a){super(i,0,0),this.binaryShiftStart=s,this.binaryShiftByteCount=a}appendTo(i,s){for(let a=0;a<this.binaryShiftByteCount;a++)(a===0||a===31&&this.binaryShiftByteCount<=62)&&(i.appendBits(31,5),this.binaryShiftByteCount>62?i.appendBits(this.binaryShiftByteCount-31,16):a===0?i.appendBits(Math.min(this.binaryShiftByteCount,31),5):i.appendBits(this.binaryShiftByteCount-31,5)),i.appendBits(s[this.binaryShiftStart+a],8)}addBinaryShift(i,s){return new qn(this,i,s)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function vl(T,i,s){return new qn(T,i,s)}function Ws(T,i,s){return new Ze(T,i,s)}const f=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],p=0,y=1,b=2,I=3,v=4,N=new Ze(null,0,0),O=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function G(T){for(let i of T)U.fill(i,-1);return T[p][v]=0,T[y][v]=0,T[y][p]=28,T[I][v]=0,T[b][v]=0,T[b][p]=15,T}const W=G(U.createInt32Array(6,6));class Q{constructor(i,s,a,h){this.token=i,this.mode=s,this.binaryShiftByteCount=a,this.bitCount=h}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(i,s){let a=this.bitCount,h=this.token;if(i!==this.mode){let d=O[this.mode][i];h=Ws(h,d&65535,d>>16),a+=d>>16}let c=i===b?4:5;return h=Ws(h,s,c),new Q(h,i,0,a+c)}shiftAndAppend(i,s){let a=this.token,h=this.mode===b?4:5;return a=Ws(a,W[this.mode][i],h),a=Ws(a,s,5),new Q(a,this.mode,0,this.bitCount+h+5)}addBinaryShiftChar(i){let s=this.token,a=this.mode,h=this.bitCount;if(this.mode===v||this.mode===b){let m=O[a][p];s=Ws(s,m&65535,m>>16),h+=m>>16,a=p}let c=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,d=new Q(s,a,this.binaryShiftByteCount+1,h+c);return d.binaryShiftByteCount===2078&&(d=d.endBinaryShift(i+1)),d}endBinaryShift(i){if(this.binaryShiftByteCount===0)return this;let s=this.token;return s=vl(s,i-this.binaryShiftByteCount,this.binaryShiftByteCount),new Q(s,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(i){let s=this.bitCount+(O[this.mode][i.mode]>>16);return this.binaryShiftByteCount<i.binaryShiftByteCount?s+=Q.calculateBinaryShiftCost(i)-Q.calculateBinaryShiftCost(this):this.binaryShiftByteCount>i.binaryShiftByteCount&&i.binaryShiftByteCount>0&&(s+=10),s<=i.bitCount}toBitArray(i){let s=[];for(let h=this.endBinaryShift(i.length).token;h!==null;h=h.getPrevious())s.unshift(h);let a=new Z;for(const h of s)h.appendTo(a,i);return a}toString(){return at.format("%s bits=%d bytes=%d",f[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(i){return i.binaryShiftByteCount>62?21:i.binaryShiftByteCount>31?20:i.binaryShiftByteCount>0?10:0}}Q.INITIAL_STATE=new Q(N,p,0,0);function it(T){const i=at.getCharCode(" "),s=at.getCharCode("."),a=at.getCharCode(",");T[p][i]=1;const h=at.getCharCode("Z"),c=at.getCharCode("A");for(let D=c;D<=h;D++)T[p][D]=D-c+2;T[y][i]=1;const d=at.getCharCode("z"),m=at.getCharCode("a");for(let D=m;D<=d;D++)T[y][D]=D-m+2;T[b][i]=1;const _=at.getCharCode("9"),C=at.getCharCode("0");for(let D=C;D<=_;D++)T[b][D]=D-C+2;T[b][a]=12,T[b][s]=13;const M=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let D=0;D<M.length;D++)T[I][at.getCharCode(M[D])]=D;const R=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let D=0;D<R.length;D++)at.getCharCode(R[D])>0&&(T[v][at.getCharCode(R[D])]=D);return T}const ct=it(U.createInt32Array(5,256));class wt{constructor(i){this.text=i}encode(){const i=at.getCharCode(" "),s=at.getCharCode(`
`);let a=ia.singletonList(Q.INITIAL_STATE);for(let c=0;c<this.text.length;c++){let d,m=c+1<this.text.length?this.text[c+1]:0;switch(this.text[c]){case at.getCharCode("\r"):d=m===s?2:0;break;case at.getCharCode("."):d=m===i?3:0;break;case at.getCharCode(","):d=m===i?4:0;break;case at.getCharCode(":"):d=m===i?5:0;break;default:d=0}d>0?(a=wt.updateStateListForPair(a,c,d),c++):a=this.updateStateListForChar(a,c)}return ia.min(a,(c,d)=>c.getBitCount()-d.getBitCount()).toBitArray(this.text)}updateStateListForChar(i,s){const a=[];for(let h of i)this.updateStateForChar(h,s,a);return wt.simplifyStates(a)}updateStateForChar(i,s,a){let h=this.text[s]&255,c=ct[i.getMode()][h]>0,d=null;for(let m=0;m<=v;m++){let _=ct[m][h];if(_>0){if(d==null&&(d=i.endBinaryShift(s)),!c||m===i.getMode()||m===b){const C=d.latchAndAppend(m,_);a.push(C)}if(!c&&W[i.getMode()][m]>=0){const C=d.shiftAndAppend(m,_);a.push(C)}}}if(i.getBinaryShiftByteCount()>0||ct[i.getMode()][h]===0){let m=i.addBinaryShiftChar(s);a.push(m)}}static updateStateListForPair(i,s,a){const h=[];for(let c of i)this.updateStateForPair(c,s,a,h);return this.simplifyStates(h)}static updateStateForPair(i,s,a,h){let c=i.endBinaryShift(s);if(h.push(c.latchAndAppend(v,a)),i.getMode()!==v&&h.push(c.shiftAndAppend(v,a)),a===3||a===4){let d=c.latchAndAppend(b,16-a).latchAndAppend(b,1);h.push(d)}if(i.getBinaryShiftByteCount()>0){let d=i.addBinaryShiftChar(s).addBinaryShiftChar(s+1);h.push(d)}}static simplifyStates(i){let s=[];for(const a of i){let h=!0;for(const c of s){if(c.isBetterThanOrEqualTo(a)){h=!1;break}a.isBetterThanOrEqualTo(c)&&(s=s.filter(d=>d!==c))}h&&s.push(a)}return s}}class rt{constructor(){}static encodeBytes(i){return rt.encode(i,rt.DEFAULT_EC_PERCENT,rt.DEFAULT_AZTEC_LAYERS)}static encode(i,s,a){let h=new wt(i).encode(),c=Y.truncDivision(h.getSize()*s,100)+11,d=h.getSize()+c,m,_,C,M,R;if(a!==rt.DEFAULT_AZTEC_LAYERS){if(m=a<0,_=Math.abs(a),_>(m?rt.MAX_NB_BITS_COMPACT:rt.MAX_NB_BITS))throw new A(at.format("Illegal value %s for layers",a));C=rt.totalBitsInLayer(_,m),M=rt.WORD_SIZE[_];let mt=C-C%M;if(R=rt.stuffBits(h,M),R.getSize()+c>mt)throw new A("Data to large for user specified layer");if(m&&R.getSize()>M*64)throw new A("Data to large for user specified layer")}else{M=0,R=null;for(let mt=0;;mt++){if(mt>rt.MAX_NB_BITS)throw new A("Data too large for an Aztec code");if(m=mt<=3,_=m?mt+1:mt,C=rt.totalBitsInLayer(_,m),d>C)continue;(R==null||M!==rt.WORD_SIZE[_])&&(M=rt.WORD_SIZE[_],R=rt.stuffBits(h,M));let le=C-C%M;if(!(m&&R.getSize()>M*64)&&R.getSize()+c<=le)break}}let D=rt.generateCheckWords(R,C,M),k=R.getSize()/M,j=rt.generateModeMessage(m,_,k),K=(m?11:14)+_*4,tt=new Int32Array(K),st;if(m){st=K;for(let mt=0;mt<tt.length;mt++)tt[mt]=mt}else{st=K+1+2*Y.truncDivision(Y.truncDivision(K,2)-1,15);let mt=Y.truncDivision(K,2),le=Y.truncDivision(st,2);for(let Kt=0;Kt<mt;Kt++){let Xi=Kt+Y.truncDivision(Kt,15);tt[mt-Kt-1]=le-Xi-1,tt[mt+Kt]=le+Xi+1}}let Et=new pt(st);for(let mt=0,le=0;mt<_;mt++){let Kt=(_-mt)*4+(m?9:12);for(let Xi=0;Xi<Kt;Xi++){let Cn=Xi*2;for(let Vi=0;Vi<2;Vi++)D.get(le+Cn+Vi)&&Et.set(tt[mt*2+Vi],tt[mt*2+Xi]),D.get(le+Kt*2+Cn+Vi)&&Et.set(tt[mt*2+Xi],tt[K-1-mt*2-Vi]),D.get(le+Kt*4+Cn+Vi)&&Et.set(tt[K-1-mt*2-Vi],tt[K-1-mt*2-Xi]),D.get(le+Kt*6+Cn+Vi)&&Et.set(tt[K-1-mt*2-Xi],tt[mt*2+Vi])}le+=Kt*8}if(rt.drawModeMessage(Et,m,st,j),m)rt.drawBullsEye(Et,Y.truncDivision(st,2),5);else{rt.drawBullsEye(Et,Y.truncDivision(st,2),7);for(let mt=0,le=0;mt<Y.truncDivision(K,2)-1;mt+=15,le+=16)for(let Kt=Y.truncDivision(st,2)&1;Kt<st;Kt+=2)Et.set(Y.truncDivision(st,2)-le,Kt),Et.set(Y.truncDivision(st,2)+le,Kt),Et.set(Kt,Y.truncDivision(st,2)-le),Et.set(Kt,Y.truncDivision(st,2)+le)}let At=new ea;return At.setCompact(m),At.setSize(st),At.setLayers(_),At.setCodeWords(k),At.setMatrix(Et),At}static drawBullsEye(i,s,a){for(let h=0;h<a;h+=2)for(let c=s-h;c<=s+h;c++)i.set(c,s-h),i.set(c,s+h),i.set(s-h,c),i.set(s+h,c);i.set(s-a,s-a),i.set(s-a+1,s-a),i.set(s-a,s-a+1),i.set(s+a,s-a),i.set(s+a,s-a+1),i.set(s+a,s+a-1)}static generateModeMessage(i,s,a){let h=new Z;return i?(h.appendBits(s-1,2),h.appendBits(a-1,6),h=rt.generateCheckWords(h,28,4)):(h.appendBits(s-1,5),h.appendBits(a-1,11),h=rt.generateCheckWords(h,40,4)),h}static drawModeMessage(i,s,a,h){let c=Y.truncDivision(a,2);if(s)for(let d=0;d<7;d++){let m=c-3+d;h.get(d)&&i.set(m,c-5),h.get(d+7)&&i.set(c+5,m),h.get(20-d)&&i.set(m,c+5),h.get(27-d)&&i.set(c-5,m)}else for(let d=0;d<10;d++){let m=c-5+d+Y.truncDivision(d,5);h.get(d)&&i.set(m,c-7),h.get(d+10)&&i.set(c+7,m),h.get(29-d)&&i.set(m,c+7),h.get(39-d)&&i.set(c-7,m)}}static generateCheckWords(i,s,a){let h=i.getSize()/a,c=new qr(rt.getGF(a)),d=Y.truncDivision(s,a),m=rt.bitsToWords(i,a,d);c.encode(m,d-h);let _=s%a,C=new Z;C.appendBits(0,_);for(const M of Array.from(m))C.appendBits(M,a);return C}static bitsToWords(i,s,a){let h=new Int32Array(a),c,d;for(c=0,d=i.getSize()/s;c<d;c++){let m=0;for(let _=0;_<s;_++)m|=i.get(c*s+_)?1<<s-_-1:0;h[c]=m}return h}static getGF(i){switch(i){case 4:return ne.AZTEC_PARAM;case 6:return ne.AZTEC_DATA_6;case 8:return ne.AZTEC_DATA_8;case 10:return ne.AZTEC_DATA_10;case 12:return ne.AZTEC_DATA_12;default:throw new A("Unsupported word size "+i)}}static stuffBits(i,s){let a=new Z,h=i.getSize(),c=(1<<s)-2;for(let d=0;d<h;d+=s){let m=0;for(let _=0;_<s;_++)(d+_>=h||i.get(d+_))&&(m|=1<<s-1-_);(m&c)===c?(a.appendBits(m&c,s),d--):m&c?a.appendBits(m,s):(a.appendBits(m|1,s),d--)}return a}static totalBitsInLayer(i,s){return((s?88:112)+16*i)*i}}rt.DEFAULT_EC_PERCENT=33,rt.DEFAULT_AZTEC_LAYERS=0,rt.MAX_NB_BITS=32,rt.MAX_NB_BITS_COMPACT=4,rt.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class Mt{encode(i,s,a,h){return this.encodeWithHints(i,s,a,h,null)}encodeWithHints(i,s,a,h,c){let d=ps.ISO_8859_1,m=rt.DEFAULT_EC_PERCENT,_=rt.DEFAULT_AZTEC_LAYERS;return c!=null&&(c.has(ai.CHARACTER_SET)&&(d=Kn.forName(c.get(ai.CHARACTER_SET).toString())),c.has(ai.ERROR_CORRECTION)&&(m=Y.parseInt(c.get(ai.ERROR_CORRECTION).toString())),c.has(ai.AZTEC_LAYERS)&&(_=Y.parseInt(c.get(ai.AZTEC_LAYERS).toString()))),Mt.encodeLayers(i,s,a,h,d,m,_)}static encodeLayers(i,s,a,h,c,d,m){if(s!==Rt.AZTEC)throw new A("Can only encode AZTEC, but got "+s);let _=rt.encode(at.getBytes(i,c),d,m);return Mt.renderResult(_,a,h)}static renderResult(i,s,a){let h=i.getMatrix();if(h==null)throw new hi;let c=h.getWidth(),d=h.getHeight(),m=Math.max(s,c),_=Math.max(a,d),C=Math.min(m/c,_/d),M=(m-c*C)/2,R=(_-d*C)/2,D=new pt(m,_);for(let k=0,j=R;k<d;k++,j+=C)for(let K=0,tt=M;K<c;K++,tt+=C)h.get(K,k)&&D.setRegion(tt,j,C,C);return D}}e.AbstractExpandedDecoder=ds,e.ArgumentException=w,e.ArithmeticException=ze,e.AztecCode=ea,e.AztecCodeReader=Xn,e.AztecCodeWriter=Mt,e.AztecDecoder=he,e.AztecDetector=cr,e.AztecDetectorResult=on,e.AztecEncoder=rt,e.AztecHighLevelEncoder=wt,e.AztecPoint=ce,e.BarcodeFormat=Rt,e.Binarizer=L,e.BinaryBitmap=S,e.BitArray=Z,e.BitMatrix=pt,e.BitSource=dr,e.BrowserAztecCodeReader=Vn,e.BrowserBarcodeReader=ri,e.BrowserCodeReader=te,e.BrowserDatamatrixCodeReader=zi,e.BrowserMultiFormatReader=Ml,e.BrowserPDF417Reader=bl,e.BrowserQRCodeReader=Tl,e.BrowserQRCodeSvgWriter=Qi,e.CharacterSetECI=H,e.ChecksumException=P,e.Code128Reader=It,e.Code39Reader=Te,e.DataMatrixDecodedBitStreamParser=_n,e.DataMatrixReader=He,e.DecodeHintType=ot,e.DecoderResult=mi,e.DefaultGridSampler=qi,e.DetectorResult=Ci,e.EAN13Reader=Gi,e.EncodeHintType=ai,e.Exception=E,e.FormatException=X,e.GenericGF=ne,e.GenericGFPoly=Ke,e.GlobalHistogramBinarizer=lt,e.GridSampler=Ui,e.GridSamplerInstance=qe,e.HTMLCanvasElementLuminanceSource=Gt,e.HybridBinarizer=yt,e.ITFReader=se,e.IllegalArgumentException=A,e.IllegalStateException=hi,e.InvertedLuminanceSource=oe,e.LuminanceSource=Lt,e.MathUtils=ee,e.MultiFormatOneDReader=_s,e.MultiFormatReader=$o,e.MultiFormatWriter=ta,e.NotFoundException=q,e.OneDReader=Ae,e.PDF417DecodedBitStreamParser=nt,e.PDF417DecoderErrorCorrection=Ko,e.PDF417Reader=fi,e.PDF417ResultMetadata=En,e.PerspectiveTransform=ni,e.PlanarYUVLuminanceSource=$i,e.QRCodeByteMatrix=mr,e.QRCodeDataMask=Ii,e.QRCodeDecodedBitStreamParser=Pe,e.QRCodeDecoderErrorCorrectionLevel=Ee,e.QRCodeDecoderFormatInformation=pi,e.QRCodeEncoder=Re,e.QRCodeEncoderQRCode=jn,e.QRCodeMaskUtil=Xe,e.QRCodeMatrixUtil=bt,e.QRCodeMode=Dt,e.QRCodeReader=un,e.QRCodeVersion=Nt,e.QRCodeWriter=Zn,e.RGBLuminanceSource=Jr,e.RSS14Reader=Ot,e.RSSExpandedReader=dt,e.ReaderException=zs,e.ReedSolomonDecoder=Ei,e.ReedSolomonEncoder=qr,e.ReedSolomonException=xi,e.Result=gt,e.ResultMetadataType=ye,e.ResultPoint=St,e.StringUtils=at,e.UnsupportedOperationException=_t,e.VideoInputDevice=$t,e.WhiteRectangleDetector=ci,e.WriterException=zt,e.ZXingArrays=U,e.ZXingCharset=Kn,e.ZXingInteger=Y,e.ZXingStandardCharsets=ps,e.ZXingStringBuilder=ut,e.ZXingStringEncoding=xt,e.ZXingSystem=F,e.createAbstractExpandedDecoder=ms,Object.defineProperty(e,"__esModule",{value:!0})})})(ku,ku.exports);var Nc=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(n[l]=o[l])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),U1=function(){function r(t,e){this.name=t,this.track=e}return r.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},r.prototype.apply=function(t){var e={};e[this.name]=t;var n={advanced:[e]};return this.track.applyConstraints(n)},r.prototype.value=function(){var t=this.track.getSettings();if(this.name in t){var e=t[this.name];return e}return null},r}(),L_=function(r){Nc(t,r);function t(e,n){return r.call(this,e,n)||this}return t.prototype.min=function(){return this.getCapabilities().min},t.prototype.max=function(){return this.getCapabilities().max},t.prototype.step=function(){return this.getCapabilities().step},t.prototype.apply=function(e){var n={};n[this.name]=e;var o={advanced:[n]};return this.track.applyConstraints(o)},t.prototype.getCapabilities=function(){this.failIfNotSupported();var e=this.track.getCapabilities(),n=e[this.name];return{min:n.min,max:n.max,step:n.step}},t.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},t}(U1);(function(r){Nc(t,r);function t(e){return r.call(this,"zoom",e)||this}return t})(L_);(function(r){Nc(t,r);function t(e){return r.call(this,"torch",e)||this}return t})(U1);var Gu;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.NOT_STARTED=1]="NOT_STARTED",r[r.SCANNING=2]="SCANNING",r[r.PAUSED=3]="PAUSED"})(Gu||(Gu={}));var F_=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(n[l]=o[l])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();(function(r){F_(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.DEFAULT_WIDTH=300,t.DEFAULT_WIDTH_OFFSET=2,t.FILE_SCAN_MIN_HEIGHT=300,t.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,t.MIN_QR_BOX_SIZE=50,t.SHADED_LEFT=1,t.SHADED_RIGHT=2,t.SHADED_TOP=3,t.SHADED_BOTTOM=4,t.SHADED_REGION_ELEMENT_ID="qr-shaded-region",t.VERBOSE=!1,t.BORDER_SHADER_DEFAULT_COLOR="#ffffff",t.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",t})(D_);var Uu;(function(r){r[r.STATUS_DEFAULT=0]="STATUS_DEFAULT",r[r.STATUS_SUCCESS=1]="STATUS_SUCCESS",r[r.STATUS_WARNING=2]="STATUS_WARNING",r[r.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(Uu||(Uu={}));const Th=(r,t)=>t.some(e=>r instanceof e);let zu,Wu;function B_(){return zu||(zu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function k_(){return Wu||(Wu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Sh=new WeakMap,ih=new WeakMap,ml=new WeakMap;function G_(r){const t=new Promise((e,n)=>{const o=()=>{r.removeEventListener("success",l),r.removeEventListener("error",u)},l=()=>{e(tr(r.result)),o()},u=()=>{n(r.error),o()};r.addEventListener("success",l),r.addEventListener("error",u)});return ml.set(t,r),t}function U_(r){if(Sh.has(r))return;const t=new Promise((e,n)=>{const o=()=>{r.removeEventListener("complete",l),r.removeEventListener("error",u),r.removeEventListener("abort",u)},l=()=>{e(),o()},u=()=>{n(r.error||new DOMException("AbortError","AbortError")),o()};r.addEventListener("complete",l),r.addEventListener("error",u),r.addEventListener("abort",u)});Sh.set(r,t)}let Rh={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return Sh.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return tr(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function z1(r){Rh=r(Rh)}function z_(r){return k_().includes(r)?function(...t){return r.apply(vh(this),t),tr(this.request)}:function(...t){return tr(r.apply(vh(this),t))}}function W_(r){return typeof r=="function"?z_(r):(r instanceof IDBTransaction&&U_(r),Th(r,B_())?new Proxy(r,Rh):r)}function tr(r){if(r instanceof IDBRequest)return G_(r);if(ih.has(r))return ih.get(r);const t=W_(r);return t!==r&&(ih.set(r,t),ml.set(t,r)),t}const vh=r=>ml.get(r);function X_(r,t,{blocked:e,upgrade:n,blocking:o,terminated:l}={}){const u=indexedDB.open(r,t),g=tr(u);return n&&u.addEventListener("upgradeneeded",x=>{n(tr(u.result),x.oldVersion,x.newVersion,tr(u.transaction),x)}),e&&u.addEventListener("blocked",x=>e(x.oldVersion,x.newVersion,x)),g.then(x=>{l&&x.addEventListener("close",()=>l()),o&&x.addEventListener("versionchange",E=>o(E.oldVersion,E.newVersion,E))}).catch(()=>{}),g}const V_=["get","getKey","getAll","getAllKeys","count"],Y_=["put","add","delete","clear"],nh=new Map;function Xu(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(nh.get(t))return nh.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,o=Y_.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(o||V_.includes(e)))return;const l=async function(u,...g){const x=this.transaction(u,o?"readwrite":"readonly");let E=x.store;return n&&(E=E.index(g.shift())),(await Promise.all([E[e](...g),o&&x.done]))[0]};return nh.set(t,l),l}z1(r=>({...r,get:(t,e,n)=>Xu(t,e)||r.get(t,e,n),has:(t,e)=>!!Xu(t,e)||r.has(t,e)}));const H_=["continue","continuePrimaryKey","advance"],Vu={},Oh=new WeakMap,W1=new WeakMap,j_={get(r,t){if(!H_.includes(t))return r[t];let e=Vu[t];return e||(e=Vu[t]=function(...n){Oh.set(this,W1.get(this)[t](...n))}),e}};async function*Z_(...r){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...r)),!t)return;t=t;const e=new Proxy(t,j_);for(W1.set(e,t),ml.set(e,vh(t));t;)yield e,t=await(Oh.get(e)||t.continue()),Oh.delete(e)}function Yu(r,t){return t===Symbol.asyncIterator&&Th(r,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&Th(r,[IDBIndex,IDBObjectStore])}z1(r=>({...r,get(t,e,n){return Yu(t,e)?Z_:r.get(t,e,n)},has(t,e){return Yu(t,e)||r.has(t,e)}}));var X1={exports:{}};(function(r,t){(function(e,n){n()})(Mn,function(){function e(E,w){return typeof w>"u"?w={autoBom:!1}:typeof w!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),w={autoBom:!w}),w.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(E.type)?new Blob(["\uFEFF",E],{type:E.type}):E}function n(E,w,A){var S=new XMLHttpRequest;S.open("GET",E),S.responseType="blob",S.onload=function(){x(S.response,w,A)},S.onerror=function(){console.error("could not download file")},S.send()}function o(E){var w=new XMLHttpRequest;w.open("HEAD",E,!1);try{w.send()}catch{}return 200<=w.status&&299>=w.status}function l(E){try{E.dispatchEvent(new MouseEvent("click"))}catch{var w=document.createEvent("MouseEvents");w.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),E.dispatchEvent(w)}}var u=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof Mn=="object"&&Mn.global===Mn?Mn:void 0,g=u.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),x=u.saveAs||(typeof window!="object"||window!==u?function(){}:"download"in HTMLAnchorElement.prototype&&!g?function(E,w,A){var S=u.URL||u.webkitURL,P=document.createElement("a");w=w||E.name||"download",P.download=w,P.rel="noopener",typeof E=="string"?(P.href=E,P.origin===location.origin?l(P):o(P.href)?n(E,w,A):l(P,P.target="_blank")):(P.href=S.createObjectURL(E),setTimeout(function(){S.revokeObjectURL(P.href)},4e4),setTimeout(function(){l(P)},0))}:"msSaveOrOpenBlob"in navigator?function(E,w,A){if(w=w||E.name||"download",typeof E!="string")navigator.msSaveOrOpenBlob(e(E,A),w);else if(o(E))n(E,w,A);else{var S=document.createElement("a");S.href=E,S.target="_blank",setTimeout(function(){l(S)})}}:function(E,w,A,S){if(S=S||open("","_blank"),S&&(S.document.title=S.document.body.innerText="downloading..."),typeof E=="string")return n(E,w,A);var P=E.type==="application/octet-stream",L=/constructor/i.test(u.HTMLElement)||u.safari,F=/CriOS\/[\d]+/.test(navigator.userAgent);if((F||P&&L||g)&&typeof FileReader<"u"){var V=new FileReader;V.onloadend=function(){var Y=V.result;Y=F?Y:Y.replace(/^data:[^;]*;/,"data:attachment/file;"),S?S.location.href=Y:location=Y,S=null},V.readAsDataURL(E)}else{var z=u.URL||u.webkitURL,U=z.createObjectURL(E);S?S.location=U:location.href=U,S=null,setTimeout(function(){z.revokeObjectURL(U)},4e4)}});u.saveAs=x.saveAs=x,r.exports=x})})(X1);var K_=X1.exports;const q_=C1(K_);let In=!1;document.getElementById("loginBtn").onclick=r=>{const t=document.getElementById("user").value,e=document.getElementById("pwd").value;localStorage.setItem("lastUser",t),V1(t,e)};try{const r=new AbortController,t=setTimeout(()=>r.abort(),1e3),e=await fetch("https://192.168.56.101:8443/geoserver/wfs?service=WFS&version=1.1.0&request=GetFeature&typename=wfsttest:wfsuser_view&outputFormat=application/json",{signal:r.signal});clearTimeout(t);const n=await e.json();In=!0}catch{In=!1}if(!In){const r=localStorage.getItem("lastUser");V1(r)}function J_(r){return new Promise((t,e)=>{let n=new FileReader;n.onload=function(){return t({data:n.result,name:r.name,size:r.size,type:r.type})},n.readAsDataURL(r)})}function Q_(r){return new Promise((t,e)=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(r)})}async function V1(r,t){document.getElementById("loginDiv").innerHTML="";const e=await X_("hofapp",20,{upgrade(X,J,H,_t,xt){X.objectStoreNames.contains("imgs")&&X.deleteObjectStore("imgs"),X.objectStoreNames.contains("txt")&&X.deleteObjectStore("txt"),X.objectStoreNames.contains("file")&&X.deleteObjectStore("file"),X.createObjectStore("imgs",{keyPath:"url"}).createIndex("url","url"),X.createObjectStore("txt",{keyPath:"url"}).createIndex("url","url");const pt=X.createObjectStore("file",{keyPath:"filename"});pt.createIndex("filename","filename"),pt.createIndex("gid","gid",{unique:!1}),pt.createIndex("uploadpending","uploadpending",{unique:!1}),pt.createIndex("removalpending","removalpending",{unique:!1})}});function n(X,J={}){return J.headers=J.headers??{},J.headers.Authorization=`Basic ${window.btoa(r+":"+t)}`,fetch(X,J)}async function o(X,J,H){if(In){const _t=await(await X(J,H)).text();return e.transaction("txt","readwrite").objectStore("txt").put({url:J,data:_t}),_t}else return(await e.transaction("txt","readonly").objectStore("txt").get(J)).data}async function l(X,J){const H=[];if(In){const _t=await o(n,"https://192.168.56.101:8443/geoserver/wfs/?service=WFS&version=2.0.0&request=GetFeature&typeNames=wfsttest:protectedsite_files_view&cql_filter=mimetype=%27application%2Fgpx%2Bxml%27&outputformat=json"),xt=JSON.parse(_t);for(const at of xt.features)H.push(at.properties.fdata)}else{const xt=(await e.transaction("file","readonly").objectStore("file").index("removalpending").getAll(IDBKeyRange.only(0))).filter(at=>at.filename.indexOf(".gpx")>-1);for(const at of xt){let ut=await Q_(at.blob);ut=ut.substring(ut.indexOf(",")+1),H.push(ut)}}J.getSource().clear();for(const _t of H){const xt=window.atob(_t),at=J.getSource().getFormat().readFeatures(xt,{featureProjection:X.getView().getProjection()});J.getSource().addFeatures(at)}}const u=new Eu({source:new bu({format:new Km})});ma.defs("EPSG:31287","+proj=lcc +lat_0=47.5 +lon_0=13.3333333333333 +lat_1=49 +lat_2=46 +x_0=400000 +y_0=400000 +ellps=bessel +towgs84=577.326,90.129,463.919,5.137,1.474,5.297,2.4232 +units=m +no_defs +type=crs"),ma.defs("EPSG:4326","+proj=longlat +datum=WGS84 +no_defs +type=crs"),ma.defs("EPSG:3035","+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs"),Vx(ma);const g=await o(n,"https://192.168.56.101:8443/geoserver/wfs?service=WFS&version=1.1.0&request=GetFeature&typename=wfsttest:protectedsite_view&outputFormat=application/json&srsname=EPSG:31287"),x=new bu({features:new Tx().readFeatures(g)}),E=new Eu({source:x,style:{"stroke-width":.75,"stroke-color":"white","fill-color":"rgba(255,0,0,0.5)"}}),w=new sm({target:"map",layers:[new ym({source:new Pm({url:"https://mapproxy.rest-gdi.geo-data.space/tiles/osm/webmercator/{z}/{x}/{y}.png",maxZoom:19,tileLoadFunction:async function(X,J){const H=X.getImage(),_t=(await e.transaction("imgs","readonly").objectStore("imgs").get(J))?.data;if(_t)H.src=_t;else{H.src=J;const at=await(await fetch(J)).blob(),ut=new FileReader;ut.onload=pt=>{e.transaction("imgs","readwrite").objectStore("imgs").put({url:J,data:ut.result})},ut.readAsDataURL(at)}}})}),E,u],view:new Ln({center:[401306,423398],zoom:8,projection:"EPSG:31287"})});w.getView().fit(x.getExtent());const A=localStorage.getItem("zoom");A&&w.getView().setZoom(JSON.parse(A)),w.getView().on("change",X=>{const J=w.getView().getCenter(),H=w.getView().getZoom();localStorage.setItem("center",JSON.stringify(J)),localStorage.setItem("zoom",JSON.stringify(H))});const S=document.getElementById("popup"),P=document.getElementById("popup-content"),L=document.getElementById("popup-closer"),F=new rm({element:S,autoPan:{animation:{duration:250}}});w.addOverlay(F);function V(X,J,H){for(var _t=512,xt=atob(X),at=[],ut=0;ut<xt.length;ut+=_t){for(var pt=xt.slice(ut,ut+_t),q=new Array(pt.length),lt=0;lt<pt.length;lt++)q[lt]=pt.charCodeAt(lt);var yt=new Uint8Array(q);at.push(yt)}var Lt=new File(at,J,{type:H});return Lt}async function z(X){let J="https://192.168.56.101:8443/geoserver/wfs/?service=WFS&version=2.0.0&request=GetFeature&typeNames=wfsttest:protectedsite_files_view&propertyname=fid,psiteid,filename,filesize,mimetype,userids&outputformat=json";return X&&(J+="&cql_filter=psiteid="+X),(await(await n(J)).json()).features.map(_t=>_t.properties)}async function U(){let X=e.transaction("file","readonly").objectStore("file");const J=await X.index("uploadpending").getAll(IDBKeyRange.only(1));for(const lt of J){const yt=new File([lt.blob],lt.filename);await Y(lt.gid,lt.filename,lt.filesize,lt.mimetype,yt),lt.uploadpending=0,e.transaction("file","readwrite").objectStore("file").put(lt)}X=e.transaction("file","readonly").objectStore("file");const H=await X.index("removalpending").getAll(IDBKeyRange.only(1));for(const lt of H)ot(lt.filename);const _t=await z(),xt=new Map(_t.map(lt=>[lt.filename,lt])),at=await e.transaction("file","readonly").objectStore("file").getAll(),ut=new Map(at.map(lt=>[lt.filename,lt])),pt=new Map(xt);ut.forEach(lt=>pt.delete(lt.filename));for(const[lt,yt]of pt){const Lt=await $(lt);e.transaction("file","readwrite").objectStore("file").put({...yt,uploadPending:0,gid:yt.psiteid,blob:Lt})}const q=new Map(ut);xt.forEach(lt=>q.delete(lt.filename));for(const lt of q.keys())e.transaction("file","readwrite").objectStore("file").delete(lt)}In&&await U(),l(w,u);async function Y(X,J,H,_t,xt,at){const ut=await J_(at),pt=ut.data.substring(ut.data.indexOf(",")+1),q=`<wfs:Transaction service="WFS" version="1.1.0"
  xmlns:wfs="http://www.opengis.net/wfs"
  xmlns:gml="http://www.opengis.net/gml"
  xmlns:wfstest="wfstest"> 

    <wfs:Insert>
        <wfstest:protectedsite_files_view>
            <wfstest:psiteid>${X}</wfstest:psiteid>
            <wfstest:filename>${J}</wfstest:filename>
            <wfstest:filesize>${H}</wfstest:filesize>
            <wfstest:mimetype>${_t}</wfstest:mimetype>
            <wfstest:userids>${xt}</wfstest:userids>
            <wfstest:fdata>${pt}</wfstest:fdata>
        </wfstest:protectedsite_files_view>
    </wfs:Insert>
  </wfs:Transaction>`;await n("https://192.168.56.101:8443/geoserver/wfs",{method:"POST",body:q})}async function Z(X,J,H){let _t=[];if(In)_t=await z(X);else{const ut=e.transaction("file","readonly").objectStore("file").index("gid"),pt=IDBKeyRange.only(X);for await(const q of ut.iterate(pt)){const lt=q.value;lt.removalpending||_t.push(lt)}}J.innerHTML="";for(let at of _t){const ut=document.createElement("a");if(ut.innerText=`${at.filename} (${at.filesize})`,ut.setAttribute("href","#"),ut.onclick=async pt=>{const q=await $(at.filename);q_.saveAs(q,at.filename,"application/octet_stream"),pt.preventDefault()},J.appendChild(ut),at.userids.split(",").includes("bauer1")){const pt=document.createElement("a");pt.innerText=" X",pt.setAttribute("href","#"),pt.onclick=q=>{q.preventDefault(),ot(at.filename),setTimeout(()=>Z(X,J,H),100)},J.appendChild(pt),J.appendChild(document.createElement("br"))}}l(w,u);const xt=document.createElement("input",{id:"fileInput"});xt.setAttribute("type","file"),J.appendChild(xt),F.setPosition(H),xt.addEventListener("change",async at=>{var ut=at.target.files[0];const pt=ut.name.toLowerCase().endsWith(".gpx")?"application/gpx+xml":"application/octet-stream",q=window.prompt("Beistrich-getrennte Liste von zusätzlich leseberechtigten Benutzern:"),lt=await ut.arrayBuffer();In&&await Y(X,ut.name,lt.byteLength,pt,q,ut);const yt=new Blob([lt],{type:pt});e.transaction("file","readwrite").objectStore("file").put({uploadpending:In?0:1,removalpending:0,gid:X,mimetype:pt,filesize:lt.byteLength,filename:ut.name,userids:q,blob:yt}),Z(X,J,H)})}async function $(X){if(In){const J=await(await n(`https://192.168.56.101:8443/geoserver/wfs/?service=WFS&version=2.0.0&request=GetFeature&typeNames=wfsttest:protectedsite_files_view&cql_filter=filename='${X}'&outputformat=json`)).text(),xt=JSON.parse(J).features[0].properties.fdata;return V(xt)}else{const H=await e.transaction("file","readonly").objectStore("file").index("filename").openCursor(IDBKeyRange.only(X));if(H){const _t=H?.value;return new File([_t.blob],X)}}}async function ot(X){if(In){const J=`<wfs:Transaction service="WFS" version="1.1.0"
    xmlns:wfs="http://www.opengis.net/wfs"
    xmlns:gml="http://www.opengis.net/gml"
    xmlns:wfstest="wfstest"> 

    <wfs:Delete typeName="wfstest:protectedsite_files_view">
      <Filter>
        <PropertyIsEqualTo>
          <PropertyName>filename</PropertyName>
          <Literal>${X}</Literal>
        </PropertyIsEqualTo>
      </Filter>
    </wfs:Delete>
    </wfs:Transaction>`;await(await n("https://192.168.56.101:8443/geoserver/wfs",{method:"POST",body:J})).text(),e.transaction("file","readwrite").objectStore("file").delete(X)}else{const J=await e.transaction("file","readonly").objectStore("file").get(X);J.removalpending=1,e.transaction("file","readwrite").objectStore("file").put(J)}}w.on("click",async function(X){w.forEachFeatureAtPixel(X.pixel,async function(J,H){if(H===E){const xt=J.getProperties().gid;Z(xt,P,X.coordinate)}})}),L.onclick=function(){return F.setPosition(void 0),L.blur(),!1}}
//# sourceMappingURL=index-Bd4hJ6az.js.map
