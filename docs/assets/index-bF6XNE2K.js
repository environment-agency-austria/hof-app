function Yf(s,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in s)){const l=Object.getOwnPropertyDescriptor(n,r);l&&Object.defineProperty(s,r,l.get?l:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(r){if(r.ep)return;r.ep=!0;const l=e(r);fetch(r.href,l)}})();class cs{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Nr={PROPERTYCHANGE:"propertychange"};class Ih{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Hf(s,t,e){let n,r;e=e||rs;let l=0,u=s.length,g=!1;for(;l<u;)n=l+(u-l>>1),r=+e(s[n],t),r<0?l=n+1:(u=n,g=!r);return g?l:~l}function rs(s,t){return s>t?1:s<t?-1:0}function Mh(s,t,e){if(s[0]<=t)return 0;const n=s.length;if(t<=s[n-1])return n-1;if(typeof e=="function"){for(let r=1;r<n;++r){const l=s[r];if(l===t)return r;if(l<t)return e(t,s[r-1],l)>0?r-1:r}return n-1}if(e>0){for(let r=1;r<n;++r)if(s[r]<t)return r-1;return n-1}if(e<0){for(let r=1;r<n;++r)if(s[r]<=t)return r;return n-1}for(let r=1;r<n;++r){if(s[r]==t)return r;if(s[r]<t)return s[r-1]-t<t-s[r]?r-1:r}return n-1}function Zf(s,t,e){for(;t<e;){const n=s[t];s[t]=s[e],s[e]=n,++t,--e}}function Gn(s,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let r=0;r<n;r++)s[s.length]=e[r]}function Fs(s,t){const e=s.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(s[n]!==t[n])return!1;return!0}function Kf(s,t,e){const n=t||rs;return s.every(function(r,l){if(l===0)return!0;const u=n(s[l-1],r);return!(u>0||e&&u===0)})}function uo(){return!0}function La(){return!1}function Or(){}function Vu(s){let t=!1,e,n,r;return function(){const l=Array.prototype.slice.call(arguments);return(!t||this!==r||!Fs(l,n))&&(t=!0,r=this,n=l,e=s.apply(this,arguments)),e}}function qf(s){function t(){let e;try{e=s()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function To(s){for(const t in s)delete s[t]}function er(s){let t;for(t in s)return!1;return!t}class Pa extends Ih{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);r.includes(e)||r.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const l=e?new cs(t):t;l.target||(l.target=this.eventTarget_||this);const u=this.dispatching_||(this.dispatching_={}),g=this.pendingRemovals_||(this.pendingRemovals_={});n in u||(u[n]=0,g[n]=0),++u[n];let m;for(let p=0,E=r.length;p<E;++p)if("handleEvent"in r[p]?m=r[p].handleEvent(l):m=r[p].call(this,l),m===!1||l.propagationStopped){m=!1;break}if(--u[n]===0){let p=g[n];for(delete g[n];p--;)this.removeEventListener(n,Or);delete u[n]}return m}disposeInternal(){this.listeners_&&To(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const r=n.indexOf(e);r!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=Or,++this.pendingRemovals_[t]):(n.splice(r,1),n.length===0&&delete this.listeners_[t]))}}const Ht={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function de(s,t,e,n,r){if(n&&n!==s&&(e=e.bind(n)),r){const u=e;e=function(){s.removeEventListener(t,e),u.apply(this,arguments)}}const l={target:s,type:t,listener:e};return s.addEventListener(t,e),l}function ga(s,t,e,n){return de(s,t,e,n,!0)}function Fe(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),To(s))}class bo extends Pa{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Ht.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,r=new Array(n);for(let l=0;l<n;++l)r[l]=de(this,t[l],e);return r}return de(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const r=t.length;n=new Array(r);for(let l=0;l<r;++l)n[l]=ga(this,t[l],e)}else n=ga(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)Qf(n);else if(Array.isArray(t))for(let r=0,l=t.length;r<l;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)}}bo.prototype.on;bo.prototype.once;bo.prototype.un;function Qf(s){if(Array.isArray(s))for(let t=0,e=s.length;t<e;++t)Fe(s[t]);else Fe(s)}function Xt(){throw new Error("Unimplemented abstract method.")}let Jf=0;function Me(s){return s.ol_uid||(s.ol_uid=String(++Jf))}class wc extends cs{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class bn extends bo{constructor(t){super(),this.on,this.once,this.un,Me(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new wc(n,t,e)),n=Nr.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new wc(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const r=this.values_||(this.values_={});if(n)r[t]=e;else{const l=r[t];r[t]=e,l!==e&&this.notify(t,l)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],er(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}const Wi={ADD:"add",REMOVE:"remove"},Cc={LENGTH:"length"};class Qo extends cs{constructor(t,e,n){super(t),this.element=e,this.index=n}}class Bn extends bn{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let n=0,r=this.array_.length;n<r;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,r=e.length;n<r;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Cc.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Qo(Wi.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,r=e.length;n<r;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Qo(Wi.REMOVE,e,t)),e}setAt(t,e){const n=this.getLength();if(t>=n){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Qo(Wi.REMOVE,r,t)),this.dispatchEvent(new Qo(Wi.ADD,e,t))}updateLength_(){this.set(Cc.LENGTH,this.array_.length)}assertUnique_(t,e){for(let n=0,r=this.array_.length;n<r;++n)if(this.array_[n]===t&&n!==e)throw new Error("Duplicate item added to a unique collection")}}function pe(s,t){if(!s)throw new Error(t)}class Fa extends bn{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Fa(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Fe(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=de(t,Ht.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?$f(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function $f(s){if(typeof s=="function")return s;let t;return Array.isArray(s)?t=s:(pe(typeof s.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[s]),function(){return t}}new Array(6);function Mn(){return[1,0,0,1,0,0]}function td(s,t){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s}function Ai(s,t){const e=t[0],n=t[1];return t[0]=s[0]*e+s[2]*n+s[4],t[1]=s[1]*e+s[3]*n+s[5],t}function ls(s,t,e,n,r,l,u,g){const m=Math.sin(l),p=Math.cos(l);return s[0]=n*p,s[1]=r*m,s[2]=-n*m,s[3]=r*p,s[4]=u*n*p-g*n*m+t,s[5]=u*r*m+g*r*p+e,s}function Yu(s,t){const e=ed(t);pe(e!==0,"Transformation matrix cannot be inverted");const n=t[0],r=t[1],l=t[2],u=t[3],g=t[4],m=t[5];return s[0]=u/e,s[1]=-r/e,s[2]=-l/e,s[3]=n/e,s[4]=(l*m-u*g)/e,s[5]=-(n*m-r*g)/e,s}function ed(s){return s[0]*s[3]-s[1]*s[2]}const Ac=[1e6,1e6,1e6,1e6,2,2];function id(s){return"matrix("+s.map((e,n)=>Math.round(e*Ac[n])/Ac[n]).join(", ")+")"}const xi={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Ic(s){const t=mn();for(let e=0,n=s.length;e<n;++e)ao(t,s[e]);return t}function nd(s,t,e){const n=Math.min.apply(null,s),r=Math.min.apply(null,t),l=Math.max.apply(null,s),u=Math.max.apply(null,t);return hs(n,r,l,u,e)}function Sh(s,t,e){return e?(e[0]=s[0]-t,e[1]=s[1]-t,e[2]=s[2]+t,e[3]=s[3]+t,e):[s[0]-t,s[1]-t,s[2]+t,s[3]+t]}function Hu(s,t){return t?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t):s.slice()}function ir(s,t,e){let n,r;return t<s[0]?n=s[0]-t:s[2]<t?n=t-s[2]:n=0,e<s[1]?r=s[1]-e:s[3]<e?r=e-s[3]:r=0,n*n+r*r}function Dr(s,t){return Th(s,t[0],t[1])}function Zs(s,t){return s[0]<=t[0]&&t[2]<=s[2]&&s[1]<=t[1]&&t[3]<=s[3]}function Th(s,t,e){return s[0]<=t&&t<=s[2]&&s[1]<=e&&e<=s[3]}function Hl(s,t){const e=s[0],n=s[1],r=s[2],l=s[3],u=t[0],g=t[1];let m=xi.UNKNOWN;return u<e?m=m|xi.LEFT:u>r&&(m=m|xi.RIGHT),g<n?m=m|xi.BELOW:g>l&&(m=m|xi.ABOVE),m===xi.UNKNOWN&&(m=xi.INTERSECTING),m}function mn(){return[1/0,1/0,-1/0,-1/0]}function hs(s,t,e,n,r){return r?(r[0]=s,r[1]=t,r[2]=e,r[3]=n,r):[s,t,e,n]}function Wr(s){return hs(1/0,1/0,-1/0,-1/0,s)}function Zu(s,t){const e=s[0],n=s[1];return hs(e,n,e,n,t)}function bh(s,t,e,n,r){const l=Wr(r);return qu(l,s,t,e,n)}function fo(s,t){return s[0]==t[0]&&s[2]==t[2]&&s[1]==t[1]&&s[3]==t[3]}function Ku(s,t){return t[0]<s[0]&&(s[0]=t[0]),t[2]>s[2]&&(s[2]=t[2]),t[1]<s[1]&&(s[1]=t[1]),t[3]>s[3]&&(s[3]=t[3]),s}function ao(s,t){t[0]<s[0]&&(s[0]=t[0]),t[0]>s[2]&&(s[2]=t[0]),t[1]<s[1]&&(s[1]=t[1]),t[1]>s[3]&&(s[3]=t[1])}function qu(s,t,e,n,r){for(;e<n;e+=r)sd(s,t[e],t[e+1]);return s}function sd(s,t,e){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}function Qu(s,t){let e;return e=t(Ba(s)),e||(e=t(ka(s)),e)||(e=t(Ua(s)),e)||(e=t(nr(s)),e)?e:!1}function Zl(s){let t=0;return Ro(s)||(t=we(s)*Li(s)),t}function Ba(s){return[s[0],s[1]]}function ka(s){return[s[2],s[1]]}function Os(s){return[(s[0]+s[2])/2,(s[1]+s[3])/2]}function rd(s,t){let e;if(t==="bottom-left")e=Ba(s);else if(t==="bottom-right")e=ka(s);else if(t==="top-left")e=nr(s);else if(t==="top-right")e=Ua(s);else throw new Error("Invalid corner");return e}function Kl(s,t,e,n,r){const[l,u,g,m,p,E,A,b]=ql(s,t,e,n);return hs(Math.min(l,g,p,A),Math.min(u,m,E,b),Math.max(l,g,p,A),Math.max(u,m,E,b),r)}function ql(s,t,e,n){const r=t*n[0]/2,l=t*n[1]/2,u=Math.cos(e),g=Math.sin(e),m=r*u,p=r*g,E=l*u,A=l*g,b=s[0],D=s[1];return[b-m+A,D-p-E,b-m-A,D-p+E,b+m-A,D+p+E,b+m+A,D+p-E,b-m+A,D-p-E]}function Li(s){return s[3]-s[1]}function lo(s,t,e){const n=e||mn();return Vi(s,t)?(s[0]>t[0]?n[0]=s[0]:n[0]=t[0],s[1]>t[1]?n[1]=s[1]:n[1]=t[1],s[2]<t[2]?n[2]=s[2]:n[2]=t[2],s[3]<t[3]?n[3]=s[3]:n[3]=t[3]):Wr(n),n}function nr(s){return[s[0],s[3]]}function Ua(s){return[s[2],s[3]]}function we(s){return s[2]-s[0]}function Vi(s,t){return s[0]<=t[2]&&s[2]>=t[0]&&s[1]<=t[3]&&s[3]>=t[1]}function Ro(s){return s[2]<s[0]||s[3]<s[1]}function od(s,t){return t?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t):s}function ad(s,t,e){let n=!1;const r=Hl(s,t),l=Hl(s,e);if(r===xi.INTERSECTING||l===xi.INTERSECTING)n=!0;else{const u=s[0],g=s[1],m=s[2],p=s[3],E=t[0],A=t[1],b=e[0],D=e[1],P=(D-A)/(b-E);let F,z;l&xi.ABOVE&&!(r&xi.ABOVE)&&(F=b-(D-p)/P,n=F>=u&&F<=m),!n&&l&xi.RIGHT&&!(r&xi.RIGHT)&&(z=D-(b-m)*P,n=z>=g&&z<=p),!n&&l&xi.BELOW&&!(r&xi.BELOW)&&(F=b-(D-g)/P,n=F>=u&&F<=m),!n&&l&xi.LEFT&&!(r&xi.LEFT)&&(z=D-(b-u)*P,n=z>=g&&z<=p)}return n}function ld(s,t,e,n){if(Ro(s))return Wr(e);let r=[];if(n>1){const g=s[2]-s[0],m=s[3]-s[1];for(let p=0;p<n;++p)r.push(s[0]+g*p/n,s[1],s[2],s[1]+m*p/n,s[2]-g*p/n,s[3],s[0],s[3]-m*p/n)}else r=[s[0],s[1],s[2],s[1],s[2],s[3],s[0],s[3]];t(r,r,2);const l=[],u=[];for(let g=0,m=r.length;g<m;g+=2)l.push(r[g]),u.push(r[g+1]);return nd(l,u,e)}function Ju(s,t){const e=t.getExtent(),n=Os(s);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){const r=we(e),u=Math.floor((n[0]-e[0])/r)*r;s[0]-=u,s[2]-=u}return s}function $u(s,t,e){if(t.canWrapX()){const n=t.getExtent();if(!isFinite(s[0])||!isFinite(s[2]))return[[n[0],s[1],n[2],s[3]]];Ju(s,t);const r=we(n);if(we(s)>r&&!e)return[[n[0],s[1],n[2],s[3]]];if(s[0]<n[0])return[[s[0]+r,s[1],n[2],s[3]],[n[0],s[1],s[2],s[3]]];if(s[2]>n[2])return[[s[0],s[1],n[2],s[3]],[n[0],s[1],s[2]-r,s[3]]]}return[s]}const go={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class hd{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||go[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Rh=hd,vo=6378137,Mr=Math.PI*vo,cd=[-Mr,-Mr,Mr,Mr],ud=[-180,-85,180,85],Jo=vo*Math.log(Math.tan(Math.PI/2));class mr extends Rh{constructor(t){super({code:t,units:"m",extent:cd,global:!0,worldExtent:ud,getPointResolution:function(e,n){return e/Math.cosh(n[1]/vo)}})}}const Mc=[new mr("EPSG:3857"),new mr("EPSG:102100"),new mr("EPSG:102113"),new mr("EPSG:900913"),new mr("http://www.opengis.net/def/crs/EPSG/0/3857"),new mr("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fd(s,t,e){const n=s.length;e=e>1?e:2,t===void 0&&(e>2?t=s.slice():t=new Array(n));for(let r=0;r<n;r+=e){t[r]=Mr*s[r]/180;let l=vo*Math.log(Math.tan(Math.PI*(+s[r+1]+90)/360));l>Jo?l=Jo:l<-Jo&&(l=-Jo),t[r+1]=l}return t}function dd(s,t,e){const n=s.length;e=e>1?e:2,t===void 0&&(e>2?t=s.slice():t=new Array(n));for(let r=0;r<n;r+=e)t[r]=180*s[r]/Mr,t[r+1]=360*Math.atan(Math.exp(s[r+1]/vo))/Math.PI-90;return t}const gd=6378137,Sc=[-180,-90,180,90],md=Math.PI*gd/180;class Xs extends Rh{constructor(t,e){super({code:t,units:"degrees",extent:Sc,axisOrientation:e,global:!0,metersPerUnit:md,worldExtent:Sc})}}const Tc=[new Xs("CRS:84"),new Xs("EPSG:4326","neu"),new Xs("urn:ogc:def:crs:OGC:1.3:CRS84"),new Xs("urn:ogc:def:crs:OGC:2:84"),new Xs("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Xs("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Xs("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ql={};function xd(s){return Ql[s]||Ql[s.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function pd(s,t){Ql[s]=t}let br={};function Lr(s,t,e){const n=s.getCode(),r=t.getCode();n in br||(br[n]={}),br[n][r]=e}function t0(s,t){let e;return s in br&&t in br[s]&&(e=br[s][t]),e}function ei(s,t,e){return Math.min(Math.max(s,t),e)}function _d(s,t,e,n,r,l){const u=r-e,g=l-n;if(u!==0||g!==0){const m=((s-e)*u+(t-n)*g)/(u*u+g*g);m>1?(e=r,n=l):m>0&&(e+=u*m,n+=g*m)}return $s(s,t,e,n)}function $s(s,t,e,n){const r=e-s,l=n-t;return r*r+l*l}function yd(s){const t=s.length;for(let n=0;n<t;n++){let r=n,l=Math.abs(s[n][n]);for(let g=n+1;g<t;g++){const m=Math.abs(s[g][n]);m>l&&(l=m,r=g)}if(l===0)return null;const u=s[r];s[r]=s[n],s[n]=u;for(let g=n+1;g<t;g++){const m=-s[g][n]/s[n][n];for(let p=n;p<t+1;p++)n==p?s[g][p]=0:s[g][p]+=m*s[n][p]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=s[n][t]/s[n][n];for(let r=n-1;r>=0;r--)s[r][t]-=s[r][n]*e[n]}return e}function ua(s){return s*Math.PI/180}function Rr(s,t){const e=s%t;return e*t<0?e+t:e}function tn(s,t,e){return s+e*(t-s)}function vh(s,t){const e=Math.pow(10,t);return Math.round(s*e)/e}function $o(s,t){return Math.floor(vh(s,t))}function ta(s,t){return Math.ceil(vh(s,t))}function Ed(s,t){return s[0]+=+t[0],s[1]+=+t[1],s}function ma(s,t){let e=!0;for(let n=s.length-1;n>=0;--n)if(s[n]!=t[n]){e=!1;break}return e}function Nh(s,t){const e=Math.cos(t),n=Math.sin(t),r=s[0]*e-s[1]*n,l=s[1]*e+s[0]*n;return s[0]=r,s[1]=l,s}function wd(s,t){return s[0]*=t,s[1]*=t,s}function e0(s,t){if(t.canWrapX()){const e=we(t.getExtent()),n=i0(s,t,e);n&&(s[0]-=n*e)}return s}function i0(s,t,e){const n=t.getExtent();let r=0;return t.canWrapX()&&(s[0]<n[0]||s[0]>n[2])&&(e=e||we(n),r=Math.floor((s[0]-n[0])/e)),r}const Cd=63710088e-1;function bc(s,t,e){e=e||Cd;const n=ua(s[1]),r=ua(t[1]),l=(r-n)/2,u=ua(t[0]-s[0])/2,g=Math.sin(l)*Math.sin(l)+Math.sin(u)*Math.sin(u)*Math.cos(n)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))}function n0(...s){console.warn(...s)}let Jl=!0;function Ad(s){Jl=!(s===void 0?!0:s)}function Oh(s,t){if(t!==void 0){for(let e=0,n=s.length;e<n;++e)t[e]=s[e];t=t}else t=s.slice();return t}function s0(s,t){if(t!==void 0&&s!==t){for(let e=0,n=s.length;e<n;++e)t[e]=s[e];s=t}return s}function r0(s){pd(s.getCode(),s),Lr(s,s,Oh)}function Id(s){s.forEach(r0)}function Ge(s){return typeof s=="string"?xd(s):s||null}function Rc(s,t,e,n){s=Ge(s);let r;const l=s.getPointResolutionFunc();if(l){if(r=l(t,e),n&&n!==s.getUnits()){const u=s.getMetersPerUnit();u&&(r=r*u/go[n])}}else{const u=s.getUnits();if(u=="degrees"&&!n||n=="degrees")r=t;else{const g=Ga(s,Ge("EPSG:4326"));if(g===s0&&u!=="degrees")r=t*s.getMetersPerUnit();else{let p=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];p=g(p,p,2);const E=bc(p.slice(0,2),p.slice(2,4)),A=bc(p.slice(4,6),p.slice(6,8));r=(E+A)/2}const m=n?go[n]:s.getMetersPerUnit();m!==void 0&&(r/=m)}}return r}function $l(s){Id(s),s.forEach(function(t){s.forEach(function(e){t!==e&&Lr(t,e,Oh)})})}function Md(s,t,e,n){s.forEach(function(r){t.forEach(function(l){Lr(r,l,e),Lr(l,r,n)})})}function Dh(s,t){return s?typeof s=="string"?Ge(s):s:Ge(t)}function vc(s){return function(t,e,n){const r=t.length;n=n!==void 0?n:2,e=e!==void 0?e:new Array(r);for(let l=0;l<r;l+=n){const u=s(t.slice(l,l+n)),g=u.length;for(let m=0,p=n;m<p;++m)e[l+m]=m>=g?t[l+m]:u[m]}return e}}function Sd(s,t,e,n){const r=Ge(s),l=Ge(t);Lr(r,l,vc(e)),Lr(l,r,vc(n))}function Hs(s,t){if(s===t)return!0;const e=s.getUnits()===t.getUnits();return(s.getCode()===t.getCode()||Ga(s,t)===Oh)&&e}function Ga(s,t){const e=s.getCode(),n=t.getCode();let r=t0(e,n);return r||(r=s0),r}function Pr(s,t){const e=Ge(s),n=Ge(t);return Ga(e,n)}function Td(s,t,e){return Pr(t,e)(s,void 0,s.length)}function bd(s,t,e,n){const r=Pr(t,e);return ld(s,r,void 0,n)}let Rd=null;function vd(){return Rd}function th(s,t){return s}function ts(s,t){return Jl&&!ma(s,[0,0])&&s[0]>=-180&&s[0]<=180&&s[1]>=-90&&s[1]<=90&&(Jl=!1,n0("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),s}function Lh(s,t){return s}function Ks(s,t){return s}function Nc(s,t,e){return function(n){let r,l;if(s.canWrapX()){const u=s.getExtent(),g=we(u);n=n.slice(0),l=i0(n,s,g),l&&(n[0]=n[0]-l*g),n[0]=ei(n[0],u[0],u[2]),n[1]=ei(n[1],u[1],u[3]),r=e(n)}else r=e(n);return l&&t.canWrapX()&&(r[0]+=l*we(t.getExtent())),r}}function Nd(){$l(Mc),$l(Tc),Md(Tc,Mc,fd,dd)}Nd();function Ns(s,t,e,n,r,l){l=l||[];let u=0;for(let g=t;g<e;g+=n){const m=s[g],p=s[g+1];l[u++]=r[0]*m+r[2]*p+r[4],l[u++]=r[1]*m+r[3]*p+r[5]}return l&&l.length!=u&&(l.length=u),l}function o0(s,t,e,n,r,l,u){u=u||[];const g=Math.cos(r),m=Math.sin(r),p=l[0],E=l[1];let A=0;for(let b=t;b<e;b+=n){const D=s[b]-p,P=s[b+1]-E;u[A++]=p+D*g-P*m,u[A++]=E+D*m+P*g;for(let F=b+2;F<b+n;++F)u[A++]=s[F]}return u&&u.length!=A&&(u.length=A),u}function Od(s,t,e,n,r,l,u,g){g=g||[];const m=u[0],p=u[1];let E=0;for(let A=t;A<e;A+=n){const b=s[A]-m,D=s[A+1]-p;g[E++]=m+r*b,g[E++]=p+l*D;for(let P=A+2;P<A+n;++P)g[E++]=s[P]}return g&&g.length!=E&&(g.length=E),g}function Dd(s,t,e,n,r,l,u){u=u||[];let g=0;for(let m=t;m<e;m+=n){u[g++]=s[m]+r,u[g++]=s[m+1]+l;for(let p=m+2;p<m+n;++p)u[g++]=s[p]}return u&&u.length!=g&&(u.length=g),u}const Oc=Mn();class a0 extends bn{constructor(){super(),this.extent_=mn(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Vu((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return Xt()}closestPointXY(t,e,n,r){return Xt()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return Xt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Wr(e),this.extentRevision_=this.getRevision()}return od(this.extent_,t)}rotate(t,e){Xt()}scale(t,e,n){Xt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return Xt()}getType(){return Xt()}applyTransform(t){Xt()}intersectsExtent(t){return Xt()}translate(t,e){Xt()}transform(t,e){const n=Ge(t),r=n.getUnits()=="tile-pixels"?function(l,u,g){const m=n.getExtent(),p=n.getWorldExtent(),E=Li(p)/Li(m);return ls(Oc,p[0],p[3],E,-E,0,0,0),Ns(l,0,l.length,g,Oc,u),Pr(n,e)(l,u,g)}:Pr(n,e);return this.applyTransform(r),this}}class sr extends a0{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return bh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return Xt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Dc(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){Xt()}setLayout(t,e,n){let r;if(t)r=Dc(t);else{for(let l=0;l<n;++l){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}r=e.length,t=rr(r)}this.layout=t,this.stride=r}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();o0(n,0,n.length,r,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Os(this.getExtent()));const r=this.getFlatCoordinates();if(r){const l=this.getStride();Od(r,0,r.length,l,t,e,n,r),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const r=this.getStride();Dd(n,0,n.length,r,t,e,n),this.changed()}}}function rr(s){let t;return s==2?t="XY":s==3?t="XYZ":s==4&&(t="XYZM"),t}function Dc(s){let t;return s=="XY"?t=2:s=="XYZ"||s=="XYM"?t=3:s=="XYZM"&&(t=4),t}function Ld(s,t,e){const n=s.getFlatCoordinates();if(!n)return null;const r=s.getStride();return Ns(n,0,n.length,r,t,e)}function Lc(s,t,e,n,r,l,u){const g=s[t],m=s[t+1],p=s[e]-g,E=s[e+1]-m;let A;if(p===0&&E===0)A=t;else{const b=((r-g)*p+(l-m)*E)/(p*p+E*E);if(b>1)A=e;else if(b>0){for(let D=0;D<n;++D)u[D]=tn(s[t+D],s[e+D],b);u.length=n;return}else A=t}for(let b=0;b<n;++b)u[b]=s[A+b];u.length=n}function Ph(s,t,e,n,r){let l=s[t],u=s[t+1];for(t+=n;t<e;t+=n){const g=s[t],m=s[t+1],p=$s(l,u,g,m);p>r&&(r=p),l=g,u=m}return r}function Fh(s,t,e,n,r){for(let l=0,u=e.length;l<u;++l){const g=e[l];r=Ph(s,t,g,n,r),t=g}return r}function Pd(s,t,e,n,r){for(let l=0,u=e.length;l<u;++l){const g=e[l];r=Fh(s,t,g,n,r),t=g[g.length-1]}return r}function Bh(s,t,e,n,r,l,u,g,m,p,E){if(t==e)return p;let A,b;if(r===0){if(b=$s(u,g,s[t],s[t+1]),b<p){for(A=0;A<n;++A)m[A]=s[t+A];return m.length=n,b}return p}E=E||[NaN,NaN];let D=t+n;for(;D<e;)if(Lc(s,D-n,D,n,u,g,E),b=$s(u,g,E[0],E[1]),b<p){for(p=b,A=0;A<n;++A)m[A]=E[A];m.length=n,D+=n}else D+=n*Math.max((Math.sqrt(b)-Math.sqrt(p))/r|0,1);if(l&&(Lc(s,e-n,t,n,u,g,E),b=$s(u,g,E[0],E[1]),b<p)){for(p=b,A=0;A<n;++A)m[A]=E[A];m.length=n}return p}function kh(s,t,e,n,r,l,u,g,m,p,E){E=E||[NaN,NaN];for(let A=0,b=e.length;A<b;++A){const D=e[A];p=Bh(s,t,D,n,r,l,u,g,m,p,E),t=D}return p}function Fd(s,t,e,n,r,l,u,g,m,p,E){E=E||[NaN,NaN];for(let A=0,b=e.length;A<b;++A){const D=e[A];p=kh(s,t,D,n,r,l,u,g,m,p,E),t=D[D.length-1]}return p}function Bd(s,t,e,n){for(let r=0,l=e.length;r<l;++r)s[t++]=e[r];return t}function za(s,t,e,n){for(let r=0,l=e.length;r<l;++r){const u=e[r];for(let g=0;g<n;++g)s[t++]=u[g]}return t}function No(s,t,e,n,r){r=r||[];let l=0;for(let u=0,g=e.length;u<g;++u){const m=za(s,t,e[u],n);r[l++]=m,t=m}return r.length=l,r}function l0(s,t,e,n,r){r=r||[];let l=0;for(let u=0,g=e.length;u<g;++u){const m=No(s,t,e[u],n,r[l]);m.length===0&&(m[0]=t),r[l++]=m,t=m[m.length-1]}return r.length=l,r}function ja(s,t,e,n,r,l,u){const g=(e-t)/n;if(g<3){for(;t<e;t+=n)l[u++]=s[t],l[u++]=s[t+1];return u}const m=new Array(g);m[0]=1,m[g-1]=1;const p=[t,e-n];let E=0;for(;p.length>0;){const A=p.pop(),b=p.pop();let D=0;const P=s[b],F=s[b+1],z=s[A],j=s[A+1];for(let G=b+n;G<A;G+=n){const X=s[G],Y=s[G+1],Q=_d(X,Y,P,F,z,j);Q>D&&(E=G,D=Q)}D>r&&(m[(E-t)/n]=1,b+n<E&&p.push(b,E),E+n<A&&p.push(E,A))}for(let A=0;A<g;++A)m[A]&&(l[u++]=s[t+A*n],l[u++]=s[t+A*n+1]);return u}function h0(s,t,e,n,r,l,u,g){for(let m=0,p=e.length;m<p;++m){const E=e[m];u=ja(s,t,E,n,r,l,u),g.push(u),t=E}return u}function Ys(s,t){return t*Math.round(s/t)}function kd(s,t,e,n,r,l,u){if(t==e)return u;let g=Ys(s[t],r),m=Ys(s[t+1],r);t+=n,l[u++]=g,l[u++]=m;let p,E;do if(p=Ys(s[t],r),E=Ys(s[t+1],r),t+=n,t==e)return l[u++]=p,l[u++]=E,u;while(p==g&&E==m);for(;t<e;){const A=Ys(s[t],r),b=Ys(s[t+1],r);if(t+=n,A==p&&b==E)continue;const D=p-g,P=E-m,F=A-g,z=b-m;if(D*z==P*F&&(D<0&&F<D||D==F||D>0&&F>D)&&(P<0&&z<P||P==z||P>0&&z>P)){p=A,E=b;continue}l[u++]=p,l[u++]=E,g=p,m=E,p=A,E=b}return l[u++]=p,l[u++]=E,u}function Uh(s,t,e,n,r,l,u,g){for(let m=0,p=e.length;m<p;++m){const E=e[m];u=kd(s,t,E,n,r,l,u),g.push(u),t=E}return u}function Ud(s,t,e,n,r,l,u,g){for(let m=0,p=e.length;m<p;++m){const E=e[m],A=[];u=Uh(s,t,E,n,r,l,u,A),g.push(A),t=E[E.length-1]}return u}function Ts(s,t,e,n,r){r=r!==void 0?r:[];let l=0;for(let u=t;u<e;u+=n)r[l++]=s.slice(u,u+n);return r.length=l,r}function mo(s,t,e,n,r){r=r!==void 0?r:[];let l=0;for(let u=0,g=e.length;u<g;++u){const m=e[u];r[l++]=Ts(s,t,m,n,r[l]),t=m}return r.length=l,r}function eh(s,t,e,n,r){r=r!==void 0?r:[];let l=0;for(let u=0,g=e.length;u<g;++u){const m=e[u];r[l++]=m.length===1&&m[0]===t?[]:mo(s,t,m,n,r[l]),t=m[m.length-1]}return r.length=l,r}function c0(s,t,e,n){let r=0,l=s[e-n],u=s[e-n+1];for(;t<e;t+=n){const g=s[t],m=s[t+1];r+=u*g-l*m,l=g,u=m}return r/2}function u0(s,t,e,n){let r=0;for(let l=0,u=e.length;l<u;++l){const g=e[l];r+=c0(s,t,g,n),t=g}return r}function Gd(s,t,e,n){let r=0;for(let l=0,u=e.length;l<u;++l){const g=e[l];r+=u0(s,t,g,n),t=g[g.length-1]}return r}class xo extends sr{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new xo(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,r){return r<ir(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ph(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Bh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,r))}getArea(){return c0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Ts(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=ja(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new xo(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=za(this.flatCoordinates,0,t,this.stride),this.changed()}}class Fr extends sr{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Fr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){const l=this.flatCoordinates,u=$s(t,e,l[0],l[1]);if(u<r){const g=this.stride;for(let m=0;m<g;++m)n[m]=l[m];return n.length=g,u}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return Zu(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Th(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Bd(this.flatCoordinates,0,t,this.stride),this.changed()}}function zd(s,t,e,n,r){return!Qu(r,function(u){return!qs(s,t,e,n,u[0],u[1])})}function qs(s,t,e,n,r,l){let u=0,g=s[e-n],m=s[e-n+1];for(;t<e;t+=n){const p=s[t],E=s[t+1];m<=l?E>l&&(p-g)*(l-m)-(r-g)*(E-m)>0&&u++:E<=l&&(p-g)*(l-m)-(r-g)*(E-m)<0&&u--,g=p,m=E}return u!==0}function Gh(s,t,e,n,r,l){if(e.length===0||!qs(s,t,e[0],n,r,l))return!1;for(let u=1,g=e.length;u<g;++u)if(qs(s,e[u-1],e[u],n,r,l))return!1;return!0}function jd(s,t,e,n,r,l){if(e.length===0)return!1;for(let u=0,g=e.length;u<g;++u){const m=e[u];if(Gh(s,t,m,n,r,l))return!0;t=m[m.length-1]}return!1}function zh(s,t,e,n,r,l,u){let g,m,p,E,A,b,D;const P=r[l+1],F=[];for(let G=0,X=e.length;G<X;++G){const Y=e[G];for(E=s[Y-n],b=s[Y-n+1],g=t;g<Y;g+=n)A=s[g],D=s[g+1],(P<=b&&D<=P||b<=P&&P<=D)&&(p=(P-b)/(D-b)*(A-E)+E,F.push(p)),E=A,b=D}let z=NaN,j=-1/0;for(F.sort(rs),E=F[0],g=1,m=F.length;g<m;++g){A=F[g];const G=Math.abs(A-E);G>j&&(p=(E+A)/2,Gh(s,t,e,n,p,P)&&(z=p,j=G)),E=A}return isNaN(z)&&(z=r[l]),u?(u.push(z,P,j),u):[z,P,j]}function f0(s,t,e,n,r){let l=[];for(let u=0,g=e.length;u<g;++u){const m=e[u];l=zh(s,t,m,n,r,2*u,l),t=m[m.length-1]}return l}function d0(s,t,e,n,r){let l;for(t+=n;t<e;t+=n)if(l=r(s.slice(t-n,t),s.slice(t,t+n)),l)return l;return!1}function Wa(s,t,e,n,r){const l=qu(mn(),s,t,e,n);return Vi(r,l)?Zs(r,l)||l[0]>=r[0]&&l[2]<=r[2]||l[1]>=r[1]&&l[3]<=r[3]?!0:d0(s,t,e,n,function(u,g){return ad(r,u,g)}):!1}function Wd(s,t,e,n,r){for(let l=0,u=e.length;l<u;++l){if(Wa(s,t,e[l],n,r))return!0;t=e[l]}return!1}function g0(s,t,e,n,r){return!!(Wa(s,t,e,n,r)||qs(s,t,e,n,r[0],r[1])||qs(s,t,e,n,r[0],r[3])||qs(s,t,e,n,r[2],r[1])||qs(s,t,e,n,r[2],r[3]))}function m0(s,t,e,n,r){if(!g0(s,t,e[0],n,r))return!1;if(e.length===1)return!0;for(let l=1,u=e.length;l<u;++l)if(zd(s,e[l-1],e[l],n,r)&&!Wa(s,e[l-1],e[l],n,r))return!1;return!0}function Xd(s,t,e,n,r){for(let l=0,u=e.length;l<u;++l){const g=e[l];if(m0(s,t,g,n,r))return!0;t=g[g.length-1]}return!1}function Vd(s,t,e,n){for(;t<e-n;){for(let r=0;r<n;++r){const l=s[t+r];s[t+r]=s[e-n+r],s[e-n+r]=l}t+=n,e-=n}}function jh(s,t,e,n){let r=0,l=s[e-n],u=s[e-n+1];for(;t<e;t+=n){const g=s[t],m=s[t+1];r+=(g-l)*(m+u),l=g,u=m}return r===0?void 0:r>0}function Wh(s,t,e,n,r){r=r!==void 0?r:!1;for(let l=0,u=e.length;l<u;++l){const g=e[l],m=jh(s,t,g,n);if(l===0){if(r&&m||!r&&!m)return!1}else if(r&&!m||!r&&m)return!1;t=g}return!0}function x0(s,t,e,n,r){for(let l=0,u=e.length;l<u;++l){const g=e[l];if(!Wh(s,t,g,n,r))return!1;g.length&&(t=g[g.length-1])}return!0}function xa(s,t,e,n,r){r=r!==void 0?r:!1;for(let l=0,u=e.length;l<u;++l){const g=e[l],m=jh(s,t,g,n);(l===0?r&&m||!r&&!m:r&&!m||!r&&m)&&Vd(s,t,g,n),t=g}return t}function ih(s,t,e,n,r){for(let l=0,u=e.length;l<u;++l)t=xa(s,t,e[l],n,r);return t}function Yd(s,t){const e=[];let n=0,r=0,l;for(let u=0,g=t.length;u<g;++u){const m=t[u],p=jh(s,n,m,2);if(l===void 0&&(l=p),p===l)e.push(t.slice(r,u+1));else{if(e.length===0)continue;e[e.length-1].push(t[r])}r=u+1,n=m}return e}class Ds extends sr{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Gn(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Ds(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<ir(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Fh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),kh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,r))}containsXY(t,e){return Gh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return u0(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),xa(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,mo(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Os(this.getExtent());this.flatInteriorPoint_=zh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Fr(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new xo(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,r=[];let l=0;for(let u=0,g=n.length;u<g;++u){const m=n[u],p=new xo(e.slice(l,m),t);r.push(p),l=m}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Wh(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=xa(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Uh(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new Ds(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return m0(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=No(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Pc(s){if(Ro(s))throw new Error("Cannot create polygon from empty extent");const t=s[0],e=s[1],n=s[2],r=s[3],l=[t,e,t,r,n,r,n,e,t,e];return new Ds(l,"XY",[l.length])}const gn={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},ee={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},po={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Ii={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Ii.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};Ii.max=Ii.whitepoint[2].D65;Ii.rgb=function(s,t){t=t||Ii.whitepoint[2].E;var e=s[0]/t[0],n=s[1]/t[1],r=s[2]/t[2],l,u,g;return l=e*3.240969941904521+n*-1.537383177570093+r*-.498610760293,u=e*-.96924363628087+n*1.87596750150772+r*.041555057407175,g=e*.055630079696993+n*-.20397695888897+r*1.056971514242878,l=l>.0031308?1.055*Math.pow(l,1/2.4)-.055:l=l*12.92,u=u>.0031308?1.055*Math.pow(u,1/2.4)-.055:u=u*12.92,g=g>.0031308?1.055*Math.pow(g,1/2.4)-.055:g=g*12.92,l=Math.min(Math.max(0,l),1),u=Math.min(Math.max(0,u),1),g=Math.min(Math.max(0,g),1),[l*255,u*255,g*255]};po.xyz=function(s,t){var e=s[0]/255,n=s[1]/255,r=s[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var l=e*.41239079926595+n*.35758433938387+r*.18048078840183,u=e*.21263900587151+n*.71516867876775+r*.072192315360733,g=e*.019330818715591+n*.11919477979462+r*.95053215224966;return t=t||Ii.whitepoint[2].E,[l*t[0],u*t[1],g*t[2]]};const Xh={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(s,t,e){var n,r,l,u,g,m,p,E,A,b,D,P,F;if(l=s[0],u=s[1],g=s[2],l===0)return[0,0,0];var z=.0011070564598794539;return t=t||"D65",e=e||2,A=Ii.whitepoint[e][t][0],b=Ii.whitepoint[e][t][1],D=Ii.whitepoint[e][t][2],P=4*A/(A+15*b+3*D),F=9*b/(A+15*b+3*D),n=u/(13*l)+P||0,r=g/(13*l)+F||0,p=l>8?b*Math.pow((l+16)/116,3):b*l*z,m=p*9*n/(4*r)||0,E=p*(12-3*n-20*r)/(4*r)||0,[m,p,E]}};Ii.luv=function(s,t,e){var n,r,l,u,g,m,p,E,A,b,D,P,F,z=.008856451679035631,j=903.2962962962961;t=t||"D65",e=e||2,A=Ii.whitepoint[e][t][0],b=Ii.whitepoint[e][t][1],D=Ii.whitepoint[e][t][2],P=4*A/(A+15*b+3*D),F=9*b/(A+15*b+3*D),m=s[0],p=s[1],E=s[2],n=4*m/(m+15*p+3*E)||0,r=9*p/(m+15*p+3*E)||0;var G=p/b;return l=G<=z?j*G:116*Math.pow(G,1/3)-16,u=13*l*(n-P),g=13*l*(r-F),[l,u,g]};var p0={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(s){var t=s[0],e=s[1],n=s[2],r,l,u;return u=n/360*2*Math.PI,r=e*Math.cos(u),l=e*Math.sin(u),[t,r,l]},xyz:function(s){return Xh.xyz(p0.luv(s))}};Xh.lchuv=function(s){var t=s[0],e=s[1],n=s[2],r=Math.sqrt(e*e+n*n),l=Math.atan2(n,e),u=l*360/2/Math.PI;return u<0&&(u+=360),[t,r,u]};Ii.lchuv=function(s){return Xh.lchuv(Ii.luv(s))};const Fc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Bc={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Hd(s){var t,e=[],n=1,r;if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(typeof s=="number")return{space:"rgb",values:[s>>>16,(s&65280)>>>8,s&255],alpha:1};if(s=String(s).toLowerCase(),Fc[s])e=Fc[s].slice(),r="rgb";else if(s==="transparent")n=0,r="rgb",e=[0,0,0];else if(s[0]==="#"){var l=s.slice(1),u=l.length,g=u<=4;n=1,g?(e=[parseInt(l[0]+l[0],16),parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16)],u===4&&(n=parseInt(l[3]+l[3],16)/255)):(e=[parseInt(l[0]+l[1],16),parseInt(l[2]+l[3],16),parseInt(l[4]+l[5],16)],u===8&&(n=parseInt(l[6]+l[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),r="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(s)){var m=t[1];r=m.replace(/a$/,"");var p=r==="cmyk"?4:r==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=e.shift()),e=e.map(function(E,A){if(E[E.length-1]==="%")return E=parseFloat(E)/100,A===3?E:r==="rgb"?E*255:r[0]==="h"||r[0]==="l"&&!A?E*100:r==="lab"?E*125:r==="lch"?A<2?E*150:E*360:r[0]==="o"&&!A?E:r==="oklab"?E*.4:r==="oklch"?A<2?E*.4:E*360:E;if(r[A]==="h"||A===2&&r[r.length-1]==="h"){if(Bc[E]!==void 0)return Bc[E];if(E.endsWith("deg"))return parseFloat(E);if(E.endsWith("turn"))return parseFloat(E)*360;if(E.endsWith("grad"))return parseFloat(E)*360/400;if(E.endsWith("rad"))return parseFloat(E)*180/Math.PI}return E==="none"?0:parseFloat(E)}),n=e.length>p?e.pop():1}else/[0-9](?:\s|\/|,)/.test(s)&&(e=s.match(/([0-9]+)/g).map(function(E){return parseFloat(E)}),r=s.match(/([a-z])/ig)?.join("")?.toLowerCase()||"rgb");return{space:r,values:e,alpha:n}}const Al={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(s){var t=s[0]/360,e=s[1]/100,n=s[2]/100,r,l,u,g,m,p=0;if(e===0)return m=n*255,[m,m,m];for(l=n<.5?n*(1+e):n+e-n*e,r=2*n-l,g=[0,0,0];p<3;)u=t+1/3*-(p-1),u<0?u++:u>1&&u--,m=6*u<1?r+(l-r)*6*u:2*u<1?l:3*u<2?r+(l-r)*(2/3-u)*6:r,g[p++]=m*255;return g}};po.hsl=function(s){var t=s[0]/255,e=s[1]/255,n=s[2]/255,r=Math.min(t,e,n),l=Math.max(t,e,n),u=l-r,g,m,p;return l===r?g=0:t===l?g=(e-n)/u:e===l?g=2+(n-t)/u:n===l&&(g=4+(t-e)/u),g=Math.min(g*60,360),g<0&&(g+=360),p=(r+l)/2,l===r?m=0:p<=.5?m=u/(l+r):m=u/(2-l-r),[g,m*100,p*100]};function Zd(s){Array.isArray(s)&&s.raw&&(s=String.raw(...arguments)),s instanceof Number&&(s=+s);var t,e=Hd(s);if(!e.space)return[];const n=e.space[0]==="h"?Al.min:po.min,r=e.space[0]==="h"?Al.max:po.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],n[0]),r[0]),t[1]=Math.min(Math.max(e.values[1],n[1]),r[1]),t[2]=Math.min(Math.max(e.values[2],n[2]),r[2]),e.space[0]==="h"&&(t=Al.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function Kd(s){return typeof s=="string"?s:Yh(s)}const qd=1024,$r={};let Il=0;function Qd(s){if(s.length===4)return s;const t=s.slice();return t[3]=1,t}function kc(s){const t=Ii.lchuv(po.xyz(s));return t[3]=s[3],t}function Jd(s){const t=Ii.rgb(p0.xyz(s));return t[3]=s[3],t}function Vh(s){if($r.hasOwnProperty(s))return $r[s];if(Il>=qd){let e=0;for(const n in $r)e++&3||(delete $r[n],--Il)}const t=Zd(s);if(t.length!==4)throw new Error('Failed to parse "'+s+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+s+'" as color');return _0(t),$r[s]=t,++Il,t}function _o(s){return Array.isArray(s)?s:Vh(s)}function _0(s){return s[0]=ei(s[0]+.5|0,0,255),s[1]=ei(s[1]+.5|0,0,255),s[2]=ei(s[2]+.5|0,0,255),s[3]=ei(s[3],0,1),s}function Yh(s){let t=s[0];t!=(t|0)&&(t=t+.5|0);let e=s[1];e!=(e|0)&&(e=e+.5|0);let n=s[2];n!=(n|0)&&(n=n+.5|0);const r=s[3]===void 0?1:Math.round(s[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+r+")"}function $d(s){try{return Vh(s),!0}catch{return!1}}const Ls=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",t1=Ls.includes("firefox"),e1=Ls.includes("safari")&&!Ls.includes("chrom");e1&&(Ls.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Ls));const i1=Ls.includes("webkit")&&!Ls.includes("edge"),y0=Ls.includes("macintosh"),E0=typeof devicePixelRatio<"u"?devicePixelRatio:1,w0=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,C0=typeof Image<"u"&&Image.prototype.decode,A0=function(){let s=!1;try{const t=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return s}();function Mi(s,t,e,n){let r;return e&&e.length?r=e.shift():w0?r=new OffscreenCanvas(s||300,t||300):r=document.createElement("canvas"),s&&(r.width=s),t&&(r.height=t),r.getContext("2d",n)}let Ml;function pa(){return Ml||(Ml=Mi(1,1)),Ml}function Xa(s){const t=s.canvas;t.width=1,t.height=1,s.clearRect(0,0,1,1)}function n1(s){let t=s.offsetWidth;const e=getComputedStyle(s);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function s1(s){let t=s.offsetHeight;const e=getComputedStyle(s);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function Uc(s,t){const e=t.parentNode;e&&e.replaceChild(s,t)}function _a(s){return s&&s.parentNode?s.parentNode.removeChild(s):null}function I0(s){for(;s.lastChild;)s.removeChild(s.lastChild)}function r1(s,t){const e=s.childNodes;for(let n=0;;++n){const r=e[n],l=t[n];if(!r&&!l)break;if(r!==l){if(!r){s.appendChild(l);continue}if(!l){s.removeChild(r),--n;continue}s.insertBefore(l,r)}}}function o1(s,t,e){const n=s;let r=!0,l=!1,u=!1;const g=[ga(n,Ht.LOAD,function(){u=!0,l||t()})];return n.src&&C0?(l=!0,n.decode().then(function(){r&&t()}).catch(function(m){r&&(u?t():e())})):g.push(ga(n,Ht.ERROR,e)),function(){r=!1,g.forEach(Fe)}}function a1(s,t){return new Promise((e,n)=>{function r(){u(),e(s)}function l(){u(),n(new Error("Image load error"))}function u(){s.removeEventListener("load",r),s.removeEventListener("error",l)}s.addEventListener("load",r),s.addEventListener("error",l),t&&(s.src=t)})}function l1(s,t){return t&&(s.src=t),s.src&&C0?new Promise((e,n)=>s.decode().then(()=>e(s)).catch(r=>s.complete&&s.width?e(s):n(r))):a1(s)}class h1{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const r=Sl(t,e,n);return r in this.cache_?this.cache_[r]:null}getPattern(t,e,n){const r=Sl(t,e,n);return r in this.patternCache_?this.patternCache_[r]:null}set(t,e,n,r,l){const u=Sl(t,e,n),g=u in this.cache_;this.cache_[u]=r,l&&(r.getImageState()===ee.IDLE&&r.load(),r.getImageState()===ee.LOADING?r.ready().then(()=>{this.patternCache_[u]=pa().createPattern(r.getImage(1),"repeat")}):this.patternCache_[u]=pa().createPattern(r.getImage(1),"repeat")),g||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Sl(s,t,e){const n=e?_o(e):"null";return t+":"+s+":"+n}const kn=new h1;let to=null;class c1 extends Pa{constructor(t,e,n,r,l){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=l,this.imageState_=r===void 0?ee.IDLE:r,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ee.LOADED){to||(to=Mi(1,1,void 0,{willReadFrequently:!0})),to.drawImage(this.image_,0,0);try{to.getImageData(0,0,1,1),this.tainted_=!1}catch{to=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Ht.CHANGE)}handleImageError_(){this.imageState_=ee.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ee.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=Mi(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ee.IDLE){this.image_||this.initializeImage_(),this.imageState_=ee.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&l1(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==ee.LOADED)return;const e=this.image_,n=document.createElement("canvas");n.width=Math.ceil(e.width*t),n.height=Math.ceil(e.height*t);const r=n.getContext("2d");r.scale(t,t),r.drawImage(e,0,0),r.globalCompositeOperation="multiply",r.fillStyle=Kd(this.color_),r.fillRect(0,0,n.width/t,n.height/t),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0),this.canvas_[t]=n}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===ee.LOADED||this.imageState_===ee.ERROR?t():this.addEventListener(Ht.CHANGE,function e(){(this.imageState_===ee.LOADED||this.imageState_===ee.ERROR)&&(this.removeEventListener(Ht.CHANGE,e),t())})})),this.ready_}}function Hh(s,t,e,n,r,l){let u=t===void 0?void 0:kn.get(t,e,r);return u||(u=new c1(s,s&&"src"in s?s.src||void 0:t,e,n,r),kn.set(t,e,r,u,l)),l&&u&&!kn.getPattern(t,e,r)&&kn.set(t,e,r,u,l),u}class Oo{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Oo({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Hh(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===ee.IDLE&&e.load(),e.getImageState()===ee.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function ya(s,t,e,n,r,l,u){let g,m;const p=(e-t)/n;if(p===1)g=t;else if(p===2)g=t,m=r;else if(p!==0){let E=s[t],A=s[t+1],b=0;const D=[0];for(let z=t+n;z<e;z+=n){const j=s[z],G=s[z+1];b+=Math.sqrt((j-E)*(j-E)+(G-A)*(G-A)),D.push(b),E=j,A=G}const P=r*b,F=Hf(D,P);F<0?(m=(P-D[-F-2])/(D[-F-1]-D[-F-2]),g=t+(-F-2)*n):g=t+F*n}u=u>1?u:2,l=l||new Array(u);for(let E=0;E<u;++E)l[E]=g===void 0?NaN:m===void 0?s[g+E]:tn(s[g+E],s[g+n+E],m);return l}function nh(s,t,e,n,r,l){if(e==t)return null;let u;if(r<s[t+n-1])return l?(u=s.slice(t,t+n),u[n-1]=r,u):null;if(s[e-1]<r)return l?(u=s.slice(e-n,e),u[n-1]=r,u):null;if(r==s[t+n-1])return s.slice(t,t+n);let g=t/n,m=e/n;for(;g<m;){const b=g+m>>1;r<s[(b+1)*n-1]?m=b:g=b+1}const p=s[g*n-1];if(r==p)return s.slice((g-1)*n,(g-1)*n+n);const E=s[(g+1)*n-1],A=(r-p)/(E-p);u=[];for(let b=0;b<n-1;++b)u.push(tn(s[(g-1)*n+b],s[g*n+b],A));return u.push(r),u}function u1(s,t,e,n,r,l,u){if(u)return nh(s,t,e[e.length-1],n,r,l);let g;if(r<s[n-1])return l?(g=s.slice(0,n),g[n-1]=r,g):null;if(s[s.length-1]<r)return l?(g=s.slice(s.length-n),g[n-1]=r,g):null;for(let m=0,p=e.length;m<p;++m){const E=e[m];if(t!=E){if(r<s[t+n-1])return null;if(r<=s[E-1])return nh(s,t,E,n,r,!1);t=E}}return null}function M0(s,t,e,n){let r=s[t],l=s[t+1],u=0;for(let g=t+n;g<e;g+=n){const m=s[g],p=s[g+1];u+=Math.sqrt((m-r)*(m-r)+(p-l)*(p-l)),r=m,l=p}return u}class Ea extends sr{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){Gn(this.flatCoordinates,t),this.changed()}clone(){const t=new Ea(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<ir(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ph(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Bh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,r))}forEachSegment(t){return d0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,nh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Ts(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return ya(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return M0(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=ja(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Ea(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Wa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=za(this.flatCoordinates,0,t,this.stride),this.changed()}}const sh=Ea;class Va{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Va({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}function Gc(s){return s[0]>0&&s[1]>0}function f1(s,t,e){return e===void 0&&(e=[0,0]),e[0]=s[0]*t+.5|0,e[1]=s[1]*t+.5|0,e}function sn(s,t){return Array.isArray(s)?s:(t===void 0?t=[s,s]:(t[0]=s,t[1]=s),t)}class Ya{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=sn(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Ya({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Xt()}getImage(t){return Xt()}getHitDetectionImage(){return Xt()}getPixelRatio(t){return 1}getImageState(){return Xt()}getImageSize(){return Xt()}getOrigin(){return Xt()}getSize(){return Xt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=sn(t)}listenImageChange(t){Xt()}load(){Xt()}unlistenImageChange(t){Xt()}ready(){return Promise.resolve()}}function Un(s){return s?Array.isArray(s)?Yh(s):typeof s=="object"&&"src"in s?d1(s):s:null}function d1(s){if(!s.offset||!s.size)return kn.getPattern(s.src,"anonymous",s.color);const t=s.src+":"+s.offset,e=kn.getPattern(t,void 0,s.color);if(e)return e;const n=kn.get(s.src,"anonymous",null);if(n.getImageState()!==ee.LOADED)return null;const r=Mi(s.size[0],s.size[1]);return r.drawImage(n.getImage(1),s.offset[0],s.offset[1],s.size[0],s.size[1],0,0,s.size[0],s.size[1]),Hh(r.canvas,t,void 0,ee.LOADED,s.color,!0),kn.getPattern(t,void 0,s.color)}const ea="ol-hidden",g1="ol-selectable",Ha="ol-unselectable",Zh="ol-control",zc="ol-collapsed",m1=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),jc=["style","variant","weight","size","lineHeight","family"],S0=function(s){const t=s.match(m1);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,r=jc.length;n<r;++n){const l=t[n+1];l!==void 0&&(e[jc[n]]=l)}return e.families=e.family.split(/,\s?/),e},T0="10px sans-serif",Xi="#000",Br="round",os=[],as=0,kr="round",yo=10,Eo="#000",wo="center",wa="middle",Qs=[0,0,0,0],Co=1,es=new bn;let Er=null,rh;const oh={},x1=function(){const t="32px ",e=["monospace","serif"],n=e.length,r="wmytzilWMYTZIL@#/&?$%10";let l,u;function g(p,E,A){let b=!0;for(let D=0;D<n;++D){const P=e[D];if(u=Ca(p+" "+E+" "+t+P,r),A!=P){const F=Ca(p+" "+E+" "+t+A+","+P,r);b=b&&F!=u}}return!!b}function m(){let p=!0;const E=es.getKeys();for(let A=0,b=E.length;A<b;++A){const D=E[A];es.get(D)<100&&(g.apply(this,D.split(`
`))?(To(oh),Er=null,rh=void 0,es.set(D,100)):(es.set(D,es.get(D)+1,!0),p=!1))}p&&(clearInterval(l),l=void 0)}return function(p){const E=S0(p);if(!E)return;const A=E.families;for(let b=0,D=A.length;b<D;++b){const P=A[b],F=E.style+`
`+E.weight+`
`+P;es.get(F)===void 0&&(es.set(F,100,!0),g(E.style,E.weight,P)||(es.set(F,0,!0),l===void 0&&(l=setInterval(m,32))))}}}(),p1=function(){let s;return function(t){let e=oh[t];if(e==null){if(w0){const n=S0(t),r=b0(t,"Žg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=t,document.body.appendChild(s),e=s.offsetHeight,document.body.removeChild(s);oh[t]=e}return e}}();function b0(s,t){return Er||(Er=Mi(1,1)),s!=rh&&(Er.font=s,rh=Er.font),Er.measureText(t)}function Ca(s,t){return b0(s,t).width}function Wc(s,t,e){if(t in e)return e[t];const n=t.split(`
`).reduce((r,l)=>Math.max(r,Ca(s,l)),0);return e[t]=n,n}function _1(s,t){const e=[],n=[],r=[];let l=0,u=0,g=0,m=0;for(let p=0,E=t.length;p<=E;p+=2){const A=t[p];if(A===`
`||p===E){l=Math.max(l,u),r.push(u),u=0,g+=m,m=0;continue}const b=t[p+1]||s.font,D=Ca(b,A);e.push(D),u+=D;const P=p1(b);n.push(P),m=Math.max(m,P)}return{width:l,height:g,widths:e,heights:n,lineWidths:r}}function y1(s,t,e,n,r,l,u,g,m,p,E){s.save(),e!==1&&(s.globalAlpha===void 0?s.globalAlpha=A=>A.globalAlpha*=e:s.globalAlpha*=e),t&&s.transform.apply(s,t),n.contextInstructions?(s.translate(m,p),s.scale(E[0],E[1]),E1(n,s)):E[0]<0||E[1]<0?(s.translate(m,p),s.scale(E[0],E[1]),s.drawImage(n,r,l,u,g,0,0,u,g)):s.drawImage(n,r,l,u,g,m,p,u*E[0],g*E[1]),s.restore()}function E1(s,t){const e=s.contextInstructions;for(let n=0,r=e.length;n<r;n+=2)Array.isArray(e[n+1])?t[e[n]].apply(t,e[n+1]):t[e[n]]=e[n+1]}class Za extends Ya{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?ee.LOADING:ee.LOADED,this.imageState_===ee.LOADING&&this.ready().then(()=>this.imageState_=ee.LOADED),this.render()}clone(){const t=this.getScale(),e=new Za({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const n=this.renderOptions_,r=Mi(n.size*t,n.size*t);this.draw_(n,r,t),e=r.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let r=this.radius_,l=this.radius2_===void 0?r:this.radius2_;if(r<l){const rt=r;r=l,l=rt}const u=this.radius2_===void 0?this.points_:this.points_*2,g=2*Math.PI/u,m=l*Math.sin(g),p=Math.sqrt(l*l-m*m),E=r-p,A=Math.sqrt(m*m+E*E),b=A/m;if(t==="miter"&&b<=n)return b*e;const D=e/2/b,P=e/2*(E/A),z=Math.sqrt((r+D)*(r+D)+P*P)-r;if(this.radius2_===void 0||t==="bevel")return z*2;const j=r*Math.sin(g),G=Math.sqrt(r*r-j*j),X=l-G,Q=Math.sqrt(j*j+X*X)/j;if(Q<=n){const rt=Q*e/2-l-r;return 2*Math.max(z,rt)}return z*2}createRenderOptions(){let t=Br,e=kr,n=0,r=null,l=0,u,g=0;this.stroke_&&(u=Un(this.stroke_.getColor()??Eo),g=this.stroke_.getWidth()??Co,r=this.stroke_.getLineDash(),l=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??kr,t=this.stroke_.getLineCap()??Br,n=this.stroke_.getMiterLimit()??yo);const m=this.calculateLineJoinSize_(e,g,n),p=Math.max(this.radius_,this.radius2_||0),E=Math.ceil(2*p+m);return{strokeStyle:u,strokeWidth:g,size:E,lineCap:t,lineDash:r,lineDashOffset:l,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let r=this.fill_.getColor();r===null&&(r=Xi),e.fillStyle=Un(r),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),r=0;typeof n=="string"&&(n=_o(n)),n===null?r=1:Array.isArray(n)&&(r=n.length===4?n[3]:1),r===0&&(e=Mi(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const r=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const l=this.angle_-Math.PI/2,u=2*Math.PI/e;for(let g=0;g<e;g++){const m=l+g*u,p=g%2===0?n:r;t.lineTo(p*Math.cos(m),p*Math.sin(m))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Xi,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Ka extends Za{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Ka({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}class qa{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Xc,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new qa({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Xc,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function w1(s){let t;if(typeof s=="function")t=s;else{let e;Array.isArray(s)?e=s:(pe(typeof s.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[s]),t=function(){return e}}return t}let Tl=null;function R0(s,t){if(!Tl){const e=new Oo({color:"rgba(255,255,255,0.4)"}),n=new Va({color:"#3399CC",width:1.25});Tl=[new qa({image:new Ka({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return Tl}function Xc(s){return s.getGeometry()}const fa=qa,C1="#333";class Kh{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=sn(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Oo({color:C1}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Kh({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=sn(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const Re={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class v0 extends bn{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Re.OPACITY]=t.opacity!==void 0?t.opacity:1,pe(typeof e[Re.OPACITY]=="number","Layer opacity must be a number"),e[Re.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Re.Z_INDEX]=t.zIndex,e[Re.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Re.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Re.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Re.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=ei(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return Xt()}getLayerStatesArray(t){return Xt()}getExtent(){return this.get(Re.EXTENT)}getMaxResolution(){return this.get(Re.MAX_RESOLUTION)}getMinResolution(){return this.get(Re.MIN_RESOLUTION)}getMinZoom(){return this.get(Re.MIN_ZOOM)}getMaxZoom(){return this.get(Re.MAX_ZOOM)}getOpacity(){return this.get(Re.OPACITY)}getSourceState(){return Xt()}getVisible(){return this.get(Re.VISIBLE)}getZIndex(){return this.get(Re.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Re.EXTENT,t)}setMaxResolution(t){this.set(Re.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Re.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Re.MAX_ZOOM,t)}setMinZoom(t){this.set(Re.MIN_ZOOM,t)}setOpacity(t){pe(typeof t=="number","Layer opacity must be a number"),this.set(Re.OPACITY,t)}setVisible(t){this.set(Re.VISIBLE,t)}setZIndex(t){this.set(Re.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Di={ANIMATING:0,INTERACTING:1},An={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},A1=42,qh=256;function Vc(s,t,e){return function(n,r,l,u,g){if(!n)return;if(!r&&!t)return n;const m=t?0:l[0]*r,p=t?0:l[1]*r,E=g?g[0]:0,A=g?g[1]:0;let b=s[0]+m/2+E,D=s[2]-m/2+E,P=s[1]+p/2+A,F=s[3]-p/2+A;b>D&&(b=(D+b)/2,D=b),P>F&&(P=(F+P)/2,F=P);let z=ei(n[0],b,D),j=ei(n[1],P,F);if(u&&e&&r){const G=30*r;z+=-G*Math.log(1+Math.max(0,b-n[0])/G)+G*Math.log(1+Math.max(0,n[0]-D)/G),j+=-G*Math.log(1+Math.max(0,P-n[1])/G)+G*Math.log(1+Math.max(0,n[1]-F)/G)}return[z,j]}}function I1(s){return s}function Qh(s,t,e,n){const r=we(t)/e[0],l=Li(t)/e[1];return n?Math.min(s,Math.max(r,l)):Math.min(s,Math.min(r,l))}function Jh(s,t,e){let n=Math.min(s,t);const r=50;return n*=Math.log(1+r*Math.max(0,s/t-1))/r+1,e&&(n=Math.max(n,e),n/=Math.log(1+r*Math.max(0,e/s-1))/r+1),ei(n,e/2,t*2)}function M1(s,t,e,n){return t=t!==void 0?t:!0,function(r,l,u,g){if(r!==void 0){const m=s[0],p=s[s.length-1],E=e?Qh(m,e,u,n):m;if(g)return t?Jh(r,E,p):ei(r,p,E);const A=Math.min(E,r),b=Math.floor(Mh(s,A,l));return s[b]>E&&b<s.length-1?s[b+1]:s[b]}}}function S1(s,t,e,n,r,l){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(u,g,m,p){if(u!==void 0){const E=r?Qh(t,r,m,l):t;if(p)return n?Jh(u,E,e):ei(u,e,E);const A=1e-9,b=Math.ceil(Math.log(t/E)/Math.log(s)-A),D=-g*(.5-A)+.5,P=Math.min(E,u),F=Math.floor(Math.log(t/P)/Math.log(s)+D),z=Math.max(b,F),j=t/Math.pow(s,z);return ei(j,e,E)}}}function Yc(s,t,e,n,r){return e=e!==void 0?e:!0,function(l,u,g,m){if(l!==void 0){const p=n?Qh(s,n,g,r):s;return!e||!m?ei(l,t,p):Jh(l,p,t)}}}function $h(s){if(s!==void 0)return 0}function Hc(s){if(s!==void 0)return s}function T1(s){const t=2*Math.PI/s;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function b1(s){const t=s===void 0?ua(5):s;return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}function N0(s){return Math.pow(s,3)}function Xr(s){return 1-N0(1-s)}function R1(s){return 3*s*s-2*s*s*s}function v1(s){return s}const bl=0;class N1 extends bn{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Dh(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Ad(),t.center&&(t.center=ts(t.center,this.projection_)),t.extent&&(t.extent=Ks(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const g in An)delete e[g];this.setProperties(e,!0);const n=D1(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const r=O1(t),l=n.constraint,u=L1(t);this.constraints_={center:r,resolution:l,rotation:u},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const r=t||[0,0,0,0];e=e||[0,0,0,0];const l=this.getResolution(),u=l/2*(r[3]-e[3]+e[1]-r[1]),g=l/2*(r[0]-e[0]+e[2]-r[2]);this.setCenterInternal([n[0]+u,n[1]-g])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let r=arguments[n];r.center&&(r=Object.assign({},r),r.center=ts(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=ts(r.anchor,this.getProjection())),e[n]=r}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let r=0;for(;r<e&&!this.isDef();++r){const E=arguments[r];E.center&&this.setCenterInternal(E.center),E.zoom!==void 0?this.setZoom(E.zoom):E.resolution&&this.setResolution(E.resolution),E.rotation!==void 0&&this.setRotation(E.rotation)}if(r===e){n&&ia(n,!0);return}let l=Date.now(),u=this.targetCenter_.slice(),g=this.targetResolution_,m=this.targetRotation_;const p=[];for(;r<e;++r){const E=arguments[r],A={start:l,complete:!1,anchor:E.anchor,duration:E.duration!==void 0?E.duration:1e3,easing:E.easing||R1,callback:n};if(E.center&&(A.sourceCenter=u,A.targetCenter=E.center.slice(),u=A.targetCenter),E.zoom!==void 0?(A.sourceResolution=g,A.targetResolution=this.getResolutionForZoom(E.zoom),g=A.targetResolution):E.resolution&&(A.sourceResolution=g,A.targetResolution=E.resolution,g=A.targetResolution),E.rotation!==void 0){A.sourceRotation=m;const b=Rr(E.rotation-m+Math.PI,2*Math.PI)-Math.PI;A.targetRotation=m+b,m=A.targetRotation}P1(A)?A.complete=!0:l+=A.duration,p.push(A)}this.animations_.push(p),this.setHint(Di.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Di.ANIMATING]>0}getInteracting(){return this.hints_[Di.INTERACTING]>0}cancelAnimations(){this.setHint(Di.ANIMATING,-this.hints_[Di.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const r=this.animations_[e];if(r[0].callback&&ia(r[0].callback,!1),!t)for(let l=0,u=r.length;l<u;++l){const g=r[l];if(!g.complete){t=g.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const r=this.animations_[n];let l=!0;for(let u=0,g=r.length;u<g;++u){const m=r[u];if(m.complete)continue;const p=t-m.start;let E=m.duration>0?p/m.duration:1;E>=1?(m.complete=!0,E=1):l=!1;const A=m.easing(E);if(m.sourceCenter){const b=m.sourceCenter[0],D=m.sourceCenter[1],P=m.targetCenter[0],F=m.targetCenter[1];this.nextCenter_=m.targetCenter;const z=b+A*(P-b),j=D+A*(F-D);this.targetCenter_=[z,j]}if(m.sourceResolution&&m.targetResolution){const b=A===1?m.targetResolution:m.sourceResolution+A*(m.targetResolution-m.sourceResolution);if(m.anchor){const D=this.getViewportSize_(this.getRotation()),P=this.constraints_.resolution(b,0,D,!0);this.targetCenter_=this.calculateCenterZoom(P,m.anchor)}this.nextResolution_=m.targetResolution,this.targetResolution_=b,this.applyTargetState_(!0)}if(m.sourceRotation!==void 0&&m.targetRotation!==void 0){const b=A===1?Rr(m.targetRotation+Math.PI,2*Math.PI)-Math.PI:m.sourceRotation+A*(m.targetRotation-m.sourceRotation);if(m.anchor){const D=this.constraints_.rotation(b,!0);this.targetCenter_=this.calculateCenterRotate(D,m.anchor)}this.nextRotation_=m.targetRotation,this.targetRotation_=b}if(this.applyTargetState_(!0),e=!0,!m.complete)break}if(l){this.animations_[n]=null,this.setHint(Di.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const u=r[0].callback;u&&ia(u,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const r=this.getCenterInternal();return r!==void 0&&(n=[r[0]-e[0],r[1]-e[1]],Nh(n,t-this.getRotation()),Ed(n,e)),n}calculateCenterZoom(t,e){let n;const r=this.getCenterInternal(),l=this.getResolution();if(r!==void 0&&l!==void 0){const u=e[0]-t*(e[0]-r[0])/l,g=e[1]-t*(e[1]-r[1])/l;n=[u,g]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],r=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(r*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&th(t,this.getProjection())}getCenterInternal(){return this.get(An.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return Lh(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();pe(e,"The view center is not defined");const n=this.getResolution();pe(n!==void 0,"The view resolution is not defined");const r=this.getRotation();return pe(r!==void 0,"The view rotation is not defined"),Kl(e,n,r,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(An.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Ks(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=we(t)/e[0],r=Li(t)/e[1];return Math.max(n,r)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(e/n)/Math.log(t);return function(l){return e/Math.pow(t,l*r)}}getRotation(){return this.get(An.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,l=Math.log(n/r)/e;return function(u){return Math.log(n/u)/e/l}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let r=this.getCenterInternal();const l=this.padding_;if(l){const u=this.getViewportSizeMinusPadding_();r=Rl(r,this.getViewportSize_(),[u[0]/2+l[3],u[1]/2+l[0]],e,n)}return{center:r.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,r;if(this.resolutions_){const l=Mh(this.resolutions_,t,1);e=l,n=this.resolutions_[l],l==this.resolutions_.length-1?r=2:r=n/this.resolutions_[l+1]}else n=this.maxResolution_,r=this.zoomFactor_;return e+Math.log(n/t)/Math.log(r)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=ei(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,ei(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(pe(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){pe(!Ro(t),"Cannot fit empty extent provided as `geometry`");const r=Ks(t,this.getProjection());n=Pc(r)}else if(t.getType()==="Circle"){const r=Ks(t.getExtent(),this.getProjection());n=Pc(r),n.rotate(this.getRotation(),Os(r))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),r=Math.sin(-e),l=t.getFlatCoordinates(),u=t.getStride();let g=1/0,m=1/0,p=-1/0,E=-1/0;for(let A=0,b=l.length;A<b;A+=u){const D=l[A]*n-l[A+1]*r,P=l[A]*r+l[A+1]*n;g=Math.min(g,D),m=Math.min(m,P),p=Math.max(p,D),E=Math.max(E,P)}return[g,m,p,E]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const r=e.padding!==void 0?e.padding:[0,0,0,0],l=e.nearest!==void 0?e.nearest:!1;let u;e.minResolution!==void 0?u=e.minResolution:e.maxZoom!==void 0?u=this.getResolutionForZoom(e.maxZoom):u=0;const g=this.rotatedExtentForGeometry(t);let m=this.getResolutionForExtentInternal(g,[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]);m=isNaN(m)?u:Math.max(m,u),m=this.getConstrainedResolution(m,l?0:1);const p=this.getRotation(),E=Math.sin(p),A=Math.cos(p),b=Os(g);b[0]+=(r[1]-r[3])/2*m,b[1]+=(r[0]-r[2])/2*m;const D=b[0]*A-b[1]*E,P=b[1]*A+b[0]*E,F=this.getConstrainedCenter([D,P],m),z=e.callback?e.callback:Or;e.duration!==void 0?this.animateInternal({resolution:m,center:F,duration:e.duration,easing:e.easing},z):(this.targetResolution_=m,this.targetCenter_=F,this.applyTargetState_(!1,!0),ia(z,!0))}centerOn(t,e,n){this.centerOnInternal(ts(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(Rl(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,r){let l;const u=this.padding_;if(u&&t){const g=this.getViewportSizeMinusPadding_(-n),m=Rl(t,r,[g[0]/2+u[3],g[1]/2+u[0]],e,n);l=[t[0]-m[0],t[1]-m[1]]}return l}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=th(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&ts(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),l=this.constraints_.resolution(this.targetResolution_*t,0,r,n);e&&(this.targetCenter_=this.calculateCenterZoom(l,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=ts(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(r,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&ts(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,r=this.constraints_.rotation(this.targetRotation_,n),l=this.getViewportSize_(r),u=this.constraints_.resolution(this.targetResolution_,0,l,n),g=this.constraints_.center(this.targetCenter_,u,l,n,this.calculateCenterShift(this.targetCenter_,u,r,l));this.get(An.ROTATION)!==r&&this.set(An.ROTATION,r),this.get(An.RESOLUTION)!==u&&(this.set(An.RESOLUTION,u),this.set("zoom",this.getZoom(),!0)),(!g||!this.get(An.CENTER)||!ma(this.get(An.CENTER),g))&&this.set(An.CENTER,g),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const r=e||0,l=this.constraints_.rotation(this.targetRotation_),u=this.getViewportSize_(l),g=this.constraints_.resolution(this.targetResolution_,r,u),m=this.constraints_.center(this.targetCenter_,g,u,!1,this.calculateCenterShift(this.targetCenter_,g,l,u));if(t===0&&!this.cancelAnchor_){this.targetResolution_=g,this.targetRotation_=l,this.targetCenter_=m,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==g||this.getRotation()!==l||!this.getCenterInternal()||!ma(this.getCenterInternal(),m))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:l,center:m,resolution:g,duration:t,easing:Xr,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Di.INTERACTING,1)}endInteraction(t,e,n){n=n&&ts(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(Di.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function ia(s,t){setTimeout(function(){s(t)},0)}function O1(s){if(s.extent!==void 0){const e=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return Vc(s.extent,s.constrainOnlyCenter,e)}const t=Dh(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Vc(e,!1,!1)}return I1}function D1(s){let t,e,n,u=s.minZoom!==void 0?s.minZoom:bl,g=s.maxZoom!==void 0?s.maxZoom:28;const m=s.zoomFactor!==void 0?s.zoomFactor:2,p=s.multiWorld!==void 0?s.multiWorld:!1,E=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,A=s.showFullExtent!==void 0?s.showFullExtent:!1,b=Dh(s.projection,"EPSG:3857"),D=b.getExtent();let P=s.constrainOnlyCenter,F=s.extent;if(!p&&!F&&b.isGlobal()&&(P=!1,F=D),s.resolutions!==void 0){const z=s.resolutions;e=z[u],n=z[g]!==void 0?z[g]:z[z.length-1],s.constrainResolution?t=M1(z,E,!P&&F,A):t=Yc(e,n,E,!P&&F,A)}else{const j=(D?Math.max(we(D),Li(D)):360*go.degrees/b.getMetersPerUnit())/qh/Math.pow(2,bl),G=j/Math.pow(2,28-bl);e=s.maxResolution,e!==void 0?u=0:e=j/Math.pow(m,u),n=s.minResolution,n===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?n=e/Math.pow(m,g):n=j/Math.pow(m,g):n=G),g=u+Math.floor(Math.log(e/n)/Math.log(m)),n=e/Math.pow(m,g-u),s.constrainResolution?t=S1(m,e,n,E,!P&&F,A):t=Yc(e,n,E,!P&&F,A)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:u,zoomFactor:m}}function L1(s){if(s.enableRotation!==void 0?s.enableRotation:!0){const e=s.constrainRotation;return e===void 0||e===!0?b1():e===!1?Hc:typeof e=="number"?T1(e):Hc}return $h}function P1(s){return!(s.sourceCenter&&s.targetCenter&&!ma(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function Rl(s,t,e,n,r){const l=Math.cos(-r);let u=Math.sin(-r),g=s[0]*l-s[1]*u,m=s[1]*l+s[0]*u;g+=(t[0]/2-e[0])*n,m+=(e[1]-t[1]/2)*n,u=-u;const p=g*l-m*u,E=m*l+g*u;return[p,E]}const Pn=N1;class Qa extends v0{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Re.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Re.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Fe(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=de(t,Ht.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof Pn?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let r;e.layerStatesArray?r=e.layerStatesArray.find(u=>u.layer===this):r=this.getLayerState();const l=this.getExtent();return tc(r,e.viewState)&&(!l||Vi(l,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const n=this.getSource();if(n&&(e=n.getAttributions()),!e)return[];const r=t instanceof Pn?t.getViewStateAndExtent():t;let l=e(r);return Array.isArray(l)||(l=[l]),l}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(Re.MAP,t)}getMapInternal(){return this.get(Re.MAP)}setMap(t){this.mapPrecomposeKey_&&(Fe(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Fe(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=de(t,gn.PRECOMPOSE,function(e){const r=e.frameState.layerStatesArray,l=this.getLayerState(!1);pe(!r.some(function(u){return u.layer===l.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),r.push(l)},this),this.mapRenderKey_=de(this,Ht.CHANGE,t.render,t),this.changed())}setSource(t){this.set(Re.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function tc(s,t){if(!s.visible)return!1;const e=t.resolution;if(e<s.minResolution||e>=s.maxResolution)return!1;const n=t.zoom;return n>s.minZoom&&n<=s.maxZoom}function F1(s,t,e,n,r){O0(s,t,e||0,n||s.length-1,r||B1)}function O0(s,t,e,n,r){for(;n>e;){if(n-e>600){var l=n-e+1,u=t-e+1,g=Math.log(l),m=.5*Math.exp(2*g/3),p=.5*Math.sqrt(g*m*(l-m)/l)*(u-l/2<0?-1:1),E=Math.max(e,Math.floor(t-u*m/l+p)),A=Math.min(n,Math.floor(t+(l-u)*m/l+p));O0(s,t,E,A,r)}var b=s[t],D=e,P=n;for(eo(s,e,t),r(s[n],b)>0&&eo(s,e,n);D<P;){for(eo(s,D,P),D++,P--;r(s[D],b)<0;)D++;for(;r(s[P],b)>0;)P--}r(s[e],b)===0?eo(s,e,P):(P++,eo(s,P,n)),P<=t&&(e=P+1),t<=P&&(n=P-1)}}function eo(s,t,e){var n=s[t];s[t]=s[e],s[e]=n}function B1(s,t){return s<t?-1:s>t?1:0}let D0=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!sa(t,e))return n;const r=this.toBBox,l=[];for(;e;){for(let u=0;u<e.children.length;u++){const g=e.children[u],m=e.leaf?r(g):g;sa(t,m)&&(e.leaf?n.push(g):Nl(t,m)?this._all(g,n):l.push(g))}e=l.pop()}return n}collides(t){let e=this.data;if(!sa(t,e))return!1;const n=[];for(;e;){for(let r=0;r<e.children.length;r++){const l=e.children[r],u=e.leaf?this.toBBox(l):l;if(sa(t,u)){if(e.leaf||Nl(t,u))return!0;n.push(l)}}e=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const n=this.data;this.data=e,e=n}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=wr([]),this}remove(t,e){if(!t)return this;let n=this.data;const r=this.toBBox(t),l=[],u=[];let g,m,p;for(;n||l.length;){if(n||(n=l.pop(),m=l[l.length-1],g=u.pop(),p=!0),n.leaf){const E=k1(t,n.children,e);if(E!==-1)return n.children.splice(E,1),l.push(n),this._condense(l),this}!p&&!n.leaf&&Nl(n,r)?(l.push(n),u.push(g),g=0,m=n,n=n.children[0]):m?(g++,n=m.children[g],p=!1):n=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,r){const l=n-e+1;let u=this._maxEntries,g;if(l<=u)return g=wr(t.slice(e,n+1)),xr(g,this.toBBox),g;r||(r=Math.ceil(Math.log(l)/Math.log(u)),u=Math.ceil(l/Math.pow(u,r-1))),g=wr([]),g.leaf=!1,g.height=r;const m=Math.ceil(l/u),p=m*Math.ceil(Math.sqrt(u));Zc(t,e,n,p,this.compareMinX);for(let E=e;E<=n;E+=p){const A=Math.min(E+p-1,n);Zc(t,E,A,m,this.compareMinY);for(let b=E;b<=A;b+=m){const D=Math.min(b+m-1,A);g.children.push(this._build(t,b,D,r-1))}}return xr(g,this.toBBox),g}_chooseSubtree(t,e,n,r){for(;r.push(e),!(e.leaf||r.length-1===n);){let l=1/0,u=1/0,g;for(let m=0;m<e.children.length;m++){const p=e.children[m],E=vl(p),A=z1(t,p)-E;A<u?(u=A,l=E<l?E:l,g=p):A===u&&E<l&&(l=E,g=p)}e=g||e.children[0]}return e}_insert(t,e,n){const r=n?t:this.toBBox(t),l=[],u=this._chooseSubtree(r,this.data,e,l);for(u.children.push(t),ro(u,r);e>=0&&l[e].children.length>this._maxEntries;)this._split(l,e),e--;this._adjustParentBBoxes(r,l,e)}_split(t,e){const n=t[e],r=n.children.length,l=this._minEntries;this._chooseSplitAxis(n,l,r);const u=this._chooseSplitIndex(n,l,r),g=wr(n.children.splice(u,n.children.length-u));g.height=n.height,g.leaf=n.leaf,xr(n,this.toBBox),xr(g,this.toBBox),e?t[e-1].children.push(g):this._splitRoot(n,g)}_splitRoot(t,e){this.data=wr([t,e]),this.data.height=t.height+1,this.data.leaf=!1,xr(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let r,l=1/0,u=1/0;for(let g=e;g<=n-e;g++){const m=so(t,0,g,this.toBBox),p=so(t,g,n,this.toBBox),E=j1(m,p),A=vl(m)+vl(p);E<l?(l=E,r=g,u=A<u?A:u):E===l&&A<u&&(u=A,r=g)}return r||n-e}_chooseSplitAxis(t,e,n){const r=t.leaf?this.compareMinX:U1,l=t.leaf?this.compareMinY:G1,u=this._allDistMargin(t,e,n,r),g=this._allDistMargin(t,e,n,l);u<g&&t.children.sort(r)}_allDistMargin(t,e,n,r){t.children.sort(r);const l=this.toBBox,u=so(t,0,e,l),g=so(t,n-e,n,l);let m=na(u)+na(g);for(let p=e;p<n-e;p++){const E=t.children[p];ro(u,t.leaf?l(E):E),m+=na(u)}for(let p=n-e-1;p>=e;p--){const E=t.children[p];ro(g,t.leaf?l(E):E),m+=na(g)}return m}_adjustParentBBoxes(t,e,n){for(let r=n;r>=0;r--)ro(e[r],t)}_condense(t){for(let e=t.length-1,n;e>=0;e--)t[e].children.length===0?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():xr(t[e],this.toBBox)}};function k1(s,t,e){if(!e)return t.indexOf(s);for(let n=0;n<t.length;n++)if(e(s,t[n]))return n;return-1}function xr(s,t){so(s,0,s.children.length,t,s)}function so(s,t,e,n,r){r||(r=wr(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let l=t;l<e;l++){const u=s.children[l];ro(r,s.leaf?n(u):u)}return r}function ro(s,t){return s.minX=Math.min(s.minX,t.minX),s.minY=Math.min(s.minY,t.minY),s.maxX=Math.max(s.maxX,t.maxX),s.maxY=Math.max(s.maxY,t.maxY),s}function U1(s,t){return s.minX-t.minX}function G1(s,t){return s.minY-t.minY}function vl(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function na(s){return s.maxX-s.minX+(s.maxY-s.minY)}function z1(s,t){return(Math.max(t.maxX,s.maxX)-Math.min(t.minX,s.minX))*(Math.max(t.maxY,s.maxY)-Math.min(t.minY,s.minY))}function j1(s,t){const e=Math.max(s.minX,t.minX),n=Math.max(s.minY,t.minY),r=Math.min(s.maxX,t.maxX),l=Math.min(s.maxY,t.maxY);return Math.max(0,r-e)*Math.max(0,l-n)}function Nl(s,t){return s.minX<=t.minX&&s.minY<=t.minY&&t.maxX<=s.maxX&&t.maxY<=s.maxY}function sa(s,t){return t.minX<=s.maxX&&t.minY<=s.maxY&&t.maxX>=s.minX&&t.maxY>=s.minY}function wr(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Zc(s,t,e,n,r){const l=[t,e];for(;l.length;){if(e=l.pop(),t=l.pop(),e-t<=n)continue;const u=t+Math.ceil((e-t)/n/2)*n;F1(s,u,t,e,r),l.push(t,u,u,e)}}function Kc(s,t,e,n){return e!==void 0&&n!==void 0?[e/s,n/t]:e!==void 0?e/s:n!==void 0?n/t:1}class Ja extends Ya{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,r=t.scale!==void 0?t.scale:1,l=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:r,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:l,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const u=t.img!==void 0?t.img:null;let g=t.src;pe(!(g!==void 0&&u),"`image` and `src` cannot be provided at the same time"),(g===void 0||g.length===0)&&u&&(g=u.src||Me(u)),pe(g!==void 0&&g.length>0,"A defined and non-empty `src` or `image` must be provided"),pe(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let m;if(t.src!==void 0?m=ee.IDLE:u!==void 0&&("complete"in u?u.complete?m=u.src?ee.LOADED:ee.IDLE:m=ee.LOADING:m=ee.LOADED),this.color_=t.color!==void 0?_o(t.color):null,this.iconImage_=Hh(u,g,this.crossOrigin_,m,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let p,E;if(t.size)[p,E]=t.size;else{const A=this.getImage(1);if(A.width&&A.height)p=A.width,E=A.height;else if(A instanceof HTMLImageElement){this.initialOptions_=t;const b=()=>{if(this.unlistenImageChange(b),!this.initialOptions_)return;const D=this.iconImage_.getSize();this.setScale(Kc(D[0],D[1],t.width,t.height))};this.listenImageChange(b);return}}p!==void 0&&this.setScale(Kc(p,E,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Ja({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=r[0]),this.anchorYUnits_=="fraction"&&(t[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+r[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==ee.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==ee.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(Ht.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(Ht.CHANGE,t)}ready(){return this.iconImage_.ready()}}let or=0;const Vr=0,Je=1<<or++,Lt=1<<or++,en=1<<or++,pi=1<<or++,zn=1<<or++,ho=1<<or++,Ni=Math.pow(2,or)-1,L0={[Je]:"boolean",[Lt]:"number",[en]:"string",[pi]:"color",[zn]:"number[]",[ho]:"size"},W1=Object.keys(L0).map(Number).sort(rs);function Pi(s){const t=[];for(const e of W1)X1(s,e)&&t.push(L0[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function X1(s,t){return(s&t)===t}function jn(s,t){return!!(s&t)}function $a(s,t){return s===t}class bs{constructor(t,e){this.type=t,this.value=e}}class V1{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function P0(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function Y1(s){switch(s){case"string":return en;case"color":return pi;case"number":return Lt;case"boolean":return Je;case"number[]":return zn;default:throw new Error(`Unrecognized type hint: ${s}`)}}function Ie(s,t,e){switch(typeof s){case"boolean":return new bs(Je,s);case"number":return new bs(e===ho?ho:Lt,s);case"string":{let r=en;return $d(s)&&(r|=pi),$a(r&e,Vr)||(r&=e),new bs(r,s)}}if(!Array.isArray(s))throw new Error("Expression must be an array or a primitive value");if(s.length===0)throw new Error("Empty expression");if(typeof s[0]=="string")return sg(s,t,e);for(const r of s)if(typeof r!="number")throw new Error("Expected an array of numbers");let n=zn;return s.length===2?n|=ho:(s.length===3||s.length===4)&&(n|=pi),e&&(n&=e),new bs(n,s)}const ht={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},H1={[ht.Get]:Yt(([s,t])=>t!==void 0?Y1(t.value):Ni,Qt(1,2),Z1),[ht.Var]:Yt(([s])=>s.type,Qt(1,1),K1),[ht.Id]:Yt(Lt|en,io,q1),[ht.Concat]:Yt(en,Qt(2,1/0),xe(Ni)),[ht.GeometryType]:Yt(en,io,Q1),[ht.Resolution]:Yt(Lt,io),[ht.Zoom]:Yt(Lt,io),[ht.Time]:Yt(Lt,io),[ht.Any]:Yt(Je,Qt(2,1/0),xe(Je)),[ht.All]:Yt(Je,Qt(2,1/0),xe(Je)),[ht.Not]:Yt(Je,Qt(1,1),xe(Je)),[ht.Equal]:Yt(Je,Qt(2,2),xe(Ni),ys),[ht.NotEqual]:Yt(Je,Qt(2,2),xe(Ni),ys),[ht.GreaterThan]:Yt(Je,Qt(2,2),xe(Ni),ys),[ht.GreaterThanOrEqualTo]:Yt(Je,Qt(2,2),xe(Ni),ys),[ht.LessThan]:Yt(Je,Qt(2,2),xe(Ni),ys),[ht.LessThanOrEqualTo]:Yt(Je,Qt(2,2),xe(Ni),ys),[ht.Multiply]:Yt(s=>{let t=Lt|pi;for(let e=0;e<s.length;e++)t&=s[e].type;return t},Qt(2,1/0),xe(Lt|pi),ys),[ht.Coalesce]:Yt(s=>{let t=Ni;for(let e=1;e<s.length;e+=2)t&=s[e].type;return t&=s[s.length-1].type,t},Qt(2,1/0),xe(Ni),ys),[ht.Divide]:Yt(Lt,Qt(2,2),xe(Lt)),[ht.Add]:Yt(Lt,Qt(2,1/0),xe(Lt)),[ht.Subtract]:Yt(Lt,Qt(2,2),xe(Lt)),[ht.Clamp]:Yt(Lt,Qt(3,3),xe(Lt)),[ht.Mod]:Yt(Lt,Qt(2,2),xe(Lt)),[ht.Pow]:Yt(Lt,Qt(2,2),xe(Lt)),[ht.Abs]:Yt(Lt,Qt(1,1),xe(Lt)),[ht.Floor]:Yt(Lt,Qt(1,1),xe(Lt)),[ht.Ceil]:Yt(Lt,Qt(1,1),xe(Lt)),[ht.Round]:Yt(Lt,Qt(1,1),xe(Lt)),[ht.Sin]:Yt(Lt,Qt(1,1),xe(Lt)),[ht.Cos]:Yt(Lt,Qt(1,1),xe(Lt)),[ht.Atan]:Yt(Lt,Qt(1,2),xe(Lt)),[ht.Sqrt]:Yt(Lt,Qt(1,1),xe(Lt)),[ht.Match]:Yt(s=>{let t=Ni;for(let e=2;e<s.length;e+=2)t&=s[e].type;return t&=s[s.length-1].type,t},Qt(4,1/0),qc,$1),[ht.Between]:Yt(Je,Qt(3,3),xe(Lt)),[ht.Interpolate]:Yt(s=>{let t=pi|Lt;for(let e=3;e<s.length;e+=2)t&=s[e].type;return t},Qt(6,1/0),qc,tg),[ht.Case]:Yt(s=>{let t=Ni;for(let e=1;e<s.length;e+=2)t&=s[e].type;return t&=s[s.length-1].type,t},Qt(3,1/0),J1,eg),[ht.In]:Yt(Je,Qt(2,2),ig),[ht.Number]:Yt(Lt,Qt(1,1/0),xe(Ni)),[ht.String]:Yt(en,Qt(1,1/0),xe(Ni)),[ht.Array]:Yt(s=>s.length===2?zn|ho:s.length===3||s.length===4?zn|pi:zn,Qt(1,1/0),xe(Lt)),[ht.Color]:Yt(pi,Qt(1,4),xe(Lt)),[ht.Band]:Yt(Lt,Qt(1,3),xe(Lt)),[ht.Palette]:Yt(pi,Qt(2,2),ng),[ht.ToString]:Yt(en,Qt(1,1),xe(Je|Lt|en|pi))};function Z1(s,t){const e=Ie(s[1],t);if(!(e instanceof bs))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),s.length===3){const n=Ie(s[2],t);return[e,n]}return[e]}function K1(s,t,e,n){const r=s[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(r),!("variables"in t.style)||t.style.variables[r]===void 0)return[new bs(Ni,r)];const l=t.style.variables[r],u=Ie(l,t);if(u.value=r,n&&!jn(n,u.type))throw new Error(`The variable ${r} has type ${Pi(u.type)} but the following type was expected: ${Pi(n)}`);return[u]}function q1(s,t){t.featureId=!0}function Q1(s,t){t.geometryType=!0}function io(s,t){const e=s[0];if(s.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function Qt(s,t){return function(e,n){const r=e[0],l=e.length-1;if(s===t){if(l!==s){const u=s===1?"":"s";throw new Error(`Expected ${s} argument${u} for ${r}, got ${l}`)}}else if(l<s||l>t){const u=t===1/0?`${s} or more`:`${s} to ${t}`;throw new Error(`Expected ${u} arguments for ${r}, got ${l}`)}}}function xe(s){return function(t,e){const n=t[0],r=t.length-1,l=new Array(r);for(let u=0;u<r;++u){const g=Ie(t[u+1],e);if(!jn(s,g.type)){const m=Pi(s),p=Pi(g.type);throw new Error(`Unexpected type for argument ${u} of ${n} operation, got ${m} but expected ${p}`)}g.type&=s,l[u]=g}return l}}function ys(s,t,e){const n=s[0],r=s.length-1;let l=Ni;for(let g=0;g<e.length;++g)l&=e[g].type;if(l===Vr)throw new Error(`No common type could be found for arguments of ${n} operation`);const u=new Array(r);for(let g=0;g<r;++g)u[g]=Ie(s[g+1],t,l);return u}function J1(s,t){const e=s[0],n=s.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function qc(s,t){const e=s[0],n=s.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function $1(s,t,e,n){const r=s.length-1;let u=Ie(s[1],t).type;const g=Ie(s[s.length-1],t);let m=n!==void 0?n&g.type:g.type;const p=new Array(r-2);for(let A=0;A<r-2;A+=2){const b=Ie(s[A+2],t),D=Ie(s[A+3],t);u&=b.type,m&=D.type,p[A]=b,p[A+1]=D}const E=en|Lt|Je;if(!jn(E,u))throw new Error(`Expected an input of type ${Pi(E)} for the interpolate operation, got ${Pi(u)} instead`);if(u&=E,$a(m,Vr))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(s));for(let A=0;A<r-2;A+=2){const b=Ie(s[A+2],t,u),D=Ie(s[A+3],t,m);p[A]=b,p[A+1]=D}return[Ie(s[1],t,u),...p,Ie(s[s.length-1],t,m)]}function tg(s,t,e,n){const r=s[1];let l;switch(r[0]){case"linear":l=1;break;case"exponential":if(l=r[1],typeof l!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);break;default:l=null}if(!l)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);l=Ie(l,t);let u=Ie(s[2],t);if(!jn(Lt,u.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${Pi(u.type)} instead`);u=Ie(s[2],t,Lt);const g=new Array(s.length-3);for(let m=0;m<g.length;m+=2){let p=Ie(s[m+3],t);if(!jn(Lt,p.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${Pi(p.type)} at position ${m+2} instead`);let E=Ie(s[m+4],t);if(!jn(Lt|pi,E.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${Pi(E.type)} at position ${m+3} instead`);p=Ie(s[m+3],t,Lt),E=Ie(s[m+4],t,Lt|pi),g[m]=p,g[m+1]=E}return[l,u,...g]}function eg(s,t,e,n){const r=Ie(s[s.length-1],t,n);let l=n!==void 0?n&r.type:r.type;const u=new Array(s.length-1);for(let g=0;g<u.length-1;g+=2){const m=Ie(s[g+1],t),p=Ie(s[g+2],t,n);if(!jn(Je,m.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${Pi(m.type)} at position ${g} instead`);l&=p.type,u[g]=m,u[g+1]=p}if($a(l,Vr))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(s));for(let g=0;g<u.length-1;g+=2)u[g+1]=Ie(s[g+2],t,l);return u[u.length-1]=Ie(s[s.length-1],t,l),u}function ig(s,t){let e=s[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let n=en|Lt;const r=new Array(e.length);for(let u=0;u<r.length;u++){const g=Ie(e[u],t);n&=g.type,r[u]=g}if($a(n,Vr))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(s));return[Ie(s[1],t,n),...r]}function ng(s,t){const e=Ie(s[1],t,Lt);if(e.type!==Lt)throw new Error(`The first argument of palette must be an number, got ${Pi(e.type)} instead`);const n=s[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");const r=new Array(n.length);for(let l=0;l<r.length;l++){const u=Ie(n[l],t,pi);if(!(u instanceof bs))throw new Error(`The palette color at index ${l} must be a literal value`);if(!jn(u.type,pi))throw new Error(`The palette color at index ${l} should be of type color, got ${Pi(u.type)} instead`);r[l]=u}return[e,...r]}function Yt(s,...t){return function(e,n,r){const l=e[0];let u=[];for(let m=0;m<t.length;m++)u=t[m](e,n,u,r)||u;let g=typeof s=="function"?s(u):s;if(r!==void 0){if(!jn(g,r))throw new Error(`The following expression was expected to return ${Pi(r)}, but returns ${Pi(g)} instead: ${JSON.stringify(e)}`);g&=r}if(g===Vr)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new V1(g,l,...u)}}function sg(s,t,e){const n=s[0],r=H1[n];if(!r)throw new Error(`Unknown operator: ${n}`);return r(s,t,e)}function F0(s){if(!s)return"";const t=s.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return F0(s.getGeometries()[0]);default:return""}}function B0(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function us(s,t,e){const n=Ie(s,e);if(!jn(t,n.type)){const r=Pi(t),l=Pi(n.type);throw new Error(`Expected expression to be of type ${r}, got ${l}`)}return Tn(n)}function Tn(s,t){if(s instanceof bs){if(s.type===pi&&typeof s.value=="string"){const n=Vh(s.value);return function(){return n}}return function(){return s.value}}const e=s.operator;switch(e){case ht.Number:case ht.String:case ht.Coalesce:return rg(s);case ht.Get:case ht.Var:return og(s);case ht.Id:return n=>n.featureId;case ht.GeometryType:return n=>n.geometryType;case ht.Concat:{const n=s.args.map(r=>Tn(r));return r=>"".concat(...n.map(l=>l(r).toString()))}case ht.Resolution:return n=>n.resolution;case ht.Any:case ht.All:case ht.Between:case ht.In:case ht.Not:return lg(s);case ht.Equal:case ht.NotEqual:case ht.LessThan:case ht.LessThanOrEqualTo:case ht.GreaterThan:case ht.GreaterThanOrEqualTo:return ag(s);case ht.Multiply:case ht.Divide:case ht.Add:case ht.Subtract:case ht.Clamp:case ht.Mod:case ht.Pow:case ht.Abs:case ht.Floor:case ht.Ceil:case ht.Round:case ht.Sin:case ht.Cos:case ht.Atan:case ht.Sqrt:return hg(s);case ht.Case:return cg(s);case ht.Match:return ug(s);case ht.Interpolate:return fg(s);case ht.ToString:return dg(s);default:throw new Error(`Unsupported operator ${e}`)}}function rg(s,t){const e=s.operator,n=s.args.length,r=new Array(n);for(let l=0;l<n;++l)r[l]=Tn(s.args[l]);switch(e){case ht.Coalesce:return l=>{for(let u=0;u<n;++u){const g=r[u](l);if(typeof g<"u"&&g!==null)return g}throw new Error("Expected one of the values to be non-null")};case ht.Number:case ht.String:return l=>{for(let u=0;u<n;++u){const g=r[u](l);if(typeof g===e)return g}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function og(s,t){const n=s.args[0].value;switch(s.operator){case ht.Get:return r=>r.properties[n];case ht.Var:return r=>r.variables[n];default:throw new Error(`Unsupported accessor operator ${s.operator}`)}}function ag(s,t){const e=s.operator,n=Tn(s.args[0]),r=Tn(s.args[1]);switch(e){case ht.Equal:return l=>n(l)===r(l);case ht.NotEqual:return l=>n(l)!==r(l);case ht.LessThan:return l=>n(l)<r(l);case ht.LessThanOrEqualTo:return l=>n(l)<=r(l);case ht.GreaterThan:return l=>n(l)>r(l);case ht.GreaterThanOrEqualTo:return l=>n(l)>=r(l);default:throw new Error(`Unsupported comparison operator ${e}`)}}function lg(s,t){const e=s.operator,n=s.args.length,r=new Array(n);for(let l=0;l<n;++l)r[l]=Tn(s.args[l]);switch(e){case ht.Any:return l=>{for(let u=0;u<n;++u)if(r[u](l))return!0;return!1};case ht.All:return l=>{for(let u=0;u<n;++u)if(!r[u](l))return!1;return!0};case ht.Between:return l=>{const u=r[0](l),g=r[1](l),m=r[2](l);return u>=g&&u<=m};case ht.In:return l=>{const u=r[0](l);for(let g=1;g<n;++g)if(u===r[g](l))return!0;return!1};case ht.Not:return l=>!r[0](l);default:throw new Error(`Unsupported logical operator ${e}`)}}function hg(s,t){const e=s.operator,n=s.args.length,r=new Array(n);for(let l=0;l<n;++l)r[l]=Tn(s.args[l]);switch(e){case ht.Multiply:return l=>{let u=1;for(let g=0;g<n;++g)u*=r[g](l);return u};case ht.Divide:return l=>r[0](l)/r[1](l);case ht.Add:return l=>{let u=0;for(let g=0;g<n;++g)u+=r[g](l);return u};case ht.Subtract:return l=>r[0](l)-r[1](l);case ht.Clamp:return l=>{const u=r[0](l),g=r[1](l);if(u<g)return g;const m=r[2](l);return u>m?m:u};case ht.Mod:return l=>r[0](l)%r[1](l);case ht.Pow:return l=>Math.pow(r[0](l),r[1](l));case ht.Abs:return l=>Math.abs(r[0](l));case ht.Floor:return l=>Math.floor(r[0](l));case ht.Ceil:return l=>Math.ceil(r[0](l));case ht.Round:return l=>Math.round(r[0](l));case ht.Sin:return l=>Math.sin(r[0](l));case ht.Cos:return l=>Math.cos(r[0](l));case ht.Atan:return n===2?l=>Math.atan2(r[0](l),r[1](l)):l=>Math.atan(r[0](l));case ht.Sqrt:return l=>Math.sqrt(r[0](l));default:throw new Error(`Unsupported numeric operator ${e}`)}}function cg(s,t){const e=s.args.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=Tn(s.args[r]);return r=>{for(let l=0;l<e-1;l+=2)if(n[l](r))return n[l+1](r);return n[e-1](r)}}function ug(s,t){const e=s.args.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=Tn(s.args[r]);return r=>{const l=n[0](r);for(let u=1;u<e;u+=2)if(l===n[u](r))return n[u+1](r);return n[e-1](r)}}function fg(s,t){const e=s.args.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=Tn(s.args[r]);return r=>{const l=n[0](r),u=n[1](r);let g,m;for(let p=2;p<e;p+=2){const E=n[p](r);let A=n[p+1](r);const b=Array.isArray(A);if(b&&(A=Qd(A)),E>=u)return p===2?A:b?gg(l,u,g,m,E,A):oo(l,u,g,m,E,A);g=E,m=A}return m}}function dg(s,t){const e=s.operator,n=s.args.length,r=new Array(n);for(let l=0;l<n;++l)r[l]=Tn(s.args[l]);switch(e){case ht.ToString:return l=>{const u=r[0](l);return s.args[0].type===pi?Yh(u):u.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function oo(s,t,e,n,r,l){const u=r-e;if(u===0)return n;const g=t-e,m=s===1?g/u:(Math.pow(s,g)-1)/(Math.pow(s,u)-1);return n+m*(l-n)}function gg(s,t,e,n,r,l){if(r-e===0)return n;const g=kc(n),m=kc(l);let p=m[2]-g[2];p>180?p-=360:p<-180&&(p+=360);const E=[oo(s,t,e,g[0],r,m[0]),oo(s,t,e,g[1],r,m[1]),g[2]+oo(s,t,e,0,r,p),oo(s,t,e,n[3],r,l[3])];return _0(Jd(E))}function mg(s){return!0}function xg(s){const t=P0(),e=pg(s,t),n=B0();return function(r,l){if(n.properties=r.getPropertiesInternal(),n.resolution=l,t.featureId){const u=r.getId();u!==void 0?n.featureId=u:n.featureId=null}return t.geometryType&&(n.geometryType=F0(r.getGeometry())),e(n)}}function Qc(s){const t=P0(),e=s.length,n=new Array(e);for(let u=0;u<e;++u)n[u]=ah(s[u],t);const r=B0(),l=new Array(e);return function(u,g){if(r.properties=u.getPropertiesInternal(),r.resolution=g,t.featureId){const p=u.getId();p!==void 0?r.featureId=p:r.featureId=null}let m=0;for(let p=0;p<e;++p){const E=n[p](r);E&&(l[m]=E,m+=1)}return l.length=m,l}}function pg(s,t){const e=s.length,n=new Array(e);for(let r=0;r<e;++r){const l=s[r],u="filter"in l?us(l.filter,Je,t):mg;let g;if(Array.isArray(l.style)){const m=l.style.length;g=new Array(m);for(let p=0;p<m;++p)g[p]=ah(l.style[p],t)}else g=[ah(l.style,t)];n[r]={filter:u,styles:g}}return function(r){const l=[];let u=!1;for(let g=0;g<e;++g){const m=n[g].filter;if(m(r)&&!(s[g].else&&u)){u=!0;for(const p of n[g].styles){const E=p(r);E&&l.push(E)}}}return l}}function ah(s,t){const e=Ao(s,"",t),n=Io(s,"",t),r=_g(s,t),l=yg(s,t),u=Yi(s,"z-index",t);if(!e&&!n&&!r&&!l&&!er(s))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(s));const g=new fa;return function(m){let p=!0;if(e){const E=e(m);E&&(p=!1),g.setFill(E)}if(n){const E=n(m);E&&(p=!1),g.setStroke(E)}if(r){const E=r(m);E&&(p=!1),g.setText(E)}if(l){const E=l(m);E&&(p=!1),g.setImage(E)}return u&&g.setZIndex(u(m)),p?null:g}}function Ao(s,t,e){let n;if(t+"fill-pattern-src"in s?n=Ag(s,t+"fill-",e):n=ec(s,t+"fill-color",e),!n)return null;const r=new Oo;return function(l){const u=n(l);return u==="none"?null:(r.setColor(u),r)}}function Io(s,t,e){const n=Yi(s,t+"stroke-width",e),r=ec(s,t+"stroke-color",e);if(!n&&!r)return null;const l=ns(s,t+"stroke-line-cap",e),u=ns(s,t+"stroke-line-join",e),g=k0(s,t+"stroke-line-dash",e),m=Yi(s,t+"stroke-line-dash-offset",e),p=Yi(s,t+"stroke-miter-limit",e),E=new Va;return function(A){if(r){const b=r(A);if(b==="none")return null;E.setColor(b)}if(n&&E.setWidth(n(A)),l){const b=l(A);if(b!=="butt"&&b!=="round"&&b!=="square")throw new Error("Expected butt, round, or square line cap");E.setLineCap(b)}if(u){const b=u(A);if(b!=="bevel"&&b!=="round"&&b!=="miter")throw new Error("Expected bevel, round, or miter line join");E.setLineJoin(b)}return g&&E.setLineDash(g(A)),m&&E.setLineDashOffset(m(A)),p&&E.setMiterLimit(p(A)),E}}function _g(s,t){const e="text-",n=ns(s,e+"value",t);if(!n)return null;const r=Ao(s,e,t),l=Ao(s,e+"background-",t),u=Io(s,e,t),g=Io(s,e+"background-",t),m=ns(s,e+"font",t),p=Yi(s,e+"max-angle",t),E=Yi(s,e+"offset-x",t),A=Yi(s,e+"offset-y",t),b=Mo(s,e+"overflow",t),D=ns(s,e+"placement",t),P=Yi(s,e+"repeat",t),F=tl(s,e+"scale",t),z=Mo(s,e+"rotate-with-view",t),j=Yi(s,e+"rotation",t),G=ns(s,e+"align",t),X=ns(s,e+"justify",t),Y=ns(s,e+"baseline",t),Q=k0(s,e+"padding",t),rt=el(s,e+"declutter-mode"),K=new Kh({declutterMode:rt});return function(ot){if(K.setText(n(ot)),r&&K.setFill(r(ot)),l&&K.setBackgroundFill(l(ot)),u&&K.setStroke(u(ot)),g&&K.setBackgroundStroke(g(ot)),m&&K.setFont(m(ot)),p&&K.setMaxAngle(p(ot)),E&&K.setOffsetX(E(ot)),A&&K.setOffsetY(A(ot)),b&&K.setOverflow(b(ot)),D){const Z=D(ot);if(Z!=="point"&&Z!=="line")throw new Error("Expected point or line for text-placement");K.setPlacement(Z)}if(P&&K.setRepeat(P(ot)),F&&K.setScale(F(ot)),z&&K.setRotateWithView(z(ot)),j&&K.setRotation(j(ot)),G){const Z=G(ot);if(Z!=="left"&&Z!=="center"&&Z!=="right"&&Z!=="end"&&Z!=="start")throw new Error("Expected left, right, center, start, or end for text-align");K.setTextAlign(Z)}if(X){const Z=X(ot);if(Z!=="left"&&Z!=="right"&&Z!=="center")throw new Error("Expected left, right, or center for text-justify");K.setJustify(Z)}if(Y){const Z=Y(ot);if(Z!=="bottom"&&Z!=="top"&&Z!=="middle"&&Z!=="alphabetic"&&Z!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");K.setTextBaseline(Z)}return Q&&K.setPadding(Q(ot)),K}}function yg(s,t){return"icon-src"in s?Eg(s,t):"shape-points"in s?wg(s,t):"circle-radius"in s?Cg(s,t):null}function Eg(s,t){const e="icon-",n=e+"src",r=U0(s[n],n),l=Aa(s,e+"anchor",t),u=tl(s,e+"scale",t),g=Yi(s,e+"opacity",t),m=Aa(s,e+"displacement",t),p=Yi(s,e+"rotation",t),E=Mo(s,e+"rotate-with-view",t),A=$c(s,e+"anchor-origin"),b=tu(s,e+"anchor-x-units"),D=tu(s,e+"anchor-y-units"),P=Tg(s,e+"color"),F=Mg(s,e+"cross-origin"),z=Sg(s,e+"offset"),j=$c(s,e+"offset-origin"),G=Ia(s,e+"width"),X=Ia(s,e+"height"),Y=Ig(s,e+"size"),Q=el(s,e+"declutter-mode"),rt=new Ja({src:r,anchorOrigin:A,anchorXUnits:b,anchorYUnits:D,color:P,crossOrigin:F,offset:z,offsetOrigin:j,height:X,width:G,size:Y,declutterMode:Q});return function(K){return g&&rt.setOpacity(g(K)),m&&rt.setDisplacement(m(K)),p&&rt.setRotation(p(K)),E&&rt.setRotateWithView(E(K)),u&&rt.setScale(u(K)),l&&rt.setAnchor(l(K)),rt}}function wg(s,t){const e="shape-",n=e+"points",r=e+"radius",l=lh(s[n],n),u=lh(s[r],r),g=Ao(s,e,t),m=Io(s,e,t),p=tl(s,e+"scale",t),E=Aa(s,e+"displacement",t),A=Yi(s,e+"rotation",t),b=Mo(s,e+"rotate-with-view",t),D=Ia(s,e+"radius2"),P=Ia(s,e+"angle"),F=el(s,e+"declutter-mode"),z=new Za({points:l,radius:u,radius2:D,angle:P,declutterMode:F});return function(j){return g&&z.setFill(g(j)),m&&z.setStroke(m(j)),E&&z.setDisplacement(E(j)),A&&z.setRotation(A(j)),b&&z.setRotateWithView(b(j)),p&&z.setScale(p(j)),z}}function Cg(s,t){const e="circle-",n=Ao(s,e,t),r=Io(s,e,t),l=Yi(s,e+"radius",t),u=tl(s,e+"scale",t),g=Aa(s,e+"displacement",t),m=Yi(s,e+"rotation",t),p=Mo(s,e+"rotate-with-view",t),E=el(s,e+"declutter-mode"),A=new Ka({radius:5,declutterMode:E});return function(b){return l&&A.setRadius(l(b)),n&&A.setFill(n(b)),r&&A.setStroke(r(b)),g&&A.setDisplacement(g(b)),m&&A.setRotation(m(b)),p&&A.setRotateWithView(p(b)),u&&A.setScale(u(b)),A}}function Yi(s,t,e){if(!(t in s))return;const n=us(s[t],Lt,e);return function(r){return lh(n(r),t)}}function ns(s,t,e){if(!(t in s))return null;const n=us(s[t],en,e);return function(r){return U0(n(r),t)}}function Ag(s,t,e){const n=ns(s,t+"pattern-src",e),r=Jc(s,t+"pattern-offset",e),l=Jc(s,t+"pattern-size",e),u=ec(s,t+"color",e);return function(g){return{src:n(g),offset:r&&r(g),size:l&&l(g),color:u&&u(g)}}}function Mo(s,t,e){if(!(t in s))return null;const n=us(s[t],Je,e);return function(r){const l=n(r);if(typeof l!="boolean")throw new Error(`Expected a boolean for ${t}`);return l}}function ec(s,t,e){if(!(t in s))return null;const n=us(s[t],pi|en,e);return function(r){return G0(n(r),t)}}function k0(s,t,e){if(!(t in s))return null;const n=us(s[t],zn,e);return function(r){return Do(n(r),t)}}function Aa(s,t,e){if(!(t in s))return null;const n=us(s[t],zn,e);return function(r){const l=Do(n(r),t);if(l.length!==2)throw new Error(`Expected two numbers for ${t}`);return l}}function Jc(s,t,e){if(!(t in s))return null;const n=us(s[t],zn,e);return function(r){return z0(n(r),t)}}function tl(s,t,e){if(!(t in s))return null;const n=us(s[t],zn|Lt,e);return function(r){return bg(n(r),t)}}function Ia(s,t){const e=s[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function Ig(s,t){const e=s[t];if(e!==void 0){if(typeof e=="number")return sn(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Mg(s,t){const e=s[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function $c(s,t){const e=s[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function tu(s,t){const e=s[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Sg(s,t){const e=s[t];if(e!==void 0)return Do(e,t)}function el(s,t){const e=s[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Tg(s,t){const e=s[t];if(e!==void 0)return G0(e,t)}function Do(s,t){if(!Array.isArray(s))throw new Error(`Expected an array for ${t}`);const e=s.length;for(let n=0;n<e;++n)if(typeof s[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return s}function U0(s,t){if(typeof s!="string")throw new Error(`Expected a string for ${t}`);return s}function lh(s,t){if(typeof s!="number")throw new Error(`Expected a number for ${t}`);return s}function G0(s,t){if(typeof s=="string")return s;const e=Do(s,t),n=e.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function z0(s,t){const e=Do(s,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function bg(s,t){return typeof s=="number"?s:z0(s,t)}const eu={RENDER_ORDER:"renderOrder"};class j0 extends Qa{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(eu.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new D0(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(eu.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?R0:t;const e=Rg(t);this.styleFunction_=t===null?void 0:w1(e),this.changed()}}function Rg(s){if(s===void 0)return R0;if(!s)return null;if(typeof s=="function"||s instanceof fa)return s;if(!Array.isArray(s))return Qc([s]);if(s.length===0)return[];const t=s.length,e=s[0];if(e instanceof fa){const r=new Array(t);for(let l=0;l<t;++l){const u=s[l];if(!(u instanceof fa))throw new Error("Expected a list of style instances");r[l]=u}return r}if("style"in e){const r=new Array(t);for(let l=0;l<t;++l){const u=s[l];if(!("style"in u))throw new Error("Expected a list of rules with a style property");r[l]=u}return xg(r)}return Qc(s)}const Bt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ra=[Bt.FILL],Rs=[Bt.STROKE],Js=[Bt.BEGIN_PATH],iu=[Bt.CLOSE_PATH];class W0{drawCustom(t,e,n,r,l){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class Lo extends W0{constructor(t,e,n,r){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})}appendFlatPointCoordinates(t,e){const n=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,l=this.coordinates;let u=l.length;for(let g=0,m=t.length;g<m;g+=e)r[0]=t[g],r[1]=t[g+1],Dr(n,r)&&(l[u++]=r[0],l[u++]=r[1]);return u}appendFlatLineCoordinates(t,e,n,r,l,u){const g=this.coordinates;let m=g.length;const p=this.getBufferedMaxExtent();u&&(e+=r);let E=t[e],A=t[e+1];const b=this.tmpCoordinate_;let D=!0,P,F,z;for(P=e+r;P<n;P+=r)b[0]=t[P],b[1]=t[P+1],z=Hl(p,b),z!==F?(D&&(g[m++]=E,g[m++]=A,D=!1),g[m++]=b[0],g[m++]=b[1]):z===xi.INTERSECTING?(g[m++]=b[0],g[m++]=b[1],D=!1):D=!0,E=b[0],A=b[1],F=z;return(l&&D||P===e+r)&&(g[m++]=E,g[m++]=A),m}drawCustomCoordinates_(t,e,n,r,l){for(let u=0,g=n.length;u<g;++u){const m=n[u],p=this.appendFlatLineCoordinates(t,e,m,r,!1,!1);l.push(p),e=m}return e}drawCustom(t,e,n,r,l){this.beginGeometry(t,e,l);const u=t.getType(),g=t.getStride(),m=this.coordinates.length;let p,E,A,b,D;switch(u){case"MultiPolygon":p=t.getOrientedFlatCoordinates(),b=[];const P=t.getEndss();D=0;for(let F=0,z=P.length;F<z;++F){const j=[];D=this.drawCustomCoordinates_(p,D,P[F],g,j),b.push(j)}this.instructions.push([Bt.CUSTOM,m,b,t,n,eh,l]),this.hitDetectionInstructions.push([Bt.CUSTOM,m,b,t,r||n,eh,l]);break;case"Polygon":case"MultiLineString":A=[],p=u=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),D=this.drawCustomCoordinates_(p,0,t.getEnds(),g,A),this.instructions.push([Bt.CUSTOM,m,A,t,n,mo,l]),this.hitDetectionInstructions.push([Bt.CUSTOM,m,A,t,r||n,mo,l]);break;case"LineString":case"Circle":p=t.getFlatCoordinates(),E=this.appendFlatLineCoordinates(p,0,p.length,g,!1,!1),this.instructions.push([Bt.CUSTOM,m,E,t,n,Ts,l]),this.hitDetectionInstructions.push([Bt.CUSTOM,m,E,t,r||n,Ts,l]);break;case"MultiPoint":p=t.getFlatCoordinates(),E=this.appendFlatPointCoordinates(p,g),E>m&&(this.instructions.push([Bt.CUSTOM,m,E,t,n,Ts,l]),this.hitDetectionInstructions.push([Bt.CUSTOM,m,E,t,r||n,Ts,l]));break;case"Point":p=t.getFlatCoordinates(),this.coordinates.push(p[0],p[1]),E=this.coordinates.length,this.instructions.push([Bt.CUSTOM,m,E,t,n,void 0,l]),this.hitDetectionInstructions.push([Bt.CUSTOM,m,E,t,r||n,void 0,l]);break}this.endGeometry(e)}beginGeometry(t,e,n){this.beginGeometryInstruction1_=[Bt.BEGIN_GEOMETRY,e,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Bt.BEGIN_GEOMETRY,e,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const n=t.length;let r,l,u=-1;for(e=0;e<n;++e)r=t[e],l=r[0],l==Bt.END_GEOMETRY?u=e:l==Bt.BEGIN_GEOMETRY&&(r[2]=e,Zf(this.hitDetectionInstructions,u,e),u=-1)}setFillStrokeStyle(t,e){const n=this.state;if(t){const r=t.getColor();n.fillPatternScale=r&&typeof r=="object"&&"src"in r?this.pixelRatio:1,n.fillStyle=Un(r||Xi)}else n.fillStyle=void 0;if(e){const r=e.getColor();n.strokeStyle=Un(r||Eo);const l=e.getLineCap();n.lineCap=l!==void 0?l:Br;const u=e.getLineDash();n.lineDash=u?u.slice():os;const g=e.getLineDashOffset();n.lineDashOffset=g||as;const m=e.getLineJoin();n.lineJoin=m!==void 0?m:kr;const p=e.getWidth();n.lineWidth=p!==void 0?p:Co;const E=e.getMiterLimit();n.miterLimit=E!==void 0?E:yo,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(t){const e=t.fillStyle,n=[Bt.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[Bt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,e){const n=t.strokeStyle,r=t.lineCap,l=t.lineDash,u=t.lineDashOffset,g=t.lineJoin,m=t.lineWidth,p=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=r||l!=t.currentLineDash&&!Fs(t.currentLineDash,l)||t.currentLineDashOffset!=u||t.currentLineJoin!=g||t.currentLineWidth!=m||t.currentMiterLimit!=p)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=r,t.currentLineDash=l,t.currentLineDashOffset=u,t.currentLineJoin=g,t.currentLineWidth=m,t.currentMiterLimit=p)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[Bt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Hu(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Sh(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class vg extends Lo{constructor(t,e,n,r){super(t,e,n,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,n){if(!this.image_||this.maxExtent&&!Dr(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,n);const r=t.getFlatCoordinates(),l=t.getStride(),u=this.coordinates.length,g=this.appendFlatPointCoordinates(r,l);this.instructions.push([Bt.DRAW_IMAGE,u,g,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Bt.DRAW_IMAGE,u,g,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,n){if(!this.image_)return;this.beginGeometry(t,e,n);const r=t.getFlatCoordinates(),l=[];for(let m=0,p=r.length;m<p;m+=t.getStride())(!this.maxExtent||Dr(this.maxExtent,r.slice(m,m+2)))&&l.push(r[m],r[m+1]);const u=this.coordinates.length,g=this.appendFlatPointCoordinates(l,2);this.instructions.push([Bt.DRAW_IMAGE,u,g,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Bt.DRAW_IMAGE,u,g,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const n=t.getAnchor(),r=t.getSize(),l=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=l[0],this.originY_=l[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=r[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Ng=vg;class Og extends Lo{constructor(t,e,n,r){super(t,e,n,r)}drawFlatCoordinates_(t,e,n,r){const l=this.coordinates.length,u=this.appendFlatLineCoordinates(t,e,n,r,!1,!1),g=[Bt.MOVE_TO_LINE_TO,l,u];return this.instructions.push(g),this.hitDetectionInstructions.push(g),n}drawLineString(t,e,n){const r=this.state,l=r.strokeStyle,u=r.lineWidth;if(l===void 0||u===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([Bt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,os,as],Js);const g=t.getFlatCoordinates(),m=t.getStride();this.drawFlatCoordinates_(g,0,g.length,m),this.hitDetectionInstructions.push(Rs),this.endGeometry(e)}drawMultiLineString(t,e,n){const r=this.state,l=r.strokeStyle,u=r.lineWidth;if(l===void 0||u===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([Bt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,os,as],Js);const g=t.getEnds(),m=t.getFlatCoordinates(),p=t.getStride();let E=0;for(let A=0,b=g.length;A<b;++A)E=this.drawFlatCoordinates_(m,E,g[A],p);this.hitDetectionInstructions.push(Rs),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Rs),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Rs),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Js)}}const Dg=Og;class Lg extends Lo{constructor(t,e,n,r){super(t,e,n,r)}drawFlatCoordinatess_(t,e,n,r){const l=this.state,u=l.fillStyle!==void 0,g=l.strokeStyle!==void 0,m=n.length;this.instructions.push(Js),this.hitDetectionInstructions.push(Js);for(let p=0;p<m;++p){const E=n[p],A=this.coordinates.length,b=this.appendFlatLineCoordinates(t,e,E,r,!0,!g),D=[Bt.MOVE_TO_LINE_TO,A,b];this.instructions.push(D),this.hitDetectionInstructions.push(D),g&&(this.instructions.push(iu),this.hitDetectionInstructions.push(iu)),e=E}return u&&(this.instructions.push(ra),this.hitDetectionInstructions.push(ra)),g&&(this.instructions.push(Rs),this.hitDetectionInstructions.push(Rs)),e}drawCircle(t,e,n){const r=this.state,l=r.fillStyle,u=r.strokeStyle;if(l===void 0&&u===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_FILL_STYLE,Xi]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,os,as]);const g=t.getFlatCoordinates(),m=t.getStride(),p=this.coordinates.length;this.appendFlatLineCoordinates(g,0,g.length,m,!1,!1);const E=[Bt.CIRCLE,p];this.instructions.push(Js,E),this.hitDetectionInstructions.push(Js,E),r.fillStyle!==void 0&&(this.instructions.push(ra),this.hitDetectionInstructions.push(ra)),r.strokeStyle!==void 0&&(this.instructions.push(Rs),this.hitDetectionInstructions.push(Rs)),this.endGeometry(e)}drawPolygon(t,e,n){const r=this.state,l=r.fillStyle,u=r.strokeStyle;if(l===void 0&&u===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_FILL_STYLE,Xi]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,os,as]);const g=t.getEnds(),m=t.getOrientedFlatCoordinates(),p=t.getStride();this.drawFlatCoordinatess_(m,0,g,p),this.endGeometry(e)}drawMultiPolygon(t,e,n){const r=this.state,l=r.fillStyle,u=r.strokeStyle;if(l===void 0&&u===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_FILL_STYLE,Xi]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Bt.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,os,as]);const g=t.getEndss(),m=t.getOrientedFlatCoordinates(),p=t.getStride();let E=0;for(let A=0,b=g.length;A<b;++A)E=this.drawFlatCoordinatess_(m,E,g[A],p);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let n=0,r=e.length;n<r;++n)e[n]=Ys(e[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const nu=Lg;function Pg(s,t,e,n,r){const l=[];let u=e,g=0,m=t.slice(e,2);for(;g<s&&u+r<n;){const[p,E]=m.slice(-2),A=t[u+r],b=t[u+r+1],D=Math.sqrt((A-p)*(A-p)+(b-E)*(b-E));if(g+=D,g>=s){const P=(s-g+D)/D,F=tn(p,A,P),z=tn(E,b,P);m.push(F,z),l.push(m),m=[F,z],g==s&&(u+=r),g=0}else if(g<s)m.push(t[u+r],t[u+r+1]),u+=r;else{const P=D-g,F=tn(p,A,P/D),z=tn(E,b,P/D);m.push(F,z),l.push(m),m=[F,z],g=0,u+=r}}return g>0&&l.push(m),l}function Fg(s,t,e,n,r){let l=e,u=e,g=0,m=0,p=e,E,A,b,D,P,F,z,j,G,X;for(A=e;A<n;A+=r){const Y=t[A],Q=t[A+1];P!==void 0&&(G=Y-P,X=Q-F,D=Math.sqrt(G*G+X*X),z!==void 0&&(m+=b,E=Math.acos((z*G+j*X)/(b*D)),E>s&&(m>g&&(g=m,l=p,u=A),m=0,p=A-r)),b=D,z=G,j=X),P=Y,F=Q}return m+=D,m>g?[p,A]:[l,u]}const Ma={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Bg extends Lo{constructor(t,e,n,r){super(t,e,n,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Xi]={fillStyle:Xi},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,n){const r=this.textFillState_,l=this.textStrokeState_,u=this.textState_;if(this.text_===""||!u||!r&&!l)return;const g=this.coordinates;let m=g.length;const p=t.getType();let E=null,A=t.getStride();if(u.placement==="line"&&(p=="LineString"||p=="MultiLineString"||p=="Polygon"||p=="MultiPolygon")){if(!Vi(this.maxExtent,t.getExtent()))return;let b;if(E=t.getFlatCoordinates(),p=="LineString")b=[E.length];else if(p=="MultiLineString")b=t.getEnds();else if(p=="Polygon")b=t.getEnds().slice(0,1);else if(p=="MultiPolygon"){const z=t.getEndss();b=[];for(let j=0,G=z.length;j<G;++j)b.push(z[j][0])}this.beginGeometry(t,e,n);const D=u.repeat,P=D?void 0:u.textAlign;let F=0;for(let z=0,j=b.length;z<j;++z){let G;D?G=Pg(D*this.resolution,E,F,b[z],A):G=[E.slice(F,b[z])];for(let X=0,Y=G.length;X<Y;++X){const Q=G[X];let rt=0,K=Q.length;if(P==null){const Z=Fg(u.maxAngle,Q,0,Q.length,2);rt=Z[0],K=Z[1]}for(let Z=rt;Z<K;Z+=A)g.push(Q[Z],Q[Z+1]);const ot=g.length;F=b[z],this.drawChars_(m,ot),m=ot}}this.endGeometry(e)}else{let b=u.overflow?null:[];switch(p){case"Point":case"MultiPoint":E=t.getFlatCoordinates();break;case"LineString":E=t.getFlatMidpoint();break;case"Circle":E=t.getCenter();break;case"MultiLineString":E=t.getFlatMidpoints(),A=2;break;case"Polygon":E=t.getFlatInteriorPoint(),u.overflow||b.push(E[2]/this.resolution),A=3;break;case"MultiPolygon":const G=t.getFlatInteriorPoints();E=[];for(let X=0,Y=G.length;X<Y;X+=3)u.overflow||b.push(G[X+2]/this.resolution),E.push(G[X],G[X+1]);if(E.length===0)return;A=2;break}const D=this.appendFlatPointCoordinates(E,A);if(D===m)return;if(b&&(D-m)/2!==E.length/A){let G=m/2;b=b.filter((X,Y)=>{const Q=g[(G+Y)*2]===E[Y*A]&&g[(G+Y)*2+1]===E[Y*A+1];return Q||--G,Q})}this.saveTextStates_(),(u.backgroundFill||u.backgroundStroke)&&(this.setFillStrokeStyle(u.backgroundFill,u.backgroundStroke),u.backgroundFill&&this.updateFillStyle(this.state,this.createFill),u.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,n);let P=u.padding;if(P!=Qs&&(u.scale[0]<0||u.scale[1]<0)){let G=u.padding[0],X=u.padding[1],Y=u.padding[2],Q=u.padding[3];u.scale[0]<0&&(X=-X,Q=-Q),u.scale[1]<0&&(G=-G,Y=-Y),P=[G,X,Y,Q]}const F=this.pixelRatio;this.instructions.push([Bt.DRAW_IMAGE,m,D,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,P==Qs?Qs:P.map(function(G){return G*F}),!!u.backgroundFill,!!u.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,b]);const z=1/F,j=this.state.fillStyle;u.backgroundFill&&(this.state.fillStyle=Xi,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([Bt.DRAW_IMAGE,m,D,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[z,z],NaN,this.declutterMode_,this.declutterImageWithText_,P,!!u.backgroundFill,!!u.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Xi:this.fillKey_,this.textOffsetX_,this.textOffsetY_,b]),u.backgroundFill&&(this.state.fillStyle=j,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const l=this.textKey_;l in this.textStates||(this.textStates[l]={font:e.font,textAlign:e.textAlign||wo,justify:e.justify,textBaseline:e.textBaseline||wa,scale:e.scale});const u=this.fillKey_;n&&(u in this.fillStates||(this.fillStates[u]={fillStyle:n.fillStyle}))}drawChars_(t,e){const n=this.textStrokeState_,r=this.textState_,l=this.strokeKey_,u=this.textKey_,g=this.fillKey_;this.saveTextStates_();const m=this.pixelRatio,p=Ma[r.textBaseline],E=this.textOffsetY_*m,A=this.text_,b=n?n.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([Bt.DRAW_CHARS,t,e,p,r.overflow,g,r.maxAngle,m,E,l,b*m,A,u,1,this.declutterMode_]),this.hitDetectionInstructions.push([Bt.DRAW_CHARS,t,e,p,r.overflow,g&&Xi,r.maxAngle,m,E,l,b*m,A,u,1/m,this.declutterMode_])}setTextStyle(t,e){let n,r,l;if(!t)this.text_="";else{const u=t.getFill();u?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=Un(u.getColor()||Xi)):(r=null,this.textFillState_=r);const g=t.getStroke();if(!g)l=null,this.textStrokeState_=l;else{l=this.textStrokeState_,l||(l={},this.textStrokeState_=l);const P=g.getLineDash(),F=g.getLineDashOffset(),z=g.getWidth(),j=g.getMiterLimit();l.lineCap=g.getLineCap()||Br,l.lineDash=P?P.slice():os,l.lineDashOffset=F===void 0?as:F,l.lineJoin=g.getLineJoin()||kr,l.lineWidth=z===void 0?Co:z,l.miterLimit=j===void 0?yo:j,l.strokeStyle=Un(g.getColor()||Eo)}n=this.textState_;const m=t.getFont()||T0;x1(m);const p=t.getScaleArray();n.overflow=t.getOverflow(),n.font=m,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||wa,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Qs,n.scale=p===void 0?[1,1]:p;const E=t.getOffsetX(),A=t.getOffsetY(),b=t.getRotateWithView(),D=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=E===void 0?0:E,this.textOffsetY_=A===void 0?0:A,this.textRotateWithView_=b===void 0?!1:b,this.textRotation_=D===void 0?0:D,this.strokeKey_=l?(typeof l.strokeStyle=="string"?l.strokeStyle:Me(l.strokeStyle))+l.lineCap+l.lineDashOffset+"|"+l.lineWidth+l.lineJoin+l.miterLimit+"["+l.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+Me(r.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const kg={Circle:nu,Default:Lo,Image:Ng,LineString:Dg,Polygon:nu,Text:Bg};class Ug{constructor(t,e,n,r){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=r,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const n=this.buildersByZIndex_[e];for(const r in n){const l=n[r].finish();t[e][r]=l}}return t}getBuilder(t,e){const n=t!==void 0?t.toString():"0";let r=this.buildersByZIndex_[n];r===void 0&&(r={},this.buildersByZIndex_[n]=r);let l=r[e];if(l===void 0){const u=kg[e];l=new u(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[e]=l}return l}}class Gg extends bo{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t}getFeatures(t){return Xt()}getData(t){return null}prepareFrame(t){return Xt()}renderFrame(t,e){return Xt()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return(r,l)=>{const u=this.loadedTileCallback.bind(this,n,r);return t.forEachLoadedTile(e,r,l,u)}}forEachFeatureAtCoordinate(t,e,n,r,l){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===ee.LOADED||e.getState()===ee.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=ee.LOADED&&e!=ee.ERROR&&t.addEventListener(Ht.CHANGE,this.boundHandleImageChange_),e==ee.IDLE&&(t.load(),e=t.getState()),e==ee.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class X0 extends cs{constructor(t,e,n,r){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=r}}class V0{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(pa(),{get:(t,e)=>{if(typeof pa()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,n),!0)})}pushMethodArgs_=(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this);pushFunction(t){this.instructions_[this.zIndex+this.offset_].push(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let n=0,r=e.length;n<r;++n){const l=e[n];if(typeof l=="function"){l(t);continue}const u=e[++n];if(typeof t[l]=="function")t[l](...u);else{if(typeof u=="function"){t[l]=u(t);continue}t[l]=u}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const su=[];let Cr=null;function zg(){Cr=Mi(1,1,void 0,{willReadFrequently:!0})}class Y0 extends Gg{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Mn(),this.pixelTransform=Mn(),this.inversePixelTransform=Mn(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){Cr||zg(),Cr.clearRect(0,0,1,1);let r;try{Cr.drawImage(t,e,n,1,1,0,0,1,1),r=Cr.getImageData(0,0,1,1).data}catch{return Cr=null,null}return r}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,e,n){const r=this.getLayer().getClassName();let l,u;if(t&&t.className===r&&(!n||t&&t.style.backgroundColor&&Fs(_o(t.style.backgroundColor),_o(n)))){const g=t.firstElementChild;g instanceof HTMLCanvasElement&&(u=g.getContext("2d"))}if(u&&u.canvas.style.transform===e?(this.container=t,this.context=u,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){l=document.createElement("div"),l.className=r;let g=l.style;g.position="absolute",g.width="100%",g.height="100%",u=Mi();const m=u.canvas;l.appendChild(m),g=m.style,g.position="absolute",g.left="0",g.transformOrigin="top left",this.container=l,this.context=u}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const r=nr(n),l=Ua(n),u=ka(n),g=Ba(n);Ai(e.coordinateToPixelTransform,r),Ai(e.coordinateToPixelTransform,l),Ai(e.coordinateToPixelTransform,u),Ai(e.coordinateToPixelTransform,g);const m=this.inversePixelTransform;Ai(m,r),Ai(m,l),Ai(m,u),Ai(m,g),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(l[0]),Math.round(l[1])),t.lineTo(Math.round(u[0]),Math.round(u[1])),t.lineTo(Math.round(g[0]),Math.round(g[1])),t.clip()}prepareContainer(t,e){const n=t.extent,r=t.viewState.resolution,l=t.viewState.rotation,u=t.pixelRatio,g=Math.round(we(n)/r*u),m=Math.round(Li(n)/r*u);ls(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/u,1/u,l,-g/2,-m/2),Yu(this.inversePixelTransform,this.pixelTransform);const p=id(this.pixelTransform);if(this.useContainer(e,p,this.getBackground(t)),!this.containerReused){const E=this.context.canvas;E.width!=g||E.height!=m?(E.width=g,E.height=m):this.context.clearRect(0,0,g,m),p!==E.style.transform&&(E.style.transform=p)}}dispatchRenderEvent_(t,e,n){const r=this.getLayer();if(r.hasListener(t)){const l=new X0(t,this.inversePixelTransform,n,e);r.dispatchEvent(l)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(gn.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(gn.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new V0),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(gn.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(gn.POSTRENDER,this.context,t))}getRenderTransform(t,e,n,r,l,u,g){const m=l/2,p=u/2,E=r/e,A=-E,b=-t[0]+g,D=-t[1];return ls(this.tempTransform,m,p,E,A,-n,b,D)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function jg(s,t,e,n,r,l,u,g,m,p,E,A){let b=s[t],D=s[t+1],P=0,F=0,z=0,j=0;function G(){P=b,F=D,t+=n,b=s[t],D=s[t+1],j+=z,z=Math.sqrt((b-P)*(b-P)+(D-F)*(D-F))}do G();while(t<e-n&&j+z<l);let X=z===0?0:(l-j)/z;const Y=tn(P,b,X),Q=tn(F,D,X),rt=t-n,K=j,ot=l+g*m(p,r,E);for(;t<e-n&&j+z<ot;)G();X=z===0?0:(ot-j)/z;const Z=tn(P,b,X),Ot=tn(F,D,X);let St;if(A){const gt=[Y,Q,Z,Ot];o0(gt,0,4,2,A,gt,gt),St=gt[0]>gt[2]}else St=Y>Z;const ut=Math.PI,yt=[],Nt=rt+n===t;t=rt,z=0,j=K,b=s[t],D=s[t+1];let J;if(Nt){G(),J=Math.atan2(D-F,b-P),St&&(J+=J>0?-ut:ut);const gt=(Z+Y)/2,Et=(Ot+Q)/2;return yt[0]=[gt,Et,(ot-l)/2,J,r],yt}r=r.replace(/\n/g," ");for(let gt=0,Et=r.length;gt<Et;){G();let Wt=Math.atan2(D-F,b-P);if(St&&(Wt+=Wt>0?-ut:ut),J!==void 0){let ft=Wt-J;if(ft+=ft>ut?-2*ut:ft<-ut?2*ut:0,Math.abs(ft)>u)return null}J=Wt;const re=gt;let Ut=0;for(;gt<Et;++gt){const ft=St?Et-gt-1:gt,ii=g*m(p,r[ft],E);if(t+n<e&&j+z<l+Ut+ii/2)break;Ut+=ii}if(gt===re)continue;const Jt=St?r.substring(Et-re,Et-gt):r.substring(re,gt);X=z===0?0:(l+Ut/2-j)/z;const Ft=tn(P,b,X),$t=tn(F,D,X);yt.push([Ft,$t,Ut/2,Wt,Jt]),l+=Ut}return yt}const pr=mn(),Es=[],Jn=[],$n=[],ws=[];function ru(s){return s[3].declutterBox}const ou=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function Ol(s,t){return t==="start"?t=ou.test(s)?"right":"left":t==="end"&&(t=ou.test(s)?"left":"right"),Ma[t]}function Wg(s,t,e){return e>0&&s.push(`
`,""),s.push(t,""),s}class Xg{constructor(t,e,n,r,l){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=Mn(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=l?new V0:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,n,r){const l=t+e+n+r;if(this.labels_[l])return this.labels_[l];const u=r?this.strokeStates[r]:null,g=n?this.fillStates[n]:null,m=this.textStates[e],p=this.pixelRatio,E=[m.scale[0]*p,m.scale[1]*p],A=Array.isArray(t),b=m.justify?Ma[m.justify]:Ol(Array.isArray(t)?t[0]:t,m.textAlign||wo),D=r&&u.lineWidth?u.lineWidth:0,P=A?t:t.split(`
`).reduce(Wg,[]),{width:F,height:z,widths:j,heights:G,lineWidths:X}=_1(m,P),Y=F+D,Q=[],rt=(Y+2)*E[0],K=(z+D)*E[1],ot={width:rt<0?Math.floor(rt):Math.ceil(rt),height:K<0?Math.floor(K):Math.ceil(K),contextInstructions:Q};(E[0]!=1||E[1]!=1)&&Q.push("scale",E),r&&(Q.push("strokeStyle",u.strokeStyle),Q.push("lineWidth",D),Q.push("lineCap",u.lineCap),Q.push("lineJoin",u.lineJoin),Q.push("miterLimit",u.miterLimit),Q.push("setLineDash",[u.lineDash]),Q.push("lineDashOffset",u.lineDashOffset)),n&&Q.push("fillStyle",g.fillStyle),Q.push("textBaseline","middle"),Q.push("textAlign","center");const Z=.5-b;let Ot=b*Y+Z*D;const St=[],ut=[];let yt=0,Nt=0,J=0,gt=0,Et;for(let Wt=0,re=P.length;Wt<re;Wt+=2){const Ut=P[Wt];if(Ut===`
`){Nt+=yt,yt=0,Ot=b*Y+Z*D,++gt;continue}const Jt=P[Wt+1]||m.font;Jt!==Et&&(r&&St.push("font",Jt),n&&ut.push("font",Jt),Et=Jt),yt=Math.max(yt,G[J]);const Ft=[Ut,Ot+Z*j[J]+b*(j[J]-X[gt]),.5*(D+yt)+Nt];Ot+=j[J],r&&St.push("strokeText",Ft),n&&ut.push("fillText",Ft),++J}return Array.prototype.push.apply(Q,St),Array.prototype.push.apply(Q,ut),this.labels_[l]=ot,ot}replayTextBackground_(t,e,n,r,l,u,g){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,l),t.lineTo.apply(t,e),u&&(this.alignAndScaleFill_=u[2],this.fill_(t)),g&&(this.setStrokeStyle_(t,g),t.stroke())}calculateImageOrLabelDimensions_(t,e,n,r,l,u,g,m,p,E,A,b,D,P,F,z){g*=b[0],m*=b[1];let j=n-g,G=r-m;const X=l+p>t?t-p:l,Y=u+E>e?e-E:u,Q=P[3]+X*b[0]+P[1],rt=P[0]+Y*b[1]+P[2],K=j-P[3],ot=G-P[0];(F||A!==0)&&(Es[0]=K,ws[0]=K,Es[1]=ot,Jn[1]=ot,Jn[0]=K+Q,$n[0]=Jn[0],$n[1]=ot+rt,ws[1]=$n[1]);let Z;return A!==0?(Z=ls(Mn(),n,r,1,1,A,-n,-r),Ai(Z,Es),Ai(Z,Jn),Ai(Z,$n),Ai(Z,ws),hs(Math.min(Es[0],Jn[0],$n[0],ws[0]),Math.min(Es[1],Jn[1],$n[1],ws[1]),Math.max(Es[0],Jn[0],$n[0],ws[0]),Math.max(Es[1],Jn[1],$n[1],ws[1]),pr)):hs(Math.min(K,K+Q),Math.min(ot,ot+rt),Math.max(K,K+Q),Math.max(ot,ot+rt),pr),D&&(j=Math.round(j),G=Math.round(G)),{drawImageX:j,drawImageY:G,drawImageW:X,drawImageH:Y,originX:p,originY:E,declutterBox:{minX:pr[0],minY:pr[1],maxX:pr[2],maxY:pr[3],value:z},canvasTransform:Z,scale:b}}replayImageOrLabel_(t,e,n,r,l,u,g){const m=!!(u||g),p=r.declutterBox,E=g?g[2]*r.scale[0]/2:0;return p.minX-E<=e[0]&&p.maxX+E>=0&&p.minY-E<=e[1]&&p.maxY+E>=0&&(m&&this.replayTextBackground_(t,Es,Jn,$n,ws,u,g),y1(t,r.canvasTransform,l,n,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const n=Ai(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.save(),t.translate(n[0]%r,n[1]%r),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,n,r){const l=this.textStates[e],u=this.createLabel(t,e,r,n),g=this.strokeStates[n],m=this.pixelRatio,p=Ol(Array.isArray(t)?t[0]:t,l.textAlign||wo),E=Ma[l.textBaseline||wa],A=g&&g.lineWidth?g.lineWidth:0,b=u.width/m-2*l.scale[0],D=p*b+2*(.5-p)*A,P=E*u.height/m+2*(.5-E)*A;return{label:u,anchorX:D,anchorY:P}}execute_(t,e,n,r,l,u,g,m){const p=this.zIndexContext_;let E;this.pixelCoordinates_&&Fs(n,this.renderedTransform_)?E=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),E=Ns(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),td(this.renderedTransform_,n));let A=0;const b=r.length;let D=0,P,F,z,j,G,X,Y,Q,rt,K,ot,Z,Ot,St=0,ut=0,yt=null,Nt=null;const J=this.coordinateCache_,gt=this.viewRotation_,Et=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,Wt={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:gt},re=this.instructions!=r||this.overlaps?0:200;let Ut,Jt,Ft,$t;for(;A<b;){const ft=r[A];switch(ft[0]){case Bt.BEGIN_GEOMETRY:Ut=ft[1],$t=ft[3],Ut.getGeometry()?g!==void 0&&!Vi(g,$t.getExtent())?A=ft[2]+1:++A:A=ft[2],p&&(p.zIndex=ft[4]);break;case Bt.BEGIN_PATH:St>re&&(this.fill_(t),St=0),ut>re&&(t.stroke(),ut=0),!St&&!ut&&(t.beginPath(),G=NaN,X=NaN),++A;break;case Bt.CIRCLE:D=ft[1];const Tt=E[D],Oe=E[D+1],_e=E[D+2],fi=E[D+3],Be=_e-Tt,Ze=fi-Oe,ze=Math.sqrt(Be*Be+Ze*Ze);t.moveTo(Tt+ze,Oe),t.arc(Tt,Oe,ze,0,2*Math.PI,!0),++A;break;case Bt.CLOSE_PATH:t.closePath(),++A;break;case Bt.CUSTOM:D=ft[1],P=ft[2];const ie=ft[3],di=ft[4],li=ft[5];Wt.geometry=ie,Wt.feature=Ut,A in J||(J[A]=[]);const _i=J[A];li?li(E,D,P,2,_i):(_i[0]=E[D],_i[1]=E[D+1],_i.length=2),p&&(p.zIndex=ft[6]),di(_i,Wt),++A;break;case Bt.DRAW_IMAGE:D=ft[1],P=ft[2],rt=ft[3],F=ft[4],z=ft[5];let ke=ft[6];const le=ft[7],te=ft[8],gi=ft[9],Mt=ft[10];let yi=ft[11];const on=ft[12];let hi=ft[13];j=ft[14]||"declutter";const Bi=ft[15];if(!rt&&ft.length>=20){K=ft[19],ot=ft[20],Z=ft[21],Ot=ft[22];const ue=this.drawLabelWithPointPlacement_(K,ot,Z,Ot);rt=ue.label,ft[3]=rt;const ce=ft[23];F=(ue.anchorX-ce)*this.pixelRatio,ft[4]=F;const jt=ft[24];z=(ue.anchorY-jt)*this.pixelRatio,ft[5]=z,ke=rt.height,ft[6]=ke,hi=rt.width,ft[13]=hi}let ni;ft.length>25&&(ni=ft[25]);let Hi,Ke,he;ft.length>17?(Hi=ft[16],Ke=ft[17],he=ft[18]):(Hi=Qs,Ke=!1,he=!1),Mt&&Et?yi+=gt:!Mt&&!Et&&(yi-=gt);let ar=0;for(;D<P;D+=2){if(ni&&ni[ar++]<hi/this.pixelRatio)continue;const ue=this.calculateImageOrLabelDimensions_(rt.width,rt.height,E[D],E[D+1],hi,ke,F,z,te,gi,yi,on,l,Hi,Ke||he,Ut),ce=[t,e,rt,ue,le,Ke?yt:null,he?Nt:null];if(m){let jt,si,Vt;if(Bi){const Te=P-D;if(!Bi[Te]){Bi[Te]={args:ce,declutterMode:j};continue}const fe=Bi[Te];jt=fe.args,si=fe.declutterMode,delete Bi[Te],Vt=ru(jt)}let Pe,ci;if(jt&&(si!=="declutter"||!m.collides(Vt))&&(Pe=!0),(j!=="declutter"||!m.collides(ue.declutterBox))&&(ci=!0),si==="declutter"&&j==="declutter"){const Te=Pe&&ci;Pe=Te,ci=Te}Pe&&(si!=="none"&&m.insert(Vt),this.replayImageOrLabel_.apply(this,jt)),ci&&(j!=="none"&&m.insert(ue.declutterBox),this.replayImageOrLabel_.apply(this,ce))}else this.replayImageOrLabel_.apply(this,ce)}++A;break;case Bt.DRAW_CHARS:const Xn=ft[1],Vn=ft[2],Ce=ft[3],wt=ft[4];Ot=ft[5];const Se=ft[6],ne=ft[7],ye=ft[8];Z=ft[9];const xn=ft[10];K=ft[11],ot=ft[12];const Rn=[ft[13],ft[13]];j=ft[14]||"declutter";const an=this.textStates[ot],at=an.font,Fi=[an.scale[0]*ne,an.scale[1]*ne];let vn;at in this.widths_?vn=this.widths_[at]:(vn={},this.widths_[at]=vn);const ks=M0(E,Xn,Vn,2),pt=Math.abs(Fi[0])*Wc(at,K,vn);if(wt||pt<=ks){const ue=this.textStates[ot].textAlign,ce=(ks-pt)*Ol(K,ue),jt=jg(E,Xn,Vn,2,K,ce,Se,Math.abs(Fi[0]),Wc,at,vn,Et?0:this.viewRotation_);t:if(jt){const si=[];let Vt,Pe,ci,Te,fe;if(Z)for(Vt=0,Pe=jt.length;Vt<Pe;++Vt){fe=jt[Vt],ci=fe[4],Te=this.createLabel(ci,ot,"",Z),F=fe[2]+(Fi[0]<0?-xn:xn),z=Ce*Te.height+(.5-Ce)*2*xn*Fi[1]/Fi[0]-ye;const Xe=this.calculateImageOrLabelDimensions_(Te.width,Te.height,fe[0],fe[1],Te.width,Te.height,F,z,0,0,fe[3],Rn,!1,Qs,!1,Ut);if(m&&j==="declutter"&&m.collides(Xe.declutterBox))break t;si.push([t,e,Te,Xe,1,null,null])}if(Ot)for(Vt=0,Pe=jt.length;Vt<Pe;++Vt){fe=jt[Vt],ci=fe[4],Te=this.createLabel(ci,ot,Ot,""),F=fe[2],z=Ce*Te.height-ye;const Xe=this.calculateImageOrLabelDimensions_(Te.width,Te.height,fe[0],fe[1],Te.width,Te.height,F,z,0,0,fe[3],Rn,!1,Qs,!1,Ut);if(m&&j==="declutter"&&m.collides(Xe.declutterBox))break t;si.push([t,e,Te,Xe,1,null,null])}m&&j!=="none"&&m.load(si.map(ru));for(let Xe=0,Si=si.length;Xe<Si;++Xe)this.replayImageOrLabel_.apply(this,si[Xe])}}++A;break;case Bt.END_GEOMETRY:if(u!==void 0){Ut=ft[1];const ue=u(Ut,$t,j);if(ue)return ue}++A;break;case Bt.FILL:re?St++:this.fill_(t),++A;break;case Bt.MOVE_TO_LINE_TO:for(D=ft[1],P=ft[2],Jt=E[D],Ft=E[D+1],t.moveTo(Jt,Ft),G=Jt+.5|0,X=Ft+.5|0,D+=2;D<P;D+=2)Jt=E[D],Ft=E[D+1],Y=Jt+.5|0,Q=Ft+.5|0,(D==P-2||Y!==G||Q!==X)&&(t.lineTo(Jt,Ft),G=Y,X=Q);++A;break;case Bt.SET_FILL_STYLE:yt=ft,this.alignAndScaleFill_=ft[2],St&&(this.fill_(t),St=0,ut&&(t.stroke(),ut=0)),t.fillStyle=ft[1],++A;break;case Bt.SET_STROKE_STYLE:Nt=ft,ut&&(t.stroke(),ut=0),this.setStrokeStyle_(t,ft),++A;break;case Bt.STROKE:re?ut++:t.stroke(),++A;break;default:++A;break}}St&&this.fill_(t),ut&&t.stroke()}execute(t,e,n,r,l,u){this.viewRotation_=r,this.execute_(t,e,n,this.instructions,l,void 0,void 0,u)}executeHitDetection(t,e,n,r,l){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,r,l)}}const Sr=["Polygon","Circle","LineString","Image","Text","Default"],H0=["Image","Text"],Vg=Sr.filter(s=>!H0.includes(s));class Yg{constructor(t,e,n,r,l,u,g){this.maxExtent_=t,this.overlaps_=r,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=u,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Mn(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(l,g)}clip(t,e){const n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,e){for(const n in t){let r=this.executorsByZIndex_[n];r===void 0&&(r={},this.executorsByZIndex_[n]=r);const l=t[n];for(const u in l){const g=l[u];r[u]=new Xg(this.resolution_,this.pixelRatio_,this.overlaps_,g,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const n=this.executorsByZIndex_[e];for(let r=0,l=t.length;r<l;++r)if(t[r]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,n,r,l,u){r=Math.round(r);const g=r*2+1,m=ls(this.hitDetectionTransform_,r+.5,r+.5,1/e,-1/e,-n,-t[0],-t[1]),p=!this.hitDetectionContext_;p&&(this.hitDetectionContext_=Mi(g,g,void 0,{willReadFrequently:!0}));const E=this.hitDetectionContext_;E.canvas.width!==g||E.canvas.height!==g?(E.canvas.width=g,E.canvas.height=g):p||E.clearRect(0,0,g,g);let A;this.renderBuffer_!==void 0&&(A=mn(),ao(A,t),Sh(A,e*(this.renderBuffer_+r),A));const b=Hg(r);let D;function P(Q,rt,K){const ot=E.getImageData(0,0,g,g).data;for(let Z=0,Ot=b.length;Z<Ot;Z++)if(ot[b[Z]]>0){if(!u||K==="none"||D!=="Image"&&D!=="Text"||u.includes(Q)){const St=(b[Z]-3)/4,ut=r-St%g,yt=r-(St/g|0),Nt=l(Q,rt,ut*ut+yt*yt);if(Nt)return Nt}E.clearRect(0,0,g,g);break}}const F=Object.keys(this.executorsByZIndex_).map(Number);F.sort(rs);let z,j,G,X,Y;for(z=F.length-1;z>=0;--z){const Q=F[z].toString();for(G=this.executorsByZIndex_[Q],j=Sr.length-1;j>=0;--j)if(D=Sr[j],X=G[D],X!==void 0&&(Y=X.executeHitDetection(E,m,n,P,A),Y))return Y}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const n=e[0],r=e[1],l=e[2],u=e[3],g=[n,r,n,u,l,u,l,r];return Ns(g,0,8,2,t,g),g}isEmpty(){return er(this.executorsByZIndex_)}execute(t,e,n,r,l,u,g){const m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(rs),u=u||Sr;const p=Sr.length;let E,A,b,D,P;for(g&&m.reverse(),E=0,A=m.length;E<A;++E){const F=m[E].toString();for(P=this.executorsByZIndex_[F],b=0,D=u.length;b<D;++b){const z=u[b],j=P[z];if(j!==void 0){const G=g===null?void 0:j.getZIndexContext(),X=G?G.getContext():t,Y=this.maxExtent_&&z!=="Image"&&z!=="Text";if(Y&&(X.save(),this.clip(X,n)),!G||z==="Text"||z==="Image"?j.execute(X,e,n,r,l,g):G.pushFunction(Q=>j.execute(Q,e,n,r,l,g)),Y&&X.restore(),G){G.offset();const Q=m[E]*p+b;this.deferredZIndexContexts_[Q]||(this.deferredZIndexContexts_[Q]=[]),this.deferredZIndexContexts_[Q].push(G)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(rs);for(let n=0,r=e.length;n<r;++n)t[e[n]].forEach(l=>{l.draw(this.renderedContext_),l.clear()}),t[e[n]].length=0}}const Dl={};function Hg(s){if(Dl[s]!==void 0)return Dl[s];const t=s*2+1,e=s*s,n=new Array(e+1);for(let l=0;l<=s;++l)for(let u=0;u<=s;++u){const g=l*l+u*u;if(g>e)break;let m=n[g];m||(m=[],n[g]=m),m.push(((s+l)*t+(s+u))*4+3),l>0&&m.push(((s-l)*t+(s+u))*4+3),u>0&&(m.push(((s+l)*t+(s-u))*4+3),l>0&&m.push(((s-l)*t+(s-u))*4+3))}const r=[];for(let l=0,u=n.length;l<u;++l)n[l]&&r.push(...n[l]);return Dl[s]=r,r}class Zg extends W0{constructor(t,e,n,r,l,u,g){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=r,this.transformRotation_=r?vh(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=l,this.squaredTolerance_=u,this.userTransform_=g,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Mn()}drawImages_(t,e,n,r){if(!this.image_)return;const l=Ns(t,e,n,r,this.transform_,this.pixelCoordinates_),u=this.context_,g=this.tmpLocalTransform_,m=u.globalAlpha;this.imageOpacity_!=1&&(u.globalAlpha=m*this.imageOpacity_);let p=this.imageRotation_;this.transformRotation_===0&&(p-=this.viewRotation_),this.imageRotateWithView_&&(p+=this.viewRotation_);for(let E=0,A=l.length;E<A;E+=2){const b=l[E]-this.imageAnchorX_,D=l[E+1]-this.imageAnchorY_;if(p!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const P=b+this.imageAnchorX_,F=D+this.imageAnchorY_;ls(g,P,F,1,1,p,-P,-F),u.save(),u.transform.apply(u,g),u.translate(P,F),u.scale(this.imageScale_[0],this.imageScale_[1]),u.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),u.restore()}else u.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,b,D,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(u.globalAlpha=m)}drawText_(t,e,n,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const l=Ns(t,e,n,r,this.transform_,this.pixelCoordinates_),u=this.context_;let g=this.textRotation_;for(this.transformRotation_===0&&(g-=this.viewRotation_),this.textRotateWithView_&&(g+=this.viewRotation_);e<n;e+=r){const m=l[e]+this.textOffsetX_,p=l[e+1]+this.textOffsetY_;g!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(u.save(),u.translate(m-this.textOffsetX_,p-this.textOffsetY_),u.rotate(g),u.translate(this.textOffsetX_,this.textOffsetY_),u.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&u.strokeText(this.text_,0,0),this.textFillState_&&u.fillText(this.text_,0,0),u.restore()):(this.textStrokeState_&&u.strokeText(this.text_,m,p),this.textFillState_&&u.fillText(this.text_,m,p))}}moveToLineTo_(t,e,n,r,l){const u=this.context_,g=Ns(t,e,n,r,this.transform_,this.pixelCoordinates_);u.moveTo(g[0],g[1]);let m=g.length;l&&(m-=2);for(let p=2;p<m;p+=2)u.lineTo(g[p],g[p+1]);return l&&u.closePath(),n}drawRings_(t,e,n,r){for(let l=0,u=n.length;l<u;++l)e=this.moveToLineTo_(t,e,n[l],r,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Vi(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Ld(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],r=e[3]-e[1],l=Math.sqrt(n*n+r*r),u=this.context_;u.beginPath(),u.arc(e[0],e[1],l,0,2*Math.PI),this.fillState_&&u.fill(),this.strokeState_&&u.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,r=e.length;n<r;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Vi(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Vi(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,r=t.getFlatCoordinates();let l=0;const u=t.getEnds(),g=t.getStride();n.beginPath();for(let m=0,p=u.length;m<p;++m)l=this.moveToLineTo_(r,l,u[m],g,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Vi(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Vi(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let r=0;const l=t.getEndss(),u=t.getStride();e.beginPath();for(let g=0,m=l.length;g<m;++g){const p=l[g];r=this.drawRings_(n,r,p,u)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),Fs(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,r=t.textAlign?t.textAlign:wo;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=r&&(n.textAlign=r,e.textAlign=r),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:Un(n||Xi)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),r=e.getLineCap(),l=e.getLineDash(),u=e.getLineDashOffset(),g=e.getLineJoin(),m=e.getWidth(),p=e.getMiterLimit(),E=l||os;this.strokeState_={lineCap:r!==void 0?r:Br,lineDash:this.pixelRatio_===1?E:E.map(A=>A*this.pixelRatio_),lineDashOffset:(u||as)*this.pixelRatio_,lineJoin:g!==void 0?g:kr,lineWidth:(m!==void 0?m:Co)*this.pixelRatio_,miterLimit:p!==void 0?p:yo,strokeStyle:Un(n||Eo)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),r=t.getAnchor(),l=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*n,this.imageAnchorY_=r[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=l[0],this.imageOriginY_=l[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const u=t.getScaleArray();this.imageScale_=[u[0]*this.pixelRatio_/n,u[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const D=e.getColor();this.textFillState_={fillStyle:Un(D||Xi)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const D=n.getColor(),P=n.getLineCap(),F=n.getLineDash(),z=n.getLineDashOffset(),j=n.getLineJoin(),G=n.getWidth(),X=n.getMiterLimit();this.textStrokeState_={lineCap:P!==void 0?P:Br,lineDash:F||os,lineDashOffset:z||as,lineJoin:j!==void 0?j:kr,lineWidth:G!==void 0?G:Co,miterLimit:X!==void 0?X:yo,strokeStyle:Un(D||Eo)}}const r=t.getFont(),l=t.getOffsetX(),u=t.getOffsetY(),g=t.getRotateWithView(),m=t.getRotation(),p=t.getScaleArray(),E=t.getText(),A=t.getTextAlign(),b=t.getTextBaseline();this.textState_={font:r!==void 0?r:T0,textAlign:A!==void 0?A:wo,textBaseline:b!==void 0?b:wa},this.text_=E!==void 0?Array.isArray(E)?E.reduce((D,P,F)=>D+=F%2?" ":P,""):E:"",this.textOffsetX_=l!==void 0?this.pixelRatio_*l:0,this.textOffsetY_=u!==void 0?this.pixelRatio_*u:0,this.textRotateWithView_=g!==void 0?g:!1,this.textRotation_=m!==void 0?m:0,this.textScale_=[this.pixelRatio_*p[0],this.pixelRatio_*p[1]]}}}const Kg=Zg,Fn=.5;function qg(s,t,e,n,r,l,u,g,m){const p=m?Lh(r):r,E=s[0]*Fn,A=s[1]*Fn,b=Mi(E,A);b.imageSmoothingEnabled=!1;const D=b.canvas,P=new Kg(b,Fn,r,null,u,g,m?Ga(vd(),m):null),F=e.length,z=Math.floor((256*256*256-1)/F),j={};for(let X=1;X<=F;++X){const Y=e[X-1],Q=Y.getStyleFunction()||n;if(!Q)continue;let rt=Q(Y,l);if(!rt)continue;Array.isArray(rt)||(rt=[rt]);const ot=(X*z).toString(16).padStart(7,"#00000");for(let Z=0,Ot=rt.length;Z<Ot;++Z){const St=rt[Z],ut=St.getGeometryFunction()(Y);if(!ut||!Vi(p,ut.getExtent()))continue;const yt=St.clone(),Nt=yt.getFill();Nt&&Nt.setColor(ot);const J=yt.getStroke();J&&(J.setColor(ot),J.setLineDash(null)),yt.setText(void 0);const gt=St.getImage();if(gt){const Ut=gt.getImageSize();if(!Ut)continue;const Jt=Mi(Ut[0],Ut[1],void 0,{alpha:!1}),Ft=Jt.canvas;Jt.fillStyle=ot,Jt.fillRect(0,0,Ft.width,Ft.height),yt.setImage(new Ja({img:Ft,anchor:gt.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:gt.getOrigin(),opacity:1,size:gt.getSize(),scale:gt.getScale(),rotation:gt.getRotation(),rotateWithView:gt.getRotateWithView()}))}const Et=yt.getZIndex()||0;let Wt=j[Et];Wt||(Wt={},j[Et]=Wt,Wt.Polygon=[],Wt.Circle=[],Wt.LineString=[],Wt.Point=[]);const re=ut.getType();if(re==="GeometryCollection"){const Ut=ut.getGeometriesArrayRecursive();for(let Jt=0,Ft=Ut.length;Jt<Ft;++Jt){const $t=Ut[Jt];Wt[$t.getType().replace("Multi","")].push($t,yt)}}else Wt[re.replace("Multi","")].push(ut,yt)}}const G=Object.keys(j).map(Number).sort(rs);for(let X=0,Y=G.length;X<Y;++X){const Q=j[G[X]];for(const rt in Q){const K=Q[rt];for(let ot=0,Z=K.length;ot<Z;ot+=2){P.setStyle(K[ot+1]);for(let Ot=0,St=t.length;Ot<St;++Ot)P.setTransform(t[Ot]),P.drawGeometry(K[ot])}}}return b.getImageData(0,0,D.width,D.height)}function Qg(s,t,e){const n=[];if(e){const r=Math.floor(Math.round(s[0])*Fn),l=Math.floor(Math.round(s[1])*Fn),u=(ei(r,0,e.width-1)+ei(l,0,e.height-1)*e.width)*4,g=e.data[u],m=e.data[u+1],E=e.data[u+2]+256*(m+256*g),A=Math.floor((256*256*256-1)/t.length);E&&E%A===0&&n.push(t[E/A-1])}return n}const Jg=.5,Z0={Point:o2,LineString:n2,Polygon:l2,MultiPoint:a2,MultiLineString:s2,MultiPolygon:r2,GeometryCollection:i2,Circle:t2};function $g(s,t){return parseInt(Me(s),10)-parseInt(Me(t),10)}function au(s,t){const e=K0(s,t);return e*e}function K0(s,t){return Jg*s/t}function t2(s,t,e,n,r){const l=e.getFill(),u=e.getStroke();if(l||u){const m=s.getBuilder(e.getZIndex(),"Circle");m.setFillStrokeStyle(l,u),m.drawCircle(t,n,r)}const g=e.getText();if(g&&g.getText()){const m=s.getBuilder(e.getZIndex(),"Text");m.setTextStyle(g),m.drawText(t,n)}}function lu(s,t,e,n,r,l,u,g){const m=[],p=e.getImage();if(p){let b=!0;const D=p.getImageState();D==ee.LOADED||D==ee.ERROR?b=!1:D==ee.IDLE&&p.load(),b&&m.push(p.ready())}const E=e.getFill();E&&E.loading()&&m.push(E.ready());const A=m.length>0;return A&&Promise.all(m).then(()=>r(null)),e2(s,t,e,n,l,u,g),A}function e2(s,t,e,n,r,l,u){const g=e.getGeometryFunction()(t);if(!g)return;const m=g.simplifyTransformed(n,r);if(e.getRenderer())q0(s,m,e,t,u);else{const E=Z0[m.getType()];E(s,m,e,t,u,l)}}function q0(s,t,e,n,r){if(t.getType()=="GeometryCollection"){const u=t.getGeometries();for(let g=0,m=u.length;g<m;++g)q0(s,u[g],e,n,r);return}s.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer(),r)}function i2(s,t,e,n,r,l){const u=t.getGeometriesArray();let g,m;for(g=0,m=u.length;g<m;++g){const p=Z0[u[g].getType()];p(s,u[g],e,n,r,l)}}function n2(s,t,e,n,r){const l=e.getStroke();if(l){const g=s.getBuilder(e.getZIndex(),"LineString");g.setFillStrokeStyle(null,l),g.drawLineString(t,n,r)}const u=e.getText();if(u&&u.getText()){const g=s.getBuilder(e.getZIndex(),"Text");g.setTextStyle(u),g.drawText(t,n,r)}}function s2(s,t,e,n,r){const l=e.getStroke();if(l){const g=s.getBuilder(e.getZIndex(),"LineString");g.setFillStrokeStyle(null,l),g.drawMultiLineString(t,n,r)}const u=e.getText();if(u&&u.getText()){const g=s.getBuilder(e.getZIndex(),"Text");g.setTextStyle(u),g.drawText(t,n,r)}}function r2(s,t,e,n,r){const l=e.getFill(),u=e.getStroke();if(u||l){const m=s.getBuilder(e.getZIndex(),"Polygon");m.setFillStrokeStyle(l,u),m.drawMultiPolygon(t,n,r)}const g=e.getText();if(g&&g.getText()){const m=s.getBuilder(e.getZIndex(),"Text");m.setTextStyle(g),m.drawText(t,n,r)}}function o2(s,t,e,n,r,l){const u=e.getImage(),g=e.getText(),m=g&&g.getText(),p=l&&u&&m?{}:void 0;if(u){if(u.getImageState()!=ee.LOADED)return;const E=s.getBuilder(e.getZIndex(),"Image");E.setImageStyle(u,p),E.drawPoint(t,n,r)}if(m){const E=s.getBuilder(e.getZIndex(),"Text");E.setTextStyle(g,p),E.drawText(t,n,r)}}function a2(s,t,e,n,r,l){const u=e.getImage(),g=u&&u.getOpacity()!==0,m=e.getText(),p=m&&m.getText(),E=l&&g&&p?{}:void 0;if(g){if(u.getImageState()!=ee.LOADED)return;const A=s.getBuilder(e.getZIndex(),"Image");A.setImageStyle(u,E),A.drawMultiPoint(t,n,r)}if(p){const A=s.getBuilder(e.getZIndex(),"Text");A.setTextStyle(m,E),A.drawText(t,n,r)}}function l2(s,t,e,n,r){const l=e.getFill(),u=e.getStroke();if(l||u){const m=s.getBuilder(e.getZIndex(),"Polygon");m.setFillStrokeStyle(l,u),m.drawPolygon(t,n,r)}const g=e.getText();if(g&&g.getText()){const m=s.getBuilder(e.getZIndex(),"Text");m.setTextStyle(g),m.drawText(t,n,r)}}class h2 extends Y0{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=mn(),this.wrappedRenderedExtent_=mn(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,n){const r=e.extent,l=e.viewState,u=l.center,g=l.resolution,m=l.projection,p=l.rotation,E=m.getExtent(),A=this.getLayer().getSource(),b=this.getLayer().getDeclutter(),D=e.pixelRatio,P=e.viewHints,F=!(P[Di.ANIMATING]||P[Di.INTERACTING]),z=this.context,j=Math.round(we(r)/g*D),G=Math.round(Li(r)/g*D),X=A.getWrapX()&&m.canWrapX(),Y=X?we(E):null,Q=X?Math.ceil((r[2]-E[2])/Y)+1:1;let rt=X?Math.floor((r[0]-E[0])/Y):0;do{let K=this.getRenderTransform(u,g,0,D,j,G,rt*Y);e.declutter&&(K=K.slice(0)),t.execute(z,[z.canvas.width,z.canvas.height],K,p,F,n===void 0?Sr:n?H0:Vg,n?b&&e.declutter[b]:void 0)}while(++rt<Q)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Mi(this.context.canvas.width,this.context.canvas.height,su))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Xa(this.context),su.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex];this.opacity_=n.opacity;const r=t.viewState;this.prepareContainer(t,e);const l=this.context,u=this.replayGroup_;let g=u&&!u.isEmpty();if(!g&&!(this.getLayer().hasListener(gn.PRERENDER)||this.getLayer().hasListener(gn.POSTRENDER)))return null;if(this.setDrawContext_(),this.preRender(l,t),r.projection,this.clipped_=!1,g&&n.extent&&this.clipping){const m=Ks(n.extent);g=Vi(m,t.extent),this.clipped_=g&&!Zs(m,t.extent),this.clipped_&&this.clipUnrotated(l,t,m)}return g&&this.renderWorlds(u,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&l.restore(),this.postRender(l,t),this.renderedRotation_!==r.rotation&&(this.renderedRotation_=r.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=this.frameState.size.slice(),r=this.renderedCenter_,l=this.renderedResolution_,u=this.renderedRotation_,g=this.renderedProjection_,m=this.wrappedRenderedExtent_,p=this.getLayer(),E=[],A=n[0]*Fn,b=n[1]*Fn;E.push(this.getRenderTransform(r,l,u,Fn,A,b,0).slice());const D=p.getSource(),P=g.getExtent();if(D.getWrapX()&&g.canWrapX()&&!Zs(P,m)){let F=m[0];const z=we(P);let j=0,G;for(;F<P[0];)--j,G=z*j,E.push(this.getRenderTransform(r,l,u,Fn,A,b,G).slice()),F+=z;for(j=0,F=m[2];F>P[2];)++j,G=z*j,E.push(this.getRenderTransform(r,l,u,Fn,A,b,G).slice()),F-=z}this.hitDetectionImageData_=qg(n,E,this.renderedFeatures_,p.getStyleFunction(),m,l,u,au(l,this.renderedPixelRatio_),null)}e(Qg(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,n,r,l){if(!this.replayGroup_)return;const u=e.viewState.resolution,g=e.viewState.rotation,m=this.getLayer(),p={},E=function(P,F,z){const j=Me(P),G=p[j];if(G){if(G!==!0&&z<G.distanceSq){if(z===0)return p[j]=!0,l.splice(l.lastIndexOf(G),1),r(P,m,F);G.geometry=F,G.distanceSq=z}}else{if(z===0)return p[j]=!0,r(P,m,F);l.push(p[j]={feature:P,layer:m,geometry:F,distanceSq:z,callback:r})}};let A;const b=[this.replayGroup_],D=this.getLayer().getDeclutter();return b.some(P=>A=P.forEachFeatureAtCoordinate(t,u,g,n,E,D&&e.declutter[D]?e.declutter[D].all().map(F=>F.value):null)),A}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),n=e.getSource();if(!n)return!1;const r=t.viewHints[Di.ANIMATING],l=t.viewHints[Di.INTERACTING],u=e.getUpdateWhileAnimating(),g=e.getUpdateWhileInteracting();if(this.ready&&!u&&r||!g&&l)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const m=t.extent,p=t.viewState,E=p.projection,A=p.resolution,b=t.pixelRatio,D=e.getRevision(),P=e.getRenderBuffer();let F=e.getRenderOrder();F===void 0&&(F=$g);const z=p.center.slice(),j=Sh(m,P*A),G=j.slice(),X=[j.slice()],Y=E.getExtent();if(n.getWrapX()&&E.canWrapX()&&!Zs(Y,t.extent)){const Nt=we(Y),J=Math.max(we(j)/2,Nt);j[0]=Y[0]-J,j[2]=Y[2]+J,e0(z,E);const gt=Ju(X[0],E);gt[0]<Y[0]&&gt[2]<Y[2]?X.push([gt[0]+Nt,gt[1],gt[2]+Nt,gt[3]]):gt[0]>Y[0]&&gt[2]>Y[2]&&X.push([gt[0]-Nt,gt[1],gt[2]-Nt,gt[3]])}if(this.ready&&this.renderedResolution_==A&&this.renderedRevision_==D&&this.renderedRenderOrder_==F&&this.renderedFrameDeclutter_===!!t.declutter&&Zs(this.wrappedRenderedExtent_,j))return Fs(this.renderedExtent_,G)||(this.hitDetectionImageData_=null,this.renderedExtent_=G),this.renderedCenter_=z,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const Q=new Ug(K0(A,b),j,A,b);let rt;for(let Nt=0,J=X.length;Nt<J;++Nt)n.loadFeatures(X[Nt],A,E);const K=au(A,b);let ot=!0;const Z=(Nt,J)=>{let gt;const Et=Nt.getStyleFunction()||e.getStyleFunction();if(Et&&(gt=Et(Nt,A)),gt){const Wt=this.renderFeature(Nt,K,gt,Q,rt,this.getLayer().getDeclutter(),J);ot=ot&&!Wt}},Ot=Lh(j),St=n.getFeaturesInExtent(Ot);F&&St.sort(F);for(let Nt=0,J=St.length;Nt<J;++Nt)Z(St[Nt],Nt);this.renderedFeatures_=St,this.ready=ot;const ut=Q.finish(),yt=new Yg(j,A,b,n.getOverlaps(),ut,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=A,this.renderedRevision_=D,this.renderedRenderOrder_=F,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=G,this.wrappedRenderedExtent_=j,this.renderedCenter_=z,this.renderedProjection_=E,this.renderedPixelRatio_=b,this.replayGroup_=yt,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,n,r,l,u,g){if(!n)return!1;let m=!1;if(Array.isArray(n))for(let p=0,E=n.length;p<E;++p)m=lu(r,t,n[p],e,this.boundHandleStyleImageChange_,l,u,g)||m;else m=lu(r,t,n,e,this.boundHandleStyleImageChange_,l,u,g);return m}}class Q0 extends j0{constructor(t){super(t)}createRenderer(){return new h2(this)}}class hu{constructor(t){this.rbush_=new D0(t),this.items_={}}insert(t,e){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[Me(e)]=n}load(t,e){const n=new Array(e.length);for(let r=0,l=e.length;r<l;r++){const u=t[r],g=e[r],m={minX:u[0],minY:u[1],maxX:u[2],maxY:u[3],value:g};n[r]=m,this.items_[Me(g)]=m}this.rbush_.load(n)}remove(t){const e=Me(t),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(t,e){const n=this.items_[Me(e)],r=[n.minX,n.minY,n.maxX,n.maxY];fo(r,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(r){return r.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let n;for(let r=0,l=t.length;r<l;r++)if(n=e(t[r]),n)return n;return n}isEmpty(){return er(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return hs(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class Sa extends a0{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Fe),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,n=t.length;e<n;++e)this.changeEventsKeys_.push(de(t[e],Ht.CHANGE,this.changed,this))}clone(){const t=new Sa(Ll(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,n,r){if(r<ir(this.getExtent(),t,e))return r;const l=this.geometries_;for(let u=0,g=l.length;u<g;++u)r=l[u].closestPointXY(t,e,n,r);return r}containsXY(t,e){const n=this.geometries_;for(let r=0,l=n.length;r<l;++r)if(n[r].containsXY(t,e))return!0;return!1}computeExtent(t){Wr(t);const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)Ku(t,e[n].getExtent());return t}getGeometries(){return Ll(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let r=!1;for(let l=0,u=n.length;l<u;++l){const g=n[l],m=g.getSimplifiedGeometry(t);e.push(m),m!==g&&(r=!0)}return r?new Sa(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let r=0,l=n.length;r<l;++r)n[r].rotate(t,e);this.changed()}scale(t,e,n){n||(n=Os(this.getExtent()));const r=this.geometries_;for(let l=0,u=r.length;l<u;++l)r[l].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(Ll(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,r=e.length;n<r;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let r=0,l=n.length;r<l;++r)n[r].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Ll(s){return s.map(t=>t.clone())}const c2=Sa;class Ta extends sr{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{const r=t,l=[],u=[];for(let m=0,p=r.length;m<p;++m){const E=r[m];Gn(l,E.getFlatCoordinates()),u.push(l.length)}const g=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(g,l),this.ends_=u}}appendLineString(t){Gn(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Ta(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,r){return r<ir(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Fh(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),kh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,r))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,u1(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return mo(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new sh(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,r=[];let l=0;for(let u=0,g=e.length;u<g;++u){const m=e[u],p=new sh(t.slice(l,m),n);r.push(p),l=m}return r}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const r=this.ends_,l=this.stride;for(let u=0,g=r.length;u<g;++u){const m=r[u],p=ya(e,n,m,l,.5);Gn(t,p),n=m}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=h0(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new Ta(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return Wd(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=No(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}const u2=Ta;class ic extends sr{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){Gn(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new ic(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,r){if(r<ir(this.getExtent(),t,e))return r;const l=this.flatCoordinates,u=this.stride;for(let g=0,m=l.length;g<m;g+=u){const p=$s(t,e,l[g],l[g+1]);if(p<r){r=p;for(let E=0;E<u;++E)n[E]=l[g+E];n.length=u}}return r}getCoordinates(){return Ts(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Fr(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,r=[];for(let l=0,u=t.length;l<u;l+=n){const g=new Fr(t.slice(l,l+n),e);r.push(g)}return r}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let r=0,l=e.length;r<l;r+=n){const u=e[r],g=e[r+1];if(Th(t,u,g))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=za(this.flatCoordinates,0,t,this.stride),this.changed()}}const J0=ic;function $0(s,t,e,n){const r=[];let l=mn();for(let u=0,g=e.length;u<g;++u){const m=e[u];l=bh(s,t,m[0],n),r.push((l[0]+l[2])/2,(l[1]+l[3])/2),t=m[m.length-1]}return r}class ba extends sr{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const r=t,l=[],u=[];for(let g=0,m=r.length;g<m;++g){const p=r[g],E=l.length,A=p.getEnds();for(let b=0,D=A.length;b<D;++b)A[b]+=E;Gn(l,p.getFlatCoordinates()),u.push(A)}e=r.length===0?this.getLayout():r[0].getLayout(),t=l,n=u}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;Gn(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let r=0,l=e.length;r<l;++r)e[r]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let r=0;r<t;++r)e[r]=this.endss_[r].slice();const n=new ba(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,r){return r<ir(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Pd(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Fd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,r))}containsXY(t,e){return jd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Gd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),ih(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,eh(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=$0(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=f0(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new J0(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;x0(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=ih(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Ud(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new ba(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const l=this.endss_[t-1];e=l[l.length-1]}const n=this.endss_[t].slice(),r=n[n.length-1];if(e!==0)for(let l=0,u=n.length;l<u;++l)n[l]-=e;return new Ds(this.flatCoordinates.slice(e,r),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,r=[];let l=0;for(let u=0,g=n.length;u<g;++u){const m=n[u].slice(),p=m[m.length-1];if(l!==0)for(let A=0,b=m.length;A<b;++A)m[A]-=l;const E=new Ds(e.slice(l,p),t,m);r.push(E),l=p}return r}getType(){return"MultiPolygon"}intersectsExtent(t){return Xd(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=l0(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const r=n[n.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}const f2=ba,cu=Mn();class ji{constructor(t,e,n,r,l,u){this.styleFunction,this.extent_,this.id_=u,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=l,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Zu(this.flatCoordinates_):bh(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Os(this.getExtent());this.flatInteriorPoints_=zh(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Yd(this.flatCoordinates_,this.ends_),e=$0(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=f0(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=ya(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let r=0,l=n.length;r<l;++r){const u=n[r],g=ya(t,e,u,2,.5);Gn(this.flatMidpoints_,g),e=u}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Ge(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const r=Li(n)/Li(e);ls(cu,n[0],n[3],r,-r,0,0,0),Ns(this.flatCoordinates_,0,this.flatCoordinates_.length,2,cu,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new ji(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Vu((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":n.length=ja(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),r=[n.length];break;case"MultiLineString":r=[],n.length=h0(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,r);break;case"Polygon":r=[],n.length=Uh(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,r);break}return r&&(this.simplifiedGeometry_=new ji(this.type_,n,r,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}ji.prototype.getFlatCoordinates=ji.prototype.getOrientedFlatCoordinates;class tf extends bn{constructor(t){super(),this.projection=Ge(t.projection),this.attributions_=uu(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,r){e.viewResolver=n,e.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=uu(t),this.changed()}setState(t){this.state_=t,this.changed()}}function uu(s){return s?Array.isArray(s)?function(t){return s}:typeof s=="function"?s:function(t){return[s]}:null}const dn={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function d2(s,t){return[[-1/0,-1/0,1/0,1/0]]}let g2=!1;function m2(s,t,e,n,r,l,u){const g=new XMLHttpRequest;g.open("GET",typeof s=="function"?s(e,n,r):s,!0),t.getType()=="arraybuffer"&&(g.responseType="arraybuffer"),g.withCredentials=g2,g.onload=function(m){if(!g.status||g.status>=200&&g.status<300){const p=t.getType();try{let E;p=="text"||p=="json"?E=g.responseText:p=="xml"?E=g.responseXML||g.responseText:p=="arraybuffer"&&(E=g.response),E?l(t.readFeatures(E,{extent:e,featureProjection:r}),t.readProjection(E)):u()}catch{u()}}else u()},g.onerror=u,g.send()}function fu(s,t){return function(e,n,r,l,u){const g=this;m2(s,t,e,n,r,function(m,p){g.addFeatures(m),l!==void 0&&l(m)},u||Or)}}class Cs extends cs{constructor(t,e,n){super(t),this.feature=e,this.features=n}}class x2 extends tf{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Or,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(pe(this.format_,"`format` must be set when `url` is set"),this.loader_=fu(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:d2;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new hu:null,this.loadedExtentsRtree_=new hu,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,r;Array.isArray(t.features)?r=t.features:t.features&&(n=t.features,r=n.getArray()),!e&&n===void 0&&(n=new Bn(r)),r!==void 0&&this.addFeaturesInternal(r),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=Me(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const n=t.getGeometry();if(n){const r=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Cs(dn.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof ji||(this.featureChangeKeys_[t]=[de(e,Ht.CHANGE,this.handleFeatureChange_,this),de(e,Nr.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let n=!0;if(e.getId()!==void 0){const r=String(e.getId());if(!(r in this.idIndex_))this.idIndex_[r]=e;else if(e instanceof ji){const l=this.idIndex_[r];l instanceof ji?Array.isArray(l)?l.push(e):this.idIndex_[r]=[l,e]:n=!1}else n=!1}return n&&(pe(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],n=[],r=[];for(let l=0,u=t.length;l<u;l++){const g=t[l],m=Me(g);this.addToIndex_(m,g)&&n.push(g)}for(let l=0,u=n.length;l<u;l++){const g=n[l],m=Me(g);this.setupChangeEvents_(m,g);const p=g.getGeometry();if(p){const E=p.getExtent();e.push(E),r.push(g)}else this.nullGeometryFeatures_[m]=g}if(this.featuresRtree_&&this.featuresRtree_.load(e,r),this.hasListener(dn.ADDFEATURE))for(let l=0,u=n.length;l<u;l++)this.dispatchEvent(new Cs(dn.ADDFEATURE,n[l]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(dn.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(dn.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(Wi.ADD,n=>{e||(e=!0,this.addFeature(n.element),e=!1)}),t.addEventListener(Wi.REMOVE,n=>{e||(e=!0,this.removeFeature(n.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(Fe);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=r=>{this.removeFeatureInternal(r)};this.featuresRtree_.forEach(n);for(const r in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Cs(dn.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(r){const l=r.getGeometry();if(l instanceof ji||l.intersectsCoordinate(t))return e(r)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(n){const r=n.getGeometry();if(r instanceof ji||r.intersectsExtent(t)){const l=e(n);if(l)return l}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),er(this.nullGeometryFeatures_)||Gn(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const r=$u(t,e);return[].concat(...r.map(l=>this.featuresRtree_.getInExtent(l)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const n=t[0],r=t[1];let l=null;const u=[NaN,NaN];let g=1/0;const m=[-1/0,-1/0,1/0,1/0];return e=e||uo,this.featuresRtree_.forEachInExtent(m,function(p){if(e(p)){const E=p.getGeometry(),A=g;if(g=E instanceof ji?0:E.closestPointXY(n,r,u,g),g<A){l=p;const b=Math.sqrt(g);m[0]=n-b,m[1]=r-b,m[2]=n+b,m[3]=r+b}}}),l}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,n=Me(e),r=e.getGeometry();if(!r)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{const u=r.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(u,e)):this.featuresRtree_&&this.featuresRtree_.update(u,e)}const l=e.getId();if(l!==void 0){const u=l.toString();this.idIndex_[u]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[u]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Cs(dn.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:Me(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&er(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,n){const r=this.loadedExtentsRtree_,l=this.strategy_(t,e,n);for(let u=0,g=l.length;u<g;++u){const m=l[u];r.forEachInExtent(m,function(E){return Zs(E.extent,m)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Cs(dn.FEATURESLOADSTART)),this.loader_.call(this,m,e,n,E=>{--this.loadingExtentsCount_,this.dispatchEvent(new Cs(dn.FEATURESLOADEND,void 0,E))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Cs(dn.FEATURESLOADERROR))}),r.insert(m,{extent:m.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let n;e.forEachInExtent(t,function(r){if(fo(r.extent,t))return n=r,!0}),n&&e.remove(n)}removeFeatures(t){const e=[];for(let n=0,r=t.length;n<r;++n){const l=t[n],u=this.removeFeatureInternal(l);u&&e.push(u)}e.length>0&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=Me(t);if(!(e in this.uidIndex_))return;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[e]?.forEach(Fe),delete this.featureChangeKeys_[e];const r=t.getId();if(r!==void 0){const l=r.toString(),u=this.idIndex_[l];u===t?delete this.idIndex_[l]:Array.isArray(u)&&(u.splice(u.indexOf(t),1),u.length===1&&(this.idIndex_[l]=u[0]))}return delete this.uidIndex_[e],this.hasListener(dn.REMOVEFEATURE)&&this.dispatchEvent(new Cs(dn.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const n in this.idIndex_){const r=this.idIndex_[n];if(t instanceof ji&&Array.isArray(r)&&r.includes(t))r.splice(r.indexOf(t),1);else if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){pe(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(fu(t,this.format_))}}const kt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class ef extends Pa{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(Ht.CHANGE)}release(){this.state===kt.ERROR&&this.setState(kt.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==kt.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==kt.LOADED){t.interimTile=null;break}t.getState()==kt.LOADING?e=t:t.getState()==kt.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==kt.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){Xt()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const r=e-n+1e3/60;return r>=this.transition_?1:N0(r/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}class nf extends ef{constructor(t,e,n,r,l,u){super(t,e,u),this.crossOrigin_=r,this.src_=n,this.key=n,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=l}getImage(){return this.image_}setImage(t){this.image_=t,this.state=kt.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=kt.ERROR,this.unlistenImage_(),this.image_=p2(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=kt.LOADED:this.state=kt.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==kt.ERROR&&(this.state=kt.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==kt.IDLE&&(this.state=kt.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=o1(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function p2(){const s=Mi(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}class _2{constructor(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const r=this.points_[e+2]-this.points_[n+2];if(r<1e3/60)return!1;const l=this.points_[e]-this.points_[n],u=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(u,l),this.initialVelocity_=Math.sqrt(l*l+u*u)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class y2 extends Ih{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){Xt()}calculateMatrices2D(t){const e=t.viewState,n=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;ls(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Yu(r,n)}forEachFeatureAtCoordinate(t,e,n,r,l,u,g,m){let p;const E=e.viewState;function A(Y,Q,rt,K){return l.call(u,Q,Y?rt:null,K)}const b=E.projection,D=e0(t.slice(),b),P=[[0,0]];if(b.canWrapX()&&r){const Y=b.getExtent(),Q=we(Y);P.push([-Q,0],[Q,0])}const F=e.layerStatesArray,z=F.length,j=[],G=[];for(let Y=0;Y<P.length;Y++)for(let Q=z-1;Q>=0;--Q){const rt=F[Q],K=rt.layer;if(K.hasRenderer()&&tc(rt,E)&&g.call(m,K)){const ot=K.getRenderer(),Z=K.getSource();if(ot&&Z){const Ot=Z.getWrapX()?D:t,St=A.bind(null,rt.managed);G[0]=Ot[0]+P[Y][0],G[1]=Ot[1]+P[Y][1],p=ot.forEachFeatureAtCoordinate(G,e,n,St,j)}if(p)return p}}if(j.length===0)return;const X=1/j.length;return j.forEach((Y,Q)=>Y.distanceSq+=Q*X),j.sort((Y,Q)=>Y.distanceSq-Q.distanceSq),j.some(Y=>p=Y.callback(Y.feature,Y.layer,Y.geometry)),p}hasFeatureAtCoordinate(t,e,n,r,l,u){return this.forEachFeatureAtCoordinate(t,e,n,r,uo,this,l,u)!==void 0}getMap(){return this.map_}renderFrame(t){Xt()}scheduleExpireIconCache(t){kn.canExpireCache()&&t.postRenderFunctions.push(E2)}}function E2(s,t){kn.expire()}class w2 extends y2{constructor(t){super(t),this.fontChangeListenerKey_=de(es,Nr.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Ha+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const n=this.getMap();if(n.hasListener(t)){const r=new X0(t,void 0,e);n.dispatchEvent(r)}}disposeInternal(){Fe(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(gn.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(g,m){return g.zIndex-m.zIndex});e.some(g=>g.layer instanceof j0&&g.layer.getDeclutter())&&(t.declutter={});const r=t.viewState;this.children_.length=0;const l=[];let u=null;for(let g=0,m=e.length;g<m;++g){const p=e[g];t.layerIndex=g;const E=p.layer,A=E.getSourceState();if(!tc(p,r)||A!="ready"&&A!="undefined"){E.unrender();continue}const b=E.render(t,u);b&&(b!==u&&(this.children_.push(b),u=b),l.push(p))}this.declutter(t,l),r1(this.element_,this.children_),this.dispatchRenderEvent(gn.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let n=e.length-1;n>=0;--n){const r=e[n],l=r.layer;l.getDeclutter()&&l.renderDeclutter(t,r)}e.forEach(n=>n.layer.renderDeferred(t))}}}class Ss extends cs{constructor(t,e){super(t),this.layer=e}}const Pl={LAYERS:"layers"};class Yr extends v0{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Pl.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Bn(n.slice(),{unique:!0}):pe(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Bn(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Fe),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(de(t,Wi.ADD,this.handleLayersAdd_,this),de(t,Wi.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(Fe);To(this.listenerKeys_);const e=t.getArray();for(let n=0,r=e.length;n<r;n++){const l=e[n];this.registerLayerListeners_(l),this.dispatchEvent(new Ss("addlayer",l))}this.changed()}registerLayerListeners_(t){const e=[de(t,Nr.PROPERTYCHANGE,this.handleLayerChange_,this),de(t,Ht.CHANGE,this.handleLayerChange_,this)];t instanceof Yr&&e.push(de(t,"addlayer",this.handleLayerGroupAdd_,this),de(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Me(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Ss("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Ss("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Ss("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=Me(e);this.listenerKeys_[n].forEach(Fe),delete this.listenerKeys_[n],this.dispatchEvent(new Ss("removelayer",e)),this.changed()}getLayers(){return this.get(Pl.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let r=0,l=n.length;r<l;++r)this.dispatchEvent(new Ss("removelayer",n[r]))}this.set(Pl.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(u){u.getLayerStatesArray(e)});const r=this.getLayerState();let l=r.zIndex;!t&&r.zIndex===void 0&&(l=0);for(let u=n,g=e.length;u<g;u++){const m=e[u];m.opacity*=r.opacity,m.visible=m.visible&&r.visible,m.maxResolution=Math.min(m.maxResolution,r.maxResolution),m.minResolution=Math.max(m.minResolution,r.minResolution),m.minZoom=Math.max(m.minZoom,r.minZoom),m.maxZoom=Math.min(m.maxZoom,r.maxZoom),r.extent!==void 0&&(m.extent!==void 0?m.extent=lo(m.extent,r.extent):m.extent=r.extent),m.zIndex===void 0&&(m.zIndex=l)}return e}getSourceState(){return"ready"}}class Ar extends cs{constructor(t,e,n){super(t),this.map=e,this.frameState=n!==void 0?n:null}}class Ms extends Ar{constructor(t,e,n,r,l,u){super(t,e,l),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=u}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const $e={SINGLECLICK:"singleclick",CLICK:Ht.CLICK,DBLCLICK:Ht.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},hh={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class C2 extends Pa{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=de(n,hh.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=de(n,hh.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Ht.TOUCHMOVE,this.boundHandleTouchMove_,A0?{passive:!1}:!1)}emulateClick_(t){let e=new Ms($e.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Ms($e.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Ms($e.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){const e=t,n=e.pointerId;if(e.type==$e.POINTERUP||e.type==$e.POINTERCANCEL){delete this.trackedTouches_[n];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==e.target){delete this.trackedTouches_[r];break}}else(e.type==$e.POINTERDOWN||e.type==$e.POINTERMOVE)&&(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Ms($e.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Fe),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new Ms($e.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(de(n,$e.POINTERMOVE,this.handlePointerMove_,this),de(n,$e.POINTERUP,this.handlePointerUp_,this),de(this.element_,$e.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(de(this.element_.getRootNode(),$e.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Ms($e.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Ms($e.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Fe(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Ht.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Fe(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Fe),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const is={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Oi={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Ra=1/0;class A2{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,To(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(t){pe(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=Ra?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,r=e.length,l=e[t],u=n[t],g=t;for(;t<r>>1;){const m=this.getLeftChildIndex_(t),p=this.getRightChildIndex_(t),E=p<r&&n[p]<n[m]?p:m;e[t]=e[E],n[t]=n[E],t=E}e[t]=l,n[t]=u,this.siftDown_(g,t)}siftDown_(t,e){const n=this.elements_,r=this.priorities_,l=n[e],u=r[e];for(;e>t;){const g=this.getParentIndex_(e);if(r[g]>u)n[e]=n[g],r[e]=r[g],e=g;else break}n[e]=l,r[e]=u}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let r=0;const l=e.length;let u,g,m;for(g=0;g<l;++g)u=e[g],m=t(u),m==Ra?delete this.queuedElements_[this.keyFunction_(u)]:(n[r]=m,e[r++]=u);e.length=r,n.length=r,this.heapify_()}}class I2 extends A2{constructor(t,e){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(Ht.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===kt.LOADED||n===kt.ERROR||n===kt.EMPTY){n!==kt.ERROR&&e.removeEventListener(Ht.CHANGE,this.boundHandleTileChange_);const r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0,r,l,u;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;)l=this.dequeue()[0],u=l.getKey(),r=l.getState(),r===kt.IDLE&&!(u in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[u]=!0,++this.tilesLoading_,++n,l.load())}}function M2(s,t,e,n,r){if(!s||!(e in s.wantedTiles)||!s.wantedTiles[e][t.getKey()])return Ra;const l=s.viewState.center,u=n[0]-l[0],g=n[1]-l[1];return 65536*Math.log(r)+Math.sqrt(u*u+g*g)/r}class nc extends bn{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){_a(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&_a(this.element);for(let e=0,n=this.listenerKeys.length;e<n;++e)Fe(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Or&&this.listenerKeys.push(de(t,is.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class S2 extends nc{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",r=t.expandClassName!==void 0?t.expandClassName:e+"-expand",l=t.collapseLabel!==void 0?t.collapseLabel:"›",u=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof l=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=l,this.collapseLabel_.className=u):this.collapseLabel_=l;const g=t.label!==void 0?t.label:"i";typeof g=="string"?(this.label_=document.createElement("span"),this.label_.textContent=g,this.label_.className=r):this.label_=g;const m=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(m),this.toggleButton_.addEventListener(Ht.CLICK,this.handleClick_.bind(this),!1);const p=e+" "+Ha+" "+Zh+(this.collapsed_&&this.collapsible_?" "+zc:"")+(this.collapsible_?"":" ol-uncollapsible"),E=this.element;E.className=p,E.appendChild(this.toggleButton_),E.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(t)))),n=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),e}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(r=>qf(()=>r))),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Fs(e,this.renderedAttributions_)){I0(this.ulElement_);for(let r=0,l=e.length;r<l;++r){const u=document.createElement("li");u.innerHTML=e[r],this.ulElement_.appendChild(u)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(zc),this.collapsed_?Uc(this.collapseLabel_,this.label_):Uc(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}const T2=S2;class b2 extends nc{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"⇧",r=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));const l=t.tipLabel?t.tipLabel:"Reset rotation",u=document.createElement("button");u.className=e+"-reset",u.setAttribute("type","button"),u.title=l,u.appendChild(this.label_),u.addEventListener(Ht.CLICK,this.handleClick_.bind(this),!1);const g=e+" "+Ha+" "+Zh,m=this.element;m.className=g,m.appendChild(u),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(ea)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const n=e.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Xr}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const n=e.viewState.rotation;if(n!=this.rotation_){const r="rotate("+n+"rad)";if(this.autoHide_){const l=this.element.classList.contains(ea);!l&&n===0?this.element.classList.add(ea):l&&n!==0&&this.element.classList.remove(ea)}this.label_.style.transform=r}this.rotation_=n}}const R2=b2;class v2 extends nc{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,r=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",l=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",u=t.zoomInLabel!==void 0?t.zoomInLabel:"+",g=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",m=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",p=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",E=document.createElement("button");E.className=r,E.setAttribute("type","button"),E.title=m,E.appendChild(typeof u=="string"?document.createTextNode(u):u),E.addEventListener(Ht.CLICK,this.handleClick_.bind(this,n),!1);const A=document.createElement("button");A.className=l,A.setAttribute("type","button"),A.title=p,A.appendChild(typeof g=="string"?document.createTextNode(g):g),A.addEventListener(Ht.CLICK,this.handleClick_.bind(this,-n),!1);const b=e+" "+Ha+" "+Zh,D=this.element;D.className=b,D.appendChild(E),D.appendChild(A),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const n=this.getMap().getView();if(!n)return;const r=n.getZoom();if(r!==void 0){const l=n.getConstrainedZoom(r+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:l,duration:this.duration_,easing:Xr})):n.setZoom(l)}}}const N2=v2;function O2(s){s=s||{};const t=new Bn;return(s.zoom!==void 0?s.zoom:!0)&&t.push(new N2(s.zoomOptions)),(s.rotate!==void 0?s.rotate:!0)&&t.push(new R2(s.rotateOptions)),(s.attribution!==void 0?s.attribution:!0)&&t.push(new T2(s.attributionOptions)),t}const du={ACTIVE:"active"};class Po extends bn{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(du.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(du.ACTIVE,t)}setMap(t){this.map_=t}}function D2(s,t,e){const n=s.getCenterInternal();if(n){const r=[n[0]+t[0],n[1]+t[1]];s.animateInternal({duration:e!==void 0?e:250,easing:v1,center:s.getConstrainedCenter(r)})}}function sc(s,t,e,n){const r=s.getZoom();if(r===void 0)return;const l=s.getConstrainedZoom(r+t),u=s.getResolutionForZoom(l);s.getAnimating()&&s.cancelAnimations(),s.animate({resolution:u,anchor:e,duration:n!==void 0?n:250,easing:Xr})}class L2 extends Po{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==$e.DBLCLICK){const n=t.originalEvent,r=t.map,l=t.coordinate,u=n.shiftKey?-this.delta_:this.delta_,g=r.getView();sc(g,u,l,this.duration_),n.preventDefault(),e=!0}return!e}}const P2=L2;class Fo extends Po{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==$e.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==$e.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==$e.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==$e.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function rc(s){const t=s.length;let e=0,n=0;for(let r=0;r<t;r++)e+=s[r].clientX,n+=s[r].clientY;return{clientX:e/t,clientY:n/t}}function ch(s){const t=arguments;return function(e){let n=!0;for(let r=0,l=t.length;r<l&&(n=n&&t[r](e),!!n);++r);return n}}const F2=function(s){const t=s.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},B2=function(s){const t=s.map.getTargetElement(),e=s.map.getOwnerDocument().activeElement;return t.contains(e)},sf=function(s){return s.map.getTargetElement().hasAttribute("tabindex")?B2(s):!0},k2=uo,rf=function(s){const t=s.originalEvent;return t.button==0&&!(i1&&y0&&t.ctrlKey)},of=function(s){const t=s.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},U2=function(s){const t=s.originalEvent;return y0?t.metaKey:t.ctrlKey},G2=function(s){const t=s.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},af=function(s){const t=s.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},Fl=function(s){const t=s.originalEvent;return pe(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.pointerType=="mouse"},z2=function(s){const t=s.originalEvent;return pe(t!==void 0,"mapBrowserEvent must originate from a pointer event"),t.isPrimary&&t.button===0};class j2 extends Fo{constructor(t){super({stopDown:La}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:ch(of,z2);this.condition_=t.onFocusOnly?ch(sf,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const n=this.targetPointers,r=e.getEventPixel(rc(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const l=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],g=t.map.getView();wd(l,g.getResolution()),Nh(l,g.getRotation()),g.adjustCenterInternal(l)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),l=this.kinetic_.getAngle(),u=n.getCenterInternal(),g=e.getPixelFromCoordinateInternal(u),m=e.getCoordinateFromPixelInternal([g[0]-r*Math.cos(l),g[1]-r*Math.sin(l)]);n.animateInternal({center:n.getConstrainedCenter(m),duration:500,easing:Xr})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const W2=j2;class X2 extends Fo{constructor(t){t=t||{},super({stopDown:La}),this.condition_=t.condition?t.condition:F2,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Fl(t))return;const e=t.map,n=e.getView();if(n.getConstraints().rotation===$h)return;const r=e.getSize(),l=t.pixel,u=Math.atan2(r[1]/2-l[1],l[0]-r[0]/2);if(this.lastAngle_!==void 0){const g=u-this.lastAngle_;n.adjustRotationInternal(-g)}this.lastAngle_=u}handleUpEvent(t){return Fl(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Fl(t)&&rf(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class V2 extends Ih{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,n="px",r=this.element_.style;r.left=Math.min(t[0],e[0])+n,r.top=Math.min(t[1],e[1])+n,r.width=Math.abs(e[0]-t[0])+n,r.height=Math.abs(e[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,r=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Ds([r])}getGeometry(){return this.geometry_}}const no={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class oa extends cs{constructor(t,e,n){super(t),this.coordinate=e,this.mapBrowserEvent=n}}class Y2 extends Fo{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new V2(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:rf,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,n){const r=n[0]-e[0],l=n[1]-e[1];return r*r+l*l>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new oa(no.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new oa(e?no.BOXEND:no.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new oa(no.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new oa(no.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}}class H2 extends Y2{constructor(t){t=t||{};const e=t.condition?t.condition:G2;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const n=this.getMap().getView();let r=this.getGeometry();if(this.out_){const l=n.rotatedExtentForGeometry(r),u=n.getResolutionForExtentInternal(l),g=n.getResolution()/u;r=r.clone(),r.scale(g*g)}n.fitInternal(r,{duration:this.duration_,easing:Xr})}}const Z2=H2,Vs={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class K2 extends Po{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return of(e)&&af(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==Ht.KEYDOWN){const n=t.originalEvent,r=n.key;if(this.condition_(t)&&(r==Vs.DOWN||r==Vs.LEFT||r==Vs.RIGHT||r==Vs.UP)){const u=t.map.getView(),g=u.getResolution()*this.pixelDelta_;let m=0,p=0;r==Vs.DOWN?p=-g:r==Vs.LEFT?m=-g:r==Vs.RIGHT?m=g:p=g;const E=[m,p];Nh(E,u.getRotation()),D2(u,E,this.duration_),n.preventDefault(),e=!0}}return!e}}class q2 extends Po{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!U2(e)&&af(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==Ht.KEYDOWN||t.type==Ht.KEYPRESS){const n=t.originalEvent,r=n.key;if(this.condition_(t)&&(r==="+"||r==="-")){const l=t.map,u=r==="+"?this.delta_:-this.delta_,g=l.getView();sc(g,u,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}}const Q2=q2;class J2 extends Po{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:k2;this.condition_=t.onFocusOnly?ch(sf,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==Ht.WHEEL)return!0;const n=t.map,r=t.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let l;if(t.type==Ht.WHEEL&&(l=r.deltaY,t1&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(l/=E0),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(l*=40)),l===0)return!1;this.lastDelta_=l;const u=Date.now();this.startTime_===void 0&&(this.startTime_=u),(!this.mode_||u-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(l)<4?"trackpad":"wheel");const g=n.getView();if(this.mode_==="trackpad"&&!(g.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(g.getAnimating()&&g.cancelAnimations(),g.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),g.adjustZoom(-l/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=u,!1;this.totalDelta_+=l;const m=Math.max(this.timeout_-(u-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),m),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let n=-ei(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),sc(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}const $2=J2;class tm extends Fo{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=La),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const n=this.targetPointers[0],r=this.targetPointers[1],l=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(this.lastAngle_!==void 0){const m=l-this.lastAngle_;this.rotationDelta_+=m,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=m}this.lastAngle_=l;const u=t.map,g=u.getView();g.getConstraints().rotation!==$h&&(this.anchor_=u.getCoordinateFromPixelInternal(u.getEventPixel(rc(this.targetPointers))),this.rotating_&&(u.render(),g.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class em extends Fo{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=La),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const n=this.targetPointers[0],r=this.targetPointers[1],l=n.clientX-r.clientX,u=n.clientY-r.clientY,g=Math.sqrt(l*l+u*u);this.lastDistance_!==void 0&&(e=this.lastDistance_/g),this.lastDistance_=g;const m=t.map,p=m.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=m.getCoordinateFromPixelInternal(m.getEventPixel(rc(this.targetPointers))),m.render(),p.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const n=t.map.getView(),r=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}const im=em;function nm(s){s=s||{};const t=new Bn,e=new _2(-.005,.05,100);return(s.altShiftDragRotate!==void 0?s.altShiftDragRotate:!0)&&t.push(new X2),(s.doubleClickZoom!==void 0?s.doubleClickZoom:!0)&&t.push(new P2({delta:s.zoomDelta,duration:s.zoomDuration})),(s.dragPan!==void 0?s.dragPan:!0)&&t.push(new W2({onFocusOnly:s.onFocusOnly,kinetic:e})),(s.pinchRotate!==void 0?s.pinchRotate:!0)&&t.push(new tm),(s.pinchZoom!==void 0?s.pinchZoom:!0)&&t.push(new im({duration:s.zoomDuration})),(s.keyboard!==void 0?s.keyboard:!0)&&(t.push(new K2),t.push(new Q2({delta:s.zoomDelta,duration:s.zoomDuration}))),(s.mouseWheelZoom!==void 0?s.mouseWheelZoom:!0)&&t.push(new $2({onFocusOnly:s.onFocusOnly,duration:s.zoomDuration})),(s.shiftDragZoom!==void 0?s.shiftDragZoom:!0)&&t.push(new Z2({duration:s.zoomDuration})),t}function lf(s){if(s instanceof Qa){s.setMapInternal(null);return}s instanceof Yr&&s.getLayers().forEach(lf)}function hf(s,t){if(s instanceof Qa){s.setMapInternal(t);return}if(s instanceof Yr){const e=s.getLayers().getArray();for(let n=0,r=e.length;n<r;++n)hf(e[n],t)}}let sm=class extends bn{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=rm(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:E0,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Mn(),this.pixelToCoordinateTransform_=Mn(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||O2(),this.interactions=e.interactions||nm({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new I2(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Oi.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Oi.VIEW,this.handleViewChanged_),this.addChangeListener(Oi.SIZE,this.handleSizeChanged_),this.addChangeListener(Oi.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const n=this;t.view&&!(t.view instanceof Pn)&&t.view.then(function(r){n.setView(new Pn(r))}),this.controls.addEventListener(Wi.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(Wi.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(Wi.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(Wi.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(Wi.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(Wi.REMOVE,r=>{const l=r.element.getId();l!==void 0&&delete this.overlayIdIndex_[l.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){hf(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,n){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};const l=n.hitTolerance!==void 0?n.hitTolerance:0,u=n.layerFilter!==void 0?n.layerFilter:uo,g=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,l,g,e,null,u,null)}getFeaturesAtPixel(t,e){const n=[];return this.forEachFeatureAtPixel(t,function(r){n.push(r)},e),n}getAllLayers(){const t=[];function e(n){n.forEach(function(r){r instanceof Yr?e(r.getLayers()):t.push(r)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const r=e.layerFilter!==void 0?e.layerFilter:uo,l=e.hitTolerance!==void 0?e.hitTolerance:0,u=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,l,u,r,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const n=this.viewport_.getBoundingClientRect(),r=this.getSize(),l=n.width/r[0],u=n.height/r[1],g="changedTouches"in t?t.changedTouches[0]:t;return[(g.clientX-n.left)/l,(g.clientY-n.top)/u]}getTarget(){return this.get(Oi.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return th(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?Ai(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Oi.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof Bn){e.setLayers(t);return}const n=e.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const r=t[e];if(!r.visible)continue;const l=r.layer.getRenderer();if(l&&!l.ready)return!0;const u=r.layer.getSource();if(u&&u.loading)return!0}return!1}getPixelFromCoordinate(t){const e=ts(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?Ai(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Oi.SIZE)}getView(){return this.get(Oi.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,n,r){return M2(this.frameState_,t,e,n,r)}handleBrowserEvent(t,e){e=e||t.type;const n=new Ms(e,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,n=e.type;if(n===hh.POINTERDOWN||n===Ht.WHEEL||n===Ht.KEYDOWN){const r=this.getOwnerDocument(),l=this.viewport_.getRootNode?this.viewport_.getRootNode():r,u=e.target;if(this.overlayContainerStopEvent_.contains(u)||!(l===r?r.documentElement:l).contains(u))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const r=this.getInteractions().getArray().slice();for(let l=r.length-1;l>=0;l--){const u=r[l];if(u.getMap()!==this||!u.getActive()||!this.getTargetElement())continue;if(!u.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let r=this.maxTilesLoading_,l=r;if(t){const u=t.viewHints;if(u[Di.ANIMATING]||u[Di.INTERACTING]){const g=Date.now()-t.time>8;r=g?0:8,l=g?0:2}}e.getTilesLoading()<r&&(e.reprioritize(),e.loadMoreTiles(r,l))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(gn.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(gn.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Ar(is.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Ar(is.LOADSTART,this,t))));const n=this.postRenderFunctions_;for(let r=0,l=n.length;r<l;++r)n[r](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,r=this.targetChangeHandlerKeys_.length;n<r;++n)Fe(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Ht.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Ht.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,_a(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new w2(this)),this.mapBrowserEventHandler_=new C2(this,this.moveTolerance_);for(const l in $e)this.mapBrowserEventHandler_.addEventListener($e[l],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Ht.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Ht.WHEEL,this.boundHandleBrowserEvent_,A0?{passive:!1}:!1);const n=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[de(n,Ht.KEYDOWN,this.handleBrowserEvent,this),de(n,Ht.KEYPRESS,this.handleBrowserEvent,this)];const r=e.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Fe(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Fe(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=de(t,Nr.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=de(t,Ht.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Fe),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Ss("addlayer",t)),this.layerGroupPropertyListenerKeys_=[de(t,Nr.PROPERTYCHANGE,this.render,this),de(t,Ht.CHANGE,this.render,this),de(t,"addlayer",this.handleLayerAdd_,this),de(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const r=t[e].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){lf(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),n=this.getView(),r=this.frameState_;let l=null;if(e!==void 0&&Gc(e)&&n&&n.isDef()){const u=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),g=n.getState();if(l={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Kl(g.center,g.resolution,g.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:g,viewHints:u,wantedTiles:{},mapId:Me(this),renderTargets:{}},g.nextCenter&&g.nextResolution){const m=isNaN(g.nextRotation)?g.rotation:g.nextRotation;l.nextExtent=Kl(g.nextCenter,g.nextResolution,m,e)}}this.frameState_=l,this.renderer_.renderFrame(l),l&&(l.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,l.postRenderFunctions),r&&(!this.previousExtent_||!Ro(this.previousExtent_)&&!fo(l.extent,this.previousExtent_))&&(this.dispatchEvent(new Ar(is.MOVESTART,this,r)),this.previousExtent_=Wr(this.previousExtent_)),this.previousExtent_&&!l.viewHints[Di.ANIMATING]&&!l.viewHints[Di.INTERACTING]&&!fo(l.extent,this.previousExtent_)&&(this.dispatchEvent(new Ar(is.MOVEEND,this,l)),Hu(l.extent,this.previousExtent_))),this.dispatchEvent(new Ar(is.POSTRENDER,this,l)),this.renderComplete_=this.hasListener(is.LOADSTART)||this.hasListener(is.LOADEND)||this.hasListener(gn.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Ss("removelayer",e)),this.set(Oi.LAYERGROUP,t)}setSize(t){this.set(Oi.SIZE,t)}setTarget(t){this.set(Oi.TARGET,t)}setView(t){if(!t||t instanceof Pn){this.set(Oi.VIEW,t);return}this.set(Oi.VIEW,new Pn);const e=this;t.then(function(n){e.setView(new Pn(n))})}updateSize(){const t=this.getTargetElement();let e;if(t){const r=getComputedStyle(t),l=t.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),u=t.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);!isNaN(l)&&!isNaN(u)&&(e=[l,u],!Gc(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&n0("No map visible because the map container's width or height are 0."))}const n=this.getSize();e&&(!n||!Fs(e,n))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}};function rm(s){let t=null;s.keyboardEventTarget!==void 0&&(t=typeof s.keyboardEventTarget=="string"?document.getElementById(s.keyboardEventTarget):s.keyboardEventTarget);const e={},n=s.layers&&typeof s.layers.getLayers=="function"?s.layers:new Yr({layers:s.layers});e[Oi.LAYERGROUP]=n,e[Oi.TARGET]=s.target,e[Oi.VIEW]=s.view instanceof Pn?s.view:new Pn;let r;s.controls!==void 0&&(Array.isArray(s.controls)?r=new Bn(s.controls.slice()):(pe(typeof s.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=s.controls));let l;s.interactions!==void 0&&(Array.isArray(s.interactions)?l=new Bn(s.interactions.slice()):(pe(typeof s.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),l=s.interactions));let u;return s.overlays!==void 0?Array.isArray(s.overlays)?u=new Bn(s.overlays.slice()):(pe(typeof s.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),u=s.overlays):u=new Bn,{controls:r,interactions:l,keyboardEventTarget:t,overlays:u,values:e}}const om=sm,vi={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class am extends bn{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+g1,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(vi.ELEMENT,this.handleElementChanged),this.addChangeListener(vi.MAP,this.handleMapChanged),this.addChangeListener(vi.OFFSET,this.handleOffsetChanged),this.addChangeListener(vi.POSITION,this.handlePositionChanged),this.addChangeListener(vi.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(vi.ELEMENT)}getId(){return this.id}getMap(){return this.get(vi.MAP)||null}getOffset(){return this.get(vi.OFFSET)}getPosition(){return this.get(vi.POSITION)}getPositioning(){return this.get(vi.POSITIONING)}handleElementChanged(){I0(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(_a(this.element),Fe(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=de(t,is.POSTRENDER,this.render,this),this.updatePixelPosition();const e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(vi.ELEMENT,t)}setMap(t){this.set(vi.MAP,t)}setOffset(t){this.set(vi.OFFSET,t)}setPosition(t){this.set(vi.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(vi.POSITION))return;const n=this.getRect(e.getTargetElement(),e.getSize()),r=this.getElement(),l=this.getRect(r,[n1(r),s1(r)]);t=t||{};const u=t.margin===void 0?20:t.margin;if(!Zs(n,l)){const g=l[0]-n[0],m=n[2]-l[2],p=l[1]-n[1],E=n[3]-l[3],A=[0,0];if(g<0?A[0]=g-u:m<0&&(A[0]=Math.abs(m)+u),p<0?A[1]=p-u:E<0&&(A[1]=Math.abs(E)+u),A[0]!==0||A[1]!==0){const b=e.getView().getCenterInternal(),D=e.getPixelFromCoordinateInternal(b);if(!D)return;const P=[D[0]+A[0],D[1]+A[1]],F=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(P),duration:F.duration,easing:F.easing})}}}getRect(t,e){const n=t.getBoundingClientRect(),r=n.left+window.pageXOffset,l=n.top+window.pageYOffset;return[r,l,r+e[0],l+e[1]]}setPositioning(t){this.set(vi.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}const n=t.getPixelFromCoordinate(e),r=t.getSize();this.updateRenderedPosition(n,r)}updateRenderedPosition(t,e){const n=this.element.style,r=this.getOffset(),l=this.getPositioning();this.setVisible(!0);const u=Math.round(t[0]+r[0])+"px",g=Math.round(t[1]+r[1])+"px";let m="0%",p="0%";l=="bottom-right"||l=="center-right"||l=="top-right"?m="-100%":(l=="bottom-center"||l=="center-center"||l=="top-center")&&(m="-50%"),l=="bottom-left"||l=="bottom-center"||l=="bottom-right"?p="-100%":(l=="center-left"||l=="center-center"||l=="center-right")&&(p="-50%");const E=`translate(${m}, ${p}) translate(${u}, ${g})`;this.rendered.transform_!=E&&(this.rendered.transform_=E,n.transform=E)}getOptions(){return this.options}}class lm{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return pe(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return pe(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){pe(!(t in this.entries_),"Tried to set a value for a key that is used already");const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}function gu(s,t,e,n){return n!==void 0?(n[0]=s,n[1]=t,n[2]=e,n):[s,t,e]}function il(s,t,e){return s+"/"+t+"/"+e}function cf(s){return il(s[0],s[1],s[2])}function hm(s){return s.split("/").map(Number)}function cm(s){return(s[1]<<s[0])+s[2]}function um(s,t){const e=s[0],n=s[1],r=s[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const l=t.getFullTileRange(e);return l?l.containsXY(n,r):!0}class uf extends lm{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),n=hm(t)[0];this.forEach(r=>{r.tileCoord[0]!==n&&(this.remove(cf(r.tileCoord)),r.release())})}}class oc{constructor(t,e,n,r){this.minX=t,this.maxX=e,this.minY=n,this.maxY=r}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function _r(s,t,e,n,r){return r!==void 0?(r.minX=s,r.maxX=t,r.minY=e,r.maxY=n,r):new oc(s,t,e,n)}const aa={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class fm extends Qa{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(aa.PRELOAD)}setPreload(t){this.set(aa.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(aa.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(aa.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const dm=.5,gm=10,mu=.25;class mm{constructor(t,e,n,r,l,u){this.sourceProj_=t,this.targetProj_=e;let g={};const m=Pr(this.targetProj_,this.sourceProj_);this.transformInv_=function(G){const X=G[0]+"/"+G[1];return g[X]||(g[X]=m(G)),g[X]},this.maxSourceExtent_=r,this.errorThresholdSquared_=l*l,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&we(r)>=we(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?we(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?we(this.targetProj_.getExtent()):null;const p=nr(n),E=Ua(n),A=ka(n),b=Ba(n),D=this.transformInv_(p),P=this.transformInv_(E),F=this.transformInv_(A),z=this.transformInv_(b),j=gm+(u?Math.max(0,Math.ceil(Math.log2(Zl(n)/(u*u*256*256)))):0);if(this.addQuad_(p,E,A,b,D,P,F,z,j),this.wrapsXInSource_){let G=1/0;this.triangles_.forEach(function(X,Y,Q){G=Math.min(G,X.source[0][0],X.source[1][0],X.source[2][0])}),this.triangles_.forEach(X=>{if(Math.max(X.source[0][0],X.source[1][0],X.source[2][0])-G>this.sourceWorldWidth_/2){const Y=[[X.source[0][0],X.source[0][1]],[X.source[1][0],X.source[1][1]],[X.source[2][0],X.source[2][1]]];Y[0][0]-G>this.sourceWorldWidth_/2&&(Y[0][0]-=this.sourceWorldWidth_),Y[1][0]-G>this.sourceWorldWidth_/2&&(Y[1][0]-=this.sourceWorldWidth_),Y[2][0]-G>this.sourceWorldWidth_/2&&(Y[2][0]-=this.sourceWorldWidth_);const Q=Math.min(Y[0][0],Y[1][0],Y[2][0]);Math.max(Y[0][0],Y[1][0],Y[2][0])-Q<this.sourceWorldWidth_/2&&(X.source=Y)}})}g={}}addTriangle_(t,e,n,r,l,u){this.triangles_.push({source:[r,l,u],target:[t,e,n]})}addQuad_(t,e,n,r,l,u,g,m,p){const E=Ic([l,u,g,m]),A=this.sourceWorldWidth_?we(E)/this.sourceWorldWidth_:null,b=this.sourceWorldWidth_,D=this.sourceProj_.canWrapX()&&A>.5&&A<1;let P=!1;if(p>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const z=Ic([t,e,n,r]);P=we(z)/this.targetWorldWidth_>mu||P}!D&&this.sourceProj_.isGlobal()&&A&&(P=A>mu||P)}if(!P&&this.maxSourceExtent_&&isFinite(E[0])&&isFinite(E[1])&&isFinite(E[2])&&isFinite(E[3])&&!Vi(E,this.maxSourceExtent_))return;let F=0;if(!P&&(!isFinite(l[0])||!isFinite(l[1])||!isFinite(u[0])||!isFinite(u[1])||!isFinite(g[0])||!isFinite(g[1])||!isFinite(m[0])||!isFinite(m[1]))){if(p>0)P=!0;else if(F=(!isFinite(l[0])||!isFinite(l[1])?8:0)+(!isFinite(u[0])||!isFinite(u[1])?4:0)+(!isFinite(g[0])||!isFinite(g[1])?2:0)+(!isFinite(m[0])||!isFinite(m[1])?1:0),F!=1&&F!=2&&F!=4&&F!=8)return}if(p>0){if(!P){const z=[(t[0]+n[0])/2,(t[1]+n[1])/2],j=this.transformInv_(z);let G;D?G=(Rr(l[0],b)+Rr(g[0],b))/2-Rr(j[0],b):G=(l[0]+g[0])/2-j[0];const X=(l[1]+g[1])/2-j[1];P=G*G+X*X>this.errorThresholdSquared_}if(P){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const z=[(e[0]+n[0])/2,(e[1]+n[1])/2],j=this.transformInv_(z),G=[(r[0]+t[0])/2,(r[1]+t[1])/2],X=this.transformInv_(G);this.addQuad_(t,e,z,G,l,u,j,X,p-1),this.addQuad_(G,z,n,r,X,j,g,m,p-1)}else{const z=[(t[0]+e[0])/2,(t[1]+e[1])/2],j=this.transformInv_(z),G=[(n[0]+r[0])/2,(n[1]+r[1])/2],X=this.transformInv_(G);this.addQuad_(t,z,G,r,l,j,X,m,p-1),this.addQuad_(z,e,n,G,j,u,g,X,p-1)}return}}if(D){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}F&11||this.addTriangle_(t,n,r,l,g,m),F&14||this.addTriangle_(t,n,e,l,g,u),F&&(F&13||this.addTriangle_(e,r,t,u,m,l),F&7||this.addTriangle_(e,r,n,u,m,g))}calculateSourceExtent(){const t=mn();return this.triangles_.forEach(function(e,n,r){const l=e.source;ao(t,l[0]),ao(t,l[1]),ao(t,l[2])}),t}getTriangles(){return this.triangles_}}let Bl;const vr=[];function xu(s,t,e,n,r){s.beginPath(),s.moveTo(0,0),s.lineTo(t,e),s.lineTo(n,r),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(t,n)+1,Math.max(e,r)),s.restore()}function kl(s,t){return Math.abs(s[t*4]-210)>2||Math.abs(s[t*4+3]-.75*255)>2}function xm(){if(Bl===void 0){const s=Mi(6,6,vr);s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",xu(s,4,5,4,0),xu(s,4,5,0,5);const t=s.getImageData(0,0,3,3).data;Bl=kl(t,0)||kl(t,4)||kl(t,8),Xa(s),vr.push(s.canvas)}return Bl}function pu(s,t,e,n){const r=Td(e,t,s);let l=Rc(t,n,e);const u=t.getMetersPerUnit();u!==void 0&&(l*=u);const g=s.getMetersPerUnit();g!==void 0&&(l/=g);const m=s.getExtent();if(!m||Dr(m,r)){const p=Rc(s,l,r)/l;isFinite(p)&&p>0&&(l/=p)}return l}function pm(s,t,e,n){const r=Os(e);let l=pu(s,t,r,n);return(!isFinite(l)||l<=0)&&Qu(e,function(u){return l=pu(s,t,u,n),isFinite(l)&&l>0}),l}function _m(s,t,e,n,r,l,u,g,m,p,E,A,b,D){const P=Mi(Math.round(e*s),Math.round(e*t),vr);if(A||(P.imageSmoothingEnabled=!1),m.length===0)return P.canvas;P.scale(e,e);function F(Q){return Math.round(Q*e)/e}P.globalCompositeOperation="lighter";const z=mn();m.forEach(function(Q,rt,K){Ku(z,Q.extent)});let j;const G=e/n,X=(A?1:1+Math.pow(2,-24))/G;if(!b||m.length!==1||p!==0){if(j=Mi(Math.round(we(z)*G),Math.round(Li(z)*G),vr),A||(j.imageSmoothingEnabled=!1),r&&D){const Q=(r[0]-z[0])*G,rt=-(r[3]-z[3])*G,K=we(r)*G,ot=Li(r)*G;j.rect(Q,rt,K,ot),j.clip()}m.forEach(function(Q,rt,K){if(Q.image.width>0&&Q.image.height>0){if(Q.clipExtent){j.save();const ut=(Q.clipExtent[0]-z[0])*G,yt=-(Q.clipExtent[3]-z[3])*G,Nt=we(Q.clipExtent)*G,J=Li(Q.clipExtent)*G;j.rect(A?ut:Math.round(ut),A?yt:Math.round(yt),A?Nt:Math.round(ut+Nt)-Math.round(ut),A?J:Math.round(yt+J)-Math.round(yt)),j.clip()}const ot=(Q.extent[0]-z[0])*G,Z=-(Q.extent[3]-z[3])*G,Ot=we(Q.extent)*G,St=Li(Q.extent)*G;j.drawImage(Q.image,p,p,Q.image.width-2*p,Q.image.height-2*p,A?ot:Math.round(ot),A?Z:Math.round(Z),A?Ot:Math.round(ot+Ot)-Math.round(ot),A?St:Math.round(Z+St)-Math.round(Z)),Q.clipExtent&&j.restore()}})}const Y=nr(u);return g.getTriangles().forEach(function(Q,rt,K){const ot=Q.source,Z=Q.target;let Ot=ot[0][0],St=ot[0][1],ut=ot[1][0],yt=ot[1][1],Nt=ot[2][0],J=ot[2][1];const gt=F((Z[0][0]-Y[0])/l),Et=F(-(Z[0][1]-Y[1])/l),Wt=F((Z[1][0]-Y[0])/l),re=F(-(Z[1][1]-Y[1])/l),Ut=F((Z[2][0]-Y[0])/l),Jt=F(-(Z[2][1]-Y[1])/l),Ft=Ot,$t=St;Ot=0,St=0,ut-=Ft,yt-=$t,Nt-=Ft,J-=$t;const ft=[[ut,yt,0,0,Wt-gt],[Nt,J,0,0,Ut-gt],[0,0,ut,yt,re-Et],[0,0,Nt,J,Jt-Et]],ii=yd(ft);if(!ii)return;if(P.save(),P.beginPath(),xm()||!A){P.moveTo(Wt,re);const Oe=4,_e=gt-Wt,fi=Et-re;for(let Be=0;Be<Oe;Be++)P.lineTo(Wt+F((Be+1)*_e/Oe),re+F(Be*fi/(Oe-1))),Be!=Oe-1&&P.lineTo(Wt+F((Be+1)*_e/Oe),re+F((Be+1)*fi/(Oe-1)));P.lineTo(Ut,Jt)}else P.moveTo(Wt,re),P.lineTo(gt,Et),P.lineTo(Ut,Jt);P.clip(),P.transform(ii[0],ii[2],ii[1],ii[3],gt,Et),P.translate(z[0]-Ft,z[3]-$t);let Tt;if(j)Tt=j.canvas,P.scale(X,-X);else{const Oe=m[0],_e=Oe.extent;Tt=Oe.image,P.scale(we(_e)/Tt.width,-Li(_e)/Tt.height)}P.drawImage(Tt,0,0),P.restore()}),j&&(Xa(j),vr.push(j.canvas)),E&&(P.save(),P.globalCompositeOperation="source-over",P.strokeStyle="black",P.lineWidth=1,g.getTriangles().forEach(function(Q,rt,K){const ot=Q.target,Z=(ot[0][0]-Y[0])/l,Ot=-(ot[0][1]-Y[1])/l,St=(ot[1][0]-Y[0])/l,ut=-(ot[1][1]-Y[1])/l,yt=(ot[2][0]-Y[0])/l,Nt=-(ot[2][1]-Y[1])/l;P.beginPath(),P.moveTo(St,ut),P.lineTo(Z,Ot),P.lineTo(yt,Nt),P.closePath(),P.stroke()}),P.restore()),P.canvas}class uh extends ef{constructor(t,e,n,r,l,u,g,m,p,E,A,b){super(l,kt.IDLE,b),this.renderEdges_=A!==void 0?A:!1,this.pixelRatio_=g,this.gutter_=m,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=r,this.wrappedTileCoord_=u||l,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const D=r.getTileCoordExtent(this.wrappedTileCoord_),P=this.targetTileGrid_.getExtent();let F=this.sourceTileGrid_.getExtent();const z=P?lo(D,P):D;if(Zl(z)===0){this.state=kt.EMPTY;return}const j=t.getExtent();j&&(F?F=lo(F,j):F=j);const G=r.getResolution(this.wrappedTileCoord_[0]),X=pm(t,n,z,G);if(!isFinite(X)||X<=0){this.state=kt.EMPTY;return}const Y=E!==void 0?E:dm;if(this.triangulation_=new mm(t,n,z,F,X*Y,G),this.triangulation_.getTriangles().length===0){this.state=kt.EMPTY;return}this.sourceZ_=e.getZForResolution(X);let Q=this.triangulation_.calculateSourceExtent();if(F&&(t.canWrapX()?(Q[1]=ei(Q[1],F[1],F[3]),Q[3]=ei(Q[3],F[1],F[3])):Q=lo(Q,F)),!Zl(Q))this.state=kt.EMPTY;else{let rt=0,K=0;t.canWrapX()&&(rt=we(j),K=Math.floor((Q[0]-j[0])/rt)),$u(Q.slice(),t,!0).forEach(Z=>{const Ot=e.getTileRangeForExtentAndZ(Z,this.sourceZ_);for(let St=Ot.minX;St<=Ot.maxX;St++)for(let ut=Ot.minY;ut<=Ot.maxY;ut++){const yt=p(this.sourceZ_,St,ut,g);if(yt){const Nt=K*rt;this.sourceTiles_.push({tile:yt,offset:Nt})}}++K}),this.sourceTiles_.length===0&&(this.state=kt.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{const n=e.tile;if(n&&n.getState()==kt.LOADED){const r=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);r[0]+=e.offset,r[2]+=e.offset;const l=this.clipExtent_?.slice();l&&(l[0]+=e.offset,l[2]+=e.offset),t.push({extent:r,clipExtent:l,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=kt.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),r=typeof n=="number"?n:n[0],l=typeof n=="number"?n:n[1],u=this.targetTileGrid_.getResolution(e),g=this.sourceTileGrid_.getResolution(this.sourceZ_),m=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=_m(r,l,this.pixelRatio_,g,this.sourceTileGrid_.getExtent(),u,m,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=kt.LOADED}this.changed()}load(){if(this.state==kt.IDLE){this.state=kt.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const n=e.getState();if(n==kt.IDLE||n==kt.LOADING){t++;const r=de(e,Ht.CHANGE,function(l){const u=e.getState();(u==kt.LOADED||u==kt.ERROR||u==kt.EMPTY)&&(Fe(r),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},n,r){e.getState()==kt.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Fe),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Xa(this.canvas_.getContext("2d")),vr.push(this.canvas_),this.canvas_=null),super.release()}}class ym extends Y0{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=mn(),this.tmpTileRange_=new oc(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),n=t.getState(),r=e.getUseInterimTilesOnError();return n==kt.LOADED||n==kt.EMPTY||n==kt.ERROR&&!r}getTile(t,e,n,r){const l=r.pixelRatio,u=r.viewState.projection,g=this.getLayer();let p=g.getSource().getTile(t,e,n,l,u);return p.getState()==kt.ERROR&&g.getUseInterimTilesOnError()&&g.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(p)||(p=p.getInterimTile()),p}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),r=Ai(e.pixelToCoordinateTransform,t.slice()),l=n.getExtent();if(l&&!Dr(l,r))return null;const u=e.pixelRatio,g=e.viewState.projection,m=e.viewState,p=n.getRenderSource(),E=p.getTileGridForProjection(m.projection),A=p.getTilePixelRatio(e.pixelRatio);for(let b=E.getZForResolution(m.resolution);b>=E.getMinZoom();--b){const D=E.getTileCoordForCoordAndZ(r,b),P=p.getTile(b,D[1],D[2],u,g);if(!(P instanceof nf||P instanceof uh)||P instanceof uh&&P.getState()===kt.EMPTY)return null;if(P.getState()!==kt.LOADED)continue;const F=E.getOrigin(b),z=sn(E.getTileSize(b)),j=E.getResolution(b),G=Math.floor(A*((r[0]-F[0])/j-D[1]*z[0])),X=Math.floor(A*((F[1]-r[1])/j-D[2]*z[1])),Y=Math.round(A*p.getGutterForProjection(m.projection));return this.getImageData(P.getImage(),G+Y,X+Y)}return null}loadedTileCallback(t,e,n){return this.isDrawableTile(n)?super.loadedTileCallback(t,e,n):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex],r=t.viewState,l=r.projection,u=r.resolution,g=r.center,m=r.rotation,p=t.pixelRatio,E=this.getLayer(),A=E.getSource(),b=A.getRevision(),D=A.getTileGridForProjection(l),P=D.getZForResolution(u,A.zDirection),F=D.getResolution(P);let z=t.extent;const j=t.viewState.resolution,G=A.getTilePixelRatio(p);this.prepareContainer(t,e);const X=this.context.canvas.width,Y=this.context.canvas.height,Q=n.extent&&Ks(n.extent);Q&&(z=lo(z,Ks(n.extent)));const rt=F*X/2/G,K=F*Y/2/G,ot=[g[0]-rt,g[1]-K,g[0]+rt,g[1]+K],Z=D.getTileRangeForExtentAndZ(z,P),Ot={};Ot[P]={};const St=this.createLoadedTileFinder(A,l,Ot),ut=this.tmpExtent,yt=this.tmpTileRange_;this.newTiles_=!1;const Nt=m?ql(r.center,j,m,t.size):void 0;for(let Jt=Z.minX;Jt<=Z.maxX;++Jt)for(let Ft=Z.minY;Ft<=Z.maxY;++Ft){if(m&&!D.tileCoordIntersectsViewport([P,Jt,Ft],Nt))continue;const $t=this.getTile(P,Jt,Ft,t);if(this.isDrawableTile($t)){const Tt=Me(this);if($t.getState()==kt.LOADED){Ot[P][$t.tileCoord.toString()]=$t;let Oe=$t.inTransition(Tt);Oe&&n.opacity!==1&&($t.endTransition(Tt),Oe=!1),!this.newTiles_&&(Oe||!this.renderedTiles.includes($t))&&(this.newTiles_=!0)}if($t.getAlpha(Tt,t.time)===1)continue}const ft=D.getTileCoordChildTileRange($t.tileCoord,yt,ut);let ii=!1;ft&&(ii=St(P+1,ft)),ii||D.forEachTileCoordParentTileRange($t.tileCoord,St,yt,ut)}const J=F/u*p/G,gt=this.getRenderContext(t);ls(this.tempTransform,X/2,Y/2,J,J,0,-X/2,-Y/2),Q&&this.clipUnrotated(gt,t,Q),A.getInterpolate()||(gt.imageSmoothingEnabled=!1),this.preRender(gt,t),this.renderedTiles.length=0;let Et=Object.keys(Ot).map(Number);Et.sort(rs);let Wt,re,Ut;n.opacity===1&&(!this.containerReused||A.getOpaque(t.viewState.projection))?Et=Et.reverse():(Wt=[],re=[]);for(let Jt=Et.length-1;Jt>=0;--Jt){const Ft=Et[Jt],$t=A.getTilePixelSize(Ft,p,l),ii=D.getResolution(Ft)/F,Tt=$t[0]*ii*J,Oe=$t[1]*ii*J,_e=D.getTileCoordForCoordAndZ(nr(ot),Ft),fi=D.getTileCoordExtent(_e),Be=Ai(this.tempTransform,[G*(fi[0]-ot[0])/F,G*(ot[3]-fi[3])/F]),Ze=G*A.getGutterForProjection(l),ze=Ot[Ft];for(const ie in ze){const di=ze[ie],li=di.tileCoord,_i=_e[1]-li[1],ke=Math.round(Be[0]-(_i-1)*Tt),le=_e[2]-li[2],te=Math.round(Be[1]-(le-1)*Oe),gi=Math.round(Be[0]-_i*Tt),Mt=Math.round(Be[1]-le*Oe),yi=ke-gi,on=te-Mt,hi=P===Ft,Bi=hi&&di.getAlpha(Me(this),t.time)!==1;let ni=!1;if(!Bi)if(Wt){Ut=[gi,Mt,gi+yi,Mt,gi+yi,Mt+on,gi,Mt+on];for(let Hi=0,Ke=Wt.length;Hi<Ke;++Hi)if(P!==Ft&&Ft<re[Hi]){const he=Wt[Hi];Vi([gi,Mt,gi+yi,Mt+on],[he[0],he[3],he[4],he[7]])&&(ni||(gt.save(),ni=!0),gt.beginPath(),gt.moveTo(Ut[0],Ut[1]),gt.lineTo(Ut[2],Ut[3]),gt.lineTo(Ut[4],Ut[5]),gt.lineTo(Ut[6],Ut[7]),gt.moveTo(he[6],he[7]),gt.lineTo(he[4],he[5]),gt.lineTo(he[2],he[3]),gt.lineTo(he[0],he[1]),gt.clip())}Wt.push(Ut),re.push(Ft)}else gt.clearRect(gi,Mt,yi,on);this.drawTileImage(di,t,gi,Mt,yi,on,Ze,hi),Wt&&!Bi?(ni&&gt.restore(),this.renderedTiles.unshift(di)):this.renderedTiles.push(di),this.updateUsedTiles(t.usedTiles,A,di)}}return this.renderedRevision=b,this.renderedResolution=F,this.extentChanged=!this.renderedExtent_||!fo(this.renderedExtent_,ot),this.renderedExtent_=ot,this.renderedPixelRatio=p,this.renderedProjection=l,this.manageTilePyramid(t,A,D,p,l,z,P,E.getPreload()),this.scheduleExpireCache(t,A),this.postRender(this.context,t),n.extent&&gt.restore(),gt.imageSmoothingEnabled=!0,this.container}drawTileImage(t,e,n,r,l,u,g,m){const p=this.getTileImage(t);if(!p)return;const E=this.getRenderContext(e),A=Me(this),b=e.layerStatesArray[e.layerIndex],D=b.opacity*(m?t.getAlpha(A,e.time):1),P=D!==E.globalAlpha;P&&(E.save(),E.globalAlpha=D),E.drawImage(p,g,g,p.width-2*g,p.height-2*g,n,r,l,u),P&&E.restore(),D!==b.opacity?e.animate=!0:m&&t.endTransition(A)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const n=function(r,l,u){const g=Me(r);g in u.usedTiles&&r.expireCache(u.viewState.projection,u.usedTiles[g])}.bind(null,e);t.postRenderFunctions.push(n)}}updateUsedTiles(t,e,n){const r=Me(e);r in t||(t[r]={}),t[r][n.getKey()]=!0}manageTilePyramid(t,e,n,r,l,u,g,m,p){const E=Me(e);E in t.wantedTiles||(t.wantedTiles[E]={});const A=t.wantedTiles[E],b=t.tileQueue,D=n.getMinZoom(),P=t.viewState.rotation,F=P?ql(t.viewState.center,t.viewState.resolution,P,t.size):void 0;let z=0,j,G,X,Y,Q,rt;for(rt=D;rt<=g;++rt)for(G=n.getTileRangeForExtentAndZ(u,rt,G),X=n.getResolution(rt),Y=G.minX;Y<=G.maxX;++Y)for(Q=G.minY;Q<=G.maxY;++Q)P&&!n.tileCoordIntersectsViewport([rt,Y,Q],F)||(g-rt<=m?(++z,j=e.getTile(rt,Y,Q,r,l),j.getState()==kt.IDLE&&(A[j.getKey()]=!0,b.isKeyQueued(j.getKey())||b.enqueue([j,E,n.getTileCoordCenter(j.tileCoord),X])),p!==void 0&&p(j)):e.useTile(rt,Y,Q,l));e.updateCacheSize(z,l)}}class Em extends fm{constructor(t){super(t)}createRenderer(){return new ym(this)}}const wm=Em,Ul={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},yr=[0,0,0],As=5;class Cm{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,pe(Kf(this.resolutions_,(r,l)=>l-r,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let r=0,l=this.resolutions_.length-1;r<l;++r)if(!e)e=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,pe(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=nr(n)),pe(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,pe(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:qh,pe(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((r,l)=>{const u=new oc(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(n){const g=this.getTileRangeForExtentAndZ(n,l);u.minX=Math.max(g.minX,u.minX),u.maxX=Math.min(g.maxX,u.maxX),u.minY=Math.max(g.minY,u.minY),u.maxY=Math.min(g.maxY,u.maxY)}return u}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const r=this.getTileRangeForExtentAndZ(t,e);for(let l=r.minX,u=r.maxX;l<=u;++l)for(let g=r.minY,m=r.maxY;g<=m;++g)n([e,l,g])}forEachTileCoordParentTileRange(t,e,n,r){let l,u,g,m=null,p=t[0]-1;for(this.zoomFactor_===2?(u=t[1],g=t[2]):m=this.getTileCoordExtent(t,r);p>=this.minZoom;){if(u!==void 0&&g!==void 0?(u=Math.floor(u/2),g=Math.floor(g/2),l=_r(u,u,g,g,n)):l=this.getTileRangeForExtentAndZ(m,p,n),e(p,l))return!0;--p}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const l=t[1]*2,u=t[2]*2;return _r(l,l+1,u,u+1,e)}const r=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const r=t[0],l=t[1],u=t[2];if(e===r)return _r(l,u,l,u,n);if(this.zoomFactor_){const m=Math.pow(this.zoomFactor_,e-r),p=Math.floor(l*m),E=Math.floor(u*m);if(e<r)return _r(p,p,E,E,n);const A=Math.floor(m*(l+1))-1,b=Math.floor(m*(u+1))-1;return _r(p,A,E,b,n)}const g=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(g,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,yr);const r=yr[1],l=yr[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,yr);const u=yr[1],g=yr[2];return _r(r,u,l,g,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=sn(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*n,e[1]-(t[2]+.5)*r[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),r=this.getResolution(t[0]),l=sn(this.getTileSize(t[0]),this.tmpSize_),u=n[0]+t[1]*l[0]*r,g=n[1]-(t[2]+1)*l[1]*r,m=u+l[0]*r,p=g+l[1]*r;return hs(u,g,m,p,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,r,l){const u=this.getZForResolution(n),g=n/this.getResolution(u),m=this.getOrigin(u),p=sn(this.getTileSize(u),this.tmpSize_);let E=g*(t-m[0])/n/p[0],A=g*(m[1]-e)/n/p[1];return r?(E=ta(E,As)-1,A=ta(A,As)-1):(E=$o(E,As),A=$o(A,As)),gu(u,E,A,l)}getTileCoordForXYAndZ_(t,e,n,r,l){const u=this.getOrigin(n),g=this.getResolution(n),m=sn(this.getTileSize(n),this.tmpSize_);let p=(t-u[0])/g/m[0],E=(u[1]-e)/g/m[1];return r?(p=ta(p,As)-1,E=ta(E,As)-1):(p=$o(p,As),E=$o(E,As)),gu(n,p,E,l)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=Mh(this.resolutions_,t,e||0);return ei(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return g0(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let r=this.minZoom;r<e;++r)n[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=n}}const ff=Cm;function df(s){let t=s.getDefaultTileGrid();return t||(t=Sm(s),s.setDefaultTileGrid(t)),t}function Am(s,t,e){const n=t[0],r=s.getTileCoordCenter(t),l=ac(e);if(!Dr(l,r)){const u=we(l),g=Math.ceil((l[0]-r[0])/u);return r[0]+=u*g,s.getTileCoordForCoordAndZ(r,n)}return t}function Im(s,t,e,n){n=n!==void 0?n:"top-left";const r=gf(s,t,e);return new ff({extent:s,origin:rd(s,n),resolutions:r,tileSize:e})}function Mm(s){const t=s||{},e=t.extent||Ge("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:gf(e,t.maxZoom,t.tileSize,t.maxResolution)};return new ff(n)}function gf(s,t,e,n){t=t!==void 0?t:A1,e=sn(e!==void 0?e:qh);const r=Li(s),l=we(s);n=n>0?n:Math.max(l/e[0],r/e[1]);const u=t+1,g=new Array(u);for(let m=0;m<u;++m)g[m]=n/Math.pow(2,m);return g}function Sm(s,t,e,n){const r=ac(s);return Im(r,t,e,n)}function ac(s){s=Ge(s);let t=s.getExtent();if(!t){const e=180*go.degrees/s.getMetersPerUnit();t=hs(-e,-e,e,e)}return t}class Tm extends tf{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&sn(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new uf(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,r){const l=this.getTileCacheForProjection(t);if(!l)return!1;let u=!0,g,m,p;for(let E=n.minX;E<=n.maxX;++E)for(let A=n.minY;A<=n.maxY;++A)m=il(e,E,A),p=!1,l.containsKey(m)&&(g=l.get(m),p=g.getState()===kt.LOADED,p&&(p=r(g)!==!1)),p||(u=!1);return u}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,r,l){return Xt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:df(t)}getTileCacheForProjection(t){const e=this.getProjection();return pe(e===null||Hs(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const r=this.getTileGridForProjection(n),l=this.getTilePixelRatio(e),u=sn(r.getTileSize(t),this.tmpSize);return l==1?u:f1(u,l,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=Am(n,t,e)),um(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,r){}}class bm extends cs{constructor(t,e){super(t),this.tile=e}}function Rm(s,t){const e=/\{z\}/g,n=/\{x\}/g,r=/\{y\}/g,l=/\{-y\}/g;return function(u,g,m){if(u)return s.replace(e,u[0].toString()).replace(n,u[1].toString()).replace(r,u[2].toString()).replace(l,function(){const p=u[0],E=t.getFullTileRange(p);if(!E)throw new Error("The {-y} placeholder requires a tile grid with extent");return(E.getHeight()-u[2]-1).toString()})}}function vm(s,t){const e=s.length,n=new Array(e);for(let r=0;r<e;++r)n[r]=Rm(s[r],t);return Nm(n)}function Nm(s){return s.length===1?s[0]:function(t,e,n){if(!t)return;const r=cm(t),l=Rr(r,s.length);return s[l](t,e,n)}}function Om(s){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(s);if(e){const n=e[1].charCodeAt(0),r=e[2].charCodeAt(0);let l;for(l=n;l<=r;++l)t.push(s.replace(e[0],String.fromCharCode(l)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(s),e){const n=parseInt(e[2],10);for(let r=parseInt(e[1],10);r<=n;r++)t.push(s.replace(e[0],r.toString()));return t}return t.push(s),t}class lc extends Tm{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===lc.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=Me(e),r=e.getState();let l;r==kt.LOADING?(this.tileLoadingKeys_[n]=!0,l=Ul.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],l=r==kt.ERROR?Ul.TILELOADERROR:r==kt.LOADED?Ul.TILELOADEND:void 0),l!=null&&this.dispatchEvent(new bm(l,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=Om(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(vm(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const r=il(t,e,n);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}class Dm extends lc{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Lm,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:nf,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const r in this.tileCacheForProjection){const l=this.tileCacheForProjection[r];l.expireCache(l==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Hs(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!Hs(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Hs(e,t)))return this.tileGrid;const n=Me(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=df(t)),this.tileGridForProjection[n]}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Hs(e,t))return this.tileCache;const n=Me(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new uf(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(t,e,n,r,l,u){const g=[t,e,n],m=this.getTileCoordForTileUrlFunction(g,l),p=m?this.tileUrlFunction(m,r,l):void 0,E=new this.tileClass(g,p!==void 0?kt.IDLE:kt.EMPTY,p!==void 0?p:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return E.key=u,E.addEventListener(Ht.CHANGE,this.handleTileChange.bind(this)),E}getTile(t,e,n,r,l){const u=this.getProjection();if(!u||!l||Hs(u,l))return this.getTileInternal(t,e,n,r,u||l);const g=this.getTileCacheForProjection(l),m=[t,e,n];let p;const E=cf(m);g.containsKey(E)&&(p=g.get(E));const A=this.getKey();if(p&&p.key==A)return p;const b=this.getTileGridForProjection(u),D=this.getTileGridForProjection(l),P=this.getTileCoordForTileUrlFunction(m,l),F=new uh(u,b,l,D,m,P,this.getTilePixelRatio(r),this.getGutter(),(z,j,G,X)=>this.getTileInternal(z,j,G,X,u),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return F.key=A,p?(F.interimTile=p,F.refreshInterimChain(),g.replace(E,F)):g.set(E,F),F}getTileInternal(t,e,n,r,l){let u=null;const g=il(t,e,n),m=this.getKey();if(!this.tileCache.containsKey(g))u=this.createTile_(t,e,n,r,l,m),this.tileCache.set(g,u);else if(u=this.tileCache.get(g),u.key!=m){const p=u;u=this.createTile_(t,e,n,r,l,m),p.getState()==kt.IDLE?u.interimTile=p.interimTile:u.interimTile=p,u.refreshInterimChain(),this.tileCache.replace(g,u)}return u}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const n=Ge(t);if(n){const r=Me(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function Lm(s,t){s.getImage().src=t}class Pm extends Dm{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:Mm({extent:ac(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}class Fm{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Fa,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?Ge(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=Ge(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return Xt()}readFeature(t,e){return Xt()}readFeatures(t,e){return Xt()}readGeometry(t,e){return Xt()}readProjection(t){return Xt()}writeFeature(t,e){return Xt()}writeFeatures(t,e){return Xt()}writeGeometry(t,e){return Xt()}}function hc(s,t,e){const n=e?Ge(e.featureProjection):null,r=e?Ge(e.dataProjection):null;let l=s;if(n&&r&&!Hs(n,r)){t&&(l=s.clone());const u=t?n:r,g=t?r:n;u.getUnits()==="tile-pixels"?l.transform(u,g):l.applyTransform(Pr(u,g))}if(t&&e&&e.decimals!==void 0){const u=Math.pow(10,e.decimals),g=function(m){for(let p=0,E=m.length;p<E;++p)m[p]=Math.round(m[p]*u)/u;return m};l===s&&(l=s.clone()),l.applyTransform(g)}return l}const Bm={Point:Fr,LineString:sh,Polygon:Ds,MultiPoint:J0,MultiLineString:u2,MultiPolygon:f2};function km(s,t,e){return Array.isArray(t[0])?(x0(s,0,t,e)||(s=s.slice(),ih(s,0,t,e)),s):(Wh(s,0,t,e)||(s=s.slice(),xa(s,0,t,e)),s)}function mf(s,t){const e=s.geometry;if(!e)return[];if(Array.isArray(e))return e.map(l=>mf({...s,geometry:l})).flat();const n=e.type==="MultiPolygon"?"Polygon":e.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const r=e.layout.length;return hc(new ji(n,n==="Polygon"?km(e.flatCoordinates,e.ends,r):e.flatCoordinates,e.ends?.flat(),r,s.properties||{},s.id).enableSimplifyTransformed(),!1,t)}function cc(s,t){if(!s)return null;if(Array.isArray(s)){const n=s.map(r=>cc(r,t));return new c2(n)}const e=Bm[s.type];return hc(new e(s.flatCoordinates,s.layout,s.ends),!1,t)}class Um extends Fm{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(la(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(la(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return Xt()}readFeaturesFromObject(t,e){return Xt()}readGeometry(t,e){return this.readGeometryFromObject(la(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return Xt()}readProjection(t){return this.readProjectionFromObject(la(t))}readProjectionFromObject(t){return Xt()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return Xt()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return Xt()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return Xt()}}function la(s){if(typeof s=="string"){const t=JSON.parse(s);return t||null}return s!==null?s:null}class Gm extends Um{constructor(t){t=t||{},super(),this.dataProjection=Ge(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=Ge(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const r=uc(n.geometry);if(this.featureClass===ji)return mf({geometry:r,id:n.id,properties:n.properties},e);const l=new Fa;return this.geometryName_?l.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&l.setGeometryName(n.geometry_name),l.setGeometry(cc(r,e)),"id"in n&&l.setId(n.id),n.properties&&l.setProperties(n.properties,!0),l}readFeaturesFromObject(t,e){const n=t;let r=null;if(n.type==="FeatureCollection"){const l=t;r=[];const u=l.features;for(let g=0,m=u.length;g<m;++g){const p=this.readFeatureFromObject(u[g],e);p&&r.push(p)}}else r=[this.readFeatureFromObject(t,e)];return r.flat()}readGeometryFromObject(t,e){return zm(t,e)}readProjectionFromObject(t){const e=t.crs;let n;if(e)if(e.type=="name")n=Ge(e.properties.name);else if(e.type==="EPSG")n=Ge("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},r=t.getId();if(r!==void 0&&(n.id=r),!t.hasProperties())return n;const l=t.getProperties(),u=t.getGeometry();return u&&(n.geometry=fh(u,e),delete l[t.getGeometryName()]),er(l)||(n.properties=l),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let r=0,l=t.length;r<l;++r)n.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return fh(t,this.adaptOptions(e))}}function uc(s,t){if(!s)return null;let e;switch(s.type){case"Point":{e=Wm(s);break}case"LineString":{e=Xm(s);break}case"Polygon":{e=Zm(s);break}case"MultiPoint":{e=Ym(s);break}case"MultiLineString":{e=Vm(s);break}case"MultiPolygon":{e=Hm(s);break}case"GeometryCollection":{e=jm(s);break}default:throw new Error("Unsupported GeoJSON type: "+s.type)}return e}function zm(s,t){const e=uc(s);return cc(e,t)}function jm(s,t){return s.geometries.map(function(n){return uc(n)})}function Wm(s){const t=s.coordinates;return{type:"Point",flatCoordinates:t,layout:rr(t.length)}}function Xm(s){const t=s.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:rr(t[0]?.length||2)}}function Vm(s){const t=s.coordinates,e=t[0]?.[0]?.length||2,n=[],r=No(n,0,t,e);return{type:"MultiLineString",flatCoordinates:n,ends:r,layout:rr(e)}}function Ym(s){const t=s.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:rr(t[0]?.length||2)}}function Hm(s){const t=s.coordinates,e=[],n=t[0]?.[0]?.[0].length||2,r=l0(e,0,t,n);return{type:"MultiPolygon",flatCoordinates:e,ends:r,layout:rr(n)}}function Zm(s){const t=s.coordinates,e=[],n=t[0]?.[0]?.length,r=No(e,0,t,n);return{type:"Polygon",flatCoordinates:e,ends:r,layout:rr(n)}}function fh(s,t){s=hc(s,!0,t);const e=s.getType();let n;switch(e){case"Point":{n=tx(s);break}case"LineString":{n=qm(s);break}case"Polygon":{n=ex(s,t);break}case"MultiPoint":{n=Jm(s);break}case"MultiLineString":{n=Qm(s);break}case"MultiPolygon":{n=$m(s,t);break}case"GeometryCollection":{n=Km(s,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function Km(s,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:s.getGeometriesArray().map(function(n){return fh(n,t)})}}function qm(s,t){return{type:"LineString",coordinates:s.getCoordinates()}}function Qm(s,t){return{type:"MultiLineString",coordinates:s.getCoordinates()}}function Jm(s,t){return{type:"MultiPoint",coordinates:s.getCoordinates()}}function $m(s,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:s.getCoordinates(e)}}function tx(s,t){return{type:"Point",coordinates:s.getCoordinates()}}function ex(s,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:s.getCoordinates(e)}}var Ir=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xf(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var pf={exports:{}};(function(s,t){(function(e,n){s.exports=n()})(Ir,function(){function e(f,y){if(f[y])return f[y];for(var w,S=Object.keys(f),I=y.toLowerCase().replace(Te,""),v=-1;++v<S.length;)if(w=S[v],w.toLowerCase().replace(Te,"")===I)return f[w]}function n(f){if(typeof f!="string")throw new Error("not a string");this.text=f.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Xe}function r(f){return new n(f).output()}function l(f,y,w){Array.isArray(y)&&(w.unshift(y),y=null);var S=y?{}:f,I=w.reduce(function(v,O){return u(O,v),v},S);y&&(f[y]=I)}function u(f,y){if(Array.isArray(f)){var w=f.shift();if(w==="PARAMETER"&&(w=f.shift()),f.length===1)return Array.isArray(f[0])?(y[w]={},void u(f[0],y[w])):void(y[w]=f[0]);if(f.length)if(w!=="TOWGS84"){if(w==="AXIS")return w in y||(y[w]=[]),void y[w].push(f);Array.isArray(w)||(y[w]={});var S;switch(w){case"UNIT":case"PRIMEM":case"VERT_DATUM":return y[w]={name:f[0].toLowerCase(),convert:f[1]},void(f.length===3&&u(f[2],y[w]));case"SPHEROID":case"ELLIPSOID":return y[w]={name:f[0],a:f[1],rf:f[2]},void(f.length===4&&u(f[3],y[w]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return f[0]=["name",f[0]],void l(y,w,f);default:for(S=-1;++S<f.length;)if(!Array.isArray(f[S]))return u(f,y[w]);return l(y,w,f)}}else y[w]=f;else y[w]=!0}else y[f]=!0}function g(f,y){var w=y[0],S=y[1];!(w in f)&&S in f&&(f[w]=f[S],y.length===3&&(f[w]=y[2](f[w])))}function m(f){return f*gs}function p(f){function y(N){return N*(f.to_meter||1)}if(f.type==="GEOGCS"?f.projName="longlat":f.type==="LOCAL_CS"?(f.projName="identity",f.local=!0):typeof f.PROJECTION=="object"?f.projName=Object.keys(f.PROJECTION)[0]:f.projName=f.PROJECTION,f.AXIS){for(var w="",S=0,I=f.AXIS.length;S<I;++S){var v=[f.AXIS[S][0].toLowerCase(),f.AXIS[S][1].toLowerCase()];v[0].indexOf("north")!==-1||(v[0]==="y"||v[0]==="lat")&&v[1]==="north"?w+="n":v[0].indexOf("south")!==-1||(v[0]==="y"||v[0]==="lat")&&v[1]==="south"?w+="s":v[0].indexOf("east")!==-1||(v[0]==="x"||v[0]==="lon")&&v[1]==="east"?w+="e":v[0].indexOf("west")===-1&&(v[0]!=="x"&&v[0]!=="lon"||v[1]!=="west")||(w+="w")}w.length===2&&(w+="u"),w.length===3&&(f.axis=w)}f.UNIT&&(f.units=f.UNIT.name.toLowerCase(),f.units==="metre"&&(f.units="meter"),f.UNIT.convert&&(f.type==="GEOGCS"?f.DATUM&&f.DATUM.SPHEROID&&(f.to_meter=f.UNIT.convert*f.DATUM.SPHEROID.a):f.to_meter=f.UNIT.convert));var O=f.GEOGCS;f.type==="GEOGCS"&&(O=f),O&&(O.DATUM?f.datumCode=O.DATUM.name.toLowerCase():f.datumCode=O.name.toLowerCase(),f.datumCode.slice(0,2)==="d_"&&(f.datumCode=f.datumCode.slice(2)),f.datumCode!=="new_zealand_geodetic_datum_1949"&&f.datumCode!=="new_zealand_1949"||(f.datumCode="nzgd49"),f.datumCode!=="wgs_1984"&&f.datumCode!=="world_geodetic_system_1984"||(f.PROJECTION==="Mercator_Auxiliary_Sphere"&&(f.sphere=!0),f.datumCode="wgs84"),f.datumCode.slice(-6)==="_ferro"&&(f.datumCode=f.datumCode.slice(0,-6)),f.datumCode.slice(-8)==="_jakarta"&&(f.datumCode=f.datumCode.slice(0,-8)),~f.datumCode.indexOf("belge")&&(f.datumCode="rnb72"),O.DATUM&&O.DATUM.SPHEROID&&(f.ellps=O.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),f.ellps.toLowerCase().slice(0,13)==="international"&&(f.ellps="intl"),f.a=O.DATUM.SPHEROID.a,f.rf=parseFloat(O.DATUM.SPHEROID.rf,10)),O.DATUM&&O.DATUM.TOWGS84&&(f.datum_params=O.DATUM.TOWGS84),~f.datumCode.indexOf("osgb_1936")&&(f.datumCode="osgb36"),~f.datumCode.indexOf("osni_1952")&&(f.datumCode="osni52"),(~f.datumCode.indexOf("tm65")||~f.datumCode.indexOf("geodetic_datum_of_1965"))&&(f.datumCode="ire65"),f.datumCode==="ch1903+"&&(f.datumCode="ch1903"),~f.datumCode.indexOf("israel")&&(f.datumCode="isr93")),f.b&&!isFinite(f.b)&&(f.b=f.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",m],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",m],["x0","false_easting",y],["y0","false_northing",y],["long0","central_meridian",m],["lat0","latitude_of_origin",m],["lat0","standard_parallel_1",m],["lat1","standard_parallel_1",m],["lat2","standard_parallel_2",m],["azimuth","Azimuth"],["alpha","azimuth",m],["srsCode","name"]].forEach(function(N){return g(f,N)}),f.long0||!f.longc||f.projName!=="Albers_Conic_Equal_Area"&&f.projName!=="Lambert_Azimuthal_Equal_Area"||(f.long0=f.longc),f.lat_ts||!f.lat1||f.projName!=="Stereographic_South_Pole"&&f.projName!=="Polar Stereographic (variant B)"?!f.lat_ts&&f.lat0&&f.projName==="Polar_Stereographic"&&(f.lat_ts=f.lat0,f.lat0=m(f.lat0>0?90:-90)):(f.lat0=m(f.lat1>0?90:-90),f.lat_ts=f.lat1)}function E(f){var y=this;if(arguments.length===2){var w=arguments[1];typeof w=="string"?w.charAt(0)==="+"?E[f]=fe(arguments[1]):E[f]=Us(arguments[1]):E[f]=w}else if(arguments.length===1){if(Array.isArray(f))return f.map(function(S){Array.isArray(S)?E.apply(y,S):E(S)});if(typeof f=="string"){if(f in E)return E[f]}else"EPSG"in f?E["EPSG:"+f.EPSG]=f:"ESRI"in f?E["ESRI:"+f.ESRI]=f:"IAU2000"in f?E["IAU2000:"+f.IAU2000]=f:console.log(f);return}}function A(f){return typeof f=="string"}function b(f){return f in E}function D(f){return lr.some(function(y){return f.indexOf(y)>-1})}function P(f){var y=e(f,"authority");if(y){var w=e(y,"epsg");return w&&ln.indexOf(w)>-1}}function F(f){var y=e(f,"extension");if(y)return e(y,"proj4")}function z(f){return f[0]==="+"}function j(f){if(!A(f))return f;if(b(f))return E[f];if(D(f)){var y=Us(f);if(P(y))return E["EPSG:3857"];var w=F(y);return w?fe(w):y}return z(f)?fe(f):void 0}function G(f){return f}function X(f,y){var w=ct.length;return f.names?(ct[w]=f,f.names.forEach(function(S){xs[S.toLowerCase()]=w}),this):(console.log(y),!0)}function Y(f,y,w,S){var I=f*f,v=y*y,O=(I-v)/I,N=0;return S?(I=(f*=1-O*(Fi+O*(vn+O*ks)))*f,O=0):N=Math.sqrt(O),{es:O,e:N,ep2:(I-v)/v}}function Q(f,y,w,S,I){if(!f){var v=e(Rt,S);v||(v=ps),f=v.a,y=v.b,w=v.rf}return w&&!y&&(y=(1-1/w)*f),(w===0||Math.abs(f-y)<pt)&&(I=!0,y=f),{a:f,b:y,rf:w,sphere:I}}function rt(f,y,w,S,I,v,O){var N={};return N.datum_type=f===void 0||f==="none"?Rn:xn,y&&(N.datum_params=y.map(parseFloat),N.datum_params[0]===0&&N.datum_params[1]===0&&N.datum_params[2]===0||(N.datum_type=Se),N.datum_params.length>3&&(N.datum_params[3]===0&&N.datum_params[4]===0&&N.datum_params[5]===0&&N.datum_params[6]===0||(N.datum_type=ne,N.datum_params[3]*=an,N.datum_params[4]*=an,N.datum_params[5]*=an,N.datum_params[6]=N.datum_params[6]/1e6+1))),O&&(N.datum_type=ye,N.grids=O),N.a=w,N.b=S,N.es=I,N.ep2=v,N}function K(f){return f===void 0?null:f.split(",").map(ot)}function ot(f){if(f.length===0)return null;var y=f[0]==="@";return y&&(f=f.slice(1)),f==="null"?{name:"null",mandatory:!y,grid:null,isNull:!0}:{name:f,mandatory:!y,grid:ge[f]||null,isNull:!1}}function Z(f){return f/3600*Math.PI/180}function Ot(f){var y=f.getInt32(8,!1);return y!==11&&((y=f.getInt32(8,!0))!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function St(f,y){return{nFields:f.getInt32(8,y),nSubgridFields:f.getInt32(24,y),nSubgrids:f.getInt32(40,y),shiftType:ut(f,56,64).trim(),fromSemiMajorAxis:f.getFloat64(120,y),fromSemiMinorAxis:f.getFloat64(136,y),toSemiMajorAxis:f.getFloat64(152,y),toSemiMinorAxis:f.getFloat64(168,y)}}function ut(f,y,w){return String.fromCharCode.apply(null,new Uint8Array(f.buffer.slice(y,w)))}function yt(f,y,w){for(var S=176,I=[],v=0;v<y.nSubgrids;v++){var O=J(f,S,w),N=gt(f,S,O,w),U=Math.round(1+(O.upperLongitude-O.lowerLongitude)/O.longitudeInterval),W=Math.round(1+(O.upperLatitude-O.lowerLatitude)/O.latitudeInterval);I.push({ll:[Z(O.lowerLongitude),Z(O.lowerLatitude)],del:[Z(O.longitudeInterval),Z(O.latitudeInterval)],lim:[U,W],count:O.gridNodeCount,cvs:Nt(N)}),S+=176+16*O.gridNodeCount}return I}function Nt(f){return f.map(function(y){return[Z(y.longitudeShift),Z(y.latitudeShift)]})}function J(f,y,w){return{name:ut(f,y+8,y+16).trim(),parent:ut(f,y+24,y+24+8).trim(),lowerLatitude:f.getFloat64(y+72,w),upperLatitude:f.getFloat64(y+88,w),lowerLongitude:f.getFloat64(y+104,w),upperLongitude:f.getFloat64(y+120,w),latitudeInterval:f.getFloat64(y+136,w),longitudeInterval:f.getFloat64(y+152,w),gridNodeCount:f.getInt32(y+168,w)}}function gt(f,y,w,S){for(var I=y+176,v=[],O=0;O<w.gridNodeCount;O++){var N={latitudeShift:f.getFloat32(I+16*O,S),longitudeShift:f.getFloat32(I+16*O+4,S),latitudeAccuracy:f.getFloat32(I+16*O+8,S),longitudeAccuracy:f.getFloat32(I+16*O+12,S)};v.push(N)}return v}function Et(f,y){if(!(this instanceof Et))return new Et(f);y=y||function(W){if(W)throw W};var w=j(f);if(typeof w=="object"){var S=Et.projections.get(w.projName);if(S){if(w.datumCode&&w.datumCode!=="none"){var I=e(ri,w.datumCode);I&&(w.datum_params=w.datum_params||(I.towgs84?I.towgs84.split(","):null),w.ellps=I.ellipse,w.datumName=I.datumName?I.datumName:w.datumCode)}w.k0=w.k0||1,w.axis=w.axis||"enu",w.ellps=w.ellps||"wgs84",w.lat1=w.lat1||w.lat0;var v=Q(w.a,w.b,w.rf,w.ellps,w.sphere),O=Y(v.a,v.b,v.rf,w.R_A),N=K(w.nadgrids),U=w.datum||rt(w.datumCode,w.datum_params,v.a,v.b,O.es,O.ep2,N);Uo(this,w),Uo(this,S),this.a=v.a,this.b=v.b,this.rf=v.rf,this.sphere=v.sphere,this.es=O.es,this.e=O.e,this.ep2=O.ep2,this.datum=U,this.init(),y(null,this)}else y(f)}else y(f)}function Wt(f,y){return f.datum_type===y.datum_type&&!(f.a!==y.a||Math.abs(f.es-y.es)>5e-11)&&(f.datum_type===Se?f.datum_params[0]===y.datum_params[0]&&f.datum_params[1]===y.datum_params[1]&&f.datum_params[2]===y.datum_params[2]:f.datum_type!==ne||f.datum_params[0]===y.datum_params[0]&&f.datum_params[1]===y.datum_params[1]&&f.datum_params[2]===y.datum_params[2]&&f.datum_params[3]===y.datum_params[3]&&f.datum_params[4]===y.datum_params[4]&&f.datum_params[5]===y.datum_params[5]&&f.datum_params[6]===y.datum_params[6])}function re(f,y,w){var S,I,v,O,N=f.x,U=f.y,W=f.z?f.z:0;if(U<-at&&U>-1.001*at)U=-at;else if(U>at&&U<1.001*at)U=at;else{if(U<-at)return{x:-1/0,y:-1/0,z:f.z};if(U>at)return{x:1/0,y:1/0,z:f.z}}return N>Math.PI&&(N-=2*Math.PI),I=Math.sin(U),O=Math.cos(U),v=I*I,S=w/Math.sqrt(1-y*v),{x:(S+W)*O*Math.cos(N),y:(S+W)*O*Math.sin(N),z:(S*(1-y)+W)*I}}function Ut(f,y,w,S){var I,v,O,N,U,W,q,et,lt,mt,st,Ct,T,i,o,a,h=f.x,c=f.y,d=f.z?f.z:0;if(I=Math.sqrt(h*h+c*c),v=Math.sqrt(h*h+c*c+d*d),I/w<1e-12){if(i=0,v/w<1e-12)return o=at,a=-S,{x:f.x,y:f.y,z:f.z}}else i=Math.atan2(c,h);O=d/v,et=(N=I/v)*(1-y)*(U=1/Math.sqrt(1-y*(2-y)*N*N)),lt=O*U,T=0;do T++,W=y*(q=w/Math.sqrt(1-y*lt*lt))/(q+(a=I*et+d*lt-q*(1-y*lt*lt))),Ct=(st=O*(U=1/Math.sqrt(1-W*(2-W)*N*N)))*et-(mt=N*(1-W)*U)*lt,et=mt,lt=st;while(Ct*Ct>1e-24&&T<30);return o=Math.atan(st/Math.abs(mt)),{x:i,y:o,z:a}}function Jt(f,y,w){if(y===Se)return{x:f.x+w[0],y:f.y+w[1],z:f.z+w[2]};if(y===ne){var S=w[0],I=w[1],v=w[2],O=w[3],N=w[4],U=w[5],W=w[6];return{x:W*(f.x-U*f.y+N*f.z)+S,y:W*(U*f.x+f.y-O*f.z)+I,z:W*(-N*f.x+O*f.y+f.z)+v}}}function Ft(f,y,w){if(y===Se)return{x:f.x-w[0],y:f.y-w[1],z:f.z-w[2]};if(y===ne){var S=w[0],I=w[1],v=w[2],O=w[3],N=w[4],U=w[5],W=w[6],q=(f.x-S)/W,et=(f.y-I)/W,lt=(f.z-v)/W;return{x:q+U*et-N*lt,y:-U*q+et+O*lt,z:N*q-O*et+lt}}}function $t(f){return f===Se||f===ne}function ft(f,y,w){if(f.grids===null||f.grids.length===0)return console.log("Grid shift grids not found"),-1;var S={x:-w.x,y:w.y},I={x:Number.NaN,y:Number.NaN},v=[];t:for(var O=0;O<f.grids.length;O++){var N=f.grids[O];if(v.push(N.name),N.isNull){I=S;break}if(N.grid!==null)for(var U=N.grid.subgrids,W=0,q=U.length;W<q;W++){var et=U[W],lt=(Math.abs(et.del[1])+Math.abs(et.del[0]))/1e4,mt=et.ll[0]-lt,st=et.ll[1]-lt,Ct=et.ll[0]+(et.lim[0]-1)*et.del[0]+lt,T=et.ll[1]+(et.lim[1]-1)*et.del[1]+lt;if(!(st>S.y||mt>S.x||T<S.y||Ct<S.x)&&(I=ii(S,y,et),!isNaN(I.x)))break t}else if(N.mandatory)return console.log("Unable to find mandatory grid '"+N.name+"'"),-1}return isNaN(I.x)?(console.log("Failed to find a grid shift table for location '"+-S.x*ce+" "+S.y*ce+" tried: '"+v+"'"),-1):(w.x=-I.x,w.y=I.y,0)}function ii(f,y,w){var S={x:Number.NaN,y:Number.NaN};if(isNaN(f.x))return S;var I={x:f.x,y:f.y};I.x-=w.ll[0],I.y-=w.ll[1],I.x=It(I.x-Math.PI)+Math.PI;var v=Tt(I,w);if(y){if(isNaN(v.x))return S;v.x=I.x-v.x,v.y=I.y-v.y;var O,N,U=9;do{if(N=Tt(v,w),isNaN(N.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}O={x:I.x-(N.x+v.x),y:I.y-(N.y+v.y)},v.x+=O.x,v.y+=O.y}while(U--&&Math.abs(O.x)>1e-12&&Math.abs(O.y)>1e-12);if(U<0)return console.log("Inverse grid shift iterator failed to converge."),S;S.x=It(v.x+w.ll[0]),S.y=v.y+w.ll[1]}else isNaN(v.x)||(S.x=f.x+v.x,S.y=f.y+v.y);return S}function Tt(f,y){var w,S={x:f.x/y.del[0],y:f.y/y.del[1]},I={x:Math.floor(S.x),y:Math.floor(S.y)},v={x:S.x-1*I.x,y:S.y-1*I.y},O={x:Number.NaN,y:Number.NaN};if(I.x<0||I.x>=y.lim[0]||I.y<0||I.y>=y.lim[1])return O;w=I.y*y.lim[0]+I.x;var N={x:y.cvs[w][0],y:y.cvs[w][1]};w++;var U={x:y.cvs[w][0],y:y.cvs[w][1]};w+=y.lim[0];var W={x:y.cvs[w][0],y:y.cvs[w][1]};w--;var q={x:y.cvs[w][0],y:y.cvs[w][1]},et=v.x*v.y,lt=v.x*(1-v.y),mt=(1-v.x)*(1-v.y),st=(1-v.x)*v.y;return O.x=mt*N.x+lt*U.x+st*q.x+et*W.x,O.y=mt*N.y+lt*U.y+st*q.y+et*W.y,O}function Oe(f){if(typeof Number.isFinite=="function"){if(Number.isFinite(f))return;throw new TypeError("coordinates must be finite numbers")}if(typeof f!="number"||f!==f||!isFinite(f))throw new TypeError("coordinates must be finite numbers")}function _e(f,y){return(f.datum.datum_type===Se||f.datum.datum_type===ne||f.datum.datum_type===ye)&&y.datumCode!=="WGS84"||(y.datum.datum_type===Se||y.datum.datum_type===ne||y.datum.datum_type===ye)&&f.datumCode!=="WGS84"}function fi(f,y,w,S){var I,v=(w=Array.isArray(w)?hr(w):{x:w.x,y:w.y,z:w.z,m:w.m}).z!==void 0;if(Hr(w),f.datum&&y.datum&&_e(f,y)&&(w=fi(f,I=new Et("WGS84"),w,S),f=I),S&&f.axis!=="enu"&&(w=se(f,!1,w)),f.projName==="longlat")w={x:w.x*ue,y:w.y*ue,z:w.z||0};else if(f.to_meter&&(w={x:w.x*f.to_meter,y:w.y*f.to_meter,z:w.z||0}),!(w=f.inverse(w)))return;if(f.from_greenwich&&(w.x+=f.from_greenwich),w=me(f.datum,y.datum,w))return y.from_greenwich&&(w={x:w.x-y.from_greenwich,y:w.y,z:w.z||0}),y.projName==="longlat"?w={x:w.x*ce,y:w.y*ce,z:w.z||0}:(w=y.forward(w),y.to_meter&&(w={x:w.x/y.to_meter,y:w.y/y.to_meter,z:w.z||0})),S&&y.axis!=="enu"?se(y,!0,w):(w&&!v&&delete w.z,w)}function Be(f,y,w,S){var I,v,O;return Array.isArray(w)?(I=fi(f,y,w,S)||{x:NaN,y:NaN},w.length>2?f.name!==void 0&&f.name==="geocent"||y.name!==void 0&&y.name==="geocent"?typeof I.z=="number"?[I.x,I.y,I.z].concat(w.splice(3)):[I.x,I.y,w[2]].concat(w.splice(3)):[I.x,I.y].concat(w.splice(2)):[I.x,I.y]):(v=fi(f,y,w,S),(O=Object.keys(w)).length===2||O.forEach(function(N){if(f.name!==void 0&&f.name==="geocent"||y.name!==void 0&&y.name==="geocent"){if(N==="x"||N==="y"||N==="z")return}else if(N==="x"||N==="y")return;v[N]=w[N]}),v)}function Ze(f){return f instanceof Et?f:f.oProj?f.oProj:Et(f)}function ze(f,y,w){f=Ze(f);var S,I=!1;return y===void 0?(y=f,f=cr,I=!0):(y.x!==void 0||Array.isArray(y))&&(w=y,y=f,f=cr,I=!0),y=Ze(y),w?Be(f,y,w):(S={forward:function(v,O){return Be(f,y,v,O)},inverse:function(v,O){return Be(y,f,v,O)}},I&&(S.oProj=y),S)}function ie(f,y){return y=y||5,gi(ke({lat:f[1],lon:f[0]}),y)}function di(f){var y=le(hi(f.toUpperCase()));return y.lat&&y.lon?[y.lon,y.lat]:[(y.left+y.right)/2,(y.top+y.bottom)/2]}function li(f){return f*(Math.PI/180)}function _i(f){return f/Math.PI*180}function ke(f){var y,w,S,I,v,O,N=f.lat,U=f.lon,W=6378137,q=li(N),et=li(U);O=Math.floor((U+180)/6)+1,U===180&&(O=60),N>=56&&N<64&&U>=3&&U<12&&(O=32),N>=72&&N<84&&(U>=0&&U<9?O=31:U>=9&&U<21?O=33:U>=21&&U<33?O=35:U>=33&&U<42&&(O=37)),v=li(6*(O-1)-180+3),y=W/Math.sqrt(1-.00669438*Math.sin(q)*Math.sin(q)),w=Math.tan(q)*Math.tan(q),S=.006739496752268451*Math.cos(q)*Math.cos(q);var lt=.9996*y*((I=Math.cos(q)*(et-v))+(1-w+S)*I*I*I/6+(5-18*w+w*w+72*S-.39089081163157013)*I*I*I*I*I/120)+5e5,mt=.9996*(W*(.9983242984503243*q-.002514607064228144*Math.sin(2*q)+2639046602129982e-21*Math.sin(4*q)-3418046101696858e-24*Math.sin(6*q))+y*Math.tan(q)*(I*I/2+(5-w+9*S+4*S*S)*I*I*I*I/24+(61-58*w+w*w+600*S-2.2240339282485886)*I*I*I*I*I*I/720));return N<0&&(mt+=1e7),{northing:Math.round(mt),easting:Math.round(lt),zoneNumber:O,zoneLetter:te(N)}}function le(f){var y=f.northing,w=f.easting,S=f.zoneLetter,I=f.zoneNumber;if(I<0||I>60)return null;var v,O,N,U,W,q,et,lt,mt=6378137,st=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),Ct=w-5e5,T=y;S<"N"&&(T-=1e7),q=6*(I-1)-180+3,lt=(et=T/.9996/6367449145945056e-9)+(3*st/2-27*st*st*st/32)*Math.sin(2*et)+(21*st*st/16-55*st*st*st*st/32)*Math.sin(4*et)+151*st*st*st/96*Math.sin(6*et),v=mt/Math.sqrt(1-.00669438*Math.sin(lt)*Math.sin(lt)),O=Math.tan(lt)*Math.tan(lt),N=.006739496752268451*Math.cos(lt)*Math.cos(lt),U=.99330562*mt/Math.pow(1-.00669438*Math.sin(lt)*Math.sin(lt),1.5),W=Ct/(.9996*v);var i=lt-v*Math.tan(lt)/U*(W*W/2-(5+3*O+10*N-4*N*N-.06065547077041606)*W*W*W*W/24+(61+90*O+298*N+45*O*O-1.6983531815716497-3*N*N)*W*W*W*W*W*W/720);i=_i(i);var o=(W-(1+2*O+N)*W*W*W/6+(5-2*N+28*O-3*N*N+.05391597401814761+24*O*O)*W*W*W*W*W/120)/Math.cos(lt);o=q+_i(o);var a;if(f.accuracy){var h=le({northing:f.northing+f.accuracy,easting:f.easting+f.accuracy,zoneLetter:f.zoneLetter,zoneNumber:f.zoneNumber});a={top:h.lat,right:h.lon,bottom:i,left:o}}else a={lat:i,lon:o};return a}function te(f){var y="Z";return 84>=f&&f>=72?y="X":72>f&&f>=64?y="W":64>f&&f>=56?y="V":56>f&&f>=48?y="U":48>f&&f>=40?y="T":40>f&&f>=32?y="S":32>f&&f>=24?y="R":24>f&&f>=16?y="Q":16>f&&f>=8?y="P":8>f&&f>=0?y="N":0>f&&f>=-8?y="M":-8>f&&f>=-16?y="L":-16>f&&f>=-24?y="K":-24>f&&f>=-32?y="J":-32>f&&f>=-40?y="H":-40>f&&f>=-48?y="G":-48>f&&f>=-56?y="F":-56>f&&f>=-64?y="E":-64>f&&f>=-72?y="D":-72>f&&f>=-80&&(y="C"),y}function gi(f,y){var w="00000"+f.easting,S="00000"+f.northing;return f.zoneNumber+f.zoneLetter+Mt(f.easting,f.northing,f.zoneNumber)+w.substr(w.length-5,y)+S.substr(S.length-5,y)}function Mt(f,y,w){var S=yi(w);return on(Math.floor(f/1e5),Math.floor(y/1e5)%20,S)}function yi(f){var y=f%qe;return y===0&&(y=qe),y}function on(f,y,w){var S=w-1,I=pn.charCodeAt(S),v=Go.charCodeAt(S),O=I+f-1,N=v+y,U=!1;return O>Ee&&(O=O-Ee+Ne-1,U=!0),(O===Ve||I<Ve&&O>Ve||(O>Ve||I<Ve)&&U)&&O++,(O===ki||I<ki&&O>ki||(O>ki||I<ki)&&U)&&++O===Ve&&O++,O>Ee&&(O=O-Ee+Ne-1),N>cn?(N=N-cn+Ne-1,U=!0):U=!1,(N===Ve||v<Ve&&N>Ve||(N>Ve||v<Ve)&&U)&&N++,(N===ki||v<ki&&N>ki||(N>ki||v<ki)&&U)&&++N===Ve&&N++,N>cn&&(N=N-cn+Ne-1),String.fromCharCode(O)+String.fromCharCode(N)}function hi(f){if(f&&f.length===0)throw"MGRSPoint coverting from nothing";for(var y,w=f.length,S=null,I="",v=0;!/[A-Z]/.test(y=f.charAt(v));){if(v>=2)throw"MGRSPoint bad conversion from: "+f;I+=y,v++}var O=parseInt(I,10);if(v===0||v+3>w)throw"MGRSPoint bad conversion from: "+f;var N=f.charAt(v++);if(N<="A"||N==="B"||N==="Y"||N>="Z"||N==="I"||N==="O")throw"MGRSPoint zone letter "+N+" not handled: "+f;S=f.substring(v,v+=2);for(var U=yi(O),W=Bi(S.charAt(0),U),q=ni(S.charAt(1),U);q<Hi(N);)q+=2e6;var et=w-v;if(et%2!=0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+f;var lt,mt,st,Ct,T,i=et/2,o=0,a=0;return i>0&&(lt=1e5/Math.pow(10,i),mt=f.substring(v,v+i),o=parseFloat(mt)*lt,st=f.substring(v+i),a=parseFloat(st)*lt),Ct=o+W,T=a+q,{easting:Ct,northing:T,zoneLetter:N,zoneNumber:O,accuracy:lt}}function Bi(f,y){for(var w=pn.charCodeAt(y-1),S=1e5,I=!1;w!==f.charCodeAt(0);){if(++w===Ve&&w++,w===ki&&w++,w>Ee){if(I)throw"Bad character: "+f;w=Ne,I=!0}S+=1e5}return S}function ni(f,y){if(f>"V")throw"MGRSPoint given invalid Northing "+f;for(var w=Go.charCodeAt(y-1),S=0,I=!1;w!==f.charCodeAt(0);){if(++w===Ve&&w++,w===ki&&w++,w>cn){if(I)throw"Bad character: "+f;w=Ne,I=!0}S+=1e5}return S}function Hi(f){var y;switch(f){case"C":y=11e5;break;case"D":y=2e6;break;case"E":y=28e5;break;case"F":y=37e5;break;case"G":y=46e5;break;case"H":y=55e5;break;case"J":y=64e5;break;case"K":y=73e5;break;case"L":y=82e5;break;case"M":y=91e5;break;case"N":y=0;break;case"P":y=8e5;break;case"Q":y=17e5;break;case"R":y=26e5;break;case"S":y=35e5;break;case"T":y=44e5;break;case"U":y=53e5;break;case"V":y=62e5;break;case"W":y=7e6;break;case"X":y=79e5;break;default:y=-1}if(y>=0)return y;throw"Invalid zone letter: "+f}function Ke(f,y,w){if(!(this instanceof Ke))return new Ke(f,y,w);if(Array.isArray(f))this.x=f[0],this.y=f[1],this.z=f[2]||0;else if(typeof f=="object")this.x=f.x,this.y=f.y,this.z=f.z||0;else if(typeof f=="string"&&y===void 0){var S=f.split(",");this.x=parseFloat(S[0],10),this.y=parseFloat(S[1],10),this.z=parseFloat(S[2],10)||0}else this.x=f,this.y=y,this.z=w||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}function he(f){var y=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],w=typeof f.PROJECTION=="object"?Object.keys(f.PROJECTION)[0]:f.PROJECTION;return"no_uoff"in f||"no_off"in f||y.indexOf(w)!==-1}function ar(f){var y,w=[];return w[0]=f*Xo,y=f*f,w[0]+=y*Vo,w[1]=y*gl,y*=f,w[0]+=y*dl,w[1]+=y*ml,w[2]=y*Ae,w}function Xn(f,y){var w=f+f;return f+y[0]*Math.sin(w)+y[1]*Math.sin(w+w)+y[2]*Math.sin(w+w+w)}function Vn(f,y,w,S){var I;return f<pt?(S.value=At.AREA_0,I=0):(I=Math.atan2(y,w),Math.abs(I)<=jt?S.value=At.AREA_0:I>jt&&I<=at+jt?(S.value=At.AREA_1,I-=at):I>at+jt||I<=-(at+jt)?(S.value=At.AREA_2,I=I>=0?I-Vt:I+Vt):(S.value=At.AREA_3,I+=at)),I}function Ce(f,y){var w=f+y;return w<-Vt?w+=si:w>+Vt&&(w-=si),w}function wt(f,y,w,S){for(var I=y;S;--S){var v=f(I);if(I-=v,Math.abs(v)<w)break}return I}var Se=1,ne=2,ye=3,xn=4,Rn=5,an=484813681109536e-20,at=Math.PI/2,Fi=.16666666666666666,vn=.04722222222222222,ks=.022156084656084655,pt=1e-10,ue=.017453292519943295,ce=57.29577951308232,jt=Math.PI/4,si=2*Math.PI,Vt=3.14159265359,Pe={};Pe.greenwich=0,Pe.lisbon=-9.131906111111,Pe.paris=2.337229166667,Pe.bogota=-74.080916666667,Pe.madrid=-3.687938888889,Pe.rome=12.452333333333,Pe.bern=7.439583333333,Pe.jakarta=106.807719444444,Pe.ferro=-17.666666666667,Pe.brussels=4.367975,Pe.stockholm=18.058277777778,Pe.athens=23.7163375,Pe.oslo=10.722916666667;var ci={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Te=/[\s_\-\/\(\)]/g,fe=function(f){var y,w,S,I={},v=f.split("+").map(function(N){return N.trim()}).filter(function(N){return N}).reduce(function(N,U){var W=U.split("=");return W.push(!0),N[W[0].toLowerCase()]=W[1],N},{}),O={proj:"projName",datum:"datumCode",rf:function(N){I.rf=parseFloat(N)},lat_0:function(N){I.lat0=N*ue},lat_1:function(N){I.lat1=N*ue},lat_2:function(N){I.lat2=N*ue},lat_ts:function(N){I.lat_ts=N*ue},lon_0:function(N){I.long0=N*ue},lon_1:function(N){I.long1=N*ue},lon_2:function(N){I.long2=N*ue},alpha:function(N){I.alpha=parseFloat(N)*ue},gamma:function(N){I.rectified_grid_angle=parseFloat(N)},lonc:function(N){I.longc=N*ue},x_0:function(N){I.x0=parseFloat(N)},y_0:function(N){I.y0=parseFloat(N)},k_0:function(N){I.k0=parseFloat(N)},k:function(N){I.k0=parseFloat(N)},a:function(N){I.a=parseFloat(N)},b:function(N){I.b=parseFloat(N)},r_a:function(){I.R_A=!0},zone:function(N){I.zone=parseInt(N,10)},south:function(){I.utmSouth=!0},towgs84:function(N){I.datum_params=N.split(",").map(function(U){return parseFloat(U)})},to_meter:function(N){I.to_meter=parseFloat(N)},units:function(N){I.units=N;var U=e(ci,N);U&&(I.to_meter=U.to_meter)},from_greenwich:function(N){I.from_greenwich=N*ue},pm:function(N){var U=e(Pe,N);I.from_greenwich=(U||parseFloat(N))*ue},nadgrids:function(N){N==="@null"?I.datumCode="none":I.nadgrids=N},axis:function(N){N.length===3&&"ewnsud".indexOf(N.substr(0,1))!==-1&&"ewnsud".indexOf(N.substr(1,1))!==-1&&"ewnsud".indexOf(N.substr(2,1))!==-1&&(I.axis=N)},approx:function(){I.approx=!0}};for(y in v)w=v[y],y in O?typeof(S=O[y])=="function"?S(w):I[S]=w:I[y]=w;return typeof I.datumCode=="string"&&I.datumCode!=="WGS84"&&(I.datumCode=I.datumCode.toLowerCase()),I},Xe=1,Si=/\s/,bt=/[A-Za-z]/,fs=/[A-Za-z84_]/,ds=/[,\]]/,Ei=/[\d\.E\-\+]/;n.prototype.readCharicter=function(){var f=this.text[this.place++];if(this.state!==4)for(;Si.test(f);){if(this.place>=this.text.length)return;f=this.text[this.place++]}switch(this.state){case Xe:return this.neutral(f);case 2:return this.keyword(f);case 4:return this.quoted(f);case 5:return this.afterquote(f);case 3:return this.number(f);case-1:return}},n.prototype.afterquote=function(f){if(f==='"')return this.word+='"',void(this.state=4);if(ds.test(f))return this.word=this.word.trim(),void this.afterItem(f);throw new Error(`havn't handled "`+f+'" in afterquote yet, index '+this.place)},n.prototype.afterItem=function(f){return f===","?(this.word!==null&&this.currentObject.push(this.word),this.word=null,void(this.state=Xe)):f==="]"?(this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Xe,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},n.prototype.number=function(f){if(!Ei.test(f)){if(ds.test(f))return this.word=parseFloat(this.word),void this.afterItem(f);throw new Error(`havn't handled "`+f+'" in number yet, index '+this.place)}this.word+=f},n.prototype.quoted=function(f){f!=='"'?this.word+=f:this.state=5},n.prototype.keyword=function(f){if(fs.test(f))this.word+=f;else{if(f==="["){var y=[];return y.push(this.word),this.level++,this.root===null?this.root=y:this.currentObject.push(y),this.stack.push(this.currentObject),this.currentObject=y,void(this.state=Xe)}if(!ds.test(f))throw new Error(`havn't handled "`+f+'" in keyword yet, index '+this.place);this.afterItem(f)}},n.prototype.neutral=function(f){if(bt.test(f))return this.word=f,void(this.state=2);if(f==='"')return this.word="",void(this.state=4);if(Ei.test(f))return this.word=f,void(this.state=3);{if(!ds.test(f))throw new Error(`havn't handled "`+f+'" in neutral yet, index '+this.place);this.afterItem(f)}},n.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===-1)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var gs=.017453292519943295,Us=function(f){var y=r(f),w=y.shift(),S=y.shift();y.unshift(["name",S]),y.unshift(["type",w]);var I={};return u(y,I),p(I),I};(function(f){f("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),f("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),f("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),f.WGS84=f["EPSG:4326"],f["EPSG:3785"]=f["EPSG:3857"],f.GOOGLE=f["EPSG:3857"],f["EPSG:900913"]=f["EPSG:3857"],f["EPSG:102113"]=f["EPSG:3857"]})(E);var lr=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],ln=["3857","900913","3785","102113"],Uo=function(f,y){f=f||{};var w,S;if(!y)return f;for(S in y)(w=y[S])!==void 0&&(f[S]=w);return f},hn=function(f,y,w){var S=f*y;return w/Math.sqrt(1-S*S)},Ti=function(f){return f<0?-1:1},It=function(f){return Math.abs(f)<=Vt?f:f-Ti(f)*si},oe=function(f,y,w){var S=f*w,I=.5*f;return S=Math.pow((1-S)/(1+S),I),Math.tan(.5*(at-y))/S},ms=function(f,y){for(var w,S,I=.5*f,v=at-2*Math.atan(y),O=0;O<=15;O++)if(w=f*Math.sin(v),S=at-2*Math.atan(y*Math.pow((1-w)/(1+w),I))-v,v+=S,Math.abs(S)<=1e-10)return v;return-9999},Nn=[{init:function(){var f=this.b/this.a;this.es=1-f*f,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=hn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(f){var y=f.x,w=f.y;if(w*ce>90&&w*ce<-90&&y*ce>180&&y*ce<-180)return null;var S,I;if(Math.abs(Math.abs(w)-at)<=pt)return null;if(this.sphere)S=this.x0+this.a*this.k0*It(y-this.long0),I=this.y0+this.a*this.k0*Math.log(Math.tan(jt+.5*w));else{var v=Math.sin(w),O=oe(this.e,w,v);S=this.x0+this.a*this.k0*It(y-this.long0),I=this.y0-this.a*this.k0*Math.log(O)}return f.x=S,f.y=I,f},inverse:function(f){var y,w,S=f.x-this.x0,I=f.y-this.y0;if(this.sphere)w=at-2*Math.atan(Math.exp(-I/(this.a*this.k0)));else{var v=Math.exp(-I/(this.a*this.k0));if((w=ms(this.e,v))===-9999)return null}return y=It(this.long0+S/(this.a*this.k0)),f.x=y,f.y=w,f},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:G,inverse:G,names:["longlat","identity"]}],xs={},ct=[],ll={start:function(){Nn.forEach(X)},add:X,get:function(f){if(!f)return!1;var y=f.toLowerCase();return xs[y]!==void 0&&ct[xs[y]]?ct[xs[y]]:void 0}},Rt={};Rt.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},Rt.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},Rt.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},Rt.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},Rt.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},Rt.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},Rt.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},Rt.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},Rt.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},Rt.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},Rt.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},Rt.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},Rt.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},Rt.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},Rt.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},Rt.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},Rt.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},Rt.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},Rt.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},Rt.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},Rt.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},Rt.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},Rt.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},Rt.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},Rt.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},Rt.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},Rt.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},Rt.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},Rt.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},Rt.hough={a:6378270,rf:297,ellipseName:"Hough"},Rt.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},Rt.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},Rt.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},Rt.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},Rt.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},Rt.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},Rt.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},Rt.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},Rt.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},Rt.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},Rt.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},Rt.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var ps=Rt.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Rt.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var ri={};ri.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ri.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ri.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},ri.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},ri.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},ri.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},ri.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},ri.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},ri.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},ri.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ri.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},ri.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},ri.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},ri.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},ri.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},ri.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},ri.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},ri.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var ge={};Et.projections=ll,Et.projections.start();var me=function(f,y,w){if(Wt(f,y)||f.datum_type===Rn||y.datum_type===Rn)return w;var S=f.a,I=f.es;if(f.datum_type===ye){if(ft(f,!1,w)!==0)return;S=6378137,I=.0066943799901413165}var v=y.a,O=y.b,N=y.es;return y.datum_type===ye&&(v=6378137,O=6356752314e-3,N=.0066943799901413165),I!==N||S!==v||$t(f.datum_type)||$t(y.datum_type)?(w=re(w,I,S),$t(f.datum_type)&&(w=Jt(w,f.datum_type,f.datum_params)),$t(y.datum_type)&&(w=Ft(w,y.datum_type,y.datum_params)),w=Ut(w,N,v,O),y.datum_type!==ye||ft(y,!0,w)===0?w:void 0):w},se=function(f,y,w){var S,I,v,O=w.x,N=w.y,U=w.z||0,W={};for(v=0;v<3;v++)if(!y||v!==2||w.z!==void 0)switch(v===0?(S=O,I="ew".indexOf(f.axis[v])!==-1?"x":"y"):v===1?(S=N,I="ns".indexOf(f.axis[v])!==-1?"y":"x"):(S=U,I="z"),f.axis[v]){case"e":W[I]=S;break;case"w":W[I]=-S;break;case"n":W[I]=S;break;case"s":W[I]=-S;break;case"u":w[I]!==void 0&&(W.z=S);break;case"d":w[I]!==void 0&&(W.z=-S);break;default:return null}return W},hr=function(f){var y={x:f[0],y:f[1]};return f.length>2&&(y.z=f[2]),f.length>3&&(y.m=f[3]),y},Hr=function(f){Oe(f.x),Oe(f.y)},cr=Et("WGS84"),qe=6,pn="AJSAJS",Go="AFAFAF",Ne=65,Ve=73,ki=79,cn=86,Ee=90,mi={forward:ie,inverse:function(f){var y=le(hi(f.toUpperCase()));return y.lat&&y.lon?[y.lon,y.lat,y.lon,y.lat]:[y.left,y.bottom,y.right,y.top]},toPoint:di};Ke.fromMGRS=function(f){return new Ke(di(f))},Ke.prototype.toMGRS=function(f){return ie([this.x,this.y],f)};var tt=.01068115234375,B=function(f){var y=[];y[0]=1-f*(.25+f*(.046875+f*(.01953125+f*tt))),y[1]=f*(.75-f*(.046875+f*(.01953125+f*tt)));var w=f*f;return y[2]=w*(.46875-f*(.013020833333333334+.007120768229166667*f)),w*=f,y[3]=w*(.3645833333333333-.005696614583333333*f),y[4]=w*f*.3076171875,y},Dt=function(f,y,w,S){return w*=y,y*=y,S[0]*f-w*(S[1]+y*(S[2]+y*(S[3]+y*S[4])))},oi=function(f,y,w){for(var S=1/(1-y),I=f,v=20;v;--v){var O=Math.sin(I),N=1-y*O*O;if(N=(Dt(I,O,Math.cos(I),w)-f)*(N*Math.sqrt(N))*S,I-=N,Math.abs(N)<pt)return I}return I},wi={init:function(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=B(this.es),this.ml0=Dt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(f){var y,w,S,I=f.x,v=f.y,O=It(I-this.long0),N=Math.sin(v),U=Math.cos(v);if(this.es){var W=U*O,q=Math.pow(W,2),et=this.ep2*Math.pow(U,2),lt=Math.pow(et,2),mt=Math.abs(U)>pt?Math.tan(v):0,st=Math.pow(mt,2),Ct=Math.pow(st,2);y=1-this.es*Math.pow(N,2),W/=Math.sqrt(y);var T=Dt(v,N,U,this.en);w=this.a*(this.k0*W*(1+q/6*(1-st+et+q/20*(5-18*st+Ct+14*et-58*st*et+q/42*(61+179*Ct-Ct*st-479*st)))))+this.x0,S=this.a*(this.k0*(T-this.ml0+N*O*W/2*(1+q/12*(5-st+9*et+4*lt+q/30*(61+Ct-58*st+270*et-330*st*et+q/56*(1385+543*Ct-Ct*st-3111*st))))))+this.y0}else{var i=U*Math.sin(O);if(Math.abs(Math.abs(i)-1)<pt)return 93;if(w=.5*this.a*this.k0*Math.log((1+i)/(1-i))+this.x0,S=U*Math.cos(O)/Math.sqrt(1-Math.pow(i,2)),(i=Math.abs(S))>=1){if(i-1>pt)return 93;S=0}else S=Math.acos(S);v<0&&(S=-S),S=this.a*this.k0*(S-this.lat0)+this.y0}return f.x=w,f.y=S,f},inverse:function(f){var y,w,S,I,v=(f.x-this.x0)*(1/this.a),O=(f.y-this.y0)*(1/this.a);if(this.es)if(y=this.ml0+O/this.k0,w=oi(y,this.es,this.en),Math.abs(w)<at){var N=Math.sin(w),U=Math.cos(w),W=Math.abs(U)>pt?Math.tan(w):0,q=this.ep2*Math.pow(U,2),et=Math.pow(q,2),lt=Math.pow(W,2),mt=Math.pow(lt,2);y=1-this.es*Math.pow(N,2);var st=v*Math.sqrt(y)/this.k0,Ct=Math.pow(st,2);S=w-(y*=W)*Ct/(1-this.es)*.5*(1-Ct/12*(5+3*lt-9*q*lt+q-4*et-Ct/30*(61+90*lt-252*q*lt+45*mt+46*q-Ct/56*(1385+3633*lt+4095*mt+1574*mt*lt)))),I=It(this.long0+st*(1-Ct/6*(1+2*lt+q-Ct/20*(5+28*lt+24*mt+8*q*lt+6*q-Ct/42*(61+662*lt+1320*mt+720*mt*lt))))/U)}else S=at*Ti(O),I=0;else{var T=Math.exp(v/this.k0),i=.5*(T-1/T),o=this.lat0+O/this.k0,a=Math.cos(o);y=Math.sqrt((1-Math.pow(a,2))/(1+Math.pow(i,2))),S=Math.asin(y),O<0&&(S=-S),I=i===0&&a===0?0:It(Math.atan2(i,a)+this.long0)}return f.x=I,f.y=S,f},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]},zo=function(f){var y=Math.exp(f);return y=(y-1/y)/2},bi=function(f,y){f=Math.abs(f),y=Math.abs(y);var w=Math.max(f,y),S=Math.min(f,y)/(w||1);return w*Math.sqrt(1+Math.pow(S,2))},Ui=function(f){var y=1+f,w=y-1;return w===0?f:f*Math.log(y)/w},Pt=function(f){var y=Math.abs(f);return y=Ui(y*(1+y/(bi(1,y)+1))),f<0?-y:y},De=function(f,y){for(var w,S=2*Math.cos(2*y),I=f.length-1,v=f[I],O=0;--I>=0;)w=S*v-O+f[I],O=v,v=w;return y+w*Math.sin(2*y)},jo=function(f,y){for(var w,S=2*Math.cos(y),I=f.length-1,v=f[I],O=0;--I>=0;)w=S*v-O+f[I],O=v,v=w;return Math.sin(y)*w},hl=function(f){var y=Math.exp(f);return y=(y+1/y)/2},ur=function(f,y,w){for(var S,I,v=Math.sin(y),O=Math.cos(y),N=zo(w),U=hl(w),W=2*O*U,q=-2*v*N,et=f.length-1,lt=f[et],mt=0,st=0,Ct=0;--et>=0;)S=st,I=mt,lt=W*(st=lt)-S-q*(mt=Ct)+f[et],Ct=q*st-I+W*mt;return W=v*U,q=O*N,[W*lt-q*Ct,W*Ct+q*lt]},Yn={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(wi.init.apply(this),this.forward=wi.forward,this.inverse=wi.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var f=this.es/(1+Math.sqrt(1-this.es)),y=f/(2-f),w=y;this.cgb[0]=y*(2+y*(-2/3+y*(y*(116/45+y*(26/45+y*(-2854/675)))-2))),this.cbg[0]=y*(y*(2/3+y*(4/3+y*(-82/45+y*(32/45+y*(4642/4725)))))-2),w*=y,this.cgb[1]=w*(7/3+y*(y*(-227/45+y*(2704/315+y*(2323/945)))-1.6)),this.cbg[1]=w*(5/3+y*(-16/15+y*(-13/9+y*(904/315+y*(-1522/945))))),w*=y,this.cgb[2]=w*(56/15+y*(-136/35+y*(-1262/105+y*(73814/2835)))),this.cbg[2]=w*(-26/15+y*(34/21+y*(1.6+y*(-12686/2835)))),w*=y,this.cgb[3]=w*(4279/630+y*(-332/35+y*(-399572/14175))),this.cbg[3]=w*(1237/630+y*(y*(-24832/14175)-2.4)),w*=y,this.cgb[4]=w*(4174/315+y*(-144838/6237)),this.cbg[4]=w*(-734/315+y*(109598/31185)),w*=y,this.cgb[5]=w*(601676/22275),this.cbg[5]=w*(444337/155925),w=Math.pow(y,2),this.Qn=this.k0/(1+y)*(1+w*(.25+w*(1/64+w/256))),this.utg[0]=y*(y*(2/3+y*(-37/96+y*(1/360+y*(81/512+y*(-96199/604800)))))-.5),this.gtu[0]=y*(.5+y*(-2/3+y*(5/16+y*(41/180+y*(-127/288+y*(7891/37800)))))),this.utg[1]=w*(-1/48+y*(-1/15+y*(437/1440+y*(-46/105+y*(1118711/3870720))))),this.gtu[1]=w*(13/48+y*(y*(557/1440+y*(281/630+y*(-1983433/1935360)))-.6)),w*=y,this.utg[2]=w*(-17/480+y*(37/840+y*(209/4480+y*(-5569/90720)))),this.gtu[2]=w*(61/240+y*(-103/140+y*(15061/26880+y*(167603/181440)))),w*=y,this.utg[3]=w*(-4397/161280+y*(11/504+y*(830251/7257600))),this.gtu[3]=w*(49561/161280+y*(-179/168+y*(6601661/7257600))),w*=y,this.utg[4]=w*(-4583/161280+y*(108847/3991680)),this.gtu[4]=w*(34729/80640+y*(-3418889/1995840)),w*=y,this.utg[5]=-.03233083094085698*w,this.gtu[5]=.6650675310896665*w;var S=De(this.cbg,this.lat0);this.Zb=-this.Qn*(S+jo(this.gtu,2*S))},forward:function(f){var y=It(f.x-this.long0),w=f.y;w=De(this.cbg,w);var S=Math.sin(w),I=Math.cos(w),v=Math.sin(y),O=Math.cos(y);w=Math.atan2(S,O*I),y=Math.atan2(v*I,bi(S,I*O)),y=Pt(Math.tan(y));var N=ur(this.gtu,2*w,2*y);w+=N[0],y+=N[1];var U,W;return Math.abs(y)<=2.623395162778?(U=this.a*(this.Qn*y)+this.x0,W=this.a*(this.Qn*w+this.Zb)+this.y0):(U=1/0,W=1/0),f.x=U,f.y=W,f},inverse:function(f){var y=(f.x-this.x0)*(1/this.a),w=(f.y-this.y0)*(1/this.a);w=(w-this.Zb)/this.Qn,y/=this.Qn;var S,I;if(Math.abs(y)<=2.623395162778){var v=ur(this.utg,2*w,2*y);w+=v[0],y+=v[1],y=Math.atan(zo(y));var O=Math.sin(w),N=Math.cos(w),U=Math.sin(y),W=Math.cos(y);w=Math.atan2(O*W,bi(U,W*N)),y=Math.atan2(U,W*N),S=It(y+this.long0),I=De(this.cgb,w)}else S=1/0,I=1/0;return f.x=S,f.y=I,f},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]},Zr=function(f,y){if(f===void 0){if((f=Math.floor(30*(It(y)+Math.PI)/Math.PI)+1)<0)return 0;if(f>60)return 60}return f},cl={init:function(){var f=Zr(this.zone,this.long0);if(f===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(f)-183)*ue,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Yn.init.apply(this),this.forward=Yn.forward,this.inverse=Yn.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},Qe=function(f,y){return Math.pow((1-f)/(1+f),y)},Gs=20,un={init:function(){var f=Math.sin(this.lat0),y=Math.cos(this.lat0);y*=y,this.rc=Math.sqrt(1-this.es)/(1-this.es*f*f),this.C=Math.sqrt(1+this.es*y*y/(1-this.es)),this.phic0=Math.asin(f/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+jt)/(Math.pow(Math.tan(.5*this.lat0+jt),this.C)*Qe(this.e*f,this.ratexp))},forward:function(f){var y=f.x,w=f.y;return f.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*w+jt),this.C)*Qe(this.e*Math.sin(w),this.ratexp))-at,f.x=this.C*y,f},inverse:function(f){for(var y=f.x/this.C,w=f.y,S=Math.pow(Math.tan(.5*w+jt)/this.K,1/this.C),I=Gs;I>0&&(w=2*Math.atan(S*Qe(this.e*Math.sin(f.y),-.5*this.e))-at,!(Math.abs(w-f.y)<1e-14));--I)f.y=w;return I?(f.x=y,f.y=w,f):null},names:["gauss"]},Gt={init:function(){un.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(f){var y,w,S,I;return f.x=It(f.x-this.long0),un.forward.apply(this,[f]),y=Math.sin(f.y),w=Math.cos(f.y),S=Math.cos(f.x),I=this.k0*this.R2/(1+this.sinc0*y+this.cosc0*w*S),f.x=I*w*Math.sin(f.x),f.y=I*(this.cosc0*y-this.sinc0*w*S),f.x=this.a*f.x+this.x0,f.y=this.a*f.y+this.y0,f},inverse:function(f){var y,w,S,I,v;if(f.x=(f.x-this.x0)/this.a,f.y=(f.y-this.y0)/this.a,f.x/=this.k0,f.y/=this.k0,v=bi(f.x,f.y)){var O=2*Math.atan2(v,this.R2);y=Math.sin(O),w=Math.cos(O),I=Math.asin(w*this.sinc0+f.y*y*this.cosc0/v),S=Math.atan2(f.x*y,v*this.cosc0*w-f.y*this.sinc0*y)}else I=this.phic0,S=0;return f.x=S,f.y=I,un.inverse.apply(this,[f]),f.x=It(f.x+this.long0),f},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},ul={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=pt&&(this.k0=.5*(1+Ti(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=pt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=pt&&Math.abs(Math.cos(this.lat_ts))>pt&&(this.k0=.5*this.cons*hn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/oe(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=hn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-at,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(f){var y,w,S,I,v,O,N=f.x,U=f.y,W=Math.sin(U),q=Math.cos(U),et=It(N-this.long0);return Math.abs(Math.abs(N-this.long0)-Math.PI)<=pt&&Math.abs(U+this.lat0)<=pt?(f.x=NaN,f.y=NaN,f):this.sphere?(y=2*this.k0/(1+this.sinlat0*W+this.coslat0*q*Math.cos(et)),f.x=this.a*y*q*Math.sin(et)+this.x0,f.y=this.a*y*(this.coslat0*W-this.sinlat0*q*Math.cos(et))+this.y0,f):(w=2*Math.atan(this.ssfn_(U,W,this.e))-at,I=Math.cos(w),S=Math.sin(w),Math.abs(this.coslat0)<=pt?(v=oe(this.e,U*this.con,this.con*W),O=2*this.a*this.k0*v/this.cons,f.x=this.x0+O*Math.sin(N-this.long0),f.y=this.y0-this.con*O*Math.cos(N-this.long0),f):(Math.abs(this.sinlat0)<pt?(y=2*this.a*this.k0/(1+I*Math.cos(et)),f.y=y*S):(y=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*S+this.cosX0*I*Math.cos(et))),f.y=y*(this.cosX0*S-this.sinX0*I*Math.cos(et))+this.y0),f.x=y*I*Math.sin(et)+this.x0,f))},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var y,w,S,I,v,O=Math.sqrt(f.x*f.x+f.y*f.y);if(this.sphere){var N=2*Math.atan(O/(2*this.a*this.k0));return y=this.long0,w=this.lat0,O<=pt?(f.x=y,f.y=w,f):(w=Math.asin(Math.cos(N)*this.sinlat0+f.y*Math.sin(N)*this.coslat0/O),y=It(Math.abs(this.coslat0)<pt?this.lat0>0?this.long0+Math.atan2(f.x,-1*f.y):this.long0+Math.atan2(f.x,f.y):this.long0+Math.atan2(f.x*Math.sin(N),O*this.coslat0*Math.cos(N)-f.y*this.sinlat0*Math.sin(N))),f.x=y,f.y=w,f)}if(Math.abs(this.coslat0)<=pt){if(O<=pt)return w=this.lat0,y=this.long0,f.x=y,f.y=w,f;f.x*=this.con,f.y*=this.con,S=O*this.cons/(2*this.a*this.k0),w=this.con*ms(this.e,S),y=this.con*It(this.con*this.long0+Math.atan2(f.x,-1*f.y))}else I=2*Math.atan(O*this.cosX0/(2*this.a*this.k0*this.ms1)),y=this.long0,O<=pt?v=this.X0:(v=Math.asin(Math.cos(I)*this.sinX0+f.y*Math.sin(I)*this.cosX0/O),y=It(this.long0+Math.atan2(f.x*Math.sin(I),O*this.cosX0*Math.cos(I)-f.y*this.sinX0*Math.sin(I)))),w=-1*ms(this.e,Math.tan(.5*(at+v)));return f.x=y,f.y=w,f},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],ssfn_:function(f,y,w){return y*=w,Math.tan(.5*(at+f))*Math.pow((1-y)/(1+y),.5*w)}},Zt={init:function(){var f=this.lat0;this.lambda0=this.long0;var y=Math.sin(f),w=this.a,S=1/this.rf,I=2*S-Math.pow(S,2),v=this.e=Math.sqrt(I);this.R=this.k0*w*Math.sqrt(1-I)/(1-I*Math.pow(y,2)),this.alpha=Math.sqrt(1+I/(1-I)*Math.pow(Math.cos(f),4)),this.b0=Math.asin(y/this.alpha);var O=Math.log(Math.tan(Math.PI/4+this.b0/2)),N=Math.log(Math.tan(Math.PI/4+f/2)),U=Math.log((1+v*y)/(1-v*y));this.K=O-this.alpha*N+this.alpha*v/2*U},forward:function(f){var y=Math.log(Math.tan(Math.PI/4-f.y/2)),w=this.e/2*Math.log((1+this.e*Math.sin(f.y))/(1-this.e*Math.sin(f.y))),S=-this.alpha*(y+w)+this.K,I=2*(Math.atan(Math.exp(S))-Math.PI/4),v=this.alpha*(f.x-this.lambda0),O=Math.atan(Math.sin(v)/(Math.sin(this.b0)*Math.tan(I)+Math.cos(this.b0)*Math.cos(v))),N=Math.asin(Math.cos(this.b0)*Math.sin(I)-Math.sin(this.b0)*Math.cos(I)*Math.cos(v));return f.y=this.R/2*Math.log((1+Math.sin(N))/(1-Math.sin(N)))+this.y0,f.x=this.R*O+this.x0,f},inverse:function(f){for(var y=f.x-this.x0,w=f.y-this.y0,S=y/this.R,I=2*(Math.atan(Math.exp(w/this.R))-Math.PI/4),v=Math.asin(Math.cos(this.b0)*Math.sin(I)+Math.sin(this.b0)*Math.cos(I)*Math.cos(S)),O=Math.atan(Math.sin(S)/(Math.cos(this.b0)*Math.cos(S)-Math.sin(this.b0)*Math.tan(I))),N=this.lambda0+O/this.alpha,U=0,W=v,q=-1e3,et=0;Math.abs(W-q)>1e-7;){if(++et>20)return;U=1/this.alpha*(Math.log(Math.tan(Math.PI/4+v/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(W))/2)),q=W,W=2*Math.atan(Math.exp(U))-Math.PI/2}return f.x=N,f.y=W,f},names:["somerc"]},je=1e-7,fl={init:function(){var f,y,w,S,I,v,O,N,U,W,q,et=0,lt=0,mt=0,st=0,Ct=0,T=0,i=0;this.no_off=he(this),this.no_rot="no_rot"in this;var o=!1;"alpha"in this&&(o=!0);var a=!1;if("rectified_grid_angle"in this&&(a=!0),o&&(i=this.alpha),a&&(et=this.rectified_grid_angle*ue),o||a)lt=this.longc;else if(mt=this.long1,Ct=this.lat1,st=this.long2,T=this.lat2,Math.abs(Ct-T)<=je||(f=Math.abs(Ct))<=je||Math.abs(f-at)<=je||Math.abs(Math.abs(this.lat0)-at)<=je||Math.abs(Math.abs(T)-at)<=je)throw new Error;var h=1-this.es;y=Math.sqrt(h),Math.abs(this.lat0)>pt?(N=Math.sin(this.lat0),w=Math.cos(this.lat0),f=1-this.es*N*N,this.B=w*w,this.B=Math.sqrt(1+this.es*this.B*this.B/h),this.A=this.B*this.k0*y/f,(I=(S=this.B*y/(w*Math.sqrt(f)))*S-1)<=0?I=0:(I=Math.sqrt(I),this.lat0<0&&(I=-I)),this.E=I+=S,this.E*=Math.pow(oe(this.e,this.lat0,N),this.B)):(this.B=1/y,this.A=this.k0,this.E=S=I=1),o||a?(o?(q=Math.asin(Math.sin(i)/S),a||(et=i)):(q=et,i=Math.asin(S*Math.sin(q))),this.lam0=lt-Math.asin(.5*(I-1/I)*Math.tan(q))/this.B):(v=Math.pow(oe(this.e,Ct,Math.sin(Ct)),this.B),O=Math.pow(oe(this.e,T,Math.sin(T)),this.B),I=this.E/v,U=(O-v)/(O+v),W=((W=this.E*this.E)-O*v)/(W+O*v),(f=mt-st)<-Math.pi?st-=si:f>Math.pi&&(st+=si),this.lam0=It(.5*(mt+st)-Math.atan(W*Math.tan(.5*this.B*(mt-st))/U)/this.B),q=Math.atan(2*Math.sin(this.B*It(mt-this.lam0))/(I-1/I)),et=i=Math.asin(S*Math.sin(q))),this.singam=Math.sin(q),this.cosgam=Math.cos(q),this.sinrot=Math.sin(et),this.cosrot=Math.cos(et),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(S*S-1)/Math.cos(i))),this.lat0<0&&(this.u_0=-this.u_0)),I=.5*q,this.v_pole_n=this.ArB*Math.log(Math.tan(jt-I)),this.v_pole_s=this.ArB*Math.log(Math.tan(jt+I))},forward:function(f){var y,w,S,I,v,O,N,U,W={};if(f.x=f.x-this.lam0,Math.abs(Math.abs(f.y)-at)>pt){if(v=this.E/Math.pow(oe(this.e,f.y,Math.sin(f.y)),this.B),O=1/v,y=.5*(v-O),w=.5*(v+O),I=Math.sin(this.B*f.x),S=(y*this.singam-I*this.cosgam)/w,Math.abs(Math.abs(S)-1)<pt)throw new Error;U=.5*this.ArB*Math.log((1-S)/(1+S)),O=Math.cos(this.B*f.x),N=Math.abs(O)<je?this.A*f.x:this.ArB*Math.atan2(y*this.cosgam+I*this.singam,O)}else U=f.y>0?this.v_pole_n:this.v_pole_s,N=this.ArB*f.y;return this.no_rot?(W.x=N,W.y=U):(N-=this.u_0,W.x=U*this.cosrot+N*this.sinrot,W.y=N*this.cosrot-U*this.sinrot),W.x=this.a*W.x+this.x0,W.y=this.a*W.y+this.y0,W},inverse:function(f){var y,w,S,I,v,O,N,U={};if(f.x=(f.x-this.x0)*(1/this.a),f.y=(f.y-this.y0)*(1/this.a),this.no_rot?(w=f.y,y=f.x):(w=f.x*this.cosrot-f.y*this.sinrot,y=f.y*this.cosrot+f.x*this.sinrot+this.u_0),S=Math.exp(-this.BrA*w),I=.5*(S-1/S),v=.5*(S+1/S),O=Math.sin(this.BrA*y),N=(O*this.cosgam+I*this.singam)/v,Math.abs(Math.abs(N)-1)<pt)U.x=0,U.y=N<0?-at:at;else{if(U.y=this.E/Math.sqrt((1+N)/(1-N)),U.y=ms(this.e,Math.pow(U.y,1/this.B)),U.y===1/0)throw new Error;U.x=-this.rB*Math.atan2(I*this.cosgam-O*this.singam,Math.cos(this.BrA*y))}return U.x+=this.lam0,U},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},Kr={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<pt)){var f=this.b/this.a;this.e=Math.sqrt(1-f*f);var y=Math.sin(this.lat1),w=Math.cos(this.lat1),S=hn(this.e,y,w),I=oe(this.e,this.lat1,y),v=Math.sin(this.lat2),O=Math.cos(this.lat2),N=hn(this.e,v,O),U=oe(this.e,this.lat2,v),W=oe(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>pt?this.ns=Math.log(S/N)/Math.log(I/U):this.ns=y,isNaN(this.ns)&&(this.ns=y),this.f0=S/(this.ns*Math.pow(I,this.ns)),this.rh=this.a*this.f0*Math.pow(W,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(f){var y=f.x,w=f.y;Math.abs(2*Math.abs(w)-Math.PI)<=pt&&(w=Ti(w)*(at-2*pt));var S,I,v=Math.abs(Math.abs(w)-at);if(v>pt)S=oe(this.e,w,Math.sin(w)),I=this.a*this.f0*Math.pow(S,this.ns);else{if((v=w*this.ns)<=0)return null;I=0}var O=this.ns*It(y-this.long0);return f.x=this.k0*(I*Math.sin(O))+this.x0,f.y=this.k0*(this.rh-I*Math.cos(O))+this.y0,f},inverse:function(f){var y,w,S,I,v,O=(f.x-this.x0)/this.k0,N=this.rh-(f.y-this.y0)/this.k0;this.ns>0?(y=Math.sqrt(O*O+N*N),w=1):(y=-Math.sqrt(O*O+N*N),w=-1);var U=0;if(y!==0&&(U=Math.atan2(w*O,w*N)),y!==0||this.ns>0){if(w=1/this.ns,S=Math.pow(y/(this.a*this.f0),w),(I=ms(this.e,S))===-9999)return null}else I=-at;return v=It(U/this.ns+this.long0),f.x=v,f.y=I,f},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},Wo={init:function(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(f){var y,w,S,I,v,O,N,U=f.x,W=f.y,q=It(U-this.long0);return y=Math.pow((1+this.e*Math.sin(W))/(1-this.e*Math.sin(W)),this.alfa*this.e/2),w=2*(Math.atan(this.k*Math.pow(Math.tan(W/2+this.s45),this.alfa)/y)-this.s45),S=-q*this.alfa,I=Math.asin(Math.cos(this.ad)*Math.sin(w)+Math.sin(this.ad)*Math.cos(w)*Math.cos(S)),v=Math.asin(Math.cos(w)*Math.sin(S)/Math.cos(I)),O=this.n*v,N=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(I/2+this.s45),this.n),f.y=N*Math.cos(O)/1,f.x=N*Math.sin(O)/1,this.czech||(f.y*=-1,f.x*=-1),f},inverse:function(f){var y,w,S,I,v,O,N,U=f.x;f.x=f.y,f.y=U,this.czech||(f.y*=-1,f.x*=-1),v=Math.sqrt(f.x*f.x+f.y*f.y),I=Math.atan2(f.y,f.x)/Math.sin(this.s0),S=2*(Math.atan(Math.pow(this.ro0/v,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),y=Math.asin(Math.cos(this.ad)*Math.sin(S)-Math.sin(this.ad)*Math.cos(S)*Math.cos(I)),w=Math.asin(Math.cos(S)*Math.sin(I)/Math.cos(y)),f.x=this.long0-w/this.alfa,O=y,N=0;var W=0;do f.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(y/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(O))/(1-this.e*Math.sin(O)),this.e/2))-this.s45),Math.abs(O-f.y)<1e-10&&(N=1),O=f.y,W+=1;while(N===0&&W<15);return W>=15?null:f},names:["Krovak","krovak"]},Ye=function(f,y,w,S,I){return f*I-y*Math.sin(2*I)+w*Math.sin(4*I)-S*Math.sin(6*I)},zs=function(f){return 1-.25*f*(1+f/16*(3+1.25*f))},_n=function(f){return .375*f*(1+.25*f*(1+.46875*f))},yn=function(f){return .05859375*f*f*(1+.75*f)},En=function(f){return f*f*f*(35/3072)},Hn=function(f,y,w){var S=y*w;return f/Math.sqrt(1-S*S)},fn=function(f){return Math.abs(f)<at?f:f-Ti(f)*Math.PI},On=function(f,y,w,S,I){var v,O;v=f/y;for(var N=0;N<15;N++)if(O=(f-(y*v-w*Math.sin(2*v)+S*Math.sin(4*v)-I*Math.sin(6*v)))/(y-2*w*Math.cos(2*v)+4*S*Math.cos(4*v)-6*I*Math.cos(6*v)),v+=O,Math.abs(O)<=1e-10)return v;return NaN},Ri={init:function(){this.sphere||(this.e0=zs(this.es),this.e1=_n(this.es),this.e2=yn(this.es),this.e3=En(this.es),this.ml0=this.a*Ye(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(f){var y,w,S=f.x,I=f.y;if(S=It(S-this.long0),this.sphere)y=this.a*Math.asin(Math.cos(I)*Math.sin(S)),w=this.a*(Math.atan2(Math.tan(I),Math.cos(S))-this.lat0);else{var v=Math.sin(I),O=Math.cos(I),N=Hn(this.a,this.e,v),U=Math.tan(I)*Math.tan(I),W=S*Math.cos(I),q=W*W,et=this.es*O*O/(1-this.es);y=N*W*(1-q*U*(1/6-(8-U+8*et)*q/120)),w=this.a*Ye(this.e0,this.e1,this.e2,this.e3,I)-this.ml0+N*v/O*q*(.5+(5-U+6*et)*q/24)}return f.x=y+this.x0,f.y=w+this.y0,f},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var y,w,S=f.x/this.a,I=f.y/this.a;if(this.sphere){var v=I+this.lat0;y=Math.asin(Math.sin(v)*Math.cos(S)),w=Math.atan2(Math.tan(S),Math.cos(v))}else{var O=this.ml0/this.a+I,N=On(O,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(N)-at)<=pt)return f.x=this.long0,f.y=at,I<0&&(f.y*=-1),f;var U=Hn(this.a,this.e,Math.sin(N)),W=U*U*U/this.a/this.a*(1-this.es),q=Math.pow(Math.tan(N),2),et=S*this.a/U,lt=et*et;y=N-U*Math.tan(N)/W*et*et*(.5-(1+3*q)*et*et/24),w=et*(1-lt*(q/3+(1+3*q)*q*lt/15))/Math.cos(N)}return f.x=It(w+this.long0),f.y=fn(y),f},names:["Cassini","Cassini_Soldner","cass"]},wn=function(f,y){var w;return f>1e-7?(w=f*y,(1-f*f)*(y/(1-w*w)-.5/f*Math.log((1-w)/(1+w)))):2*y},Xo=.3333333333333333,Vo=.17222222222222222,dl=.10257936507936508,gl=.06388888888888888,ml=.0664021164021164,Ae=.016415012942191543,Yo={init:function(){var f=Math.abs(this.lat0);if(Math.abs(f-at)<pt?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(f)<pt?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var y;switch(this.qp=wn(this.e,1),this.mmf=.5/(1-this.es),this.apa=ar(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),y=Math.sin(this.lat0),this.sinb1=wn(this.e,y)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*y*y)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(f){var y,w,S,I,v,O,N,U,W,q,et=f.x,lt=f.y;if(et=It(et-this.long0),this.sphere){if(v=Math.sin(lt),q=Math.cos(lt),S=Math.cos(et),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((w=this.mode===this.EQUIT?1+q*S:1+this.sinph0*v+this.cosph0*q*S)<=pt)return null;y=(w=Math.sqrt(2/w))*q*Math.sin(et),w*=this.mode===this.EQUIT?v:this.cosph0*v-this.sinph0*q*S}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(S=-S),Math.abs(lt+this.lat0)<pt)return null;w=jt-.5*lt,y=(w=2*(this.mode===this.S_POLE?Math.cos(w):Math.sin(w)))*Math.sin(et),w*=S}}else{switch(N=0,U=0,W=0,S=Math.cos(et),I=Math.sin(et),v=Math.sin(lt),O=wn(this.e,v),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(N=O/this.qp,U=Math.sqrt(1-N*N)),this.mode){case this.OBLIQ:W=1+this.sinb1*N+this.cosb1*U*S;break;case this.EQUIT:W=1+U*S;break;case this.N_POLE:W=at+lt,O=this.qp-O;break;case this.S_POLE:W=lt-at,O=this.qp+O}if(Math.abs(W)<pt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:W=Math.sqrt(2/W),w=this.mode===this.OBLIQ?this.ymf*W*(this.cosb1*N-this.sinb1*U*S):(W=Math.sqrt(2/(1+U*S)))*N*this.ymf,y=this.xmf*W*U*I;break;case this.N_POLE:case this.S_POLE:O>=0?(y=(W=Math.sqrt(O))*I,w=S*(this.mode===this.S_POLE?W:-W)):y=w=0}}return f.x=this.a*y+this.x0,f.y=this.a*w+this.y0,f},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var y,w,S,I,v,O,N,U=f.x/this.a,W=f.y/this.a;if(this.sphere){var q,et=0,lt=0;if(q=Math.sqrt(U*U+W*W),(w=.5*q)>1)return null;switch(w=2*Math.asin(w),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(lt=Math.sin(w),et=Math.cos(w)),this.mode){case this.EQUIT:w=Math.abs(q)<=pt?0:Math.asin(W*lt/q),U*=lt,W=et*q;break;case this.OBLIQ:w=Math.abs(q)<=pt?this.lat0:Math.asin(et*this.sinph0+W*lt*this.cosph0/q),U*=lt*this.cosph0,W=(et-Math.sin(w)*this.sinph0)*q;break;case this.N_POLE:W=-W,w=at-w;break;case this.S_POLE:w-=at}y=W!==0||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(U,W):0}else{if(N=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(U/=this.dd,W*=this.dd,(O=Math.sqrt(U*U+W*W))<pt)return f.x=this.long0,f.y=this.lat0,f;I=2*Math.asin(.5*O/this.rq),S=Math.cos(I),U*=I=Math.sin(I),this.mode===this.OBLIQ?(N=S*this.sinb1+W*I*this.cosb1/O,v=this.qp*N,W=O*this.cosb1*S-W*this.sinb1*I):(N=W*I/O,v=this.qp*N,W=O*S)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(W=-W),!(v=U*U+W*W))return f.x=this.long0,f.y=this.lat0,f;N=1-v/this.qp,this.mode===this.S_POLE&&(N=-N)}y=Math.atan2(U,W),w=Xn(Math.asin(N),this.apa)}return f.x=It(this.long0+y),f.y=w,f},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},Zi=function(f){return Math.abs(f)>1&&(f=f>1?1:-1),Math.asin(f)},Dn={init:function(){Math.abs(this.lat1+this.lat2)<pt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=hn(this.e3,this.sin_po,this.cos_po),this.qs1=wn(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=hn(this.e3,this.sin_po,this.cos_po),this.qs2=wn(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=wn(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>pt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(f){var y=f.x,w=f.y;this.sin_phi=Math.sin(w),this.cos_phi=Math.cos(w);var S=wn(this.e3,this.sin_phi),I=this.a*Math.sqrt(this.c-this.ns0*S)/this.ns0,v=this.ns0*It(y-this.long0),O=I*Math.sin(v)+this.x0,N=this.rh-I*Math.cos(v)+this.y0;return f.x=O,f.y=N,f},inverse:function(f){var y,w,S,I,v,O;return f.x-=this.x0,f.y=this.rh-f.y+this.y0,this.ns0>=0?(y=Math.sqrt(f.x*f.x+f.y*f.y),S=1):(y=-Math.sqrt(f.x*f.x+f.y*f.y),S=-1),I=0,y!==0&&(I=Math.atan2(S*f.x,S*f.y)),S=y*this.ns0/this.a,this.sphere?O=Math.asin((this.c-S*S)/(2*this.ns0)):(w=(this.c-S*S)/this.ns0,O=this.phi1z(this.e3,w)),v=It(I/this.ns0+this.long0),f.x=v,f.y=O,f},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(f,y){var w,S,I,v,O,N=Zi(.5*y);if(f<pt)return N;for(var U=f*f,W=1;W<=25;W++)if(w=Math.sin(N),S=Math.cos(N),I=f*w,v=1-I*I,O=.5*v*v/S*(y/(1-U)-w/v+.5/f*Math.log((1-I)/(1+I))),N+=O,Math.abs(O)<=1e-7)return N;return null}},xl={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(f){var y,w,S,I,v,O,N,U=f.x,W=f.y;return S=It(U-this.long0),y=Math.sin(W),w=Math.cos(W),I=Math.cos(S),(v=this.sin_p14*y+this.cos_p14*w*I)>0||Math.abs(v)<=pt?(O=this.x0+1*this.a*w*Math.sin(S)/v,N=this.y0+1*this.a*(this.cos_p14*y-this.sin_p14*w*I)/v):(O=this.x0+this.infinity_dist*w*Math.sin(S),N=this.y0+this.infinity_dist*(this.cos_p14*y-this.sin_p14*w*I)),f.x=O,f.y=N,f},inverse:function(f){var y,w,S,I,v,O;return f.x=(f.x-this.x0)/this.a,f.y=(f.y-this.y0)/this.a,f.x/=this.k0,f.y/=this.k0,(y=Math.sqrt(f.x*f.x+f.y*f.y))?(I=Math.atan2(y,this.rc),w=Math.sin(I),S=Math.cos(I),O=Zi(S*this.sin_p14+f.y*w*this.cos_p14/y),v=Math.atan2(f.x*w,y*this.cos_p14*S-f.y*this.sin_p14*w),v=It(this.long0+v)):(O=this.phic0,v=0),f.x=v,f.y=O,f},names:["gnom"]},it=function(f,y){var w=1-(1-f*f)/(2*f)*Math.log((1-f)/(1+f));if(Math.abs(Math.abs(y)-w)<1e-6)return y<0?-1*at:at;for(var S,I,v,O,N=Math.asin(.5*y),U=0;U<30;U++)if(I=Math.sin(N),v=Math.cos(N),O=f*I,S=Math.pow(1-O*O,2)/(2*v)*(y/(1-f*f)-I/(1-O*O)+.5/f*Math.log((1-O)/(1+O))),N+=S,Math.abs(S)<=1e-10)return N;return NaN},qt={init:function(){this.sphere||(this.k0=hn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(f){var y,w,S=f.x,I=f.y,v=It(S-this.long0);if(this.sphere)y=this.x0+this.a*v*Math.cos(this.lat_ts),w=this.y0+this.a*Math.sin(I)/Math.cos(this.lat_ts);else{var O=wn(this.e,Math.sin(I));y=this.x0+this.a*this.k0*v,w=this.y0+this.a*O*.5/this.k0}return f.x=y,f.y=w,f},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var y,w;return this.sphere?(y=It(this.long0+f.x/this.a/Math.cos(this.lat_ts)),w=Math.asin(f.y/this.a*Math.cos(this.lat_ts))):(w=it(this.e,2*f.y*this.k0/this.a),y=It(this.long0+f.x/(this.a*this.k0))),f.x=y,f.y=w,f},names:["cea"]},ui={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(f){var y=f.x,w=f.y,S=It(y-this.long0),I=fn(w-this.lat0);return f.x=this.x0+this.a*S*this.rc,f.y=this.y0+this.a*I,f},inverse:function(f){var y=f.x,w=f.y;return f.x=It(this.long0+(y-this.x0)/(this.a*this.rc)),f.y=fn(this.lat0+(w-this.y0)/this.a),f},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},js=20,Ho={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=zs(this.es),this.e1=_n(this.es),this.e2=yn(this.es),this.e3=En(this.es),this.ml0=this.a*Ye(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(f){var y,w,S,I=f.x,v=f.y,O=It(I-this.long0);if(S=O*Math.sin(v),this.sphere)Math.abs(v)<=pt?(y=this.a*O,w=-1*this.a*this.lat0):(y=this.a*Math.sin(S)/Math.tan(v),w=this.a*(fn(v-this.lat0)+(1-Math.cos(S))/Math.tan(v)));else if(Math.abs(v)<=pt)y=this.a*O,w=-1*this.ml0;else{var N=Hn(this.a,this.e,Math.sin(v))/Math.tan(v);y=N*Math.sin(S),w=this.a*Ye(this.e0,this.e1,this.e2,this.e3,v)-this.ml0+N*(1-Math.cos(S))}return f.x=y+this.x0,f.y=w+this.y0,f},inverse:function(f){var y,w,S,I,v,O,N,U,W;if(S=f.x-this.x0,I=f.y-this.y0,this.sphere)if(Math.abs(I+this.a*this.lat0)<=pt)y=It(S/this.a+this.long0),w=0;else{O=this.lat0+I/this.a,N=S*S/this.a/this.a+O*O,U=O;var q;for(v=js;v;--v)if(q=Math.tan(U),W=-1*(O*(U*q+1)-U-.5*(U*U+N)*q)/((U-O)/q-1),U+=W,Math.abs(W)<=pt){w=U;break}y=It(this.long0+Math.asin(S*Math.tan(U)/this.a)/Math.sin(w))}else if(Math.abs(I+this.ml0)<=pt)w=0,y=It(this.long0+S/this.a);else{O=(this.ml0+I)/this.a,N=S*S/this.a/this.a+O*O,U=O;var et,lt,mt,st,Ct;for(v=js;v;--v)if(Ct=this.e*Math.sin(U),et=Math.sqrt(1-Ct*Ct)*Math.tan(U),lt=this.a*Ye(this.e0,this.e1,this.e2,this.e3,U),mt=this.e0-2*this.e1*Math.cos(2*U)+4*this.e2*Math.cos(4*U)-6*this.e3*Math.cos(6*U),st=lt/this.a,W=(O*(et*st+1)-st-.5*et*(st*st+N))/(this.es*Math.sin(2*U)*(st*st+N-2*O*st)/(4*et)+(O-st)*(et*mt-2/Math.sin(2*U))-mt),U-=W,Math.abs(W)<=pt){w=U;break}et=Math.sqrt(1-this.es*Math.pow(Math.sin(w),2))*Math.tan(w),y=It(this.long0+Math.asin(S*et/this.a)/Math.sin(w))}return f.x=y,f.y=w,f},names:["Polyconic","poly"]},pl={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(f){var y,w=f.x,S=f.y-this.lat0,I=w-this.long0,v=S/an*1e-5,O=I,N=1,U=0;for(y=1;y<=10;y++)N*=v,U+=this.A[y]*N;var W,q=U,et=O,lt=1,mt=0,st=0,Ct=0;for(y=1;y<=6;y++)W=mt*q+lt*et,lt=lt*q-mt*et,mt=W,st=st+this.B_re[y]*lt-this.B_im[y]*mt,Ct=Ct+this.B_im[y]*lt+this.B_re[y]*mt;return f.x=Ct*this.a+this.x0,f.y=st*this.a+this.y0,f},inverse:function(f){var y,w,S=f.x,I=f.y,v=S-this.x0,O=(I-this.y0)/this.a,N=v/this.a,U=1,W=0,q=0,et=0;for(y=1;y<=6;y++)w=W*O+U*N,U=U*O-W*N,W=w,q=q+this.C_re[y]*U-this.C_im[y]*W,et=et+this.C_im[y]*U+this.C_re[y]*W;for(var lt=0;lt<this.iterations;lt++){var mt,st=q,Ct=et,T=O,i=N;for(y=2;y<=6;y++)mt=Ct*q+st*et,st=st*q-Ct*et,Ct=mt,T+=(y-1)*(this.B_re[y]*st-this.B_im[y]*Ct),i+=(y-1)*(this.B_im[y]*st+this.B_re[y]*Ct);st=1,Ct=0;var o=this.B_re[1],a=this.B_im[1];for(y=2;y<=6;y++)mt=Ct*q+st*et,st=st*q-Ct*et,Ct=mt,o+=y*(this.B_re[y]*st-this.B_im[y]*Ct),a+=y*(this.B_im[y]*st+this.B_re[y]*Ct);var h=o*o+a*a;q=(T*o+i*a)/h,et=(i*o-T*a)/h}var c=q,d=et,x=1,_=0;for(y=1;y<=9;y++)x*=c,_+=this.D[y]*x;var C=this.lat0+_*an*1e5,M=this.long0+d;return f.x=M,f.y=C,f},names:["New_Zealand_Map_Grid","nzmg"]},_l={init:function(){},forward:function(f){var y=f.x,w=f.y,S=It(y-this.long0),I=this.x0+this.a*S,v=this.y0+this.a*Math.log(Math.tan(Math.PI/4+w/2.5))*1.25;return f.x=I,f.y=v,f},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var y=It(this.long0+f.x/this.a),w=2.5*(Math.atan(Math.exp(.8*f.y/this.a))-Math.PI/4);return f.x=y,f.y=w,f},names:["Miller_Cylindrical","mill"]},yl=20,qr={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=B(this.es)},forward:function(f){var y,w,S=f.x,I=f.y;if(S=It(S-this.long0),this.sphere){if(this.m)for(var v=this.n*Math.sin(I),O=yl;O;--O){var N=(this.m*I+Math.sin(I)-v)/(this.m+Math.cos(I));if(I-=N,Math.abs(N)<pt)break}else I=this.n!==1?Math.asin(this.n*Math.sin(I)):I;y=this.a*this.C_x*S*(this.m+Math.cos(I)),w=this.a*this.C_y*I}else{var U=Math.sin(I),W=Math.cos(I);w=this.a*Dt(I,U,W,this.en),y=this.a*S*W/Math.sqrt(1-this.es*U*U)}return f.x=y,f.y=w,f},inverse:function(f){var y,w,S,I;return f.x-=this.x0,S=f.x/this.a,f.y-=this.y0,y=f.y/this.a,this.sphere?(y/=this.C_y,S/=this.C_x*(this.m+Math.cos(y)),this.m?y=Zi((this.m*y+Math.sin(y))/this.n):this.n!==1&&(y=Zi(Math.sin(y)/this.n)),S=It(S+this.long0),y=fn(y)):(y=oi(f.y/this.a,this.es,this.en),(I=Math.abs(y))<at?(I=Math.sin(y),w=this.long0+f.x*Math.sqrt(1-this.es*I*I)/(this.a*Math.cos(y)),S=It(w)):I-pt<at&&(S=this.long0)),f.x=S,f.y=y,f},names:["Sinusoidal","sinu"]},ai={init:function(){},forward:function(f){for(var y=f.x,w=f.y,S=It(y-this.long0),I=w,v=Math.PI*Math.sin(w);;){var O=-(I+Math.sin(I)-v)/(1+Math.cos(I));if(I+=O,Math.abs(O)<pt)break}I/=2,Math.PI/2-Math.abs(w)<pt&&(S=0);var N=.900316316158*this.a*S*Math.cos(I)+this.x0,U=1.4142135623731*this.a*Math.sin(I)+this.y0;return f.x=N,f.y=U,f},inverse:function(f){var y,w;f.x-=this.x0,f.y-=this.y0,w=f.y/(1.4142135623731*this.a),Math.abs(w)>.999999999999&&(w=.999999999999),y=Math.asin(w);var S=It(this.long0+f.x/(.900316316158*this.a*Math.cos(y)));S<-Math.PI&&(S=-Math.PI),S>Math.PI&&(S=Math.PI),w=(2*y+Math.sin(2*y))/Math.PI,Math.abs(w)>1&&(w=1);var I=Math.asin(w);return f.x=S,f.y=I,f},names:["Mollweide","moll"]},Qr={init:function(){Math.abs(this.lat1+this.lat2)<pt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=zs(this.es),this.e1=_n(this.es),this.e2=yn(this.es),this.e3=En(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=hn(this.e,this.sinphi,this.cosphi),this.ml1=Ye(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<pt?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=hn(this.e,this.sinphi,this.cosphi),this.ml2=Ye(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ye(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(f){var y,w=f.x,S=f.y;if(this.sphere)y=this.a*(this.g-S);else{var I=Ye(this.e0,this.e1,this.e2,this.e3,S);y=this.a*(this.g-I)}var v=this.ns*It(w-this.long0),O=this.x0+y*Math.sin(v),N=this.y0+this.rh-y*Math.cos(v);return f.x=O,f.y=N,f},inverse:function(f){f.x-=this.x0,f.y=this.rh-f.y+this.y0;var y,w,S,I;this.ns>=0?(w=Math.sqrt(f.x*f.x+f.y*f.y),y=1):(w=-Math.sqrt(f.x*f.x+f.y*f.y),y=-1);var v=0;if(w!==0&&(v=Math.atan2(y*f.x,y*f.y)),this.sphere)return I=It(this.long0+v/this.ns),S=fn(this.g-w/this.a),f.x=I,f.y=S,f;var O=this.g-w/this.a;return S=On(O,this.e0,this.e1,this.e2,this.e3),I=It(this.long0+v/this.ns),f.x=I,f.y=S,f},names:["Equidistant_Conic","eqdc"]},We={init:function(){this.R=this.a},forward:function(f){var y,w,S=f.x,I=f.y,v=It(S-this.long0);Math.abs(I)<=pt&&(y=this.x0+this.R*v,w=this.y0);var O=Zi(2*Math.abs(I/Math.PI));(Math.abs(v)<=pt||Math.abs(Math.abs(I)-at)<=pt)&&(y=this.x0,w=I>=0?this.y0+Math.PI*this.R*Math.tan(.5*O):this.y0+Math.PI*this.R*-Math.tan(.5*O));var N=.5*Math.abs(Math.PI/v-v/Math.PI),U=N*N,W=Math.sin(O),q=Math.cos(O),et=q/(W+q-1),lt=et*et,mt=et*(2/W-1),st=mt*mt,Ct=Math.PI*this.R*(N*(et-st)+Math.sqrt(U*(et-st)*(et-st)-(st+U)*(lt-st)))/(st+U);v<0&&(Ct=-Ct),y=this.x0+Ct;var T=U+et;return Ct=Math.PI*this.R*(mt*T-N*Math.sqrt((st+U)*(U+1)-T*T))/(st+U),w=I>=0?this.y0+Ct:this.y0-Ct,f.x=y,f.y=w,f},inverse:function(f){var y,w,S,I,v,O,N,U,W,q,et,lt,mt;return f.x-=this.x0,f.y-=this.y0,et=Math.PI*this.R,S=f.x/et,I=f.y/et,v=S*S+I*I,O=-Math.abs(I)*(1+v),N=O-2*I*I+S*S,U=-2*O+1+2*I*I+v*v,mt=I*I/U+(2*N*N*N/U/U/U-9*O*N/U/U)/27,W=(O-N*N/3/U)/U,q=2*Math.sqrt(-W/3),et=3*mt/W/q,Math.abs(et)>1&&(et=et>=0?1:-1),lt=Math.acos(et)/3,w=f.y>=0?(-q*Math.cos(lt+Math.PI/3)-N/3/U)*Math.PI:-(-q*Math.cos(lt+Math.PI/3)-N/3/U)*Math.PI,y=Math.abs(S)<pt?this.long0:It(this.long0+Math.PI*(v-1+Math.sqrt(1+2*(S*S-I*I)+v*v))/2/S),f.x=y,f.y=w,f},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},fr={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(f){var y,w,S,I,v,O,N,U,W,q,et,lt,mt,st,Ct,T,i,o,a,h,c,d,x,_=f.x,C=f.y,M=Math.sin(f.y),R=Math.cos(f.y),L=It(_-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=pt?(f.x=this.x0+this.a*(at-C)*Math.sin(L),f.y=this.y0-this.a*(at-C)*Math.cos(L),f):Math.abs(this.sin_p12+1)<=pt?(f.x=this.x0+this.a*(at+C)*Math.sin(L),f.y=this.y0+this.a*(at+C)*Math.cos(L),f):(o=this.sin_p12*M+this.cos_p12*R*Math.cos(L),T=Math.acos(o),i=T?T/Math.sin(T):1,f.x=this.x0+this.a*i*R*Math.sin(L),f.y=this.y0+this.a*i*(this.cos_p12*M-this.sin_p12*R*Math.cos(L)),f):(y=zs(this.es),w=_n(this.es),S=yn(this.es),I=En(this.es),Math.abs(this.sin_p12-1)<=pt?(v=this.a*Ye(y,w,S,I,at),O=this.a*Ye(y,w,S,I,C),f.x=this.x0+(v-O)*Math.sin(L),f.y=this.y0-(v-O)*Math.cos(L),f):Math.abs(this.sin_p12+1)<=pt?(v=this.a*Ye(y,w,S,I,at),O=this.a*Ye(y,w,S,I,C),f.x=this.x0+(v+O)*Math.sin(L),f.y=this.y0+(v+O)*Math.cos(L),f):(N=M/R,U=Hn(this.a,this.e,this.sin_p12),W=Hn(this.a,this.e,M),q=Math.atan((1-this.es)*N+this.es*U*this.sin_p12/(W*R)),et=Math.atan2(Math.sin(L),this.cos_p12*Math.tan(q)-this.sin_p12*Math.cos(L)),a=et===0?Math.asin(this.cos_p12*Math.sin(q)-this.sin_p12*Math.cos(q)):Math.abs(Math.abs(et)-Math.PI)<=pt?-Math.asin(this.cos_p12*Math.sin(q)-this.sin_p12*Math.cos(q)):Math.asin(Math.sin(L)*Math.cos(q)/Math.sin(et)),lt=this.e*this.sin_p12/Math.sqrt(1-this.es),mt=this.e*this.cos_p12*Math.cos(et)/Math.sqrt(1-this.es),st=lt*mt,Ct=mt*mt,h=a*a,c=h*a,d=c*a,x=d*a,T=U*a*(1-h*Ct*(1-Ct)/6+c/8*st*(1-2*Ct)+d/120*(Ct*(4-7*Ct)-3*lt*lt*(1-7*Ct))-x/48*st),f.x=this.x0+T*Math.sin(et),f.y=this.y0+T*Math.cos(et),f))},inverse:function(f){f.x-=this.x0,f.y-=this.y0;var y,w,S,I,v,O,N,U,W,q,et,lt,mt,st,Ct,T,i,o,a,h,c,d,x,_;return this.sphere?(y=Math.sqrt(f.x*f.x+f.y*f.y))>2*at*this.a?void 0:(w=y/this.a,S=Math.sin(w),I=Math.cos(w),v=this.long0,Math.abs(y)<=pt?O=this.lat0:(O=Zi(I*this.sin_p12+f.y*S*this.cos_p12/y),N=Math.abs(this.lat0)-at,v=It(Math.abs(N)<=pt?this.lat0>=0?this.long0+Math.atan2(f.x,-f.y):this.long0-Math.atan2(-f.x,f.y):this.long0+Math.atan2(f.x*S,y*this.cos_p12*I-f.y*this.sin_p12*S))),f.x=v,f.y=O,f):(U=zs(this.es),W=_n(this.es),q=yn(this.es),et=En(this.es),Math.abs(this.sin_p12-1)<=pt?(lt=this.a*Ye(U,W,q,et,at),y=Math.sqrt(f.x*f.x+f.y*f.y),mt=lt-y,O=On(mt/this.a,U,W,q,et),v=It(this.long0+Math.atan2(f.x,-1*f.y)),f.x=v,f.y=O,f):Math.abs(this.sin_p12+1)<=pt?(lt=this.a*Ye(U,W,q,et,at),y=Math.sqrt(f.x*f.x+f.y*f.y),mt=y-lt,O=On(mt/this.a,U,W,q,et),v=It(this.long0+Math.atan2(f.x,f.y)),f.x=v,f.y=O,f):(y=Math.sqrt(f.x*f.x+f.y*f.y),T=Math.atan2(f.x,f.y),st=Hn(this.a,this.e,this.sin_p12),i=Math.cos(T),o=this.e*this.cos_p12*i,a=-o*o/(1-this.es),h=3*this.es*(1-a)*this.sin_p12*this.cos_p12*i/(1-this.es),c=y/st,d=c-a*(1+a)*Math.pow(c,3)/6-h*(1+3*a)*Math.pow(c,4)/24,x=1-a*d*d/2-c*d*d*d/6,Ct=Math.asin(this.sin_p12*Math.cos(d)+this.cos_p12*Math.sin(d)*i),v=It(this.long0+Math.asin(Math.sin(T)*Math.sin(d)/Math.cos(Ct))),_=Math.sin(Ct),O=Math.atan2((_-this.es*x*this.sin_p12)*Math.tan(Ct),_*(1-this.es)),f.x=v,f.y=O,f))},names:["Azimuthal_Equidistant","aeqd"]},Zn={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(f){var y,w,S,I,v,O,N,U=f.x,W=f.y;return S=It(U-this.long0),y=Math.sin(W),w=Math.cos(W),I=Math.cos(S),((v=this.sin_p14*y+this.cos_p14*w*I)>0||Math.abs(v)<=pt)&&(O=1*this.a*w*Math.sin(S),N=this.y0+1*this.a*(this.cos_p14*y-this.sin_p14*w*I)),f.x=O,f.y=N,f},inverse:function(f){var y,w,S,I,v,O,N;return f.x-=this.x0,f.y-=this.y0,y=Math.sqrt(f.x*f.x+f.y*f.y),w=Zi(y/this.a),S=Math.sin(w),I=Math.cos(w),O=this.long0,Math.abs(y)<=pt?(N=this.lat0,f.x=O,f.y=N,f):(N=Zi(I*this.sin_p14+f.y*S*this.cos_p14/y),v=Math.abs(this.lat0)-at,Math.abs(v)<=pt?(O=It(this.lat0>=0?this.long0+Math.atan2(f.x,-f.y):this.long0-Math.atan2(-f.x,f.y)),f.x=O,f.y=N,f):(O=It(this.long0+Math.atan2(f.x*S,y*this.cos_p14*I-f.y*this.sin_p14*S)),f.x=O,f.y=N,f))},names:["ortho"]},zt={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},At={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4},El={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=at-jt/2?this.face=zt.TOP:this.lat0<=-(at-jt/2)?this.face=zt.BOTTOM:Math.abs(this.long0)<=jt?this.face=zt.FRONT:Math.abs(this.long0)<=at+jt?this.face=this.long0>0?zt.RIGHT:zt.LEFT:this.face=zt.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(f){var y,w,S,I,v,O,N={x:0,y:0},U={value:0};if(f.x-=this.long0,y=this.es!==0?Math.atan(this.one_minus_f_squared*Math.tan(f.y)):f.y,w=f.x,this.face===zt.TOP)I=at-y,w>=jt&&w<=at+jt?(U.value=At.AREA_0,S=w-at):w>at+jt||w<=-(at+jt)?(U.value=At.AREA_1,S=w>0?w-Vt:w+Vt):w>-(at+jt)&&w<=-jt?(U.value=At.AREA_2,S=w+at):(U.value=At.AREA_3,S=w);else if(this.face===zt.BOTTOM)I=at+y,w>=jt&&w<=at+jt?(U.value=At.AREA_0,S=-w+at):w<jt&&w>=-jt?(U.value=At.AREA_1,S=-w):w<-jt&&w>=-(at+jt)?(U.value=At.AREA_2,S=-w-at):(U.value=At.AREA_3,S=w>0?-w+Vt:-w-Vt);else{var W,q,et,lt,mt,st;this.face===zt.RIGHT?w=Ce(w,+at):this.face===zt.BACK?w=Ce(w,+Vt):this.face===zt.LEFT&&(w=Ce(w,-at)),lt=Math.sin(y),mt=Math.cos(y),st=Math.sin(w),W=mt*Math.cos(w),q=mt*st,et=lt,this.face===zt.FRONT?S=Vn(I=Math.acos(W),et,q,U):this.face===zt.RIGHT?S=Vn(I=Math.acos(q),et,-W,U):this.face===zt.BACK?S=Vn(I=Math.acos(-W),et,-q,U):this.face===zt.LEFT?S=Vn(I=Math.acos(-q),et,W,U):(I=S=0,U.value=At.AREA_0)}return O=Math.atan(12/Vt*(S+Math.acos(Math.sin(S)*Math.cos(jt))-at)),v=Math.sqrt((1-Math.cos(I))/(Math.cos(O)*Math.cos(O))/(1-Math.cos(Math.atan(1/Math.cos(S))))),U.value===At.AREA_1?O+=at:U.value===At.AREA_2?O+=Vt:U.value===At.AREA_3&&(O+=1.5*Vt),N.x=v*Math.cos(O),N.y=v*Math.sin(O),N.x=N.x*this.a+this.x0,N.y=N.y*this.a+this.y0,f.x=N.x,f.y=N.y,f},inverse:function(f){var y,w,S,I,v,O,N,U,W,q={lam:0,phi:0},et={value:0};if(f.x=(f.x-this.x0)/this.a,f.y=(f.y-this.y0)/this.a,w=Math.atan(Math.sqrt(f.x*f.x+f.y*f.y)),y=Math.atan2(f.y,f.x),f.x>=0&&f.x>=Math.abs(f.y)?et.value=At.AREA_0:f.y>=0&&f.y>=Math.abs(f.x)?(et.value=At.AREA_1,y-=at):f.x<0&&-f.x>=Math.abs(f.y)?(et.value=At.AREA_2,y=y<0?y+Vt:y-Vt):(et.value=At.AREA_3,y+=at),W=Vt/12*Math.tan(y),v=Math.sin(W)/(Math.cos(W)-1/Math.sqrt(2)),O=Math.atan(v),S=Math.cos(y),I=Math.tan(w),(N=1-S*S*I*I*(1-Math.cos(Math.atan(1/Math.cos(O)))))<-1?N=-1:N>1&&(N=1),this.face===zt.TOP)U=Math.acos(N),q.phi=at-U,et.value===At.AREA_0?q.lam=O+at:et.value===At.AREA_1?q.lam=O<0?O+Vt:O-Vt:et.value===At.AREA_2?q.lam=O-at:q.lam=O;else if(this.face===zt.BOTTOM)U=Math.acos(N),q.phi=U-at,et.value===At.AREA_0?q.lam=-O+at:et.value===At.AREA_1?q.lam=-O:et.value===At.AREA_2?q.lam=-O-at:q.lam=O<0?-O-Vt:-O+Vt;else{var lt,mt,st;W=(lt=N)*lt,mt=(W+=(st=W>=1?0:Math.sqrt(1-W)*Math.sin(O))*st)>=1?0:Math.sqrt(1-W),et.value===At.AREA_1?(W=mt,mt=-st,st=W):et.value===At.AREA_2?(mt=-mt,st=-st):et.value===At.AREA_3&&(W=mt,mt=st,st=-W),this.face===zt.RIGHT?(W=lt,lt=-mt,mt=W):this.face===zt.BACK?(lt=-lt,mt=-mt):this.face===zt.LEFT&&(W=lt,lt=mt,mt=-W),q.phi=Math.acos(-st)-at,q.lam=Math.atan2(mt,lt),this.face===zt.RIGHT?q.lam=Ce(q.lam,-at):this.face===zt.BACK?q.lam=Ce(q.lam,-Vt):this.face===zt.LEFT&&(q.lam=Ce(q.lam,+at))}if(this.es!==0){var Ct,T,i;Ct=q.phi<0?1:0,T=Math.tan(q.phi),i=this.b/Math.sqrt(T*T+this.one_minus_f_squared),q.phi=Math.atan(Math.sqrt(this.a*this.a-i*i)/(this.one_minus_f*i)),Ct&&(q.phi=-q.phi)}return q.lam+=this.long0,f.x=q.lam,f.y=q.phi,f},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},be=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Ki=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Kn=.8487,Zo=1.3523,qi=ce/5,Jr=1/qi,qn=18,_s=function(f,y){return f[0]+y*(f[1]+y*(f[2]+y*f[3]))},Ko=function(f,y){return f[1]+y*(2*f[2]+3*y*f[3])},qo={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(f){var y=It(f.x-this.long0),w=Math.abs(f.y),S=Math.floor(w*qi);S<0?S=0:S>=qn&&(S=qn-1),w=ce*(w-Jr*S);var I={x:_s(be[S],w)*y,y:_s(Ki[S],w)};return f.y<0&&(I.y=-I.y),I.x=I.x*this.a*Kn+this.x0,I.y=I.y*this.a*Zo+this.y0,I},inverse:function(f){var y={x:(f.x-this.x0)/(this.a*Kn),y:Math.abs(f.y-this.y0)/(this.a*Zo)};if(y.y>=1)y.x/=be[qn][0],y.y=f.y<0?-at:at;else{var w=Math.floor(y.y*qn);for(w<0?w=0:w>=qn&&(w=qn-1);;)if(Ki[w][0]>y.y)--w;else{if(!(Ki[w+1][0]<=y.y))break;++w}var S=Ki[w],I=5*(y.y-S[0])/(Ki[w+1][0]-S[0]);I=wt(function(v){return(_s(S,v)-y.y)/Ko(S,v)},I,pt,100),y.x/=_s(be[w],I),y.y=(5*w+I)*ue,f.y<0&&(y.y=-y.y)}return y.x=It(y.x+this.long0),y},names:["Robinson","robin"]},wl={init:function(){this.name="geocent"},forward:function(f){return re(f,this.es,this.a)},inverse:function(f){return Ut(f,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},He={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Qn={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}},Cl={init:function(){if(Object.keys(Qn).forEach(function(w){if(this[w]===void 0)this[w]=Qn[w].def;else{if(Qn[w].num&&isNaN(this[w]))throw new Error("Invalid parameter value, must be numeric "+w+" = "+this[w]);Qn[w].num&&(this[w]=parseFloat(this[w]))}Qn[w].degrees&&(this[w]=this[w]*ue)}.bind(this)),Math.abs(Math.abs(this.lat0)-at)<pt?this.mode=this.lat0<0?He.S_POLE:He.N_POLE:Math.abs(this.lat0)<pt?this.mode=He.EQUIT:(this.mode=He.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var f=this.tilt,y=this.azi;this.cg=Math.cos(y),this.sg=Math.sin(y),this.cw=Math.cos(f),this.sw=Math.sin(f)},forward:function(f){f.x-=this.long0;var y,w,S=Math.sin(f.y),I=Math.cos(f.y),v=Math.cos(f.x);switch(this.mode){case He.OBLIQ:w=this.sinph0*S+this.cosph0*I*v;break;case He.EQUIT:w=I*v;break;case He.S_POLE:w=-S;break;case He.N_POLE:w=S}switch(w=this.pn1/(this.p-w),y=w*I*Math.sin(f.x),this.mode){case He.OBLIQ:w*=this.cosph0*S-this.sinph0*I*v;break;case He.EQUIT:w*=S;break;case He.N_POLE:w*=-I*v;break;case He.S_POLE:w*=I*v}var O,N;return O=w*this.cg+y*this.sg,N=1/(O*this.sw*this.h1+this.cw),y=(y*this.cg-w*this.sg)*this.cw*N,w=O*N,f.x=y*this.a,f.y=w*this.a,f},inverse:function(f){f.x/=this.a,f.y/=this.a;var y,w,S,I={x:f.x,y:f.y};S=1/(this.pn1-f.y*this.sw),y=this.pn1*f.x*S,w=this.pn1*f.y*this.cw*S,f.x=y*this.cg+w*this.sg,f.y=w*this.cg-y*this.sg;var v=bi(f.x,f.y);if(Math.abs(v)<pt)I.x=0,I.y=f.y;else{var O,N;switch(N=1-v*v*this.pfact,N=(this.p-Math.sqrt(N))/(this.pn1/v+v/this.pn1),O=Math.sqrt(1-N*N),this.mode){case He.OBLIQ:I.y=Math.asin(O*this.sinph0+f.y*N*this.cosph0/v),f.y=(O-this.sinph0*Math.sin(I.y))*v,f.x*=N*this.cosph0;break;case He.EQUIT:I.y=Math.asin(f.y*N/v),f.y=O*v,f.x*=N;break;case He.N_POLE:I.y=Math.asin(O),f.y=-f.y;break;case He.S_POLE:I.y=-Math.asin(O)}I.x=Math.atan2(f.x,f.y)}return f.x=I.x+this.long0,f.y=I.y,f},names:["Tilted_Perspective","tpers"]},Ws={init:function(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var f=1-this.es,y=1/f;this.radius_p=Math.sqrt(f),this.radius_p2=f,this.radius_p_inv2=y,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(f){var y,w,S,I,v=f.x,O=f.y;if(v-=this.long0,this.shape==="ellipse"){O=Math.atan(this.radius_p2*Math.tan(O));var N=this.radius_p/bi(this.radius_p*Math.cos(O),Math.sin(O));if(w=N*Math.cos(v)*Math.cos(O),S=N*Math.sin(v)*Math.cos(O),I=N*Math.sin(O),(this.radius_g-w)*w-S*S-I*I*this.radius_p_inv2<0)return f.x=Number.NaN,f.y=Number.NaN,f;y=this.radius_g-w,this.flip_axis?(f.x=this.radius_g_1*Math.atan(S/bi(I,y)),f.y=this.radius_g_1*Math.atan(I/y)):(f.x=this.radius_g_1*Math.atan(S/y),f.y=this.radius_g_1*Math.atan(I/bi(S,y)))}else this.shape==="sphere"&&(y=Math.cos(O),w=Math.cos(v)*y,S=Math.sin(v)*y,I=Math.sin(O),y=this.radius_g-w,this.flip_axis?(f.x=this.radius_g_1*Math.atan(S/bi(I,y)),f.y=this.radius_g_1*Math.atan(I/y)):(f.x=this.radius_g_1*Math.atan(S/y),f.y=this.radius_g_1*Math.atan(I/bi(S,y))));return f.x=f.x*this.a,f.y=f.y*this.a,f},inverse:function(f){var y,w,S,I,v=-1,O=0,N=0;if(f.x=f.x/this.a,f.y=f.y/this.a,this.shape==="ellipse"){this.flip_axis?(N=Math.tan(f.y/this.radius_g_1),O=Math.tan(f.x/this.radius_g_1)*bi(1,N)):(O=Math.tan(f.x/this.radius_g_1),N=Math.tan(f.y/this.radius_g_1)*bi(1,O));var U=N/this.radius_p;if(y=O*O+U*U+v*v,w=2*this.radius_g*v,(S=w*w-4*y*this.C)<0)return f.x=Number.NaN,f.y=Number.NaN,f;I=(-w-Math.sqrt(S))/(2*y),v=this.radius_g+I*v,O*=I,N*=I,f.x=Math.atan2(O,v),f.y=Math.atan(N*Math.cos(f.x)/v),f.y=Math.atan(this.radius_p_inv2*Math.tan(f.y))}else if(this.shape==="sphere"){if(this.flip_axis?(N=Math.tan(f.y/this.radius_g_1),O=Math.tan(f.x/this.radius_g_1)*Math.sqrt(1+N*N)):(O=Math.tan(f.x/this.radius_g_1),N=Math.tan(f.y/this.radius_g_1)*Math.sqrt(1+O*O)),y=O*O+N*N+v*v,w=2*this.radius_g*v,(S=w*w-4*y*this.C)<0)return f.x=Number.NaN,f.y=Number.NaN,f;I=(-w-Math.sqrt(S))/(2*y),v=this.radius_g+I*v,O*=I,N*=I,f.x=Math.atan2(O,v),f.y=Math.atan(N*Math.cos(f.x)/v)}return f.x=f.x+this.long0,f},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};return ze.defaultDatum="WGS84",ze.Proj=Et,ze.WGS84=new ze.Proj("WGS84"),ze.Point=Ke,ze.toPoint=hr,ze.defs=E,ze.nadgrid=function(f,y){var w=new DataView(y),S=Ot(w),I=St(w,S),v={header:I,subgrids:yt(w,I,S)};return ge[f]=v,v},ze.transform=fi,ze.mgrs=mi,ze.version="2.10.0",function(f){f.Proj.projections.add(wi),f.Proj.projections.add(Yn),f.Proj.projections.add(cl),f.Proj.projections.add(Gt),f.Proj.projections.add(ul),f.Proj.projections.add(Zt),f.Proj.projections.add(fl),f.Proj.projections.add(Kr),f.Proj.projections.add(Wo),f.Proj.projections.add(Ri),f.Proj.projections.add(Yo),f.Proj.projections.add(Dn),f.Proj.projections.add(xl),f.Proj.projections.add(qt),f.Proj.projections.add(ui),f.Proj.projections.add(Ho),f.Proj.projections.add(pl),f.Proj.projections.add(_l),f.Proj.projections.add(qr),f.Proj.projections.add(ai),f.Proj.projections.add(Qr),f.Proj.projections.add(We),f.Proj.projections.add(fr),f.Proj.projections.add(Zn),f.Proj.projections.add(El),f.Proj.projections.add(qo),f.Proj.projections.add(wl),f.Proj.projections.add(Cl),f.Proj.projections.add(Ws)}(ze),ze})})(pf);var ix=pf.exports;const fc=xf(ix);function nx(s){const t=Object.keys(s.defs),e=t.length;let n,r;for(n=0;n<e;++n){const l=t[n];if(!Ge(l)){const u=s.defs(l);let g=u.units;!g&&u.projName==="longlat"&&(g="degrees"),r0(new Rh({code:l,axisOrientation:u.axis,metersPerUnit:u.to_meter,units:g}))}}for(n=0;n<e;++n){const l=t[n],u=Ge(l);for(r=0;r<e;++r){const g=t[r],m=Ge(g);if(!t0(l,g))if(s.defs[l]===s.defs[g])$l([u,m]);else{const p=s(l,g);Sd(u,m,Nc(u,m,p.forward),Nc(m,u,p.inverse))}}}}var Bo={},sx=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},_f={},rn={};let dc;const rx=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];rn.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};rn.getSymbolTotalCodewords=function(t){return rx[t]};rn.getBCHDigit=function(s){let t=0;for(;s!==0;)t++,s>>>=1;return t};rn.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');dc=t};rn.isKanjiModeEnabled=function(){return typeof dc<"u"};rn.toSJIS=function(t){return dc(t)};var nl={};(function(s){s.L={bit:1},s.M={bit:0},s.Q={bit:3},s.H={bit:2};function t(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return s.L;case"m":case"medium":return s.M;case"q":case"quartile":return s.Q;case"h":case"high":return s.H;default:throw new Error("Unknown EC Level: "+e)}}s.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},s.from=function(n,r){if(s.isValid(n))return n;try{return t(n)}catch{return r}}})(nl);function yf(){this.buffer=[],this.length=0}yf.prototype={get:function(s){const t=Math.floor(s/8);return(this.buffer[t]>>>7-s%8&1)===1},put:function(s,t){for(let e=0;e<t;e++)this.putBit((s>>>t-e-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(s){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),s&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var ox=yf;function ko(s){if(!s||s<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=s,this.data=new Uint8Array(s*s),this.reservedBit=new Uint8Array(s*s)}ko.prototype.set=function(s,t,e,n){const r=s*this.size+t;this.data[r]=e,n&&(this.reservedBit[r]=!0)};ko.prototype.get=function(s,t){return this.data[s*this.size+t]};ko.prototype.xor=function(s,t,e){this.data[s*this.size+t]^=e};ko.prototype.isReserved=function(s,t){return this.reservedBit[s*this.size+t]};var ax=ko,Ef={};(function(s){const t=rn.getSymbolSize;s.getRowColCoords=function(n){if(n===1)return[];const r=Math.floor(n/7)+2,l=t(n),u=l===145?26:Math.ceil((l-13)/(2*r-2))*2,g=[l-7];for(let m=1;m<r-1;m++)g[m]=g[m-1]-u;return g.push(6),g.reverse()},s.getPositions=function(n){const r=[],l=s.getRowColCoords(n),u=l.length;for(let g=0;g<u;g++)for(let m=0;m<u;m++)g===0&&m===0||g===0&&m===u-1||g===u-1&&m===0||r.push([l[g],l[m]]);return r}})(Ef);var wf={};const lx=rn.getSymbolSize,_u=7;wf.getPositions=function(t){const e=lx(t);return[[0,0],[e-_u,0],[0,e-_u]]};var Cf={};(function(s){s.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};s.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},s.from=function(r){return s.isValid(r)?parseInt(r,10):void 0},s.getPenaltyN1=function(r){const l=r.size;let u=0,g=0,m=0,p=null,E=null;for(let A=0;A<l;A++){g=m=0,p=E=null;for(let b=0;b<l;b++){let D=r.get(A,b);D===p?g++:(g>=5&&(u+=t.N1+(g-5)),p=D,g=1),D=r.get(b,A),D===E?m++:(m>=5&&(u+=t.N1+(m-5)),E=D,m=1)}g>=5&&(u+=t.N1+(g-5)),m>=5&&(u+=t.N1+(m-5))}return u},s.getPenaltyN2=function(r){const l=r.size;let u=0;for(let g=0;g<l-1;g++)for(let m=0;m<l-1;m++){const p=r.get(g,m)+r.get(g,m+1)+r.get(g+1,m)+r.get(g+1,m+1);(p===4||p===0)&&u++}return u*t.N2},s.getPenaltyN3=function(r){const l=r.size;let u=0,g=0,m=0;for(let p=0;p<l;p++){g=m=0;for(let E=0;E<l;E++)g=g<<1&2047|r.get(p,E),E>=10&&(g===1488||g===93)&&u++,m=m<<1&2047|r.get(E,p),E>=10&&(m===1488||m===93)&&u++}return u*t.N3},s.getPenaltyN4=function(r){let l=0;const u=r.data.length;for(let m=0;m<u;m++)l+=r.data[m];return Math.abs(Math.ceil(l*100/u/5)-10)*t.N4};function e(n,r,l){switch(n){case s.Patterns.PATTERN000:return(r+l)%2===0;case s.Patterns.PATTERN001:return r%2===0;case s.Patterns.PATTERN010:return l%3===0;case s.Patterns.PATTERN011:return(r+l)%3===0;case s.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(l/3))%2===0;case s.Patterns.PATTERN101:return r*l%2+r*l%3===0;case s.Patterns.PATTERN110:return(r*l%2+r*l%3)%2===0;case s.Patterns.PATTERN111:return(r*l%3+(r+l)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}s.applyMask=function(r,l){const u=l.size;for(let g=0;g<u;g++)for(let m=0;m<u;m++)l.isReserved(m,g)||l.xor(m,g,e(r,m,g))},s.getBestMask=function(r,l){const u=Object.keys(s.Patterns).length;let g=0,m=1/0;for(let p=0;p<u;p++){l(p),s.applyMask(p,r);const E=s.getPenaltyN1(r)+s.getPenaltyN2(r)+s.getPenaltyN3(r)+s.getPenaltyN4(r);s.applyMask(p,r),E<m&&(m=E,g=p)}return g}})(Cf);var sl={};const vs=nl,ha=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],ca=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];sl.getBlocksCount=function(t,e){switch(e){case vs.L:return ha[(t-1)*4+0];case vs.M:return ha[(t-1)*4+1];case vs.Q:return ha[(t-1)*4+2];case vs.H:return ha[(t-1)*4+3];default:return}};sl.getTotalCodewordsCount=function(t,e){switch(e){case vs.L:return ca[(t-1)*4+0];case vs.M:return ca[(t-1)*4+1];case vs.Q:return ca[(t-1)*4+2];case vs.H:return ca[(t-1)*4+3];default:return}};var Af={},rl={};const co=new Uint8Array(512),va=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)co[e]=t,va[t]=e,t<<=1,t&256&&(t^=285);for(let e=255;e<512;e++)co[e]=co[e-255]})();rl.log=function(t){if(t<1)throw new Error("log("+t+")");return va[t]};rl.exp=function(t){return co[t]};rl.mul=function(t,e){return t===0||e===0?0:co[va[t]+va[e]]};(function(s){const t=rl;s.mul=function(n,r){const l=new Uint8Array(n.length+r.length-1);for(let u=0;u<n.length;u++)for(let g=0;g<r.length;g++)l[u+g]^=t.mul(n[u],r[g]);return l},s.mod=function(n,r){let l=new Uint8Array(n);for(;l.length-r.length>=0;){const u=l[0];for(let m=0;m<r.length;m++)l[m]^=t.mul(r[m],u);let g=0;for(;g<l.length&&l[g]===0;)g++;l=l.slice(g)}return l},s.generateECPolynomial=function(n){let r=new Uint8Array([1]);for(let l=0;l<n;l++)r=s.mul(r,new Uint8Array([1,t.exp(l)]));return r}})(Af);const If=Af;function gc(s){this.genPoly=void 0,this.degree=s,this.degree&&this.initialize(this.degree)}gc.prototype.initialize=function(t){this.degree=t,this.genPoly=If.generateECPolynomial(this.degree)};gc.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(t.length+this.degree);e.set(t);const n=If.mod(e,this.genPoly),r=this.degree-n.length;if(r>0){const l=new Uint8Array(this.degree);return l.set(n,r),l}return n};var hx=gc,Mf={},Bs={},mc={};mc.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var Wn={};const Sf="[0-9]+",cx="[A-Z $%*+\\-./:]+";let So="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";So=So.replace(/u/g,"\\u");const ux="(?:(?![A-Z0-9 $%*+\\-./:]|"+So+`)(?:.|[\r
]))+`;Wn.KANJI=new RegExp(So,"g");Wn.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Wn.BYTE=new RegExp(ux,"g");Wn.NUMERIC=new RegExp(Sf,"g");Wn.ALPHANUMERIC=new RegExp(cx,"g");const fx=new RegExp("^"+So+"$"),dx=new RegExp("^"+Sf+"$"),gx=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Wn.testKanji=function(t){return fx.test(t)};Wn.testNumeric=function(t){return dx.test(t)};Wn.testAlphanumeric=function(t){return gx.test(t)};(function(s){const t=mc,e=Wn;s.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},s.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},s.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},s.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},s.MIXED={bit:-1},s.getCharCountIndicator=function(l,u){if(!l.ccBits)throw new Error("Invalid mode: "+l);if(!t.isValid(u))throw new Error("Invalid version: "+u);return u>=1&&u<10?l.ccBits[0]:u<27?l.ccBits[1]:l.ccBits[2]},s.getBestModeForData=function(l){return e.testNumeric(l)?s.NUMERIC:e.testAlphanumeric(l)?s.ALPHANUMERIC:e.testKanji(l)?s.KANJI:s.BYTE},s.toString=function(l){if(l&&l.id)return l.id;throw new Error("Invalid mode")},s.isValid=function(l){return l&&l.bit&&l.ccBits};function n(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return s.NUMERIC;case"alphanumeric":return s.ALPHANUMERIC;case"kanji":return s.KANJI;case"byte":return s.BYTE;default:throw new Error("Unknown mode: "+r)}}s.from=function(l,u){if(s.isValid(l))return l;try{return n(l)}catch{return u}}})(Bs);(function(s){const t=rn,e=sl,n=nl,r=Bs,l=mc,u=7973,g=t.getBCHDigit(u);function m(b,D,P){for(let F=1;F<=40;F++)if(D<=s.getCapacity(F,P,b))return F}function p(b,D){return r.getCharCountIndicator(b,D)+4}function E(b,D){let P=0;return b.forEach(function(F){const z=p(F.mode,D);P+=z+F.getBitsLength()}),P}function A(b,D){for(let P=1;P<=40;P++)if(E(b,P)<=s.getCapacity(P,D,r.MIXED))return P}s.from=function(D,P){return l.isValid(D)?parseInt(D,10):P},s.getCapacity=function(D,P,F){if(!l.isValid(D))throw new Error("Invalid QR Code version");typeof F>"u"&&(F=r.BYTE);const z=t.getSymbolTotalCodewords(D),j=e.getTotalCodewordsCount(D,P),G=(z-j)*8;if(F===r.MIXED)return G;const X=G-p(F,D);switch(F){case r.NUMERIC:return Math.floor(X/10*3);case r.ALPHANUMERIC:return Math.floor(X/11*2);case r.KANJI:return Math.floor(X/13);case r.BYTE:default:return Math.floor(X/8)}},s.getBestVersionForData=function(D,P){let F;const z=n.from(P,n.M);if(Array.isArray(D)){if(D.length>1)return A(D,z);if(D.length===0)return 1;F=D[0]}else F=D;return m(F.mode,F.getLength(),z)},s.getEncodedBits=function(D){if(!l.isValid(D)||D<7)throw new Error("Invalid QR Code version");let P=D<<12;for(;t.getBCHDigit(P)-g>=0;)P^=u<<t.getBCHDigit(P)-g;return D<<12|P}})(Mf);var Tf={};const dh=rn,bf=1335,mx=21522,yu=dh.getBCHDigit(bf);Tf.getEncodedBits=function(t,e){const n=t.bit<<3|e;let r=n<<10;for(;dh.getBCHDigit(r)-yu>=0;)r^=bf<<dh.getBCHDigit(r)-yu;return(n<<10|r)^mx};var Rf={};const xx=Bs;function Ur(s){this.mode=xx.NUMERIC,this.data=s.toString()}Ur.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};Ur.prototype.getLength=function(){return this.data.length};Ur.prototype.getBitsLength=function(){return Ur.getBitsLength(this.data.length)};Ur.prototype.write=function(t){let e,n,r;for(e=0;e+3<=this.data.length;e+=3)n=this.data.substr(e,3),r=parseInt(n,10),t.put(r,10);const l=this.data.length-e;l>0&&(n=this.data.substr(e),r=parseInt(n,10),t.put(r,l*3+1))};var px=Ur;const _x=Bs,Gl=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Gr(s){this.mode=_x.ALPHANUMERIC,this.data=s}Gr.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};Gr.prototype.getLength=function(){return this.data.length};Gr.prototype.getBitsLength=function(){return Gr.getBitsLength(this.data.length)};Gr.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let n=Gl.indexOf(this.data[e])*45;n+=Gl.indexOf(this.data[e+1]),t.put(n,11)}this.data.length%2&&t.put(Gl.indexOf(this.data[e]),6)};var yx=Gr,Ex=function(t){for(var e=[],n=t.length,r=0;r<n;r++){var l=t.charCodeAt(r);if(l>=55296&&l<=56319&&n>r+1){var u=t.charCodeAt(r+1);u>=56320&&u<=57343&&(l=(l-55296)*1024+u-56320+65536,r+=1)}if(l<128){e.push(l);continue}if(l<2048){e.push(l>>6|192),e.push(l&63|128);continue}if(l<55296||l>=57344&&l<65536){e.push(l>>12|224),e.push(l>>6&63|128),e.push(l&63|128);continue}if(l>=65536&&l<=1114111){e.push(l>>18|240),e.push(l>>12&63|128),e.push(l>>6&63|128),e.push(l&63|128);continue}e.push(239,191,189)}return new Uint8Array(e).buffer};const wx=Ex,Cx=Bs;function zr(s){this.mode=Cx.BYTE,typeof s=="string"&&(s=wx(s)),this.data=new Uint8Array(s)}zr.getBitsLength=function(t){return t*8};zr.prototype.getLength=function(){return this.data.length};zr.prototype.getBitsLength=function(){return zr.getBitsLength(this.data.length)};zr.prototype.write=function(s){for(let t=0,e=this.data.length;t<e;t++)s.put(this.data[t],8)};var Ax=zr;const Ix=Bs,Mx=rn;function jr(s){this.mode=Ix.KANJI,this.data=s}jr.getBitsLength=function(t){return t*13};jr.prototype.getLength=function(){return this.data.length};jr.prototype.getBitsLength=function(){return jr.getBitsLength(this.data.length)};jr.prototype.write=function(s){let t;for(t=0;t<this.data.length;t++){let e=Mx.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else if(e>=57408&&e<=60351)e-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);e=(e>>>8&255)*192+(e&255),s.put(e,13)}};var Sx=jr,vf={exports:{}};(function(s){var t={single_source_shortest_paths:function(e,n,r){var l={},u={};u[n]=0;var g=t.PriorityQueue.make();g.push(n,0);for(var m,p,E,A,b,D,P,F,z;!g.empty();){m=g.pop(),p=m.value,A=m.cost,b=e[p]||{};for(E in b)b.hasOwnProperty(E)&&(D=b[E],P=A+D,F=u[E],z=typeof u[E]>"u",(z||F>P)&&(u[E]=P,g.push(E,P),l[E]=p))}if(typeof r<"u"&&typeof u[r]>"u"){var j=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(j)}return l},extract_shortest_path_from_predecessor_list:function(e,n){for(var r=[],l=n;l;)r.push(l),e[l],l=e[l];return r.reverse(),r},find_path:function(e,n,r){var l=t.single_source_shortest_paths(e,n,r);return t.extract_shortest_path_from_predecessor_list(l,r)},PriorityQueue:{make:function(e){var n=t.PriorityQueue,r={},l;e=e||{};for(l in n)n.hasOwnProperty(l)&&(r[l]=n[l]);return r.queue=[],r.sorter=e.sorter||n.default_sorter,r},default_sorter:function(e,n){return e.cost-n.cost},push:function(e,n){var r={value:e,cost:n};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};s.exports=t})(vf);var Tx=vf.exports;(function(s){const t=Bs,e=px,n=yx,r=Ax,l=Sx,u=Wn,g=rn,m=Tx;function p(j){return unescape(encodeURIComponent(j)).length}function E(j,G,X){const Y=[];let Q;for(;(Q=j.exec(X))!==null;)Y.push({data:Q[0],index:Q.index,mode:G,length:Q[0].length});return Y}function A(j){const G=E(u.NUMERIC,t.NUMERIC,j),X=E(u.ALPHANUMERIC,t.ALPHANUMERIC,j);let Y,Q;return g.isKanjiModeEnabled()?(Y=E(u.BYTE,t.BYTE,j),Q=E(u.KANJI,t.KANJI,j)):(Y=E(u.BYTE_KANJI,t.BYTE,j),Q=[]),G.concat(X,Y,Q).sort(function(K,ot){return K.index-ot.index}).map(function(K){return{data:K.data,mode:K.mode,length:K.length}})}function b(j,G){switch(G){case t.NUMERIC:return e.getBitsLength(j);case t.ALPHANUMERIC:return n.getBitsLength(j);case t.KANJI:return l.getBitsLength(j);case t.BYTE:return r.getBitsLength(j)}}function D(j){return j.reduce(function(G,X){const Y=G.length-1>=0?G[G.length-1]:null;return Y&&Y.mode===X.mode?(G[G.length-1].data+=X.data,G):(G.push(X),G)},[])}function P(j){const G=[];for(let X=0;X<j.length;X++){const Y=j[X];switch(Y.mode){case t.NUMERIC:G.push([Y,{data:Y.data,mode:t.ALPHANUMERIC,length:Y.length},{data:Y.data,mode:t.BYTE,length:Y.length}]);break;case t.ALPHANUMERIC:G.push([Y,{data:Y.data,mode:t.BYTE,length:Y.length}]);break;case t.KANJI:G.push([Y,{data:Y.data,mode:t.BYTE,length:p(Y.data)}]);break;case t.BYTE:G.push([{data:Y.data,mode:t.BYTE,length:p(Y.data)}])}}return G}function F(j,G){const X={},Y={start:{}};let Q=["start"];for(let rt=0;rt<j.length;rt++){const K=j[rt],ot=[];for(let Z=0;Z<K.length;Z++){const Ot=K[Z],St=""+rt+Z;ot.push(St),X[St]={node:Ot,lastCount:0},Y[St]={};for(let ut=0;ut<Q.length;ut++){const yt=Q[ut];X[yt]&&X[yt].node.mode===Ot.mode?(Y[yt][St]=b(X[yt].lastCount+Ot.length,Ot.mode)-b(X[yt].lastCount,Ot.mode),X[yt].lastCount+=Ot.length):(X[yt]&&(X[yt].lastCount=Ot.length),Y[yt][St]=b(Ot.length,Ot.mode)+4+t.getCharCountIndicator(Ot.mode,G))}}Q=ot}for(let rt=0;rt<Q.length;rt++)Y[Q[rt]].end=0;return{map:Y,table:X}}function z(j,G){let X;const Y=t.getBestModeForData(j);if(X=t.from(G,Y),X!==t.BYTE&&X.bit<Y.bit)throw new Error('"'+j+'" cannot be encoded with mode '+t.toString(X)+`.
 Suggested mode is: `+t.toString(Y));switch(X===t.KANJI&&!g.isKanjiModeEnabled()&&(X=t.BYTE),X){case t.NUMERIC:return new e(j);case t.ALPHANUMERIC:return new n(j);case t.KANJI:return new l(j);case t.BYTE:return new r(j)}}s.fromArray=function(G){return G.reduce(function(X,Y){return typeof Y=="string"?X.push(z(Y,null)):Y.data&&X.push(z(Y.data,Y.mode)),X},[])},s.fromString=function(G,X){const Y=A(G,g.isKanjiModeEnabled()),Q=P(Y),rt=F(Q,X),K=m.find_path(rt.map,"start","end"),ot=[];for(let Z=1;Z<K.length-1;Z++)ot.push(rt.table[K[Z]].node);return s.fromArray(D(ot))},s.rawSplit=function(G){return s.fromArray(A(G,g.isKanjiModeEnabled()))}})(Rf);const ol=rn,zl=nl,bx=ox,Rx=ax,vx=Ef,Nx=wf,gh=Cf,mh=sl,Ox=hx,Na=Mf,Dx=Tf,Lx=Bs,jl=Rf;function Px(s,t){const e=s.size,n=Nx.getPositions(t);for(let r=0;r<n.length;r++){const l=n[r][0],u=n[r][1];for(let g=-1;g<=7;g++)if(!(l+g<=-1||e<=l+g))for(let m=-1;m<=7;m++)u+m<=-1||e<=u+m||(g>=0&&g<=6&&(m===0||m===6)||m>=0&&m<=6&&(g===0||g===6)||g>=2&&g<=4&&m>=2&&m<=4?s.set(l+g,u+m,!0,!0):s.set(l+g,u+m,!1,!0))}}function Fx(s){const t=s.size;for(let e=8;e<t-8;e++){const n=e%2===0;s.set(e,6,n,!0),s.set(6,e,n,!0)}}function Bx(s,t){const e=vx.getPositions(t);for(let n=0;n<e.length;n++){const r=e[n][0],l=e[n][1];for(let u=-2;u<=2;u++)for(let g=-2;g<=2;g++)u===-2||u===2||g===-2||g===2||u===0&&g===0?s.set(r+u,l+g,!0,!0):s.set(r+u,l+g,!1,!0)}}function kx(s,t){const e=s.size,n=Na.getEncodedBits(t);let r,l,u;for(let g=0;g<18;g++)r=Math.floor(g/3),l=g%3+e-8-3,u=(n>>g&1)===1,s.set(r,l,u,!0),s.set(l,r,u,!0)}function Wl(s,t,e){const n=s.size,r=Dx.getEncodedBits(t,e);let l,u;for(l=0;l<15;l++)u=(r>>l&1)===1,l<6?s.set(l,8,u,!0):l<8?s.set(l+1,8,u,!0):s.set(n-15+l,8,u,!0),l<8?s.set(8,n-l-1,u,!0):l<9?s.set(8,15-l-1+1,u,!0):s.set(8,15-l-1,u,!0);s.set(n-8,8,1,!0)}function Ux(s,t){const e=s.size;let n=-1,r=e-1,l=7,u=0;for(let g=e-1;g>0;g-=2)for(g===6&&g--;;){for(let m=0;m<2;m++)if(!s.isReserved(r,g-m)){let p=!1;u<t.length&&(p=(t[u]>>>l&1)===1),s.set(r,g-m,p),l--,l===-1&&(u++,l=7)}if(r+=n,r<0||e<=r){r-=n,n=-n;break}}}function Gx(s,t,e){const n=new bx;e.forEach(function(m){n.put(m.mode.bit,4),n.put(m.getLength(),Lx.getCharCountIndicator(m.mode,s)),m.write(n)});const r=ol.getSymbolTotalCodewords(s),l=mh.getTotalCodewordsCount(s,t),u=(r-l)*8;for(n.getLengthInBits()+4<=u&&n.put(0,4);n.getLengthInBits()%8!==0;)n.putBit(0);const g=(u-n.getLengthInBits())/8;for(let m=0;m<g;m++)n.put(m%2?17:236,8);return zx(n,s,t)}function zx(s,t,e){const n=ol.getSymbolTotalCodewords(t),r=mh.getTotalCodewordsCount(t,e),l=n-r,u=mh.getBlocksCount(t,e),g=n%u,m=u-g,p=Math.floor(n/u),E=Math.floor(l/u),A=E+1,b=p-E,D=new Ox(b);let P=0;const F=new Array(u),z=new Array(u);let j=0;const G=new Uint8Array(s.buffer);for(let K=0;K<u;K++){const ot=K<m?E:A;F[K]=G.slice(P,P+ot),z[K]=D.encode(F[K]),P+=ot,j=Math.max(j,ot)}const X=new Uint8Array(n);let Y=0,Q,rt;for(Q=0;Q<j;Q++)for(rt=0;rt<u;rt++)Q<F[rt].length&&(X[Y++]=F[rt][Q]);for(Q=0;Q<b;Q++)for(rt=0;rt<u;rt++)X[Y++]=z[rt][Q];return X}function jx(s,t,e,n){let r;if(Array.isArray(s))r=jl.fromArray(s);else if(typeof s=="string"){let p=t;if(!p){const E=jl.rawSplit(s);p=Na.getBestVersionForData(E,e)}r=jl.fromString(s,p||40)}else throw new Error("Invalid data");const l=Na.getBestVersionForData(r,e);if(!l)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=l;else if(t<l)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+l+`.
`);const u=Gx(t,e,r),g=ol.getSymbolSize(t),m=new Rx(g);return Px(m,t),Fx(m),Bx(m,t),Wl(m,e,0),t>=7&&kx(m,t),Ux(m,u),isNaN(n)&&(n=gh.getBestMask(m,Wl.bind(null,m,e))),gh.applyMask(n,m),Wl(m,e,n),{modules:m,version:t,errorCorrectionLevel:e,maskPattern:n,segments:r}}_f.create=function(t,e){if(typeof t>"u"||t==="")throw new Error("No input text");let n=zl.M,r,l;return typeof e<"u"&&(n=zl.from(e.errorCorrectionLevel,zl.M),r=Na.from(e.version),l=gh.from(e.maskPattern),e.toSJISFunc&&ol.setToSJISFunction(e.toSJISFunc)),jx(t,r,n,l)};var Nf={},xc={};(function(s){function t(e){if(typeof e=="number"&&(e=e.toString()),typeof e!="string")throw new Error("Color should be defined as hex string");let n=e.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+e);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(l){return[l,l]}))),n.length===6&&n.push("F","F");const r=parseInt(n.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+n.slice(0,6).join("")}}s.getOptions=function(n){n||(n={}),n.color||(n.color={});const r=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,l=n.width&&n.width>=21?n.width:void 0,u=n.scale||4;return{width:l,scale:l?4:u,margin:r,color:{dark:t(n.color.dark||"#000000ff"),light:t(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},s.getScale=function(n,r){return r.width&&r.width>=n+r.margin*2?r.width/(n+r.margin*2):r.scale},s.getImageWidth=function(n,r){const l=s.getScale(n,r);return Math.floor((n+r.margin*2)*l)},s.qrToImageData=function(n,r,l){const u=r.modules.size,g=r.modules.data,m=s.getScale(u,l),p=Math.floor((u+l.margin*2)*m),E=l.margin*m,A=[l.color.light,l.color.dark];for(let b=0;b<p;b++)for(let D=0;D<p;D++){let P=(b*p+D)*4,F=l.color.light;if(b>=E&&D>=E&&b<p-E&&D<p-E){const z=Math.floor((b-E)/m),j=Math.floor((D-E)/m);F=A[g[z*u+j]?1:0]}n[P++]=F.r,n[P++]=F.g,n[P++]=F.b,n[P]=F.a}}})(xc);(function(s){const t=xc;function e(r,l,u){r.clearRect(0,0,l.width,l.height),l.style||(l.style={}),l.height=u,l.width=u,l.style.height=u+"px",l.style.width=u+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}s.render=function(l,u,g){let m=g,p=u;typeof m>"u"&&(!u||!u.getContext)&&(m=u,u=void 0),u||(p=n()),m=t.getOptions(m);const E=t.getImageWidth(l.modules.size,m),A=p.getContext("2d"),b=A.createImageData(E,E);return t.qrToImageData(b.data,l,m),e(A,p,E),A.putImageData(b,0,0),p},s.renderToDataURL=function(l,u,g){let m=g;typeof m>"u"&&(!u||!u.getContext)&&(m=u,u=void 0),m||(m={});const p=s.render(l,u,m),E=m.type||"image/png",A=m.rendererOpts||{};return p.toDataURL(E,A.quality)}})(Nf);var Of={};const Wx=xc;function Eu(s,t){const e=s.a/255,n=t+'="'+s.hex+'"';return e<1?n+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':n}function Xl(s,t,e){let n=s+t;return typeof e<"u"&&(n+=" "+e),n}function Xx(s,t,e){let n="",r=0,l=!1,u=0;for(let g=0;g<s.length;g++){const m=Math.floor(g%t),p=Math.floor(g/t);!m&&!l&&(l=!0),s[g]?(u++,g>0&&m>0&&s[g-1]||(n+=l?Xl("M",m+e,.5+p+e):Xl("m",r,0),r=0,l=!1),m+1<t&&s[g+1]||(n+=Xl("h",u),u=0)):r++}return n}Of.render=function(t,e,n){const r=Wx.getOptions(e),l=t.modules.size,u=t.modules.data,g=l+r.margin*2,m=r.color.light.a?"<path "+Eu(r.color.light,"fill")+' d="M0 0h'+g+"v"+g+'H0z"/>':"",p="<path "+Eu(r.color.dark,"stroke")+' d="'+Xx(u,l,r.margin)+'"/>',E='viewBox="0 0 '+g+" "+g+'"',b='<svg xmlns="http://www.w3.org/2000/svg" '+(r.width?'width="'+r.width+'" height="'+r.width+'" ':"")+E+' shape-rendering="crispEdges">'+m+p+`</svg>
`;return typeof n=="function"&&n(null,b),b};const Vx=sx,xh=_f,Df=Nf,Yx=Of;function pc(s,t,e,n,r){const l=[].slice.call(arguments,1),u=l.length,g=typeof l[u-1]=="function";if(!g&&!Vx())throw new Error("Callback required as last argument");if(g){if(u<2)throw new Error("Too few arguments provided");u===2?(r=e,e=t,t=n=void 0):u===3&&(t.getContext&&typeof r>"u"?(r=n,n=void 0):(r=n,n=e,e=t,t=void 0))}else{if(u<1)throw new Error("Too few arguments provided");return u===1?(e=t,t=n=void 0):u===2&&!t.getContext&&(n=e,e=t,t=void 0),new Promise(function(m,p){try{const E=xh.create(e,n);m(s(E,t,n))}catch(E){p(E)}})}try{const m=xh.create(e,n);r(null,s(m,t,n))}catch(m){r(m)}}Bo.create=xh.create;Bo.toCanvas=pc.bind(null,Df.render);Bo.toDataURL=pc.bind(null,Df.renderToDataURL);Bo.toString=pc.bind(null,function(s,t,e){return Yx.render(s,e)});var vt;(function(s){s[s.QR_CODE=0]="QR_CODE",s[s.AZTEC=1]="AZTEC",s[s.CODABAR=2]="CODABAR",s[s.CODE_39=3]="CODE_39",s[s.CODE_93=4]="CODE_93",s[s.CODE_128=5]="CODE_128",s[s.DATA_MATRIX=6]="DATA_MATRIX",s[s.MAXICODE=7]="MAXICODE",s[s.ITF=8]="ITF",s[s.EAN_13=9]="EAN_13",s[s.EAN_8=10]="EAN_8",s[s.PDF_417=11]="PDF_417",s[s.RSS_14=12]="RSS_14",s[s.RSS_EXPANDED=13]="RSS_EXPANDED",s[s.UPC_A=14]="UPC_A",s[s.UPC_E=15]="UPC_E",s[s.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(vt||(vt={}));var wu=new Map([[vt.QR_CODE,"QR_CODE"],[vt.AZTEC,"AZTEC"],[vt.CODABAR,"CODABAR"],[vt.CODE_39,"CODE_39"],[vt.CODE_93,"CODE_93"],[vt.CODE_128,"CODE_128"],[vt.DATA_MATRIX,"DATA_MATRIX"],[vt.MAXICODE,"MAXICODE"],[vt.ITF,"ITF"],[vt.EAN_13,"EAN_13"],[vt.EAN_8,"EAN_8"],[vt.PDF_417,"PDF_417"],[vt.RSS_14,"RSS_14"],[vt.RSS_EXPANDED,"RSS_EXPANDED"],[vt.UPC_A,"UPC_A"],[vt.UPC_E,"UPC_E"],[vt.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),Cu;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.URL=1]="URL"})(Cu||(Cu={}));function Hx(s){return Object.values(vt).includes(s)}var Ps;(function(s){s[s.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",s[s.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(Ps||(Ps={}));var In=function(){function s(){}return s.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",s.SCAN_DEFAULT_FPS=2,s.DEFAULT_DISABLE_FLIP=!1,s.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,s.DEFAULT_SUPPORTED_SCAN_TYPE=[Ps.SCAN_TYPE_CAMERA,Ps.SCAN_TYPE_FILE],s}(),Lf=function(){function s(t,e){this.format=t,this.formatName=e}return s.prototype.toString=function(){return this.formatName},s.create=function(t){if(!wu.has(t))throw"".concat(t," not in html5QrcodeSupportedFormatsTextMap");return new s(t,wu.get(t))},s}(),Au=function(){function s(){}return s.createFromText=function(t){var e={text:t};return{decodedText:t,result:e}},s.createFromQrcodeResult=function(t){return{decodedText:t.text,result:t}},s}(),ph;(function(s){s[s.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",s[s.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",s[s.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(ph||(ph={}));var Pf=function(){function s(){}return s.createFrom=function(t){return{errorMessage:t,type:ph.UNKWOWN_ERROR}},s}(),Ff=function(){function s(t){this.verbose=t}return s.prototype.log=function(t){this.verbose&&console.log(t)},s.prototype.warn=function(t){this.verbose&&console.warn(t)},s.prototype.logError=function(t,e){(this.verbose||e===!0)&&console.error(t)},s.prototype.logErrors=function(t){if(t.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(t)},s}();function Ln(s){return typeof s>"u"||s===null}function Zx(s,t,e){return s>e?e:s<t?t:s}var Tr=function(){function s(){}return s.codeParseError=function(t){return"QR code parse error, error = ".concat(t)},s.errorGettingUserMedia=function(t){return"Error getting userMedia, error = ".concat(t)},s.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},s.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},s.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},s.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},s.scannerPaused=function(){return"Scanner paused"},s}(),ve=function(){function s(){}return s.scanningStatus=function(){return"Scanning"},s.idleStatus=function(){return"Idle"},s.errorStatus=function(){return"Error"},s.permissionStatus=function(){return"Permission"},s.noCameraFoundErrorStatus=function(){return"No Cameras"},s.lastMatch=function(t){return"Last Match: ".concat(t)},s.codeScannerTitle=function(){return"Code Scanner"},s.cameraPermissionTitle=function(){return"Request Camera Permissions"},s.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},s.noCameraFound=function(){return"No camera found"},s.scanButtonStopScanningText=function(){return"Stop Scanning"},s.scanButtonStartScanningText=function(){return"Start Scanning"},s.torchOnButton=function(){return"Switch On Torch"},s.torchOffButton=function(){return"Switch Off Torch"},s.torchOnFailedMessage=function(){return"Failed to turn on torch"},s.torchOffFailedMessage=function(){return"Failed to turn off torch"},s.scanButtonScanningStarting=function(){return"Launching Camera..."},s.textIfCameraScanSelected=function(){return"Scan an Image File"},s.textIfFileScanSelected=function(){return"Scan using camera directly"},s.selectCamera=function(){return"Select Camera"},s.fileSelectionChooseImage=function(){return"Choose Image"},s.fileSelectionChooseAnother=function(){return"Choose Another"},s.fileSelectionNoImageSelected=function(){return"No image choosen"},s.anonymousCameraPrefix=function(){return"Anonymous Camera"},s.dragAndDropMessage=function(){return"Or drop an image to scan"},s.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},s.zoom=function(){return"zoom"},s.loadingImage=function(){return"Loading image..."},s.cameraScanAltText=function(){return"Camera based scan"},s.fileScanAltText=function(){return"Fule based scan"},s}(),Iu=function(){function s(){}return s.poweredBy=function(){return"Powered by "},s.reportIssues=function(){return"Report issues"},s}(),Bf=function(){function s(){}return s.isMediaStreamConstraintsValid=function(t,e){if(typeof t!="object"){var n=typeof t;return e.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(n,"."),!0),!1}for(var r=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],l=new Set(r),u=Object.keys(t),g=0,m=u;g<m.length;g++){var p=m[g];if(l.has(p))return e.logError("".concat(p," is not supported videoConstaints."),!0),!1}return!0},s}(),_h={exports:{}};(function(s,t){(function(e,n){n(t)})(Ir,function(e){function n(T){return T==null}var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,i){T.__proto__=i}||function(T,i){for(var o in i)i.hasOwnProperty(o)&&(T[o]=i[o])};function l(T,i){r(T,i);function o(){this.constructor=T}T.prototype=i===null?Object.create(i):(o.prototype=i.prototype,new o)}function u(T,i){var o=Object.setPrototypeOf;o?o(T,i):T.__proto__=i}function g(T,i){i===void 0&&(i=T.constructor);var o=Error.captureStackTrace;o&&o(T,i)}var m=function(T){l(i,T);function i(o){var a=this.constructor,h=T.call(this,o)||this;return Object.defineProperty(h,"name",{value:a.name,enumerable:!1}),u(h,a.prototype),g(h),h}return i}(Error);class p extends m{constructor(i=void 0){super(i),this.message=i}getKind(){return this.constructor.kind}}p.kind="Exception";class E extends p{}E.kind="ArgumentException";class A extends p{}A.kind="IllegalArgumentException";class b{constructor(i){if(this.binarizer=i,i===null)throw new A("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(i,o){return this.binarizer.getBlackRow(i,o)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(i,o,a,h){const c=this.binarizer.getLuminanceSource().crop(i,o,a,h);return new b(this.binarizer.createBinarizer(c))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const i=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new b(this.binarizer.createBinarizer(i))}rotateCounterClockwise45(){const i=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new b(this.binarizer.createBinarizer(i))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class D extends p{static getChecksumInstance(){return new D}}D.kind="ChecksumException";class P{constructor(i){this.source=i}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class F{static arraycopy(i,o,a,h,c){for(;c--;)a[h++]=i[o++]}static currentTimeMillis(){return Date.now()}}class z extends p{}z.kind="IndexOutOfBoundsException";class j extends z{constructor(i=void 0,o=void 0){super(o),this.index=i,this.message=o}}j.kind="ArrayIndexOutOfBoundsException";class G{static fill(i,o){for(let a=0,h=i.length;a<h;a++)i[a]=o}static fillWithin(i,o,a,h){G.rangeCheck(i.length,o,a);for(let c=o;c<a;c++)i[c]=h}static rangeCheck(i,o,a){if(o>a)throw new A("fromIndex("+o+") > toIndex("+a+")");if(o<0)throw new j(o);if(a>i)throw new j(a)}static asList(...i){return i}static create(i,o,a){return Array.from({length:i}).map(c=>Array.from({length:o}).fill(a))}static createInt32Array(i,o,a){return Array.from({length:i}).map(c=>Int32Array.from({length:o}).fill(a))}static equals(i,o){if(!i||!o||!i.length||!o.length||i.length!==o.length)return!1;for(let a=0,h=i.length;a<h;a++)if(i[a]!==o[a])return!1;return!0}static hashCode(i){if(i===null)return 0;let o=1;for(const a of i)o=31*o+a;return o}static fillUint8Array(i,o){for(let a=0;a!==i.length;a++)i[a]=o}static copyOf(i,o){return i.slice(0,o)}static copyOfUint8Array(i,o){if(i.length<=o){const a=new Uint8Array(o);return a.set(i),a}return i.slice(0,o)}static copyOfRange(i,o,a){const h=a-o,c=new Int32Array(h);return F.arraycopy(i,o,c,0,h),c}static binarySearch(i,o,a){a===void 0&&(a=G.numberComparator);let h=0,c=i.length-1;for(;h<=c;){const d=c+h>>1,x=a(o,i[d]);if(x>0)h=d+1;else if(x<0)c=d-1;else return d}return-h-1}static numberComparator(i,o){return i-o}}class X{static numberOfTrailingZeros(i){let o;if(i===0)return 32;let a=31;return o=i<<16,o!==0&&(a-=16,i=o),o=i<<8,o!==0&&(a-=8,i=o),o=i<<4,o!==0&&(a-=4,i=o),o=i<<2,o!==0&&(a-=2,i=o),a-(i<<1>>>31)}static numberOfLeadingZeros(i){if(i===0)return 32;let o=1;return i>>>16||(o+=16,i<<=16),i>>>24||(o+=8,i<<=8),i>>>28||(o+=4,i<<=4),i>>>30||(o+=2,i<<=2),o-=i>>>31,o}static toHexString(i){return i.toString(16)}static toBinaryString(i){return String(parseInt(String(i),2))}static bitCount(i){return i=i-(i>>>1&1431655765),i=(i&858993459)+(i>>>2&858993459),i=i+(i>>>4)&252645135,i=i+(i>>>8),i=i+(i>>>16),i&63}static truncDivision(i,o){return Math.trunc(i/o)}static parseInt(i,o=void 0){return parseInt(i,o)}}X.MIN_VALUE_32_BITS=-2147483648,X.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Y{constructor(i,o){i===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=i,o==null?this.bits=Y.makeArray(i):this.bits=o)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(i){if(i>this.bits.length*32){const o=Y.makeArray(i);F.arraycopy(this.bits,0,o,0,this.bits.length),this.bits=o}}get(i){return(this.bits[Math.floor(i/32)]&1<<(i&31))!==0}set(i){this.bits[Math.floor(i/32)]|=1<<(i&31)}flip(i){this.bits[Math.floor(i/32)]^=1<<(i&31)}getNextSet(i){const o=this.size;if(i>=o)return o;const a=this.bits;let h=Math.floor(i/32),c=a[h];c&=~((1<<(i&31))-1);const d=a.length;for(;c===0;){if(++h===d)return o;c=a[h]}const x=h*32+X.numberOfTrailingZeros(c);return x>o?o:x}getNextUnset(i){const o=this.size;if(i>=o)return o;const a=this.bits;let h=Math.floor(i/32),c=~a[h];c&=~((1<<(i&31))-1);const d=a.length;for(;c===0;){if(++h===d)return o;c=~a[h]}const x=h*32+X.numberOfTrailingZeros(c);return x>o?o:x}setBulk(i,o){this.bits[Math.floor(i/32)]=o}setRange(i,o){if(o<i||i<0||o>this.size)throw new A;if(o===i)return;o--;const a=Math.floor(i/32),h=Math.floor(o/32),c=this.bits;for(let d=a;d<=h;d++){const x=d>a?0:i&31,C=(2<<(d<h?31:o&31))-(1<<x);c[d]|=C}}clear(){const i=this.bits.length,o=this.bits;for(let a=0;a<i;a++)o[a]=0}isRange(i,o,a){if(o<i||i<0||o>this.size)throw new A;if(o===i)return!0;o--;const h=Math.floor(i/32),c=Math.floor(o/32),d=this.bits;for(let x=h;x<=c;x++){const _=x>h?0:i&31,M=(2<<(x<c?31:o&31))-(1<<_)&4294967295;if((d[x]&M)!==(a?M:0))return!1}return!0}appendBit(i){this.ensureCapacity(this.size+1),i&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(i,o){if(o<0||o>32)throw new A("Num bits must be between 0 and 32");this.ensureCapacity(this.size+o);for(let a=o;a>0;a--)this.appendBit((i>>a-1&1)===1)}appendBitArray(i){const o=i.size;this.ensureCapacity(this.size+o);for(let a=0;a<o;a++)this.appendBit(i.get(a))}xor(i){if(this.size!==i.size)throw new A("Sizes don't match");const o=this.bits;for(let a=0,h=o.length;a<h;a++)o[a]^=i.bits[a]}toBytes(i,o,a,h){for(let c=0;c<h;c++){let d=0;for(let x=0;x<8;x++)this.get(i)&&(d|=1<<7-x),i++;o[a+c]=d}}getBitArray(){return this.bits}reverse(){const i=new Int32Array(this.bits.length),o=Math.floor((this.size-1)/32),a=o+1,h=this.bits;for(let c=0;c<a;c++){let d=h[c];d=d>>1&1431655765|(d&1431655765)<<1,d=d>>2&858993459|(d&858993459)<<2,d=d>>4&252645135|(d&252645135)<<4,d=d>>8&16711935|(d&16711935)<<8,d=d>>16&65535|(d&65535)<<16,i[o-c]=d}if(this.size!==a*32){const c=a*32-this.size;let d=i[0]>>>c;for(let x=1;x<a;x++){const _=i[x];d|=_<<32-c,i[x-1]=d,d=_>>>c}i[a-1]=d}this.bits=i}static makeArray(i){return new Int32Array(Math.floor((i+31)/32))}equals(i){if(!(i instanceof Y))return!1;const o=i;return this.size===o.size&&G.equals(this.bits,o.bits)}hashCode(){return 31*this.size+G.hashCode(this.bits)}toString(){let i="";for(let o=0,a=this.size;o<a;o++)o&7||(i+=" "),i+=this.get(o)?"X":".";return i}clone(){return new Y(this.size,this.bits.slice())}}var Q;(function(T){T[T.OTHER=0]="OTHER",T[T.PURE_BARCODE=1]="PURE_BARCODE",T[T.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",T[T.TRY_HARDER=3]="TRY_HARDER",T[T.CHARACTER_SET=4]="CHARACTER_SET",T[T.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",T[T.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",T[T.ASSUME_GS1=7]="ASSUME_GS1",T[T.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",T[T.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",T[T.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(Q||(Q={}));var rt=Q;class K extends p{static getFormatInstance(){return new K}}K.kind="FormatException";var ot;(function(T){T[T.Cp437=0]="Cp437",T[T.ISO8859_1=1]="ISO8859_1",T[T.ISO8859_2=2]="ISO8859_2",T[T.ISO8859_3=3]="ISO8859_3",T[T.ISO8859_4=4]="ISO8859_4",T[T.ISO8859_5=5]="ISO8859_5",T[T.ISO8859_6=6]="ISO8859_6",T[T.ISO8859_7=7]="ISO8859_7",T[T.ISO8859_8=8]="ISO8859_8",T[T.ISO8859_9=9]="ISO8859_9",T[T.ISO8859_10=10]="ISO8859_10",T[T.ISO8859_11=11]="ISO8859_11",T[T.ISO8859_13=12]="ISO8859_13",T[T.ISO8859_14=13]="ISO8859_14",T[T.ISO8859_15=14]="ISO8859_15",T[T.ISO8859_16=15]="ISO8859_16",T[T.SJIS=16]="SJIS",T[T.Cp1250=17]="Cp1250",T[T.Cp1251=18]="Cp1251",T[T.Cp1252=19]="Cp1252",T[T.Cp1256=20]="Cp1256",T[T.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",T[T.UTF8=22]="UTF8",T[T.ASCII=23]="ASCII",T[T.Big5=24]="Big5",T[T.GB18030=25]="GB18030",T[T.EUC_KR=26]="EUC_KR"})(ot||(ot={}));class Z{constructor(i,o,a,...h){this.valueIdentifier=i,this.name=a,typeof o=="number"?this.values=Int32Array.from([o]):this.values=o,this.otherEncodingNames=h,Z.VALUE_IDENTIFIER_TO_ECI.set(i,this),Z.NAME_TO_ECI.set(a,this);const c=this.values;for(let d=0,x=c.length;d!==x;d++){const _=c[d];Z.VALUES_TO_ECI.set(_,this)}for(const d of h)Z.NAME_TO_ECI.set(d,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(i){if(i<0||i>=900)throw new K("incorect value");const o=Z.VALUES_TO_ECI.get(i);if(o===void 0)throw new K("incorect value");return o}static getCharacterSetECIByName(i){const o=Z.NAME_TO_ECI.get(i);if(o===void 0)throw new K("incorect value");return o}equals(i){if(!(i instanceof Z))return!1;const o=i;return this.getName()===o.getName()}}Z.VALUE_IDENTIFIER_TO_ECI=new Map,Z.VALUES_TO_ECI=new Map,Z.NAME_TO_ECI=new Map,Z.Cp437=new Z(ot.Cp437,Int32Array.from([0,2]),"Cp437"),Z.ISO8859_1=new Z(ot.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),Z.ISO8859_2=new Z(ot.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),Z.ISO8859_3=new Z(ot.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),Z.ISO8859_4=new Z(ot.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),Z.ISO8859_5=new Z(ot.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),Z.ISO8859_6=new Z(ot.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),Z.ISO8859_7=new Z(ot.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),Z.ISO8859_8=new Z(ot.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),Z.ISO8859_9=new Z(ot.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),Z.ISO8859_10=new Z(ot.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),Z.ISO8859_11=new Z(ot.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),Z.ISO8859_13=new Z(ot.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),Z.ISO8859_14=new Z(ot.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),Z.ISO8859_15=new Z(ot.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),Z.ISO8859_16=new Z(ot.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),Z.SJIS=new Z(ot.SJIS,20,"SJIS","Shift_JIS"),Z.Cp1250=new Z(ot.Cp1250,21,"Cp1250","windows-1250"),Z.Cp1251=new Z(ot.Cp1251,22,"Cp1251","windows-1251"),Z.Cp1252=new Z(ot.Cp1252,23,"Cp1252","windows-1252"),Z.Cp1256=new Z(ot.Cp1256,24,"Cp1256","windows-1256"),Z.UnicodeBigUnmarked=new Z(ot.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),Z.UTF8=new Z(ot.UTF8,26,"UTF8","UTF-8"),Z.ASCII=new Z(ot.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),Z.Big5=new Z(ot.Big5,28,"Big5"),Z.GB18030=new Z(ot.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),Z.EUC_KR=new Z(ot.EUC_KR,30,"EUC_KR","EUC-KR");class Ot extends p{}Ot.kind="UnsupportedOperationException";class St{static decode(i,o){const a=this.encodingName(o);return this.customDecoder?this.customDecoder(i,a):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(a)?this.decodeFallback(i,a):new TextDecoder(a).decode(i)}static shouldDecodeOnFallback(i){return!St.isBrowser()&&i==="ISO-8859-1"}static encode(i,o){const a=this.encodingName(o);return this.customEncoder?this.customEncoder(i,a):typeof TextEncoder>"u"?this.encodeFallback(i):new TextEncoder().encode(i)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(i){return typeof i=="string"?i:i.getName()}static encodingCharacterSet(i){return i instanceof Z?i:Z.getCharacterSetECIByName(i)}static decodeFallback(i,o){const a=this.encodingCharacterSet(o);if(St.isDecodeFallbackSupported(a)){let h="";for(let c=0,d=i.length;c<d;c++){let x=i[c].toString(16);x.length<2&&(x="0"+x),h+="%"+x}return decodeURIComponent(h)}if(a.equals(Z.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(i.buffer));throw new Ot(`Encoding ${this.encodingName(o)} not supported by fallback.`)}static isDecodeFallbackSupported(i){return i.equals(Z.UTF8)||i.equals(Z.ISO8859_1)||i.equals(Z.ASCII)}static encodeFallback(i){const a=btoa(unescape(encodeURIComponent(i))).split(""),h=[];for(let c=0;c<a.length;c++)h.push(a[c].charCodeAt(0));return new Uint8Array(h)}}class ut{static castAsNonUtf8Char(i,o=null){const a=o?o.getName():this.ISO88591;return St.decode(new Uint8Array([i]),a)}static guessEncoding(i,o){if(o!=null&&o.get(rt.CHARACTER_SET)!==void 0)return o.get(rt.CHARACTER_SET).toString();const a=i.length;let h=!0,c=!0,d=!0,x=0,_=0,C=0,M=0,R=0,L=0,k=0,V=0,H=0,$=0,nt=0;const xt=i.length>3&&i[0]===239&&i[1]===187&&i[2]===191;for(let _t=0;_t<a&&(h||c||d);_t++){const dt=i[_t]&255;d&&(x>0?dt&128?x--:d=!1:dt&128&&(dt&64?(x++,dt&32?(x++,dt&16?(x++,dt&8?d=!1:M++):C++):_++):d=!1)),h&&(dt>127&&dt<160?h=!1:dt>159&&(dt<192||dt===215||dt===247)&&nt++),c&&(R>0?dt<64||dt===127||dt>252?c=!1:R--:dt===128||dt===160||dt>239?c=!1:dt>160&&dt<224?(L++,V=0,k++,k>H&&(H=k)):dt>127?(R++,k=0,V++,V>$&&($=V)):(k=0,V=0))}return d&&x>0&&(d=!1),c&&R>0&&(c=!1),d&&(xt||_+C+M>0)?ut.UTF8:c&&(ut.ASSUME_SHIFT_JIS||H>=3||$>=3)?ut.SHIFT_JIS:h&&c?H===2&&L===2||nt*10>=a?ut.SHIFT_JIS:ut.ISO88591:h?ut.ISO88591:c?ut.SHIFT_JIS:d?ut.UTF8:ut.PLATFORM_DEFAULT_ENCODING}static format(i,...o){let a=-1;function h(d,x,_,C,M,R){if(d==="%%")return"%";if(o[++a]===void 0)return;d=C?parseInt(C.substr(1)):void 0;let L=M?parseInt(M.substr(1)):void 0,k;switch(R){case"s":k=o[a];break;case"c":k=o[a][0];break;case"f":k=parseFloat(o[a]).toFixed(d);break;case"p":k=parseFloat(o[a]).toPrecision(d);break;case"e":k=parseFloat(o[a]).toExponential(d);break;case"x":k=parseInt(o[a]).toString(L||16);break;case"d":k=parseFloat(parseInt(o[a],L||10).toPrecision(d)).toFixed(0);break}k=typeof k=="object"?JSON.stringify(k):(+k).toString(L);let V=parseInt(_),H=_&&_[0]+""=="0"?"0":" ";for(;k.length<V;)k=x!==void 0?k+H:H+k;return k}let c=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return i.replace(c,h)}static getBytes(i,o){return St.encode(i,o)}static getCharCode(i,o=0){return i.charCodeAt(o)}static getCharAt(i){return String.fromCharCode(i)}}ut.SHIFT_JIS=Z.SJIS.getName(),ut.GB2312="GB2312",ut.ISO88591=Z.ISO8859_1.getName(),ut.EUC_JP="EUC_JP",ut.UTF8=Z.UTF8.getName(),ut.PLATFORM_DEFAULT_ENCODING=ut.UTF8,ut.ASSUME_SHIFT_JIS=!1;class yt{constructor(i=""){this.value=i}enableDecoding(i){return this.encoding=i,this}append(i){return typeof i=="string"?this.value+=i.toString():this.encoding?this.value+=ut.castAsNonUtf8Char(i,this.encoding):this.value+=String.fromCharCode(i),this}appendChars(i,o,a){for(let h=o;o<o+a;h++)this.append(i[h]);return this}length(){return this.value.length}charAt(i){return this.value.charAt(i)}deleteCharAt(i){this.value=this.value.substr(0,i)+this.value.substring(i+1)}setCharAt(i,o){this.value=this.value.substr(0,i)+o+this.value.substr(i+1)}substring(i,o){return this.value.substring(i,o)}setLengthToZero(){this.value=""}toString(){return this.value}insert(i,o){this.value=this.value.substr(0,i)+o+this.value.substr(i+o.length)}}class Nt{constructor(i,o,a,h){if(this.width=i,this.height=o,this.rowSize=a,this.bits=h,o==null&&(o=i),this.height=o,i<1||o<1)throw new A("Both dimensions must be greater than 0");a==null&&(a=Math.floor((i+31)/32)),this.rowSize=a,h==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(i){const o=i.length,a=i[0].length,h=new Nt(a,o);for(let c=0;c<o;c++){const d=i[c];for(let x=0;x<a;x++)d[x]&&h.set(x,c)}return h}static parseFromString(i,o,a){if(i===null)throw new A("stringRepresentation cannot be null");const h=new Array(i.length);let c=0,d=0,x=-1,_=0,C=0;for(;C<i.length;)if(i.charAt(C)===`
`||i.charAt(C)==="\r"){if(c>d){if(x===-1)x=c-d;else if(c-d!==x)throw new A("row lengths do not match");d=c,_++}C++}else if(i.substring(C,C+o.length)===o)C+=o.length,h[c]=!0,c++;else if(i.substring(C,C+a.length)===a)C+=a.length,h[c]=!1,c++;else throw new A("illegal character encountered: "+i.substring(C));if(c>d){if(x===-1)x=c-d;else if(c-d!==x)throw new A("row lengths do not match");_++}const M=new Nt(x,_);for(let R=0;R<c;R++)h[R]&&M.set(Math.floor(R%x),Math.floor(R/x));return M}get(i,o){const a=o*this.rowSize+Math.floor(i/32);return(this.bits[a]>>>(i&31)&1)!==0}set(i,o){const a=o*this.rowSize+Math.floor(i/32);this.bits[a]|=1<<(i&31)&4294967295}unset(i,o){const a=o*this.rowSize+Math.floor(i/32);this.bits[a]&=~(1<<(i&31)&4294967295)}flip(i,o){const a=o*this.rowSize+Math.floor(i/32);this.bits[a]^=1<<(i&31)&4294967295}xor(i){if(this.width!==i.getWidth()||this.height!==i.getHeight()||this.rowSize!==i.getRowSize())throw new A("input matrix dimensions do not match");const o=new Y(Math.floor(this.width/32)+1),a=this.rowSize,h=this.bits;for(let c=0,d=this.height;c<d;c++){const x=c*a,_=i.getRow(c,o).getBitArray();for(let C=0;C<a;C++)h[x+C]^=_[C]}}clear(){const i=this.bits,o=i.length;for(let a=0;a<o;a++)i[a]=0}setRegion(i,o,a,h){if(o<0||i<0)throw new A("Left and top must be nonnegative");if(h<1||a<1)throw new A("Height and width must be at least 1");const c=i+a,d=o+h;if(d>this.height||c>this.width)throw new A("The region must fit inside the matrix");const x=this.rowSize,_=this.bits;for(let C=o;C<d;C++){const M=C*x;for(let R=i;R<c;R++)_[M+Math.floor(R/32)]|=1<<(R&31)&4294967295}}getRow(i,o){o==null||o.getSize()<this.width?o=new Y(this.width):o.clear();const a=this.rowSize,h=this.bits,c=i*a;for(let d=0;d<a;d++)o.setBulk(d*32,h[c+d]);return o}setRow(i,o){F.arraycopy(o.getBitArray(),0,this.bits,i*this.rowSize,this.rowSize)}rotate180(){const i=this.getWidth(),o=this.getHeight();let a=new Y(i),h=new Y(i);for(let c=0,d=Math.floor((o+1)/2);c<d;c++)a=this.getRow(c,a),h=this.getRow(o-1-c,h),a.reverse(),h.reverse(),this.setRow(c,h),this.setRow(o-1-c,a)}getEnclosingRectangle(){const i=this.width,o=this.height,a=this.rowSize,h=this.bits;let c=i,d=o,x=-1,_=-1;for(let C=0;C<o;C++)for(let M=0;M<a;M++){const R=h[C*a+M];if(R!==0){if(C<d&&(d=C),C>_&&(_=C),M*32<c){let L=0;for(;!(R<<31-L&4294967295);)L++;M*32+L<c&&(c=M*32+L)}if(M*32+31>x){let L=31;for(;!(R>>>L);)L--;M*32+L>x&&(x=M*32+L)}}}return x<c||_<d?null:Int32Array.from([c,d,x-c+1,_-d+1])}getTopLeftOnBit(){const i=this.rowSize,o=this.bits;let a=0;for(;a<o.length&&o[a]===0;)a++;if(a===o.length)return null;const h=a/i;let c=a%i*32;const d=o[a];let x=0;for(;!(d<<31-x&4294967295);)x++;return c+=x,Int32Array.from([c,h])}getBottomRightOnBit(){const i=this.rowSize,o=this.bits;let a=o.length-1;for(;a>=0&&o[a]===0;)a--;if(a<0)return null;const h=Math.floor(a/i);let c=Math.floor(a%i)*32;const d=o[a];let x=31;for(;!(d>>>x);)x--;return c+=x,Int32Array.from([c,h])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(i){if(!(i instanceof Nt))return!1;const o=i;return this.width===o.width&&this.height===o.height&&this.rowSize===o.rowSize&&G.equals(this.bits,o.bits)}hashCode(){let i=this.width;return i=31*i+this.width,i=31*i+this.height,i=31*i+this.rowSize,i=31*i+G.hashCode(this.bits),i}toString(i="X ",o="  ",a=`
`){return this.buildToString(i,o,a)}buildToString(i,o,a){let h=new yt;for(let c=0,d=this.height;c<d;c++){for(let x=0,_=this.width;x<_;x++)h.append(this.get(x,c)?i:o);h.append(a)}return h.toString()}clone(){return new Nt(this.width,this.height,this.rowSize,this.bits.slice())}}class J extends p{static getNotFoundInstance(){return new J}}J.kind="NotFoundException";class gt extends P{constructor(i){super(i),this.luminances=gt.EMPTY,this.buckets=new Int32Array(gt.LUMINANCE_BUCKETS)}getBlackRow(i,o){const a=this.getLuminanceSource(),h=a.getWidth();o==null||o.getSize()<h?o=new Y(h):o.clear(),this.initArrays(h);const c=a.getRow(i,this.luminances),d=this.buckets;for(let _=0;_<h;_++)d[(c[_]&255)>>gt.LUMINANCE_SHIFT]++;const x=gt.estimateBlackPoint(d);if(h<3)for(let _=0;_<h;_++)(c[_]&255)<x&&o.set(_);else{let _=c[0]&255,C=c[1]&255;for(let M=1;M<h-1;M++){const R=c[M+1]&255;(C*4-_-R)/2<x&&o.set(M),_=C,C=R}}return o}getBlackMatrix(){const i=this.getLuminanceSource(),o=i.getWidth(),a=i.getHeight(),h=new Nt(o,a);this.initArrays(o);const c=this.buckets;for(let _=1;_<5;_++){const C=Math.floor(a*_/5),M=i.getRow(C,this.luminances),R=Math.floor(o*4/5);for(let L=Math.floor(o/5);L<R;L++){const k=M[L]&255;c[k>>gt.LUMINANCE_SHIFT]++}}const d=gt.estimateBlackPoint(c),x=i.getMatrix();for(let _=0;_<a;_++){const C=_*o;for(let M=0;M<o;M++)(x[C+M]&255)<d&&h.set(M,_)}return h}createBinarizer(i){return new gt(i)}initArrays(i){this.luminances.length<i&&(this.luminances=new Uint8ClampedArray(i));const o=this.buckets;for(let a=0;a<gt.LUMINANCE_BUCKETS;a++)o[a]=0}static estimateBlackPoint(i){const o=i.length;let a=0,h=0,c=0;for(let M=0;M<o;M++)i[M]>c&&(h=M,c=i[M]),i[M]>a&&(a=i[M]);let d=0,x=0;for(let M=0;M<o;M++){const R=M-h,L=i[M]*R*R;L>x&&(d=M,x=L)}if(h>d){const M=h;h=d,d=M}if(d-h<=o/16)throw new J;let _=d-1,C=-1;for(let M=d-1;M>h;M--){const R=M-h,L=R*R*(d-M)*(a-i[M]);L>C&&(_=M,C=L)}return _<<gt.LUMINANCE_SHIFT}}gt.LUMINANCE_BITS=5,gt.LUMINANCE_SHIFT=8-gt.LUMINANCE_BITS,gt.LUMINANCE_BUCKETS=1<<gt.LUMINANCE_BITS,gt.EMPTY=Uint8ClampedArray.from([0]);class Et extends gt{constructor(i){super(i),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const i=this.getLuminanceSource(),o=i.getWidth(),a=i.getHeight();if(o>=Et.MINIMUM_DIMENSION&&a>=Et.MINIMUM_DIMENSION){const h=i.getMatrix();let c=o>>Et.BLOCK_SIZE_POWER;o&Et.BLOCK_SIZE_MASK&&c++;let d=a>>Et.BLOCK_SIZE_POWER;a&Et.BLOCK_SIZE_MASK&&d++;const x=Et.calculateBlackPoints(h,c,d,o,a),_=new Nt(o,a);Et.calculateThresholdForBlock(h,c,d,o,a,x,_),this.matrix=_}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(i){return new Et(i)}static calculateThresholdForBlock(i,o,a,h,c,d,x){const _=c-Et.BLOCK_SIZE,C=h-Et.BLOCK_SIZE;for(let M=0;M<a;M++){let R=M<<Et.BLOCK_SIZE_POWER;R>_&&(R=_);const L=Et.cap(M,2,a-3);for(let k=0;k<o;k++){let V=k<<Et.BLOCK_SIZE_POWER;V>C&&(V=C);const H=Et.cap(k,2,o-3);let $=0;for(let xt=-2;xt<=2;xt++){const _t=d[L+xt];$+=_t[H-2]+_t[H-1]+_t[H]+_t[H+1]+_t[H+2]}const nt=$/25;Et.thresholdBlock(i,V,R,nt,h,x)}}}static cap(i,o,a){return i<o?o:i>a?a:i}static thresholdBlock(i,o,a,h,c,d){for(let x=0,_=a*c+o;x<Et.BLOCK_SIZE;x++,_+=c)for(let C=0;C<Et.BLOCK_SIZE;C++)(i[_+C]&255)<=h&&d.set(o+C,a+x)}static calculateBlackPoints(i,o,a,h,c){const d=c-Et.BLOCK_SIZE,x=h-Et.BLOCK_SIZE,_=new Array(a);for(let C=0;C<a;C++){_[C]=new Int32Array(o);let M=C<<Et.BLOCK_SIZE_POWER;M>d&&(M=d);for(let R=0;R<o;R++){let L=R<<Et.BLOCK_SIZE_POWER;L>x&&(L=x);let k=0,V=255,H=0;for(let nt=0,xt=M*h+L;nt<Et.BLOCK_SIZE;nt++,xt+=h){for(let _t=0;_t<Et.BLOCK_SIZE;_t++){const dt=i[xt+_t]&255;k+=dt,dt<V&&(V=dt),dt>H&&(H=dt)}if(H-V>Et.MIN_DYNAMIC_RANGE)for(nt++,xt+=h;nt<Et.BLOCK_SIZE;nt++,xt+=h)for(let _t=0;_t<Et.BLOCK_SIZE;_t++)k+=i[xt+_t]&255}let $=k>>Et.BLOCK_SIZE_POWER*2;if(H-V<=Et.MIN_DYNAMIC_RANGE&&($=V/2,C>0&&R>0)){const nt=(_[C-1][R]+2*_[C][R-1]+_[C-1][R-1])/4;V<nt&&($=nt)}_[C][R]=$}}return _}}Et.BLOCK_SIZE_POWER=3,Et.BLOCK_SIZE=1<<Et.BLOCK_SIZE_POWER,Et.BLOCK_SIZE_MASK=Et.BLOCK_SIZE-1,Et.MINIMUM_DIMENSION=Et.BLOCK_SIZE*5,Et.MIN_DYNAMIC_RANGE=24;class Wt{constructor(i,o){this.width=i,this.height=o}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(i,o,a,h){throw new Ot("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new Ot("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new Ot("This luminance source does not support rotation by 45 degrees.")}toString(){const i=new Uint8ClampedArray(this.width);let o=new yt;for(let a=0;a<this.height;a++){const h=this.getRow(a,i);for(let c=0;c<this.width;c++){const d=h[c]&255;let x;d<64?x="#":d<128?x="+":d<192?x=".":x=" ",o.append(x)}o.append(`
`)}return o.toString()}}class re extends Wt{constructor(i){super(i.getWidth(),i.getHeight()),this.delegate=i}getRow(i,o){const a=this.delegate.getRow(i,o),h=this.getWidth();for(let c=0;c<h;c++)a[c]=255-(a[c]&255);return a}getMatrix(){const i=this.delegate.getMatrix(),o=this.getWidth()*this.getHeight(),a=new Uint8ClampedArray(o);for(let h=0;h<o;h++)a[h]=255-(i[h]&255);return a}isCropSupported(){return this.delegate.isCropSupported()}crop(i,o,a,h){return new re(this.delegate.crop(i,o,a,h))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new re(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new re(this.delegate.rotateCounterClockwise45())}}class Ut extends Wt{constructor(i){super(i.width,i.height),this.canvas=i,this.tempCanvasElement=null,this.buffer=Ut.makeBufferFromCanvasImageData(i)}static makeBufferFromCanvasImageData(i){const o=i.getContext("2d").getImageData(0,0,i.width,i.height);return Ut.toGrayscaleBuffer(o.data,i.width,i.height)}static toGrayscaleBuffer(i,o,a){const h=new Uint8ClampedArray(o*a);for(let c=0,d=0,x=i.length;c<x;c+=4,d++){let _;if(i[c+3]===0)_=255;else{const M=i[c],R=i[c+1],L=i[c+2];_=306*M+601*R+117*L+512>>10}h[d]=_}return h}getRow(i,o){if(i<0||i>=this.getHeight())throw new A("Requested row is outside the image: "+i);const a=this.getWidth(),h=i*a;return o===null?o=this.buffer.slice(h,h+a):(o.length<a&&(o=new Uint8ClampedArray(a)),o.set(this.buffer.slice(h,h+a))),o}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(i,o,a,h){return super.crop(i,o,a,h),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const i=this.canvas.ownerDocument.createElement("canvas");i.width=this.canvas.width,i.height=this.canvas.height,this.tempCanvasElement=i}return this.tempCanvasElement}rotate(i){const o=this.getTempCanvasElement(),a=o.getContext("2d"),h=i*Ut.DEGREE_TO_RADIANS,c=this.canvas.width,d=this.canvas.height,x=Math.ceil(Math.abs(Math.cos(h))*c+Math.abs(Math.sin(h))*d),_=Math.ceil(Math.abs(Math.sin(h))*c+Math.abs(Math.cos(h))*d);return o.width=x,o.height=_,a.translate(x/2,_/2),a.rotate(h),a.drawImage(this.canvas,c/-2,d/-2),this.buffer=Ut.makeBufferFromCanvasImageData(o),this}invert(){return new re(this)}}Ut.DEGREE_TO_RADIANS=Math.PI/180;class Jt{constructor(i,o,a){this.deviceId=i,this.label=o,this.kind="videoinput",this.groupId=a||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var Ft=(globalThis||Ir||self||window||void 0)&&(globalThis||Ir||self||window||void 0).__awaiter||function(T,i,o,a){function h(c){return c instanceof o?c:new o(function(d){d(c)})}return new(o||(o=Promise))(function(c,d){function x(M){try{C(a.next(M))}catch(R){d(R)}}function _(M){try{C(a.throw(M))}catch(R){d(R)}}function C(M){M.done?c(M.value):h(M.value).then(x,_)}C((a=a.apply(T,i||[])).next())})};class $t{constructor(i,o=500,a){this.reader=i,this.timeBetweenScansMillis=o,this._hints=a,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(i){this._timeBetweenDecodingAttempts=i<0?0:i}set hints(i){this._hints=i||null}get hints(){return this._hints}listVideoInputDevices(){return Ft(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const i=yield navigator.mediaDevices.enumerateDevices(),o=[];for(const a of i){const h=a.kind==="video"?"videoinput":a.kind;if(h!=="videoinput")continue;const c=a.deviceId||a.id,d=a.label||`Video device ${o.length+1}`,x=a.groupId,_={deviceId:c,label:d,kind:h,groupId:x};o.push(_)}return o})}getVideoInputDevices(){return Ft(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(o=>new Jt(o.deviceId,o.label))})}findDeviceById(i){return Ft(this,void 0,void 0,function*(){const o=yield this.listVideoInputDevices();return o?o.find(a=>a.deviceId===i):null})}decodeFromInputVideoDevice(i,o){return Ft(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(i,o)})}decodeOnceFromVideoDevice(i,o){return Ft(this,void 0,void 0,function*(){this.reset();let a;i?a={deviceId:{exact:i}}:a={facingMode:"environment"};const h={video:a};return yield this.decodeOnceFromConstraints(h,o)})}decodeOnceFromConstraints(i,o){return Ft(this,void 0,void 0,function*(){const a=yield navigator.mediaDevices.getUserMedia(i);return yield this.decodeOnceFromStream(a,o)})}decodeOnceFromStream(i,o){return Ft(this,void 0,void 0,function*(){this.reset();const a=yield this.attachStreamToVideo(i,o);return yield this.decodeOnce(a)})}decodeFromInputVideoDeviceContinuously(i,o,a){return Ft(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(i,o,a)})}decodeFromVideoDevice(i,o,a){return Ft(this,void 0,void 0,function*(){let h;i?h={deviceId:{exact:i}}:h={facingMode:"environment"};const c={video:h};return yield this.decodeFromConstraints(c,o,a)})}decodeFromConstraints(i,o,a){return Ft(this,void 0,void 0,function*(){const h=yield navigator.mediaDevices.getUserMedia(i);return yield this.decodeFromStream(h,o,a)})}decodeFromStream(i,o,a){return Ft(this,void 0,void 0,function*(){this.reset();const h=yield this.attachStreamToVideo(i,o);return yield this.decodeContinuously(h,a)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(i,o){return Ft(this,void 0,void 0,function*(){const a=this.prepareVideoElement(o);return this.addVideoSource(a,i),this.videoElement=a,this.stream=i,yield this.playVideoOnLoadAsync(a),a})}playVideoOnLoadAsync(i){return new Promise((o,a)=>this.playVideoOnLoad(i,()=>o()))}playVideoOnLoad(i,o){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(i),i.addEventListener("ended",this.videoEndedListener),i.addEventListener("canplay",this.videoCanPlayListener),i.addEventListener("playing",o),this.tryPlayVideo(i)}isVideoPlaying(i){return i.currentTime>0&&!i.paused&&!i.ended&&i.readyState>2}tryPlayVideo(i){return Ft(this,void 0,void 0,function*(){if(this.isVideoPlaying(i)){console.warn("Trying to play video that is already playing.");return}try{yield i.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(i,o){const a=document.getElementById(i);if(!a)throw new E(`element with id '${i}' not found`);if(a.nodeName.toLowerCase()!==o.toLowerCase())throw new E(`element with id '${i}' must be an ${o} element`);return a}decodeFromImage(i,o){if(!i&&!o)throw new E("either imageElement with a src set or an url must be provided");return o&&!i?this.decodeFromImageUrl(o):this.decodeFromImageElement(i)}decodeFromVideo(i,o){if(!i&&!o)throw new E("Either an element with a src set or an URL must be provided");return o&&!i?this.decodeFromVideoUrl(o):this.decodeFromVideoElement(i)}decodeFromVideoContinuously(i,o,a){if(i===void 0&&o===void 0)throw new E("Either an element with a src set or an URL must be provided");return o&&!i?this.decodeFromVideoUrlContinuously(o,a):this.decodeFromVideoElementContinuously(i,a)}decodeFromImageElement(i){if(!i)throw new E("An image element must be provided.");this.reset();const o=this.prepareImageElement(i);this.imageElement=o;let a;return this.isImageLoaded(o)?a=this.decodeOnce(o,!1,!0):a=this._decodeOnLoadImage(o),a}decodeFromVideoElement(i){const o=this._decodeFromVideoElementSetup(i);return this._decodeOnLoadVideo(o)}decodeFromVideoElementContinuously(i,o){const a=this._decodeFromVideoElementSetup(i);return this._decodeOnLoadVideoContinuously(a,o)}_decodeFromVideoElementSetup(i){if(!i)throw new E("A video element must be provided.");this.reset();const o=this.prepareVideoElement(i);return this.videoElement=o,o}decodeFromImageUrl(i){if(!i)throw new E("An URL must be provided.");this.reset();const o=this.prepareImageElement();this.imageElement=o;const a=this._decodeOnLoadImage(o);return o.src=i,a}decodeFromVideoUrl(i){if(!i)throw new E("An URL must be provided.");this.reset();const o=this.prepareVideoElement(),a=this.decodeFromVideoElement(o);return o.src=i,a}decodeFromVideoUrlContinuously(i,o){if(!i)throw new E("An URL must be provided.");this.reset();const a=this.prepareVideoElement(),h=this.decodeFromVideoElementContinuously(a,o);return a.src=i,h}_decodeOnLoadImage(i){return new Promise((o,a)=>{this.imageLoadedListener=()=>this.decodeOnce(i,!1,!0).then(o,a),i.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(i){return Ft(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(i),yield this.decodeOnce(i)})}_decodeOnLoadVideoContinuously(i,o){return Ft(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(i),this.decodeContinuously(i,o)})}isImageLoaded(i){return!(!i.complete||i.naturalWidth===0)}prepareImageElement(i){let o;return typeof i>"u"&&(o=document.createElement("img"),o.width=200,o.height=200),typeof i=="string"&&(o=this.getMediaElement(i,"img")),i instanceof HTMLImageElement&&(o=i),o}prepareVideoElement(i){let o;return!i&&typeof document<"u"&&(o=document.createElement("video"),o.width=200,o.height=200),typeof i=="string"&&(o=this.getMediaElement(i,"video")),i instanceof HTMLVideoElement&&(o=i),o.setAttribute("autoplay","true"),o.setAttribute("muted","true"),o.setAttribute("playsinline","true"),o}decodeOnce(i,o=!0,a=!0){this._stopAsyncDecode=!1;const h=(c,d)=>{if(this._stopAsyncDecode){d(new J("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const x=this.decode(i);c(x)}catch(x){const _=o&&x instanceof J,M=(x instanceof D||x instanceof K)&&a;if(_||M)return setTimeout(h,this._timeBetweenDecodingAttempts,c,d);d(x)}};return new Promise((c,d)=>h(c,d))}decodeContinuously(i,o){this._stopContinuousDecode=!1;const a=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const h=this.decode(i);o(h,null),setTimeout(a,this.timeBetweenScansMillis)}catch(h){o(null,h);const c=h instanceof D||h instanceof K,d=h instanceof J;(c||d)&&setTimeout(a,this._timeBetweenDecodingAttempts)}};a()}decode(i){const o=this.createBinaryBitmap(i);return this.decodeBitmap(o)}_isHTMLVideoElement(i){return i.videoWidth!==0}drawFrameOnCanvas(i,o,a){o||(o={sx:0,sy:0,sWidth:i.videoWidth,sHeight:i.videoHeight,dx:0,dy:0,dWidth:i.videoWidth,dHeight:i.videoHeight}),a||(a=this.captureCanvasContext),a.drawImage(i,o.sx,o.sy,o.sWidth,o.sHeight,o.dx,o.dy,o.dWidth,o.dHeight)}drawImageOnCanvas(i,o,a=this.captureCanvasContext){o||(o={sx:0,sy:0,sWidth:i.naturalWidth,sHeight:i.naturalHeight,dx:0,dy:0,dWidth:i.naturalWidth,dHeight:i.naturalHeight}),a||(a=this.captureCanvasContext),a.drawImage(i,o.sx,o.sy,o.sWidth,o.sHeight,o.dx,o.dy,o.dWidth,o.dHeight)}createBinaryBitmap(i){this.getCaptureCanvasContext(i),this._isHTMLVideoElement(i)?this.drawFrameOnCanvas(i):this.drawImageOnCanvas(i);const o=this.getCaptureCanvas(i),a=new Ut(o),h=new Et(a);return new b(h)}getCaptureCanvasContext(i){if(!this.captureCanvasContext){const a=this.getCaptureCanvas(i).getContext("2d");this.captureCanvasContext=a}return this.captureCanvasContext}getCaptureCanvas(i){if(!this.captureCanvas){const o=this.createCaptureCanvas(i);this.captureCanvas=o}return this.captureCanvas}decodeBitmap(i){return this.reader.decode(i,this._hints)}createCaptureCanvas(i){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const o=document.createElement("canvas");let a,h;return typeof i<"u"&&(i instanceof HTMLVideoElement?(a=i.videoWidth,h=i.videoHeight):i instanceof HTMLImageElement&&(a=i.naturalWidth||i.width,h=i.naturalHeight||i.height)),o.style.width=a+"px",o.style.height=h+"px",o.width=a,o.height=h,o}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(i=>i.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(i,o){try{i.srcObject=o}catch{i.src=URL.createObjectURL(o)}}cleanVideoSource(i){try{i.srcObject=null}catch{i.src=""}this.videoElement.removeAttribute("src")}}class ft{constructor(i,o,a=o==null?0:8*o.length,h,c,d=F.currentTimeMillis()){this.text=i,this.rawBytes=o,this.numBits=a,this.resultPoints=h,this.format=c,this.timestamp=d,this.text=i,this.rawBytes=o,a==null?this.numBits=o==null?0:8*o.length:this.numBits=a,this.resultPoints=h,this.format=c,this.resultMetadata=null,d==null?this.timestamp=F.currentTimeMillis():this.timestamp=d}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(i,o){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(i,o)}putAllMetadata(i){i!==null&&(this.resultMetadata===null?this.resultMetadata=i:this.resultMetadata=new Map(i))}addResultPoints(i){const o=this.resultPoints;if(o===null)this.resultPoints=i;else if(i!==null&&i.length>0){const a=new Array(o.length+i.length);F.arraycopy(o,0,a,0,o.length),F.arraycopy(i,0,a,o.length,i.length),this.resultPoints=a}}getTimestamp(){return this.timestamp}toString(){return this.text}}var ii;(function(T){T[T.AZTEC=0]="AZTEC",T[T.CODABAR=1]="CODABAR",T[T.CODE_39=2]="CODE_39",T[T.CODE_93=3]="CODE_93",T[T.CODE_128=4]="CODE_128",T[T.DATA_MATRIX=5]="DATA_MATRIX",T[T.EAN_8=6]="EAN_8",T[T.EAN_13=7]="EAN_13",T[T.ITF=8]="ITF",T[T.MAXICODE=9]="MAXICODE",T[T.PDF_417=10]="PDF_417",T[T.QR_CODE=11]="QR_CODE",T[T.RSS_14=12]="RSS_14",T[T.RSS_EXPANDED=13]="RSS_EXPANDED",T[T.UPC_A=14]="UPC_A",T[T.UPC_E=15]="UPC_E",T[T.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(ii||(ii={}));var Tt=ii,Oe;(function(T){T[T.OTHER=0]="OTHER",T[T.ORIENTATION=1]="ORIENTATION",T[T.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",T[T.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",T[T.ISSUE_NUMBER=4]="ISSUE_NUMBER",T[T.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",T[T.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",T[T.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",T[T.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",T[T.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",T[T.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(Oe||(Oe={}));var _e=Oe;class fi{constructor(i,o,a,h,c=-1,d=-1){this.rawBytes=i,this.text=o,this.byteSegments=a,this.ecLevel=h,this.structuredAppendSequenceNumber=c,this.structuredAppendParity=d,this.numBits=i==null?0:8*i.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(i){this.numBits=i}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(i){this.errorsCorrected=i}getErasures(){return this.erasures}setErasures(i){this.erasures=i}getOther(){return this.other}setOther(i){this.other=i}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Be{exp(i){return this.expTable[i]}log(i){if(i===0)throw new A;return this.logTable[i]}static addOrSubtract(i,o){return i^o}}class Ze{constructor(i,o){if(o.length===0)throw new A;this.field=i;const a=o.length;if(a>1&&o[0]===0){let h=1;for(;h<a&&o[h]===0;)h++;h===a?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(a-h),F.arraycopy(o,h,this.coefficients,0,this.coefficients.length))}else this.coefficients=o}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(i){return this.coefficients[this.coefficients.length-1-i]}evaluateAt(i){if(i===0)return this.getCoefficient(0);const o=this.coefficients;let a;if(i===1){a=0;for(let d=0,x=o.length;d!==x;d++){const _=o[d];a=Be.addOrSubtract(a,_)}return a}a=o[0];const h=o.length,c=this.field;for(let d=1;d<h;d++)a=Be.addOrSubtract(c.multiply(i,a),o[d]);return a}addOrSubtract(i){if(!this.field.equals(i.field))throw new A("GenericGFPolys do not have same GenericGF field");if(this.isZero())return i;if(i.isZero())return this;let o=this.coefficients,a=i.coefficients;if(o.length>a.length){const d=o;o=a,a=d}let h=new Int32Array(a.length);const c=a.length-o.length;F.arraycopy(a,0,h,0,c);for(let d=c;d<a.length;d++)h[d]=Be.addOrSubtract(o[d-c],a[d]);return new Ze(this.field,h)}multiply(i){if(!this.field.equals(i.field))throw new A("GenericGFPolys do not have same GenericGF field");if(this.isZero()||i.isZero())return this.field.getZero();const o=this.coefficients,a=o.length,h=i.coefficients,c=h.length,d=new Int32Array(a+c-1),x=this.field;for(let _=0;_<a;_++){const C=o[_];for(let M=0;M<c;M++)d[_+M]=Be.addOrSubtract(d[_+M],x.multiply(C,h[M]))}return new Ze(x,d)}multiplyScalar(i){if(i===0)return this.field.getZero();if(i===1)return this;const o=this.coefficients.length,a=this.field,h=new Int32Array(o),c=this.coefficients;for(let d=0;d<o;d++)h[d]=a.multiply(c[d],i);return new Ze(a,h)}multiplyByMonomial(i,o){if(i<0)throw new A;if(o===0)return this.field.getZero();const a=this.coefficients,h=a.length,c=new Int32Array(h+i),d=this.field;for(let x=0;x<h;x++)c[x]=d.multiply(a[x],o);return new Ze(d,c)}divide(i){if(!this.field.equals(i.field))throw new A("GenericGFPolys do not have same GenericGF field");if(i.isZero())throw new A("Divide by 0");const o=this.field;let a=o.getZero(),h=this;const c=i.getCoefficient(i.getDegree()),d=o.inverse(c);for(;h.getDegree()>=i.getDegree()&&!h.isZero();){const x=h.getDegree()-i.getDegree(),_=o.multiply(h.getCoefficient(h.getDegree()),d),C=i.multiplyByMonomial(x,_),M=o.buildMonomial(x,_);a=a.addOrSubtract(M),h=h.addOrSubtract(C)}return[a,h]}toString(){let i="";for(let o=this.getDegree();o>=0;o--){let a=this.getCoefficient(o);if(a!==0){if(a<0?(i+=" - ",a=-a):i.length>0&&(i+=" + "),o===0||a!==1){const h=this.field.log(a);h===0?i+="1":h===1?i+="a":(i+="a^",i+=h)}o!==0&&(o===1?i+="x":(i+="x^",i+=o))}}return i}}class ze extends p{}ze.kind="ArithmeticException";class ie extends Be{constructor(i,o,a){super(),this.primitive=i,this.size=o,this.generatorBase=a;const h=new Int32Array(o);let c=1;for(let x=0;x<o;x++)h[x]=c,c*=2,c>=o&&(c^=i,c&=o-1);this.expTable=h;const d=new Int32Array(o);for(let x=0;x<o-1;x++)d[h[x]]=x;this.logTable=d,this.zero=new Ze(this,Int32Array.from([0])),this.one=new Ze(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(i,o){if(i<0)throw new A;if(o===0)return this.zero;const a=new Int32Array(i+1);return a[0]=o,new Ze(this,a)}inverse(i){if(i===0)throw new ze;return this.expTable[this.size-this.logTable[i]-1]}multiply(i,o){return i===0||o===0?0:this.expTable[(this.logTable[i]+this.logTable[o])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+X.toHexString(this.primitive)+","+this.size+")"}equals(i){return i===this}}ie.AZTEC_DATA_12=new ie(4201,4096,1),ie.AZTEC_DATA_10=new ie(1033,1024,1),ie.AZTEC_DATA_6=new ie(67,64,1),ie.AZTEC_PARAM=new ie(19,16,1),ie.QR_CODE_FIELD_256=new ie(285,256,0),ie.DATA_MATRIX_FIELD_256=new ie(301,256,1),ie.AZTEC_DATA_8=ie.DATA_MATRIX_FIELD_256,ie.MAXICODE_FIELD_64=ie.AZTEC_DATA_6;class di extends p{}di.kind="ReedSolomonException";class li extends p{}li.kind="IllegalStateException";class _i{constructor(i){this.field=i}decode(i,o){const a=this.field,h=new Ze(a,i),c=new Int32Array(o);let d=!0;for(let k=0;k<o;k++){const V=h.evaluateAt(a.exp(k+a.getGeneratorBase()));c[c.length-1-k]=V,V!==0&&(d=!1)}if(d)return;const x=new Ze(a,c),_=this.runEuclideanAlgorithm(a.buildMonomial(o,1),x,o),C=_[0],M=_[1],R=this.findErrorLocations(C),L=this.findErrorMagnitudes(M,R);for(let k=0;k<R.length;k++){const V=i.length-1-a.log(R[k]);if(V<0)throw new di("Bad error location");i[V]=ie.addOrSubtract(i[V],L[k])}}runEuclideanAlgorithm(i,o,a){if(i.getDegree()<o.getDegree()){const k=i;i=o,o=k}const h=this.field;let c=i,d=o,x=h.getZero(),_=h.getOne();for(;d.getDegree()>=(a/2|0);){let k=c,V=x;if(c=d,x=_,c.isZero())throw new di("r_{i-1} was zero");d=k;let H=h.getZero();const $=c.getCoefficient(c.getDegree()),nt=h.inverse($);for(;d.getDegree()>=c.getDegree()&&!d.isZero();){const xt=d.getDegree()-c.getDegree(),_t=h.multiply(d.getCoefficient(d.getDegree()),nt);H=H.addOrSubtract(h.buildMonomial(xt,_t)),d=d.addOrSubtract(c.multiplyByMonomial(xt,_t))}if(_=H.multiply(x).addOrSubtract(V),d.getDegree()>=c.getDegree())throw new li("Division algorithm failed to reduce polynomial?")}const C=_.getCoefficient(0);if(C===0)throw new di("sigmaTilde(0) was zero");const M=h.inverse(C),R=_.multiplyScalar(M),L=d.multiplyScalar(M);return[R,L]}findErrorLocations(i){const o=i.getDegree();if(o===1)return Int32Array.from([i.getCoefficient(1)]);const a=new Int32Array(o);let h=0;const c=this.field;for(let d=1;d<c.getSize()&&h<o;d++)i.evaluateAt(d)===0&&(a[h]=c.inverse(d),h++);if(h!==o)throw new di("Error locator degree does not match number of roots");return a}findErrorMagnitudes(i,o){const a=o.length,h=new Int32Array(a),c=this.field;for(let d=0;d<a;d++){const x=c.inverse(o[d]);let _=1;for(let C=0;C<a;C++)if(d!==C){const M=c.multiply(o[C],x),R=M&1?M&-2:M|1;_=c.multiply(_,R)}h[d]=c.multiply(i.evaluateAt(x),c.inverse(_)),c.getGeneratorBase()!==0&&(h[d]=c.multiply(h[d],x))}return h}}var ke;(function(T){T[T.UPPER=0]="UPPER",T[T.LOWER=1]="LOWER",T[T.MIXED=2]="MIXED",T[T.DIGIT=3]="DIGIT",T[T.PUNCT=4]="PUNCT",T[T.BINARY=5]="BINARY"})(ke||(ke={}));class le{decode(i){this.ddata=i;let o=i.getBits(),a=this.extractBits(o),h=this.correctBits(a),c=le.convertBoolArrayToByteArray(h),d=le.getEncodedData(h),x=new fi(c,d,null,null);return x.setNumBits(h.length),x}static highLevelDecode(i){return this.getEncodedData(i)}static getEncodedData(i){let o=i.length,a=ke.UPPER,h=ke.UPPER,c="",d=0;for(;d<o;)if(h===ke.BINARY){if(o-d<5)break;let x=le.readCode(i,d,5);if(d+=5,x===0){if(o-d<11)break;x=le.readCode(i,d,11)+31,d+=11}for(let _=0;_<x;_++){if(o-d<8){d=o;break}const C=le.readCode(i,d,8);c+=ut.castAsNonUtf8Char(C),d+=8}h=a}else{let x=h===ke.DIGIT?4:5;if(o-d<x)break;let _=le.readCode(i,d,x);d+=x;let C=le.getCharacter(h,_);C.startsWith("CTRL_")?(a=h,h=le.getTable(C.charAt(5)),C.charAt(6)==="L"&&(a=h)):(c+=C,h=a)}return c}static getTable(i){switch(i){case"L":return ke.LOWER;case"P":return ke.PUNCT;case"M":return ke.MIXED;case"D":return ke.DIGIT;case"B":return ke.BINARY;case"U":default:return ke.UPPER}}static getCharacter(i,o){switch(i){case ke.UPPER:return le.UPPER_TABLE[o];case ke.LOWER:return le.LOWER_TABLE[o];case ke.MIXED:return le.MIXED_TABLE[o];case ke.PUNCT:return le.PUNCT_TABLE[o];case ke.DIGIT:return le.DIGIT_TABLE[o];default:throw new li("Bad table")}}correctBits(i){let o,a;this.ddata.getNbLayers()<=2?(a=6,o=ie.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(a=8,o=ie.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(a=10,o=ie.AZTEC_DATA_10):(a=12,o=ie.AZTEC_DATA_12);let h=this.ddata.getNbDatablocks(),c=i.length/a;if(c<h)throw new K;let d=i.length%a,x=new Int32Array(c);for(let L=0;L<c;L++,d+=a)x[L]=le.readCode(i,d,a);try{new _i(o).decode(x,c-h)}catch(L){throw new K(L)}let _=(1<<a)-1,C=0;for(let L=0;L<h;L++){let k=x[L];if(k===0||k===_)throw new K;(k===1||k===_-1)&&C++}let M=new Array(h*a-C),R=0;for(let L=0;L<h;L++){let k=x[L];if(k===1||k===_-1)M.fill(k>1,R,R+a-1),R+=a-1;else for(let V=a-1;V>=0;--V)M[R++]=(k&1<<V)!==0}return M}extractBits(i){let o=this.ddata.isCompact(),a=this.ddata.getNbLayers(),h=(o?11:14)+a*4,c=new Int32Array(h),d=new Array(this.totalBitsInLayer(a,o));if(o)for(let x=0;x<c.length;x++)c[x]=x;else{let x=h+1+2*X.truncDivision(X.truncDivision(h,2)-1,15),_=h/2,C=X.truncDivision(x,2);for(let M=0;M<_;M++){let R=M+X.truncDivision(M,15);c[_-M-1]=C-R-1,c[_+M]=C+R+1}}for(let x=0,_=0;x<a;x++){let C=(a-x)*4+(o?9:12),M=x*2,R=h-1-M;for(let L=0;L<C;L++){let k=L*2;for(let V=0;V<2;V++)d[_+k+V]=i.get(c[M+V],c[M+L]),d[_+2*C+k+V]=i.get(c[M+L],c[R-V]),d[_+4*C+k+V]=i.get(c[R-V],c[R-L]),d[_+6*C+k+V]=i.get(c[R-L],c[M+V])}_+=C*8}return d}static readCode(i,o,a){let h=0;for(let c=o;c<o+a;c++)h<<=1,i[c]&&(h|=1);return h}static readByte(i,o){let a=i.length-o;return a>=8?le.readCode(i,o,8):le.readCode(i,o,a)<<8-a}static convertBoolArrayToByteArray(i){let o=new Uint8Array((i.length+7)/8);for(let a=0;a<o.length;a++)o[a]=le.readByte(i,8*a);return o}totalBitsInLayer(i,o){return((o?88:112)+16*i)*i}}le.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],le.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],le.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],le.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],le.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class te{constructor(){}static round(i){return i===NaN?0:i<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:i>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:i+(i<0?-.5:.5)|0}static distance(i,o,a,h){const c=i-a,d=o-h;return Math.sqrt(c*c+d*d)}static sum(i){let o=0;for(let a=0,h=i.length;a!==h;a++){const c=i[a];o+=c}return o}}class gi{static floatToIntBits(i){return i}}gi.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Mt{constructor(i,o){this.x=i,this.y=o}getX(){return this.x}getY(){return this.y}equals(i){if(i instanceof Mt){const o=i;return this.x===o.x&&this.y===o.y}return!1}hashCode(){return 31*gi.floatToIntBits(this.x)+gi.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(i){const o=this.distance(i[0],i[1]),a=this.distance(i[1],i[2]),h=this.distance(i[0],i[2]);let c,d,x;if(a>=o&&a>=h?(d=i[0],c=i[1],x=i[2]):h>=a&&h>=o?(d=i[1],c=i[0],x=i[2]):(d=i[2],c=i[0],x=i[1]),this.crossProductZ(c,d,x)<0){const _=c;c=x,x=_}i[0]=c,i[1]=d,i[2]=x}static distance(i,o){return te.distance(i.x,i.y,o.x,o.y)}static crossProductZ(i,o,a){const h=o.x,c=o.y;return(a.x-h)*(i.y-c)-(a.y-c)*(i.x-h)}}class yi{constructor(i,o){this.bits=i,this.points=o}getBits(){return this.bits}getPoints(){return this.points}}class on extends yi{constructor(i,o,a,h,c){super(i,o),this.compact=a,this.nbDatablocks=h,this.nbLayers=c}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class hi{constructor(i,o,a,h){this.image=i,this.height=i.getHeight(),this.width=i.getWidth(),o==null&&(o=hi.INIT_SIZE),a==null&&(a=i.getWidth()/2|0),h==null&&(h=i.getHeight()/2|0);const c=o/2|0;if(this.leftInit=a-c,this.rightInit=a+c,this.upInit=h-c,this.downInit=h+c,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new J}detect(){let i=this.leftInit,o=this.rightInit,a=this.upInit,h=this.downInit,c=!1,d=!0,x=!1,_=!1,C=!1,M=!1,R=!1;const L=this.width,k=this.height;for(;d;){d=!1;let V=!0;for(;(V||!_)&&o<L;)V=this.containsBlackPoint(a,h,o,!1),V?(o++,d=!0,_=!0):_||o++;if(o>=L){c=!0;break}let H=!0;for(;(H||!C)&&h<k;)H=this.containsBlackPoint(i,o,h,!0),H?(h++,d=!0,C=!0):C||h++;if(h>=k){c=!0;break}let $=!0;for(;($||!M)&&i>=0;)$=this.containsBlackPoint(a,h,i,!1),$?(i--,d=!0,M=!0):M||i--;if(i<0){c=!0;break}let nt=!0;for(;(nt||!R)&&a>=0;)nt=this.containsBlackPoint(i,o,a,!0),nt?(a--,d=!0,R=!0):R||a--;if(a<0){c=!0;break}d&&(x=!0)}if(!c&&x){const V=o-i;let H=null;for(let _t=1;H===null&&_t<V;_t++)H=this.getBlackPointOnSegment(i,h-_t,i+_t,h);if(H==null)throw new J;let $=null;for(let _t=1;$===null&&_t<V;_t++)$=this.getBlackPointOnSegment(i,a+_t,i+_t,a);if($==null)throw new J;let nt=null;for(let _t=1;nt===null&&_t<V;_t++)nt=this.getBlackPointOnSegment(o,a+_t,o-_t,a);if(nt==null)throw new J;let xt=null;for(let _t=1;xt===null&&_t<V;_t++)xt=this.getBlackPointOnSegment(o,h-_t,o-_t,h);if(xt==null)throw new J;return this.centerEdges(xt,H,nt,$)}else throw new J}getBlackPointOnSegment(i,o,a,h){const c=te.round(te.distance(i,o,a,h)),d=(a-i)/c,x=(h-o)/c,_=this.image;for(let C=0;C<c;C++){const M=te.round(i+C*d),R=te.round(o+C*x);if(_.get(M,R))return new Mt(M,R)}return null}centerEdges(i,o,a,h){const c=i.getX(),d=i.getY(),x=o.getX(),_=o.getY(),C=a.getX(),M=a.getY(),R=h.getX(),L=h.getY(),k=hi.CORR;return c<this.width/2?[new Mt(R-k,L+k),new Mt(x+k,_+k),new Mt(C-k,M-k),new Mt(c+k,d-k)]:[new Mt(R+k,L+k),new Mt(x+k,_-k),new Mt(C-k,M+k),new Mt(c-k,d-k)]}containsBlackPoint(i,o,a,h){const c=this.image;if(h){for(let d=i;d<=o;d++)if(c.get(d,a))return!0}else for(let d=i;d<=o;d++)if(c.get(a,d))return!0;return!1}}hi.INIT_SIZE=10,hi.CORR=1;class Bi{static checkAndNudgePoints(i,o){const a=i.getWidth(),h=i.getHeight();let c=!0;for(let d=0;d<o.length&&c;d+=2){const x=Math.floor(o[d]),_=Math.floor(o[d+1]);if(x<-1||x>a||_<-1||_>h)throw new J;c=!1,x===-1?(o[d]=0,c=!0):x===a&&(o[d]=a-1,c=!0),_===-1?(o[d+1]=0,c=!0):_===h&&(o[d+1]=h-1,c=!0)}c=!0;for(let d=o.length-2;d>=0&&c;d-=2){const x=Math.floor(o[d]),_=Math.floor(o[d+1]);if(x<-1||x>a||_<-1||_>h)throw new J;c=!1,x===-1?(o[d]=0,c=!0):x===a&&(o[d]=a-1,c=!0),_===-1?(o[d+1]=0,c=!0):_===h&&(o[d+1]=h-1,c=!0)}}}class ni{constructor(i,o,a,h,c,d,x,_,C){this.a11=i,this.a21=o,this.a31=a,this.a12=h,this.a22=c,this.a32=d,this.a13=x,this.a23=_,this.a33=C}static quadrilateralToQuadrilateral(i,o,a,h,c,d,x,_,C,M,R,L,k,V,H,$){const nt=ni.quadrilateralToSquare(i,o,a,h,c,d,x,_);return ni.squareToQuadrilateral(C,M,R,L,k,V,H,$).times(nt)}transformPoints(i){const o=i.length,a=this.a11,h=this.a12,c=this.a13,d=this.a21,x=this.a22,_=this.a23,C=this.a31,M=this.a32,R=this.a33;for(let L=0;L<o;L+=2){const k=i[L],V=i[L+1],H=c*k+_*V+R;i[L]=(a*k+d*V+C)/H,i[L+1]=(h*k+x*V+M)/H}}transformPointsWithValues(i,o){const a=this.a11,h=this.a12,c=this.a13,d=this.a21,x=this.a22,_=this.a23,C=this.a31,M=this.a32,R=this.a33,L=i.length;for(let k=0;k<L;k++){const V=i[k],H=o[k],$=c*V+_*H+R;i[k]=(a*V+d*H+C)/$,o[k]=(h*V+x*H+M)/$}}static squareToQuadrilateral(i,o,a,h,c,d,x,_){const C=i-a+c-x,M=o-h+d-_;if(C===0&&M===0)return new ni(a-i,c-a,i,h-o,d-h,o,0,0,1);{const R=a-c,L=x-c,k=h-d,V=_-d,H=R*V-L*k,$=(C*V-L*M)/H,nt=(R*M-C*k)/H;return new ni(a-i+$*a,x-i+nt*x,i,h-o+$*h,_-o+nt*_,o,$,nt,1)}}static quadrilateralToSquare(i,o,a,h,c,d,x,_){return ni.squareToQuadrilateral(i,o,a,h,c,d,x,_).buildAdjoint()}buildAdjoint(){return new ni(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(i){return new ni(this.a11*i.a11+this.a21*i.a12+this.a31*i.a13,this.a11*i.a21+this.a21*i.a22+this.a31*i.a23,this.a11*i.a31+this.a21*i.a32+this.a31*i.a33,this.a12*i.a11+this.a22*i.a12+this.a32*i.a13,this.a12*i.a21+this.a22*i.a22+this.a32*i.a23,this.a12*i.a31+this.a22*i.a32+this.a32*i.a33,this.a13*i.a11+this.a23*i.a12+this.a33*i.a13,this.a13*i.a21+this.a23*i.a22+this.a33*i.a23,this.a13*i.a31+this.a23*i.a32+this.a33*i.a33)}}class Hi extends Bi{sampleGrid(i,o,a,h,c,d,x,_,C,M,R,L,k,V,H,$,nt,xt,_t){const dt=ni.quadrilateralToQuadrilateral(h,c,d,x,_,C,M,R,L,k,V,H,$,nt,xt,_t);return this.sampleGridWithTransform(i,o,a,dt)}sampleGridWithTransform(i,o,a,h){if(o<=0||a<=0)throw new J;const c=new Nt(o,a),d=new Float32Array(2*o);for(let x=0;x<a;x++){const _=d.length,C=x+.5;for(let M=0;M<_;M+=2)d[M]=M/2+.5,d[M+1]=C;h.transformPoints(d),Bi.checkAndNudgePoints(i,d);try{for(let M=0;M<_;M+=2)i.get(Math.floor(d[M]),Math.floor(d[M+1]))&&c.set(M/2,x)}catch{throw new J}}return c}}class Ke{static setGridSampler(i){Ke.gridSampler=i}static getInstance(){return Ke.gridSampler}}Ke.gridSampler=new Hi;class he{constructor(i,o){this.x=i,this.y=o}toResultPoint(){return new Mt(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class ar{constructor(i){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=i}detect(){return this.detectMirror(!1)}detectMirror(i){let o=this.getMatrixCenter(),a=this.getBullsEyeCorners(o);if(i){let d=a[0];a[0]=a[2],a[2]=d}this.extractParameters(a);let h=this.sampleGrid(this.image,a[this.shift%4],a[(this.shift+1)%4],a[(this.shift+2)%4],a[(this.shift+3)%4]),c=this.getMatrixCornerPoints(a);return new on(h,c,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(i){if(!this.isValidPoint(i[0])||!this.isValidPoint(i[1])||!this.isValidPoint(i[2])||!this.isValidPoint(i[3]))throw new J;let o=2*this.nbCenterLayers,a=new Int32Array([this.sampleLine(i[0],i[1],o),this.sampleLine(i[1],i[2],o),this.sampleLine(i[2],i[3],o),this.sampleLine(i[3],i[0],o)]);this.shift=this.getRotation(a,o);let h=0;for(let d=0;d<4;d++){let x=a[(this.shift+d)%4];this.compact?(h<<=7,h+=x>>1&127):(h<<=10,h+=(x>>2&992)+(x>>1&31))}let c=this.getCorrectedParameterData(h,this.compact);this.compact?(this.nbLayers=(c>>6)+1,this.nbDataBlocks=(c&63)+1):(this.nbLayers=(c>>11)+1,this.nbDataBlocks=(c&2047)+1)}getRotation(i,o){let a=0;i.forEach((h,c,d)=>{let x=(h>>o-2<<1)+(h&1);a=(a<<3)+x}),a=((a&1)<<11)+(a>>1);for(let h=0;h<4;h++)if(X.bitCount(a^this.EXPECTED_CORNER_BITS[h])<=2)return h;throw new J}getCorrectedParameterData(i,o){let a,h;o?(a=7,h=2):(a=10,h=4);let c=a-h,d=new Int32Array(a);for(let _=a-1;_>=0;--_)d[_]=i&15,i>>=4;try{new _i(ie.AZTEC_PARAM).decode(d,c)}catch{throw new J}let x=0;for(let _=0;_<h;_++)x=(x<<4)+d[_];return x}getBullsEyeCorners(i){let o=i,a=i,h=i,c=i,d=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let R=this.getFirstDifferent(o,d,1,-1),L=this.getFirstDifferent(a,d,1,1),k=this.getFirstDifferent(h,d,-1,1),V=this.getFirstDifferent(c,d,-1,-1);if(this.nbCenterLayers>2){let H=this.distancePoint(V,R)*this.nbCenterLayers/(this.distancePoint(c,o)*(this.nbCenterLayers+2));if(H<.75||H>1.25||!this.isWhiteOrBlackRectangle(R,L,k,V))break}o=R,a=L,h=k,c=V,d=!d}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new J;this.compact=this.nbCenterLayers===5;let x=new Mt(o.getX()+.5,o.getY()-.5),_=new Mt(a.getX()+.5,a.getY()+.5),C=new Mt(h.getX()-.5,h.getY()+.5),M=new Mt(c.getX()-.5,c.getY()-.5);return this.expandSquare([x,_,C,M],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let i,o,a,h;try{let x=new hi(this.image).detect();i=x[0],o=x[1],a=x[2],h=x[3]}catch{let _=this.image.getWidth()/2,C=this.image.getHeight()/2;i=this.getFirstDifferent(new he(_+7,C-7),!1,1,-1).toResultPoint(),o=this.getFirstDifferent(new he(_+7,C+7),!1,1,1).toResultPoint(),a=this.getFirstDifferent(new he(_-7,C+7),!1,-1,1).toResultPoint(),h=this.getFirstDifferent(new he(_-7,C-7),!1,-1,-1).toResultPoint()}let c=te.round((i.getX()+h.getX()+o.getX()+a.getX())/4),d=te.round((i.getY()+h.getY()+o.getY()+a.getY())/4);try{let x=new hi(this.image,15,c,d).detect();i=x[0],o=x[1],a=x[2],h=x[3]}catch{i=this.getFirstDifferent(new he(c+7,d-7),!1,1,-1).toResultPoint(),o=this.getFirstDifferent(new he(c+7,d+7),!1,1,1).toResultPoint(),a=this.getFirstDifferent(new he(c-7,d+7),!1,-1,1).toResultPoint(),h=this.getFirstDifferent(new he(c-7,d-7),!1,-1,-1).toResultPoint()}return c=te.round((i.getX()+h.getX()+o.getX()+a.getX())/4),d=te.round((i.getY()+h.getY()+o.getY()+a.getY())/4),new he(c,d)}getMatrixCornerPoints(i){return this.expandSquare(i,2*this.nbCenterLayers,this.getDimension())}sampleGrid(i,o,a,h,c){let d=Ke.getInstance(),x=this.getDimension(),_=x/2-this.nbCenterLayers,C=x/2+this.nbCenterLayers;return d.sampleGrid(i,x,x,_,_,C,_,C,C,_,C,o.getX(),o.getY(),a.getX(),a.getY(),h.getX(),h.getY(),c.getX(),c.getY())}sampleLine(i,o,a){let h=0,c=this.distanceResultPoint(i,o),d=c/a,x=i.getX(),_=i.getY(),C=d*(o.getX()-i.getX())/c,M=d*(o.getY()-i.getY())/c;for(let R=0;R<a;R++)this.image.get(te.round(x+R*C),te.round(_+R*M))&&(h|=1<<a-R-1);return h}isWhiteOrBlackRectangle(i,o,a,h){let c=3;i=new he(i.getX()-c,i.getY()+c),o=new he(o.getX()-c,o.getY()-c),a=new he(a.getX()+c,a.getY()-c),h=new he(h.getX()+c,h.getY()+c);let d=this.getColor(h,i);if(d===0)return!1;let x=this.getColor(i,o);return x!==d||(x=this.getColor(o,a),x!==d)?!1:(x=this.getColor(a,h),x===d)}getColor(i,o){let a=this.distancePoint(i,o),h=(o.getX()-i.getX())/a,c=(o.getY()-i.getY())/a,d=0,x=i.getX(),_=i.getY(),C=this.image.get(i.getX(),i.getY()),M=Math.ceil(a);for(let L=0;L<M;L++)x+=h,_+=c,this.image.get(te.round(x),te.round(_))!==C&&d++;let R=d/a;return R>.1&&R<.9?0:R<=.1===C?1:-1}getFirstDifferent(i,o,a,h){let c=i.getX()+a,d=i.getY()+h;for(;this.isValid(c,d)&&this.image.get(c,d)===o;)c+=a,d+=h;for(c-=a,d-=h;this.isValid(c,d)&&this.image.get(c,d)===o;)c+=a;for(c-=a;this.isValid(c,d)&&this.image.get(c,d)===o;)d+=h;return d-=h,new he(c,d)}expandSquare(i,o,a){let h=a/(2*o),c=i[0].getX()-i[2].getX(),d=i[0].getY()-i[2].getY(),x=(i[0].getX()+i[2].getX())/2,_=(i[0].getY()+i[2].getY())/2,C=new Mt(x+h*c,_+h*d),M=new Mt(x-h*c,_-h*d);c=i[1].getX()-i[3].getX(),d=i[1].getY()-i[3].getY(),x=(i[1].getX()+i[3].getX())/2,_=(i[1].getY()+i[3].getY())/2;let R=new Mt(x+h*c,_+h*d),L=new Mt(x-h*c,_-h*d);return[C,R,M,L]}isValid(i,o){return i>=0&&i<this.image.getWidth()&&o>0&&o<this.image.getHeight()}isValidPoint(i){let o=te.round(i.getX()),a=te.round(i.getY());return this.isValid(o,a)}distancePoint(i,o){return te.distance(i.getX(),i.getY(),o.getX(),o.getY())}distanceResultPoint(i,o){return te.distance(i.getX(),i.getY(),o.getX(),o.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(X.truncDivision(this.nbLayers-4,8)+1)+15}}class Xn{decode(i,o=null){let a=null,h=new ar(i.getBlackMatrix()),c=null,d=null;try{let M=h.detectMirror(!1);c=M.getPoints(),this.reportFoundResultPoints(o,c),d=new le().decode(M)}catch(M){a=M}if(d==null)try{let M=h.detectMirror(!0);c=M.getPoints(),this.reportFoundResultPoints(o,c),d=new le().decode(M)}catch(M){throw a??M}let x=new ft(d.getText(),d.getRawBytes(),d.getNumBits(),c,Tt.AZTEC,F.currentTimeMillis()),_=d.getByteSegments();_!=null&&x.putMetadata(_e.BYTE_SEGMENTS,_);let C=d.getECLevel();return C!=null&&x.putMetadata(_e.ERROR_CORRECTION_LEVEL,C),x}reportFoundResultPoints(i,o){if(i!=null){let a=i.get(rt.NEED_RESULT_POINT_CALLBACK);a!=null&&o.forEach((h,c,d)=>{a.foundPossibleResultPoint(h)})}}reset(){}}class Vn extends $t{constructor(i=500){super(new Xn,i)}}class Ce{decode(i,o){try{return this.doDecode(i,o)}catch{if(o&&o.get(rt.TRY_HARDER)===!0&&i.isRotateSupported()){const c=i.rotateCounterClockwise(),d=this.doDecode(c,o),x=d.getResultMetadata();let _=270;x!==null&&x.get(_e.ORIENTATION)===!0&&(_=_+x.get(_e.ORIENTATION)%360),d.putMetadata(_e.ORIENTATION,_);const C=d.getResultPoints();if(C!==null){const M=c.getHeight();for(let R=0;R<C.length;R++)C[R]=new Mt(M-C[R].getY()-1,C[R].getX())}return d}else throw new J}}reset(){}doDecode(i,o){const a=i.getWidth(),h=i.getHeight();let c=new Y(a);const d=o&&o.get(rt.TRY_HARDER)===!0,x=Math.max(1,h>>(d?8:5));let _;d?_=h:_=15;const C=Math.trunc(h/2);for(let M=0;M<_;M++){const R=Math.trunc((M+1)/2),L=(M&1)===0,k=C+x*(L?R:-R);if(k<0||k>=h)break;try{c=i.getBlackRow(k,c)}catch{continue}for(let V=0;V<2;V++){if(V===1&&(c.reverse(),o&&o.get(rt.NEED_RESULT_POINT_CALLBACK)===!0)){const H=new Map;o.forEach(($,nt)=>H.set(nt,$)),H.delete(rt.NEED_RESULT_POINT_CALLBACK),o=H}try{const H=this.decodeRow(k,c,o);if(V===1){H.putMetadata(_e.ORIENTATION,180);const $=H.getResultPoints();$!==null&&($[0]=new Mt(a-$[0].getX()-1,$[0].getY()),$[1]=new Mt(a-$[1].getX()-1,$[1].getY()))}return H}catch{}}}throw new J}static recordPattern(i,o,a){const h=a.length;for(let C=0;C<h;C++)a[C]=0;const c=i.getSize();if(o>=c)throw new J;let d=!i.get(o),x=0,_=o;for(;_<c;){if(i.get(_)!==d)a[x]++;else{if(++x===h)break;a[x]=1,d=!d}_++}if(!(x===h||x===h-1&&_===c))throw new J}static recordPatternInReverse(i,o,a){let h=a.length,c=i.get(o);for(;o>0&&h>=0;)i.get(--o)!==c&&(h--,c=!c);if(h>=0)throw new J;Ce.recordPattern(i,o+1,a)}static patternMatchVariance(i,o,a){const h=i.length;let c=0,d=0;for(let C=0;C<h;C++)c+=i[C],d+=o[C];if(c<d)return Number.POSITIVE_INFINITY;const x=c/d;a*=x;let _=0;for(let C=0;C<h;C++){const M=i[C],R=o[C]*x,L=M>R?M-R:R-M;if(L>a)return Number.POSITIVE_INFINITY;_+=L}return _/c}}class wt extends Ce{static findStartPattern(i){const o=i.getSize(),a=i.getNextSet(0);let h=0,c=Int32Array.from([0,0,0,0,0,0]),d=a,x=!1;const _=6;for(let C=a;C<o;C++)if(i.get(C)!==x)c[h]++;else{if(h===_-1){let M=wt.MAX_AVG_VARIANCE,R=-1;for(let L=wt.CODE_START_A;L<=wt.CODE_START_C;L++){const k=Ce.patternMatchVariance(c,wt.CODE_PATTERNS[L],wt.MAX_INDIVIDUAL_VARIANCE);k<M&&(M=k,R=L)}if(R>=0&&i.isRange(Math.max(0,d-(C-d)/2),d,!1))return Int32Array.from([d,C,R]);d+=c[0]+c[1],c=c.slice(2,c.length-1),c[h-1]=0,c[h]=0,h--}else h++;c[h]=1,x=!x}throw new J}static decodeCode(i,o,a){Ce.recordPattern(i,a,o);let h=wt.MAX_AVG_VARIANCE,c=-1;for(let d=0;d<wt.CODE_PATTERNS.length;d++){const x=wt.CODE_PATTERNS[d],_=this.patternMatchVariance(o,x,wt.MAX_INDIVIDUAL_VARIANCE);_<h&&(h=_,c=d)}if(c>=0)return c;throw new J}decodeRow(i,o,a){const h=a&&a.get(rt.ASSUME_GS1)===!0,c=wt.findStartPattern(o),d=c[2];let x=0;const _=new Uint8Array(20);_[x++]=d;let C;switch(d){case wt.CODE_START_A:C=wt.CODE_CODE_A;break;case wt.CODE_START_B:C=wt.CODE_CODE_B;break;case wt.CODE_START_C:C=wt.CODE_CODE_C;break;default:throw new K}let M=!1,R=!1,L="",k=c[0],V=c[1];const H=Int32Array.from([0,0,0,0,0,0]);let $=0,nt=0,xt=d,_t=0,dt=!0,ae=!1,Kt=!1;for(;!M;){const gr=R;switch(R=!1,$=nt,nt=wt.decodeCode(o,H,V),_[x++]=nt,nt!==wt.CODE_STOP&&(dt=!0),nt!==wt.CODE_STOP&&(_t++,xt+=_t*nt),k=V,V+=H.reduce((Xf,Vf)=>Xf+Vf,0),nt){case wt.CODE_START_A:case wt.CODE_START_B:case wt.CODE_START_C:throw new K}switch(C){case wt.CODE_CODE_A:if(nt<64)Kt===ae?L+=String.fromCharCode(32+nt):L+=String.fromCharCode(32+nt+128),Kt=!1;else if(nt<96)Kt===ae?L+=String.fromCharCode(nt-64):L+=String.fromCharCode(nt+64),Kt=!1;else switch(nt!==wt.CODE_STOP&&(dt=!1),nt){case wt.CODE_FNC_1:h&&(L.length===0?L+="]C1":L+="");break;case wt.CODE_FNC_2:case wt.CODE_FNC_3:break;case wt.CODE_FNC_4_A:!ae&&Kt?(ae=!0,Kt=!1):ae&&Kt?(ae=!1,Kt=!1):Kt=!0;break;case wt.CODE_SHIFT:R=!0,C=wt.CODE_CODE_B;break;case wt.CODE_CODE_B:C=wt.CODE_CODE_B;break;case wt.CODE_CODE_C:C=wt.CODE_CODE_C;break;case wt.CODE_STOP:M=!0;break}break;case wt.CODE_CODE_B:if(nt<96)Kt===ae?L+=String.fromCharCode(32+nt):L+=String.fromCharCode(32+nt+128),Kt=!1;else switch(nt!==wt.CODE_STOP&&(dt=!1),nt){case wt.CODE_FNC_1:h&&(L.length===0?L+="]C1":L+="");break;case wt.CODE_FNC_2:case wt.CODE_FNC_3:break;case wt.CODE_FNC_4_B:!ae&&Kt?(ae=!0,Kt=!1):ae&&Kt?(ae=!1,Kt=!1):Kt=!0;break;case wt.CODE_SHIFT:R=!0,C=wt.CODE_CODE_A;break;case wt.CODE_CODE_A:C=wt.CODE_CODE_A;break;case wt.CODE_CODE_C:C=wt.CODE_CODE_C;break;case wt.CODE_STOP:M=!0;break}break;case wt.CODE_CODE_C:if(nt<100)nt<10&&(L+="0"),L+=nt;else switch(nt!==wt.CODE_STOP&&(dt=!1),nt){case wt.CODE_FNC_1:h&&(L.length===0?L+="]C1":L+="");break;case wt.CODE_CODE_A:C=wt.CODE_CODE_A;break;case wt.CODE_CODE_B:C=wt.CODE_CODE_B;break;case wt.CODE_STOP:M=!0;break}break}gr&&(C=C===wt.CODE_CODE_A?wt.CODE_CODE_B:wt.CODE_CODE_A)}const Gi=V-k;if(V=o.getNextUnset(V),!o.isRange(V,Math.min(o.getSize(),V+(V-k)/2),!1))throw new J;if(xt-=_t*$,xt%103!==$)throw new D;const Cn=L.length;if(Cn===0)throw new J;Cn>0&&dt&&(C===wt.CODE_CODE_C?L=L.substring(0,Cn-2):L=L.substring(0,Cn-1));const zi=(c[1]+c[0])/2,Le=k+Gi/2,Ci=_.length,Qi=new Uint8Array(Ci);for(let gr=0;gr<Ci;gr++)Qi[gr]=_[gr];const dr=[new Mt(zi,i),new Mt(Le,i)];return new ft(L,Qi,0,dr,Tt.CODE_128,new Date().getTime())}}wt.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],wt.MAX_AVG_VARIANCE=.25,wt.MAX_INDIVIDUAL_VARIANCE=.7,wt.CODE_SHIFT=98,wt.CODE_CODE_C=99,wt.CODE_CODE_B=100,wt.CODE_CODE_A=101,wt.CODE_FNC_1=102,wt.CODE_FNC_2=97,wt.CODE_FNC_3=96,wt.CODE_FNC_4_A=101,wt.CODE_FNC_4_B=100,wt.CODE_START_A=103,wt.CODE_START_B=104,wt.CODE_START_C=105,wt.CODE_STOP=106;class Se extends Ce{constructor(i=!1,o=!1){super(),this.usingCheckDigit=i,this.extendedMode=o,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(i,o,a){let h=this.counters;h.fill(0),this.decodeRowResult="";let c=Se.findAsteriskPattern(o,h),d=o.getNextSet(c[1]),x=o.getSize(),_,C;do{Se.recordPattern(o,d,h);let H=Se.toNarrowWidePattern(h);if(H<0)throw new J;_=Se.patternToChar(H),this.decodeRowResult+=_,C=d;for(let $ of h)d+=$;d=o.getNextSet(d)}while(_!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let M=0;for(let H of h)M+=H;let R=d-C-M;if(d!==x&&R*2<M)throw new J;if(this.usingCheckDigit){let H=this.decodeRowResult.length-1,$=0;for(let nt=0;nt<H;nt++)$+=Se.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(nt));if(this.decodeRowResult.charAt(H)!==Se.ALPHABET_STRING.charAt($%43))throw new D;this.decodeRowResult=this.decodeRowResult.substring(0,H)}if(this.decodeRowResult.length===0)throw new J;let L;this.extendedMode?L=Se.decodeExtended(this.decodeRowResult):L=this.decodeRowResult;let k=(c[1]+c[0])/2,V=C+M/2;return new ft(L,null,0,[new Mt(k,i),new Mt(V,i)],Tt.CODE_39,new Date().getTime())}static findAsteriskPattern(i,o){let a=i.getSize(),h=i.getNextSet(0),c=0,d=h,x=!1,_=o.length;for(let C=h;C<a;C++)if(i.get(C)!==x)o[c]++;else{if(c===_-1){if(this.toNarrowWidePattern(o)===Se.ASTERISK_ENCODING&&i.isRange(Math.max(0,d-Math.floor((C-d)/2)),d,!1))return[d,C];d+=o[0]+o[1],o.copyWithin(0,2,2+c-1),o[c-1]=0,o[c]=0,c--}else c++;o[c]=1,x=!x}throw new J}static toNarrowWidePattern(i){let o=i.length,a=0,h;do{let c=2147483647;for(let _ of i)_<c&&_>a&&(c=_);a=c,h=0;let d=0,x=0;for(let _=0;_<o;_++){let C=i[_];C>a&&(x|=1<<o-1-_,h++,d+=C)}if(h===3){for(let _=0;_<o&&h>0;_++){let C=i[_];if(C>a&&(h--,C*2>=d))return-1}return x}}while(h>3);return-1}static patternToChar(i){for(let o=0;o<Se.CHARACTER_ENCODINGS.length;o++)if(Se.CHARACTER_ENCODINGS[o]===i)return Se.ALPHABET_STRING.charAt(o);if(i===Se.ASTERISK_ENCODING)return"*";throw new J}static decodeExtended(i){let o=i.length,a="";for(let h=0;h<o;h++){let c=i.charAt(h);if(c==="+"||c==="$"||c==="%"||c==="/"){let d=i.charAt(h+1),x="\0";switch(c){case"+":if(d>="A"&&d<="Z")x=String.fromCharCode(d.charCodeAt(0)+32);else throw new K;break;case"$":if(d>="A"&&d<="Z")x=String.fromCharCode(d.charCodeAt(0)-64);else throw new K;break;case"%":if(d>="A"&&d<="E")x=String.fromCharCode(d.charCodeAt(0)-38);else if(d>="F"&&d<="J")x=String.fromCharCode(d.charCodeAt(0)-11);else if(d>="K"&&d<="O")x=String.fromCharCode(d.charCodeAt(0)+16);else if(d>="P"&&d<="T")x=String.fromCharCode(d.charCodeAt(0)+43);else if(d==="U")x="\0";else if(d==="V")x="@";else if(d==="W")x="`";else if(d==="X"||d==="Y"||d==="Z")x="";else throw new K;break;case"/":if(d>="A"&&d<="O")x=String.fromCharCode(d.charCodeAt(0)-32);else if(d==="Z")x=":";else throw new K;break}a+=x,h++}else a+=c}return a}}Se.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Se.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Se.ASTERISK_ENCODING=148;class ne extends Ce{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(i,o,a){let h=this.decodeStart(o),c=this.decodeEnd(o),d=new yt;ne.decodeMiddle(o,h[1],c[0],d);let x=d.toString(),_=null;a!=null&&(_=a.get(rt.ALLOWED_LENGTHS)),_==null&&(_=ne.DEFAULT_ALLOWED_LENGTHS);let C=x.length,M=!1,R=0;for(let V of _){if(C===V){M=!0;break}V>R&&(R=V)}if(!M&&C>R&&(M=!0),!M)throw new K;const L=[new Mt(h[1],i),new Mt(c[0],i)];return new ft(x,null,0,L,Tt.ITF,new Date().getTime())}static decodeMiddle(i,o,a,h){let c=new Int32Array(10),d=new Int32Array(5),x=new Int32Array(5);for(c.fill(0),d.fill(0),x.fill(0);o<a;){Ce.recordPattern(i,o,c);for(let C=0;C<5;C++){let M=2*C;d[C]=c[M],x[C]=c[M+1]}let _=ne.decodeDigit(d);h.append(_.toString()),_=this.decodeDigit(x),h.append(_.toString()),c.forEach(function(C){o+=C})}}decodeStart(i){let o=ne.skipWhiteSpace(i),a=ne.findGuardPattern(i,o,ne.START_PATTERN);return this.narrowLineWidth=(a[1]-a[0])/4,this.validateQuietZone(i,a[0]),a}validateQuietZone(i,o){let a=this.narrowLineWidth*10;a=a<o?a:o;for(let h=o-1;a>0&&h>=0&&!i.get(h);h--)a--;if(a!==0)throw new J}static skipWhiteSpace(i){const o=i.getSize(),a=i.getNextSet(0);if(a===o)throw new J;return a}decodeEnd(i){i.reverse();try{let o=ne.skipWhiteSpace(i),a;try{a=ne.findGuardPattern(i,o,ne.END_PATTERN_REVERSED[0])}catch(c){c instanceof J&&(a=ne.findGuardPattern(i,o,ne.END_PATTERN_REVERSED[1]))}this.validateQuietZone(i,a[0]);let h=a[0];return a[0]=i.getSize()-a[1],a[1]=i.getSize()-h,a}finally{i.reverse()}}static findGuardPattern(i,o,a){let h=a.length,c=new Int32Array(h),d=i.getSize(),x=!1,_=0,C=o;c.fill(0);for(let M=o;M<d;M++)if(i.get(M)!==x)c[_]++;else{if(_===h-1){if(Ce.patternMatchVariance(c,a,ne.MAX_INDIVIDUAL_VARIANCE)<ne.MAX_AVG_VARIANCE)return[C,M];C+=c[0]+c[1],F.arraycopy(c,2,c,0,_-1),c[_-1]=0,c[_]=0,_--}else _++;c[_]=1,x=!x}throw new J}static decodeDigit(i){let o=ne.MAX_AVG_VARIANCE,a=-1,h=ne.PATTERNS.length;for(let c=0;c<h;c++){let d=ne.PATTERNS[c],x=Ce.patternMatchVariance(i,d,ne.MAX_INDIVIDUAL_VARIANCE);x<o?(o=x,a=c):x===o&&(a=-1)}if(a>=0)return a%10;throw new J}}ne.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],ne.MAX_AVG_VARIANCE=.38,ne.MAX_INDIVIDUAL_VARIANCE=.5,ne.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],ne.START_PATTERN=Int32Array.from([1,1,1,1]),ne.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class ye extends Ce{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(i){let o=!1,a,h=0,c=Int32Array.from([0,0,0]);for(;!o;){c=Int32Array.from([0,0,0]),a=ye.findGuardPattern(i,h,!1,this.START_END_PATTERN,c);let d=a[0];h=a[1];let x=d-(h-d);x>=0&&(o=i.isRange(x,d,!1))}return a}static checkChecksum(i){return ye.checkStandardUPCEANChecksum(i)}static checkStandardUPCEANChecksum(i){let o=i.length;if(o===0)return!1;let a=parseInt(i.charAt(o-1),10);return ye.getStandardUPCEANChecksum(i.substring(0,o-1))===a}static getStandardUPCEANChecksum(i){let o=i.length,a=0;for(let h=o-1;h>=0;h-=2){let c=i.charAt(h).charCodeAt(0)-48;if(c<0||c>9)throw new K;a+=c}a*=3;for(let h=o-2;h>=0;h-=2){let c=i.charAt(h).charCodeAt(0)-48;if(c<0||c>9)throw new K;a+=c}return(1e3-a)%10}static decodeEnd(i,o){return ye.findGuardPattern(i,o,!1,ye.START_END_PATTERN,new Int32Array(ye.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(i,o,a,h){return this.findGuardPattern(i,o,a,h,new Int32Array(h.length))}static findGuardPattern(i,o,a,h,c){let d=i.getSize();o=a?i.getNextUnset(o):i.getNextSet(o);let x=0,_=o,C=h.length,M=a;for(let R=o;R<d;R++)if(i.get(R)!==M)c[x]++;else{if(x===C-1){if(Ce.patternMatchVariance(c,h,ye.MAX_INDIVIDUAL_VARIANCE)<ye.MAX_AVG_VARIANCE)return Int32Array.from([_,R]);_+=c[0]+c[1];let L=c.slice(2,c.length-1);for(let k=0;k<x-1;k++)c[k]=L[k];c[x-1]=0,c[x]=0,x--}else x++;c[x]=1,M=!M}throw new J}static decodeDigit(i,o,a,h){this.recordPattern(i,a,o);let c=this.MAX_AVG_VARIANCE,d=-1,x=h.length;for(let _=0;_<x;_++){let C=h[_],M=Ce.patternMatchVariance(o,C,ye.MAX_INDIVIDUAL_VARIANCE);M<c&&(c=M,d=_)}if(d>=0)return d;throw new J}}ye.MAX_AVG_VARIANCE=.48,ye.MAX_INDIVIDUAL_VARIANCE=.7,ye.START_END_PATTERN=Int32Array.from([1,1,1]),ye.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),ye.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),ye.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class xn{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(i,o,a){let h=this.decodeRowStringBuffer,c=this.decodeMiddle(o,a,h),d=h.toString(),x=xn.parseExtensionString(d),_=[new Mt((a[0]+a[1])/2,i),new Mt(c,i)],C=new ft(d,null,0,_,Tt.UPC_EAN_EXTENSION,new Date().getTime());return x!=null&&C.putAllMetadata(x),C}decodeMiddle(i,o,a){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let c=i.getSize(),d=o[1],x=0;for(let C=0;C<5&&d<c;C++){let M=ye.decodeDigit(i,h,d,ye.L_AND_G_PATTERNS);a+=String.fromCharCode(48+M%10);for(let R of h)d+=R;M>=10&&(x|=1<<4-C),C!==4&&(d=i.getNextSet(d),d=i.getNextUnset(d))}if(a.length!==5)throw new J;let _=this.determineCheckDigit(x);if(xn.extensionChecksum(a.toString())!==_)throw new J;return d}static extensionChecksum(i){let o=i.length,a=0;for(let h=o-2;h>=0;h-=2)a+=i.charAt(h).charCodeAt(0)-48;a*=3;for(let h=o-1;h>=0;h-=2)a+=i.charAt(h).charCodeAt(0)-48;return a*=3,a%10}determineCheckDigit(i){for(let o=0;o<10;o++)if(i===this.CHECK_DIGIT_ENCODINGS[o])return o;throw new J}static parseExtensionString(i){if(i.length!==5)return null;let o=xn.parseExtension5String(i);return o==null?null:new Map([[_e.SUGGESTED_PRICE,o]])}static parseExtension5String(i){let o;switch(i.charAt(0)){case"0":o="£";break;case"5":o="$";break;case"9":switch(i){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}o="";break;default:o="";break}let a=parseInt(i.substring(1)),h=(a/100).toString(),c=a%100,d=c<10?"0"+c:c.toString();return o+h+"."+d}}class Rn{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(i,o,a){let h=this.decodeRowStringBuffer,c=this.decodeMiddle(o,a,h),d=h.toString(),x=Rn.parseExtensionString(d),_=[new Mt((a[0]+a[1])/2,i),new Mt(c,i)],C=new ft(d,null,0,_,Tt.UPC_EAN_EXTENSION,new Date().getTime());return x!=null&&C.putAllMetadata(x),C}decodeMiddle(i,o,a){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let c=i.getSize(),d=o[1],x=0;for(let _=0;_<2&&d<c;_++){let C=ye.decodeDigit(i,h,d,ye.L_AND_G_PATTERNS);a+=String.fromCharCode(48+C%10);for(let M of h)d+=M;C>=10&&(x|=1<<1-_),_!==1&&(d=i.getNextSet(d),d=i.getNextUnset(d))}if(a.length!==2)throw new J;if(parseInt(a.toString())%4!==x)throw new J;return d}static parseExtensionString(i){return i.length!==2?null:new Map([[_e.ISSUE_NUMBER,parseInt(i)]])}}class an{static decodeRow(i,o,a){let h=ye.findGuardPattern(o,a,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new xn().decodeRow(i,o,h)}catch{return new Rn().decodeRow(i,o,h)}}}an.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class at extends ye{constructor(){super(),this.decodeRowStringBuffer="",at.L_AND_G_PATTERNS=at.L_PATTERNS.map(i=>Int32Array.from(i));for(let i=10;i<20;i++){let o=at.L_PATTERNS[i-10],a=new Int32Array(o.length);for(let h=0;h<o.length;h++)a[h]=o[o.length-h-1];at.L_AND_G_PATTERNS[i]=a}}decodeRow(i,o,a){let h=at.findStartGuardPattern(o),c=a==null?null:a.get(rt.NEED_RESULT_POINT_CALLBACK);if(c!=null){const dt=new Mt((h[0]+h[1])/2,i);c.foundPossibleResultPoint(dt)}let d=this.decodeMiddle(o,h,this.decodeRowStringBuffer),x=d.rowOffset,_=d.resultString;if(c!=null){const dt=new Mt(x,i);c.foundPossibleResultPoint(dt)}let C=this.decodeEnd(o,x);if(c!=null){const dt=new Mt((C[0]+C[1])/2,i);c.foundPossibleResultPoint(dt)}let M=C[1],R=M+(M-C[0]);if(R>=o.getSize()||!o.isRange(M,R,!1))throw new J;let L=_.toString();if(L.length<8)throw new K;if(!at.checkChecksum(L))throw new D;let k=(h[1]+h[0])/2,V=(C[1]+C[0])/2,H=this.getBarcodeFormat(),$=[new Mt(k,i),new Mt(V,i)],nt=new ft(L,null,0,$,H,new Date().getTime()),xt=0;try{let dt=an.decodeRow(i,o,C[1]);nt.putMetadata(_e.UPC_EAN_EXTENSION,dt.getText()),nt.putAllMetadata(dt.getResultMetadata()),nt.addResultPoints(dt.getResultPoints()),xt=dt.getText().length}catch{}let _t=a==null?null:a.get(rt.ALLOWED_EAN_EXTENSIONS);if(_t!=null){let dt=!1;for(let ae in _t)if(xt.toString()===ae){dt=!0;break}if(!dt)throw new J}return nt}decodeEnd(i,o){return at.findGuardPattern(i,o,!1,at.START_END_PATTERN,new Int32Array(at.START_END_PATTERN.length).fill(0))}static checkChecksum(i){return at.checkStandardUPCEANChecksum(i)}static checkStandardUPCEANChecksum(i){let o=i.length;if(o===0)return!1;let a=parseInt(i.charAt(o-1),10);return at.getStandardUPCEANChecksum(i.substring(0,o-1))===a}static getStandardUPCEANChecksum(i){let o=i.length,a=0;for(let h=o-1;h>=0;h-=2){let c=i.charAt(h).charCodeAt(0)-48;if(c<0||c>9)throw new K;a+=c}a*=3;for(let h=o-2;h>=0;h-=2){let c=i.charAt(h).charCodeAt(0)-48;if(c<0||c>9)throw new K;a+=c}return(1e3-a)%10}}class Fi extends at{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(i,o,a){let h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let c=i.getSize(),d=o[1],x=0;for(let C=0;C<6&&d<c;C++){let M=at.decodeDigit(i,h,d,at.L_AND_G_PATTERNS);a+=String.fromCharCode(48+M%10);for(let R of h)d+=R;M>=10&&(x|=1<<5-C)}a=Fi.determineFirstDigit(a,x),d=at.findGuardPattern(i,d,!0,at.MIDDLE_PATTERN,new Int32Array(at.MIDDLE_PATTERN.length).fill(0))[1];for(let C=0;C<6&&d<c;C++){let M=at.decodeDigit(i,h,d,at.L_PATTERNS);a+=String.fromCharCode(48+M);for(let R of h)d+=R}return{rowOffset:d,resultString:a}}getBarcodeFormat(){return Tt.EAN_13}static determineFirstDigit(i,o){for(let a=0;a<10;a++)if(o===this.FIRST_DIGIT_ENCODINGS[a])return i=String.fromCharCode(48+a)+i,i;throw new J}}Fi.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class vn extends at{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(i,o,a){const h=this.decodeMiddleCounters;h[0]=0,h[1]=0,h[2]=0,h[3]=0;let c=i.getSize(),d=o[1];for(let _=0;_<4&&d<c;_++){let C=at.decodeDigit(i,h,d,at.L_PATTERNS);a+=String.fromCharCode(48+C);for(let M of h)d+=M}d=at.findGuardPattern(i,d,!0,at.MIDDLE_PATTERN,new Int32Array(at.MIDDLE_PATTERN.length).fill(0))[1];for(let _=0;_<4&&d<c;_++){let C=at.decodeDigit(i,h,d,at.L_PATTERNS);a+=String.fromCharCode(48+C);for(let M of h)d+=M}return{rowOffset:d,resultString:a}}getBarcodeFormat(){return Tt.EAN_8}}class ks extends at{constructor(){super(...arguments),this.ean13Reader=new Fi}getBarcodeFormat(){return Tt.UPC_A}decode(i,o){return this.maybeReturnResult(this.ean13Reader.decode(i))}decodeRow(i,o,a){return this.maybeReturnResult(this.ean13Reader.decodeRow(i,o,a))}decodeMiddle(i,o,a){return this.ean13Reader.decodeMiddle(i,o,a)}maybeReturnResult(i){let o=i.getText();if(o.charAt(0)==="0"){let a=new ft(o.substring(1),null,null,i.getResultPoints(),Tt.UPC_A);return i.getResultMetadata()!=null&&a.putAllMetadata(i.getResultMetadata()),a}else throw new J}reset(){this.ean13Reader.reset()}}class pt extends at{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(i,o,a){const h=this.decodeMiddleCounters.map(C=>C);h[0]=0,h[1]=0,h[2]=0,h[3]=0;const c=i.getSize();let d=o[1],x=0;for(let C=0;C<6&&d<c;C++){const M=pt.decodeDigit(i,h,d,pt.L_AND_G_PATTERNS);a+=String.fromCharCode(48+M%10);for(let R of h)d+=R;M>=10&&(x|=1<<5-C)}let _=pt.determineNumSysAndCheckDigit(a,x);return{rowOffset:d,resultString:_}}decodeEnd(i,o){return pt.findGuardPatternWithoutCounters(i,o,!0,pt.MIDDLE_END_PATTERN)}checkChecksum(i){return at.checkChecksum(pt.convertUPCEtoUPCA(i))}static determineNumSysAndCheckDigit(i,o){for(let a=0;a<=1;a++)for(let h=0;h<10;h++)if(o===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[a][h]){let c=String.fromCharCode(48+a),d=String.fromCharCode(48+h);return c+i+d}throw J.getNotFoundInstance()}getBarcodeFormat(){return Tt.UPC_E}static convertUPCEtoUPCA(i){const o=i.slice(1,7).split("").map(c=>c.charCodeAt(0)),a=new yt;a.append(i.charAt(0));let h=o[5];switch(h){case 0:case 1:case 2:a.appendChars(o,0,2),a.append(h),a.append("0000"),a.appendChars(o,2,3);break;case 3:a.appendChars(o,0,3),a.append("00000"),a.appendChars(o,3,2);break;case 4:a.appendChars(o,0,4),a.append("00000"),a.append(o[4]);break;default:a.appendChars(o,0,5),a.append("0000"),a.append(h);break}return i.length>=8&&a.append(i.charAt(7)),a.toString()}}pt.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),pt.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class ue extends Ce{constructor(i){super();let o=i==null?null:i.get(rt.POSSIBLE_FORMATS),a=[];n(o)?(a.push(new Fi),a.push(new ks),a.push(new vn),a.push(new pt)):(o.indexOf(Tt.EAN_13)>-1&&a.push(new Fi),o.indexOf(Tt.UPC_A)>-1&&a.push(new ks),o.indexOf(Tt.EAN_8)>-1&&a.push(new vn),o.indexOf(Tt.UPC_E)>-1&&a.push(new pt)),this.readers=a}decodeRow(i,o,a){for(let h of this.readers)try{const c=h.decodeRow(i,o,a),d=c.getBarcodeFormat()===Tt.EAN_13&&c.getText().charAt(0)==="0",x=a==null?null:a.get(rt.POSSIBLE_FORMATS),_=x==null||x.includes(Tt.UPC_A);if(d&&_){const C=c.getRawBytes(),M=new ft(c.getText().substring(1),C,C?C.length:null,c.getResultPoints(),Tt.UPC_A);return M.putAllMetadata(c.getResultMetadata()),M}return c}catch{}throw new J}reset(){for(let i of this.readers)i.reset()}}class ce extends Ce{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(i,o){for(let a=0;a<o.length;a++)if(Ce.patternMatchVariance(i,o[a],ce.MAX_INDIVIDUAL_VARIANCE)<ce.MAX_AVG_VARIANCE)return a;throw new J}static count(i){return te.sum(new Int32Array(i))}static increment(i,o){let a=0,h=o[0];for(let c=1;c<i.length;c++)o[c]>h&&(h=o[c],a=c);i[a]++}static decrement(i,o){let a=0,h=o[0];for(let c=1;c<i.length;c++)o[c]<h&&(h=o[c],a=c);i[a]--}static isFinderPattern(i){let o=i[0]+i[1],a=o+i[2]+i[3],h=o/a;if(h>=ce.MIN_FINDER_PATTERN_RATIO&&h<=ce.MAX_FINDER_PATTERN_RATIO){let c=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER;for(let x of i)x>d&&(d=x),x<c&&(c=x);return d<10*c}return!1}}ce.MAX_AVG_VARIANCE=.2,ce.MAX_INDIVIDUAL_VARIANCE=.45,ce.MIN_FINDER_PATTERN_RATIO=9.5/12,ce.MAX_FINDER_PATTERN_RATIO=12.5/14;class jt{constructor(i,o){this.value=i,this.checksumPortion=o}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(i){if(!(i instanceof jt))return!1;const o=i;return this.value===o.value&&this.checksumPortion===o.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class si{constructor(i,o,a,h,c){this.value=i,this.startEnd=o,this.value=i,this.startEnd=o,this.resultPoints=new Array,this.resultPoints.push(new Mt(a,c)),this.resultPoints.push(new Mt(h,c))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(i){if(!(i instanceof si))return!1;const o=i;return this.value===o.value}hashCode(){return this.value}}class Vt{constructor(){}static getRSSvalue(i,o,a){let h=0;for(let _ of i)h+=_;let c=0,d=0,x=i.length;for(let _=0;_<x-1;_++){let C;for(C=1,d|=1<<_;C<i[_];C++,d&=~(1<<_)){let M=Vt.combins(h-C-1,x-_-2);if(a&&d===0&&h-C-(x-_-1)>=x-_-1&&(M-=Vt.combins(h-C-(x-_),x-_-2)),x-_-1>1){let R=0;for(let L=h-C-(x-_-2);L>o;L--)R+=Vt.combins(h-C-L-1,x-_-3);M-=R*(x-1-_)}else h-C>o&&M--;c+=M}h-=C}return c}static combins(i,o){let a,h;i-o>o?(h=o,a=i-o):(h=i-o,a=o);let c=1,d=1;for(let x=i;x>a;x--)c*=x,d<=h&&(c/=d,d++);for(;d<=h;)c/=d,d++;return c}}class Pe{static buildBitArray(i){let o=i.length*2-1;i[i.length-1].getRightChar()==null&&(o-=1);let a=12*o,h=new Y(a),c=0,x=i[0].getRightChar().getValue();for(let _=11;_>=0;--_)x&1<<_&&h.set(c),c++;for(let _=1;_<i.length;++_){let C=i[_],M=C.getLeftChar().getValue();for(let R=11;R>=0;--R)M&1<<R&&h.set(c),c++;if(C.getRightChar()!=null){let R=C.getRightChar().getValue();for(let L=11;L>=0;--L)R&1<<L&&h.set(c),c++}}return h}}class ci{constructor(i,o){o?this.decodedInformation=null:(this.finished=i,this.decodedInformation=o)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Te{constructor(i){this.newPosition=i}getNewPosition(){return this.newPosition}}class fe extends Te{constructor(i,o){super(i),this.value=o}getValue(){return this.value}isFNC1(){return this.value===fe.FNC1}}fe.FNC1="$";class Xe extends Te{constructor(i,o,a){super(i),a?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=o}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class Si extends Te{constructor(i,o,a){if(super(i),o<0||o>10||a<0||a>10)throw new K;this.firstDigit=o,this.secondDigit=a}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===Si.FNC1}isSecondDigitFNC1(){return this.secondDigit===Si.FNC1}isAnyFNC1(){return this.firstDigit===Si.FNC1||this.secondDigit===Si.FNC1}}Si.FNC1=10;class bt{constructor(){}static parseFieldsInGeneralPurpose(i){if(!i)return null;if(i.length<2)throw new J;let o=i.substring(0,2);for(let c of bt.TWO_DIGIT_DATA_LENGTH)if(c[0]===o)return c[1]===bt.VARIABLE_LENGTH?bt.processVariableAI(2,c[2],i):bt.processFixedAI(2,c[1],i);if(i.length<3)throw new J;let a=i.substring(0,3);for(let c of bt.THREE_DIGIT_DATA_LENGTH)if(c[0]===a)return c[1]===bt.VARIABLE_LENGTH?bt.processVariableAI(3,c[2],i):bt.processFixedAI(3,c[1],i);for(let c of bt.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(c[0]===a)return c[1]===bt.VARIABLE_LENGTH?bt.processVariableAI(4,c[2],i):bt.processFixedAI(4,c[1],i);if(i.length<4)throw new J;let h=i.substring(0,4);for(let c of bt.FOUR_DIGIT_DATA_LENGTH)if(c[0]===h)return c[1]===bt.VARIABLE_LENGTH?bt.processVariableAI(4,c[2],i):bt.processFixedAI(4,c[1],i);throw new J}static processFixedAI(i,o,a){if(a.length<i)throw new J;let h=a.substring(0,i);if(a.length<i+o)throw new J;let c=a.substring(i,i+o),d=a.substring(i+o),x="("+h+")"+c,_=bt.parseFieldsInGeneralPurpose(d);return _==null?x:x+_}static processVariableAI(i,o,a){let h=a.substring(0,i),c;a.length<i+o?c=a.length:c=i+o;let d=a.substring(i,c),x=a.substring(c),_="("+h+")"+d,C=bt.parseFieldsInGeneralPurpose(x);return C==null?_:_+C}}bt.VARIABLE_LENGTH=[],bt.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",bt.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",bt.VARIABLE_LENGTH,20],["22",bt.VARIABLE_LENGTH,29],["30",bt.VARIABLE_LENGTH,8],["37",bt.VARIABLE_LENGTH,8],["90",bt.VARIABLE_LENGTH,30],["91",bt.VARIABLE_LENGTH,30],["92",bt.VARIABLE_LENGTH,30],["93",bt.VARIABLE_LENGTH,30],["94",bt.VARIABLE_LENGTH,30],["95",bt.VARIABLE_LENGTH,30],["96",bt.VARIABLE_LENGTH,30],["97",bt.VARIABLE_LENGTH,3],["98",bt.VARIABLE_LENGTH,30],["99",bt.VARIABLE_LENGTH,30]],bt.THREE_DIGIT_DATA_LENGTH=[["240",bt.VARIABLE_LENGTH,30],["241",bt.VARIABLE_LENGTH,30],["242",bt.VARIABLE_LENGTH,6],["250",bt.VARIABLE_LENGTH,30],["251",bt.VARIABLE_LENGTH,30],["253",bt.VARIABLE_LENGTH,17],["254",bt.VARIABLE_LENGTH,20],["400",bt.VARIABLE_LENGTH,30],["401",bt.VARIABLE_LENGTH,30],["402",17],["403",bt.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",bt.VARIABLE_LENGTH,20],["421",bt.VARIABLE_LENGTH,15],["422",3],["423",bt.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],bt.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",bt.VARIABLE_LENGTH,15],["391",bt.VARIABLE_LENGTH,18],["392",bt.VARIABLE_LENGTH,15],["393",bt.VARIABLE_LENGTH,18],["703",bt.VARIABLE_LENGTH,30]],bt.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",bt.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",bt.VARIABLE_LENGTH,20],["8003",bt.VARIABLE_LENGTH,30],["8004",bt.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",bt.VARIABLE_LENGTH,30],["8008",bt.VARIABLE_LENGTH,12],["8018",18],["8020",bt.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",bt.VARIABLE_LENGTH,70],["8200",bt.VARIABLE_LENGTH,70]];class fs{constructor(i){this.buffer=new yt,this.information=i}decodeAllCodes(i,o){let a=o,h=null;do{let c=this.decodeGeneralPurposeField(a,h),d=bt.parseFieldsInGeneralPurpose(c.getNewString());if(d!=null&&i.append(d),c.isRemaining()?h=""+c.getRemainingValue():h=null,a===c.getNewPosition())break;a=c.getNewPosition()}while(!0);return i.toString()}isStillNumeric(i){if(i+7>this.information.getSize())return i+4<=this.information.getSize();for(let o=i;o<i+3;++o)if(this.information.get(o))return!0;return this.information.get(i+3)}decodeNumeric(i){if(i+7>this.information.getSize()){let c=this.extractNumericValueFromBitArray(i,4);return c===0?new Si(this.information.getSize(),Si.FNC1,Si.FNC1):new Si(this.information.getSize(),c-1,Si.FNC1)}let o=this.extractNumericValueFromBitArray(i,7),a=(o-8)/11,h=(o-8)%11;return new Si(i+7,a,h)}extractNumericValueFromBitArray(i,o){return fs.extractNumericValueFromBitArray(this.information,i,o)}static extractNumericValueFromBitArray(i,o,a){let h=0;for(let c=0;c<a;++c)i.get(o+c)&&(h|=1<<a-c-1);return h}decodeGeneralPurposeField(i,o){this.buffer.setLengthToZero(),o!=null&&this.buffer.append(o),this.current.setPosition(i);let a=this.parseBlocks();return a!=null&&a.isRemaining()?new Xe(this.current.getPosition(),this.buffer.toString(),a.getRemainingValue()):new Xe(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let i,o;do{let a=this.current.getPosition();if(this.current.isAlpha()?(o=this.parseAlphaBlock(),i=o.isFinished()):this.current.isIsoIec646()?(o=this.parseIsoIec646Block(),i=o.isFinished()):(o=this.parseNumericBlock(),i=o.isFinished()),!(a!==this.current.getPosition())&&!i)break}while(!i);return o.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let i=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(i.getNewPosition()),i.isFirstDigitFNC1()){let o;return i.isSecondDigitFNC1()?o=new Xe(this.current.getPosition(),this.buffer.toString()):o=new Xe(this.current.getPosition(),this.buffer.toString(),i.getSecondDigit()),new ci(!0,o)}if(this.buffer.append(i.getFirstDigit()),i.isSecondDigitFNC1()){let o=new Xe(this.current.getPosition(),this.buffer.toString());return new ci(!0,o)}this.buffer.append(i.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new ci(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let i=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(i.getNewPosition()),i.isFNC1()){let o=new Xe(this.current.getPosition(),this.buffer.toString());return new ci(!0,o)}this.buffer.append(i.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new ci(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let i=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(i.getNewPosition()),i.isFNC1()){let o=new Xe(this.current.getPosition(),this.buffer.toString());return new ci(!0,o)}this.buffer.append(i.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new ci(!1)}isStillIsoIec646(i){if(i+5>this.information.getSize())return!1;let o=this.extractNumericValueFromBitArray(i,5);if(o>=5&&o<16)return!0;if(i+7>this.information.getSize())return!1;let a=this.extractNumericValueFromBitArray(i,7);if(a>=64&&a<116)return!0;if(i+8>this.information.getSize())return!1;let h=this.extractNumericValueFromBitArray(i,8);return h>=232&&h<253}decodeIsoIec646(i){let o=this.extractNumericValueFromBitArray(i,5);if(o===15)return new fe(i+5,fe.FNC1);if(o>=5&&o<15)return new fe(i+5,"0"+(o-5));let a=this.extractNumericValueFromBitArray(i,7);if(a>=64&&a<90)return new fe(i+7,""+(a+1));if(a>=90&&a<116)return new fe(i+7,""+(a+7));let h=this.extractNumericValueFromBitArray(i,8),c;switch(h){case 232:c="!";break;case 233:c='"';break;case 234:c="%";break;case 235:c="&";break;case 236:c="'";break;case 237:c="(";break;case 238:c=")";break;case 239:c="*";break;case 240:c="+";break;case 241:c=",";break;case 242:c="-";break;case 243:c=".";break;case 244:c="/";break;case 245:c=":";break;case 246:c=";";break;case 247:c="<";break;case 248:c="=";break;case 249:c=">";break;case 250:c="?";break;case 251:c="_";break;case 252:c=" ";break;default:throw new K}return new fe(i+8,c)}isStillAlpha(i){if(i+5>this.information.getSize())return!1;let o=this.extractNumericValueFromBitArray(i,5);if(o>=5&&o<16)return!0;if(i+6>this.information.getSize())return!1;let a=this.extractNumericValueFromBitArray(i,6);return a>=16&&a<63}decodeAlphanumeric(i){let o=this.extractNumericValueFromBitArray(i,5);if(o===15)return new fe(i+5,fe.FNC1);if(o>=5&&o<15)return new fe(i+5,"0"+(o-5));let a=this.extractNumericValueFromBitArray(i,6);if(a>=32&&a<58)return new fe(i+6,""+(a+33));let h;switch(a){case 58:h="*";break;case 59:h=",";break;case 60:h="-";break;case 61:h=".";break;case 62:h="/";break;default:throw new li("Decoding invalid alphanumeric value: "+a)}return new fe(i+6,h)}isAlphaTo646ToAlphaLatch(i){if(i+1>this.information.getSize())return!1;for(let o=0;o<5&&o+i<this.information.getSize();++o)if(o===2){if(!this.information.get(i+2))return!1}else if(this.information.get(i+o))return!1;return!0}isAlphaOr646ToNumericLatch(i){if(i+3>this.information.getSize())return!1;for(let o=i;o<i+3;++o)if(this.information.get(o))return!1;return!0}isNumericToAlphaNumericLatch(i){if(i+1>this.information.getSize())return!1;for(let o=0;o<4&&o+i<this.information.getSize();++o)if(this.information.get(i+o))return!1;return!0}}class ds{constructor(i){this.information=i,this.generalDecoder=new fs(i)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class Ei extends ds{constructor(i){super(i)}encodeCompressedGtin(i,o){i.append("(01)");let a=i.length();i.append("9"),this.encodeCompressedGtinWithoutAI(i,o,a)}encodeCompressedGtinWithoutAI(i,o,a){for(let h=0;h<4;++h){let c=this.getGeneralDecoder().extractNumericValueFromBitArray(o+10*h,10);c/100===0&&i.append("0"),c/10===0&&i.append("0"),i.append(c)}Ei.appendCheckDigit(i,a)}static appendCheckDigit(i,o){let a=0;for(let h=0;h<13;h++){let c=i.charAt(h+o).charCodeAt(0)-48;a+=h&1?c:3*c}a=10-a%10,a===10&&(a=0),i.append(a)}}Ei.GTIN_SIZE=40;class gs extends Ei{constructor(i){super(i)}parseInformation(){let i=new yt;i.append("(01)");let o=i.length(),a=this.getGeneralDecoder().extractNumericValueFromBitArray(gs.HEADER_SIZE,4);return i.append(a),this.encodeCompressedGtinWithoutAI(i,gs.HEADER_SIZE+4,o),this.getGeneralDecoder().decodeAllCodes(i,gs.HEADER_SIZE+44)}}gs.HEADER_SIZE=4;class Us extends ds{constructor(i){super(i)}parseInformation(){let i=new yt;return this.getGeneralDecoder().decodeAllCodes(i,Us.HEADER_SIZE)}}Us.HEADER_SIZE=5;class lr extends Ei{constructor(i){super(i)}encodeCompressedWeight(i,o,a){let h=this.getGeneralDecoder().extractNumericValueFromBitArray(o,a);this.addWeightCode(i,h);let c=this.checkWeight(h),d=1e5;for(let x=0;x<5;++x)c/d===0&&i.append("0"),d/=10;i.append(c)}}class ln extends lr{constructor(i){super(i)}parseInformation(){if(this.getInformation().getSize()!=ln.HEADER_SIZE+lr.GTIN_SIZE+ln.WEIGHT_SIZE)throw new J;let i=new yt;return this.encodeCompressedGtin(i,ln.HEADER_SIZE),this.encodeCompressedWeight(i,ln.HEADER_SIZE+lr.GTIN_SIZE,ln.WEIGHT_SIZE),i.toString()}}ln.HEADER_SIZE=5,ln.WEIGHT_SIZE=15;class Uo extends ln{constructor(i){super(i)}addWeightCode(i,o){i.append("(3103)")}checkWeight(i){return i}}class hn extends ln{constructor(i){super(i)}addWeightCode(i,o){o<1e4?i.append("(3202)"):i.append("(3203)")}checkWeight(i){return i<1e4?i:i-1e4}}class Ti extends Ei{constructor(i){super(i)}parseInformation(){if(this.getInformation().getSize()<Ti.HEADER_SIZE+Ei.GTIN_SIZE)throw new J;let i=new yt;this.encodeCompressedGtin(i,Ti.HEADER_SIZE);let o=this.getGeneralDecoder().extractNumericValueFromBitArray(Ti.HEADER_SIZE+Ei.GTIN_SIZE,Ti.LAST_DIGIT_SIZE);i.append("(392"),i.append(o),i.append(")");let a=this.getGeneralDecoder().decodeGeneralPurposeField(Ti.HEADER_SIZE+Ei.GTIN_SIZE+Ti.LAST_DIGIT_SIZE,null);return i.append(a.getNewString()),i.toString()}}Ti.HEADER_SIZE=8,Ti.LAST_DIGIT_SIZE=2;class It extends Ei{constructor(i){super(i)}parseInformation(){if(this.getInformation().getSize()<It.HEADER_SIZE+Ei.GTIN_SIZE)throw new J;let i=new yt;this.encodeCompressedGtin(i,It.HEADER_SIZE);let o=this.getGeneralDecoder().extractNumericValueFromBitArray(It.HEADER_SIZE+Ei.GTIN_SIZE,It.LAST_DIGIT_SIZE);i.append("(393"),i.append(o),i.append(")");let a=this.getGeneralDecoder().extractNumericValueFromBitArray(It.HEADER_SIZE+Ei.GTIN_SIZE+It.LAST_DIGIT_SIZE,It.FIRST_THREE_DIGITS_SIZE);a/100==0&&i.append("0"),a/10==0&&i.append("0"),i.append(a);let h=this.getGeneralDecoder().decodeGeneralPurposeField(It.HEADER_SIZE+Ei.GTIN_SIZE+It.LAST_DIGIT_SIZE+It.FIRST_THREE_DIGITS_SIZE,null);return i.append(h.getNewString()),i.toString()}}It.HEADER_SIZE=8,It.LAST_DIGIT_SIZE=2,It.FIRST_THREE_DIGITS_SIZE=10;class oe extends lr{constructor(i,o,a){super(i),this.dateCode=a,this.firstAIdigits=o}parseInformation(){if(this.getInformation().getSize()!=oe.HEADER_SIZE+oe.GTIN_SIZE+oe.WEIGHT_SIZE+oe.DATE_SIZE)throw new J;let i=new yt;return this.encodeCompressedGtin(i,oe.HEADER_SIZE),this.encodeCompressedWeight(i,oe.HEADER_SIZE+oe.GTIN_SIZE,oe.WEIGHT_SIZE),this.encodeCompressedDate(i,oe.HEADER_SIZE+oe.GTIN_SIZE+oe.WEIGHT_SIZE),i.toString()}encodeCompressedDate(i,o){let a=this.getGeneralDecoder().extractNumericValueFromBitArray(o,oe.DATE_SIZE);if(a==38400)return;i.append("("),i.append(this.dateCode),i.append(")");let h=a%32;a/=32;let c=a%12+1;a/=12;let d=a;d/10==0&&i.append("0"),i.append(d),c/10==0&&i.append("0"),i.append(c),h/10==0&&i.append("0"),i.append(h)}addWeightCode(i,o){i.append("("),i.append(this.firstAIdigits),i.append(o/1e5),i.append(")")}checkWeight(i){return i%1e5}}oe.HEADER_SIZE=8,oe.WEIGHT_SIZE=20,oe.DATE_SIZE=16;function ms(T){try{if(T.get(1))return new gs(T);if(!T.get(2))return new Us(T);switch(fs.extractNumericValueFromBitArray(T,1,4)){case 4:return new Uo(T);case 5:return new hn(T)}switch(fs.extractNumericValueFromBitArray(T,1,5)){case 12:return new Ti(T);case 13:return new It(T)}switch(fs.extractNumericValueFromBitArray(T,1,7)){case 56:return new oe(T,"310","11");case 57:return new oe(T,"320","11");case 58:return new oe(T,"310","13");case 59:return new oe(T,"320","13");case 60:return new oe(T,"310","15");case 61:return new oe(T,"320","15");case 62:return new oe(T,"310","17");case 63:return new oe(T,"320","17")}}catch(i){throw console.log(i),new li("unknown decoder: "+T)}}class Nn{constructor(i,o,a,h){this.leftchar=i,this.rightchar=o,this.finderpattern=a,this.maybeLast=h}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(i,o){return i instanceof Nn?Nn.equalsOrNull(i.leftchar,o.leftchar)&&Nn.equalsOrNull(i.rightchar,o.rightchar)&&Nn.equalsOrNull(i.finderpattern,o.finderpattern):!1}static equalsOrNull(i,o){return i===null?o===null:Nn.equals(i,o)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class xs{constructor(i,o,a){this.pairs=i,this.rowNumber=o,this.wasReversed=a}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(i){return this.checkEqualitity(this,i)}toString(){return"{ "+this.pairs+" }"}equals(i,o){return i instanceof xs?this.checkEqualitity(i,o)&&i.wasReversed===o.wasReversed:!1}checkEqualitity(i,o){if(!i||!o)return;let a;return i.forEach((h,c)=>{o.forEach(d=>{h.getLeftChar().getValue()===d.getLeftChar().getValue()&&h.getRightChar().getValue()===d.getRightChar().getValue()&&h.getFinderPatter().getValue()===d.getFinderPatter().getValue()&&(a=!0)})}),a}}class ct extends ce{constructor(i){super(...arguments),this.pairs=new Array(ct.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=i===!0}decodeRow(i,o,a){this.pairs.length=0,this.startFromEven=!1;try{return ct.constructResult(this.decodeRow2pairs(i,o))}catch(h){this.verbose&&console.log(h)}return this.pairs.length=0,this.startFromEven=!0,ct.constructResult(this.decodeRow2pairs(i,o))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(i,o){let a=!1;for(;!a;)try{this.pairs.push(this.retrieveNextPair(o,this.pairs,i))}catch(c){if(c instanceof J){if(!this.pairs.length)throw new J;a=!0}}if(this.checkChecksum())return this.pairs;let h;if(this.rows.length?h=!0:h=!1,this.storeRow(i,!1),h){let c=this.checkRowsBoolean(!1);if(c!=null||(c=this.checkRowsBoolean(!0),c!=null))return c}throw new J}checkRowsBoolean(i){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,i&&(this.rows=this.rows.reverse());let o=null;try{o=this.checkRows(new Array,0)}catch(a){this.verbose&&console.log(a)}return i&&(this.rows=this.rows.reverse()),o}checkRows(i,o){for(let a=o;a<this.rows.length;a++){let h=this.rows[a];this.pairs.length=0;for(let d of i)this.pairs.push(d.getPairs());if(this.pairs.push(h.getPairs()),!ct.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let c=new Array(i);c.push(h);try{return this.checkRows(c,a+1)}catch(d){this.verbose&&console.log(d)}}throw new J}static isValidSequence(i){for(let o of ct.FINDER_PATTERN_SEQUENCES){if(i.length>o.length)continue;let a=!0;for(let h=0;h<i.length;h++)if(i[h].getFinderPattern().getValue()!=o[h]){a=!1;break}if(a)return!0}return!1}storeRow(i,o){let a=0,h=!1,c=!1;for(;a<this.rows.length;){let d=this.rows[a];if(d.getRowNumber()>i){c=d.isEquivalent(this.pairs);break}h=d.isEquivalent(this.pairs),a++}c||h||ct.isPartialRow(this.pairs,this.rows)||(this.rows.push(a,new xs(this.pairs,i,o)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(i,o){for(let a of o)if(a.getPairs().length!==i.length){for(let h of a.getPairs())for(let c of i)if(Nn.equals(h,c))break}}static isPartialRow(i,o){for(let a of o){let h=!0;for(let c of i){let d=!1;for(let x of a.getPairs())if(c.equals(x)){d=!0;break}if(!d){h=!1;break}}if(h)return!0}return!1}getRows(){return this.rows}static constructResult(i){let o=Pe.buildBitArray(i),h=ms(o).parseInformation(),c=i[0].getFinderPattern().getResultPoints(),d=i[i.length-1].getFinderPattern().getResultPoints(),x=[c[0],c[1],d[0],d[1]];return new ft(h,null,null,x,Tt.RSS_EXPANDED,null)}checkChecksum(){let i=this.pairs.get(0),o=i.getLeftChar(),a=i.getRightChar();if(a==null)return!1;let h=a.getChecksumPortion(),c=2;for(let x=1;x<this.pairs.size();++x){let _=this.pairs.get(x);h+=_.getLeftChar().getChecksumPortion(),c++;let C=_.getRightChar();C!=null&&(h+=C.getChecksumPortion(),c++)}return h%=211,211*(c-4)+h==o.getValue()}static getNextSecondBar(i,o){let a;return i.get(o)?(a=i.getNextUnset(o),a=i.getNextSet(a)):(a=i.getNextSet(o),a=i.getNextUnset(a)),a}retrieveNextPair(i,o,a){let h=o.length%2==0;this.startFromEven&&(h=!h);let c,d=!0,x=-1;do this.findNextPair(i,o,x),c=this.parseFoundFinderPattern(i,a,h),c==null?x=ct.getNextSecondBar(i,this.startEnd[0]):d=!1;while(d);let _=this.decodeDataCharacter(i,c,h,!0);if(!this.isEmptyPair(o)&&o[o.length-1].mustBeLast())throw new J;let C;try{C=this.decodeDataCharacter(i,c,h,!1)}catch(M){C=null,this.verbose&&console.log(M)}return new Nn(_,C,c,!0)}isEmptyPair(i){return i.length===0}findNextPair(i,o,a){let h=this.getDecodeFinderCounters();h[0]=0,h[1]=0,h[2]=0,h[3]=0;let c=i.getSize(),d;a>=0?d=a:this.isEmptyPair(o)?d=0:d=o[o.length-1].getFinderPattern().getStartEnd()[1];let x=o.length%2!=0;this.startFromEven&&(x=!x);let _=!1;for(;d<c&&(_=!i.get(d),!!_);)d++;let C=0,M=d;for(let R=d;R<c;R++)if(i.get(R)!=_)h[C]++;else{if(C==3){if(x&&ct.reverseCounters(h),ct.isFinderPattern(h)){this.startEnd[0]=M,this.startEnd[1]=R;return}x&&ct.reverseCounters(h),M+=h[0]+h[1],h[0]=h[2],h[1]=h[3],h[2]=0,h[3]=0,C--}else C++;h[C]=1,_=!_}throw new J}static reverseCounters(i){let o=i.length;for(let a=0;a<o/2;++a){let h=i[a];i[a]=i[o-a-1],i[o-a-1]=h}}parseFoundFinderPattern(i,o,a){let h,c,d;if(a){let C=this.startEnd[0]-1;for(;C>=0&&!i.get(C);)C--;C++,h=this.startEnd[0]-C,c=C,d=this.startEnd[1]}else c=this.startEnd[0],d=i.getNextUnset(this.startEnd[1]+1),h=d-this.startEnd[1];let x=this.getDecodeFinderCounters();F.arraycopy(x,0,x,1,x.length-1),x[0]=h;let _;try{_=this.parseFinderValue(x,ct.FINDER_PATTERNS)}catch{return null}return new si(_,[c,d],c,d,o)}decodeDataCharacter(i,o,a,h){let c=this.getDataCharacterCounters();for(let Le=0;Le<c.length;Le++)c[Le]=0;if(h)ct.recordPatternInReverse(i,o.getStartEnd()[0],c);else{ct.recordPattern(i,o.getStartEnd()[1],c);for(let Le=0,Ci=c.length-1;Le<Ci;Le++,Ci--){let Qi=c[Le];c[Le]=c[Ci],c[Ci]=Qi}}let d=17,x=te.sum(new Int32Array(c))/d,_=(o.getStartEnd()[1]-o.getStartEnd()[0])/15;if(Math.abs(x-_)/_>.3)throw new J;let C=this.getOddCounts(),M=this.getEvenCounts(),R=this.getOddRoundingErrors(),L=this.getEvenRoundingErrors();for(let Le=0;Le<c.length;Le++){let Ci=1*c[Le]/x,Qi=Ci+.5;if(Qi<1){if(Ci<.3)throw new J;Qi=1}else if(Qi>8){if(Ci>8.7)throw new J;Qi=8}let dr=Le/2;Le&1?(M[dr]=Qi,L[dr]=Ci-Qi):(C[dr]=Qi,R[dr]=Ci-Qi)}this.adjustOddEvenCounts(d);let k=4*o.getValue()+(a?0:2)+(h?0:1)-1,V=0,H=0;for(let Le=C.length-1;Le>=0;Le--){if(ct.isNotA1left(o,a,h)){let Ci=ct.WEIGHTS[k][2*Le];H+=C[Le]*Ci}V+=C[Le]}let $=0;for(let Le=M.length-1;Le>=0;Le--)if(ct.isNotA1left(o,a,h)){let Ci=ct.WEIGHTS[k][2*Le+1];$+=M[Le]*Ci}let nt=H+$;if(V&1||V>13||V<4)throw new J;let xt=(13-V)/2,_t=ct.SYMBOL_WIDEST[xt],dt=9-_t,ae=Vt.getRSSvalue(C,_t,!0),Kt=Vt.getRSSvalue(M,dt,!1),Gi=ct.EVEN_TOTAL_SUBSET[xt],Cn=ct.GSUM[xt],zi=ae*Gi+Kt+Cn;return new jt(zi,nt)}static isNotA1left(i,o,a){return!(i.getValue()==0&&o&&a)}adjustOddEvenCounts(i){let o=te.sum(new Int32Array(this.getOddCounts())),a=te.sum(new Int32Array(this.getEvenCounts())),h=!1,c=!1;o>13?c=!0:o<4&&(h=!0);let d=!1,x=!1;a>13?x=!0:a<4&&(d=!0);let _=o+a-i,C=(o&1)==1,M=(a&1)==0;if(_==1)if(C){if(M)throw new J;c=!0}else{if(!M)throw new J;x=!0}else if(_==-1)if(C){if(M)throw new J;h=!0}else{if(!M)throw new J;d=!0}else if(_==0){if(C){if(!M)throw new J;o<a?(h=!0,x=!0):(c=!0,d=!0)}else if(M)throw new J}else throw new J;if(h){if(c)throw new J;ct.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(c&&ct.decrement(this.getOddCounts(),this.getOddRoundingErrors()),d){if(x)throw new J;ct.increment(this.getEvenCounts(),this.getOddRoundingErrors())}x&&ct.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ct.SYMBOL_WIDEST=[7,5,4,3,1],ct.EVEN_TOTAL_SUBSET=[4,20,52,104,204],ct.GSUM=[0,348,1388,2948,3988],ct.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],ct.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],ct.FINDER_PAT_A=0,ct.FINDER_PAT_B=1,ct.FINDER_PAT_C=2,ct.FINDER_PAT_D=3,ct.FINDER_PAT_E=4,ct.FINDER_PAT_F=5,ct.FINDER_PATTERN_SEQUENCES=[[ct.FINDER_PAT_A,ct.FINDER_PAT_A],[ct.FINDER_PAT_A,ct.FINDER_PAT_B,ct.FINDER_PAT_B],[ct.FINDER_PAT_A,ct.FINDER_PAT_C,ct.FINDER_PAT_B,ct.FINDER_PAT_D],[ct.FINDER_PAT_A,ct.FINDER_PAT_E,ct.FINDER_PAT_B,ct.FINDER_PAT_D,ct.FINDER_PAT_C],[ct.FINDER_PAT_A,ct.FINDER_PAT_E,ct.FINDER_PAT_B,ct.FINDER_PAT_D,ct.FINDER_PAT_D,ct.FINDER_PAT_F],[ct.FINDER_PAT_A,ct.FINDER_PAT_E,ct.FINDER_PAT_B,ct.FINDER_PAT_D,ct.FINDER_PAT_E,ct.FINDER_PAT_F,ct.FINDER_PAT_F],[ct.FINDER_PAT_A,ct.FINDER_PAT_A,ct.FINDER_PAT_B,ct.FINDER_PAT_B,ct.FINDER_PAT_C,ct.FINDER_PAT_C,ct.FINDER_PAT_D,ct.FINDER_PAT_D],[ct.FINDER_PAT_A,ct.FINDER_PAT_A,ct.FINDER_PAT_B,ct.FINDER_PAT_B,ct.FINDER_PAT_C,ct.FINDER_PAT_C,ct.FINDER_PAT_D,ct.FINDER_PAT_E,ct.FINDER_PAT_E],[ct.FINDER_PAT_A,ct.FINDER_PAT_A,ct.FINDER_PAT_B,ct.FINDER_PAT_B,ct.FINDER_PAT_C,ct.FINDER_PAT_C,ct.FINDER_PAT_D,ct.FINDER_PAT_E,ct.FINDER_PAT_F,ct.FINDER_PAT_F],[ct.FINDER_PAT_A,ct.FINDER_PAT_A,ct.FINDER_PAT_B,ct.FINDER_PAT_B,ct.FINDER_PAT_C,ct.FINDER_PAT_D,ct.FINDER_PAT_D,ct.FINDER_PAT_E,ct.FINDER_PAT_E,ct.FINDER_PAT_F,ct.FINDER_PAT_F]],ct.MAX_PAIRS=11;class ll extends jt{constructor(i,o,a){super(i,o),this.count=0,this.finderPattern=a}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class Rt extends ce{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(i,o,a){const h=this.decodePair(o,!1,i,a);Rt.addOrTally(this.possibleLeftPairs,h),o.reverse();let c=this.decodePair(o,!0,i,a);Rt.addOrTally(this.possibleRightPairs,c),o.reverse();for(let d of this.possibleLeftPairs)if(d.getCount()>1){for(let x of this.possibleRightPairs)if(x.getCount()>1&&Rt.checkChecksum(d,x))return Rt.constructResult(d,x)}throw new J}static addOrTally(i,o){if(o==null)return;let a=!1;for(let h of i)if(h.getValue()===o.getValue()){h.incrementCount(),a=!0;break}a||i.push(o)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(i,o){let a=4537077*i.getValue()+o.getValue(),h=new String(a).toString(),c=new yt;for(let C=13-h.length;C>0;C--)c.append("0");c.append(h);let d=0;for(let C=0;C<13;C++){let M=c.charAt(C).charCodeAt(0)-48;d+=C&1?M:3*M}d=10-d%10,d===10&&(d=0),c.append(d.toString());let x=i.getFinderPattern().getResultPoints(),_=o.getFinderPattern().getResultPoints();return new ft(c.toString(),null,0,[x[0],x[1],_[0],_[1]],Tt.RSS_14,new Date().getTime())}static checkChecksum(i,o){let a=(i.getChecksumPortion()+16*o.getChecksumPortion())%79,h=9*i.getFinderPattern().getValue()+o.getFinderPattern().getValue();return h>72&&h--,h>8&&h--,a===h}decodePair(i,o,a,h){try{let c=this.findFinderPattern(i,o),d=this.parseFoundFinderPattern(i,a,o,c),x=h==null?null:h.get(rt.NEED_RESULT_POINT_CALLBACK);if(x!=null){let M=(c[0]+c[1])/2;o&&(M=i.getSize()-1-M),x.foundPossibleResultPoint(new Mt(M,a))}let _=this.decodeDataCharacter(i,d,!0),C=this.decodeDataCharacter(i,d,!1);return new ll(1597*_.getValue()+C.getValue(),_.getChecksumPortion()+4*C.getChecksumPortion(),d)}catch{return null}}decodeDataCharacter(i,o,a){let h=this.getDataCharacterCounters();for(let $=0;$<h.length;$++)h[$]=0;if(a)Ce.recordPatternInReverse(i,o.getStartEnd()[0],h);else{Ce.recordPattern(i,o.getStartEnd()[1]+1,h);for(let $=0,nt=h.length-1;$<nt;$++,nt--){let xt=h[$];h[$]=h[nt],h[nt]=xt}}let c=a?16:15,d=te.sum(new Int32Array(h))/c,x=this.getOddCounts(),_=this.getEvenCounts(),C=this.getOddRoundingErrors(),M=this.getEvenRoundingErrors();for(let $=0;$<h.length;$++){let nt=h[$]/d,xt=Math.floor(nt+.5);xt<1?xt=1:xt>8&&(xt=8);let _t=Math.floor($/2);$&1?(_[_t]=xt,M[_t]=nt-xt):(x[_t]=xt,C[_t]=nt-xt)}this.adjustOddEvenCounts(a,c);let R=0,L=0;for(let $=x.length-1;$>=0;$--)L*=9,L+=x[$],R+=x[$];let k=0,V=0;for(let $=_.length-1;$>=0;$--)k*=9,k+=_[$],V+=_[$];let H=L+3*k;if(a){if(R&1||R>12||R<4)throw new J;let $=(12-R)/2,nt=Rt.OUTSIDE_ODD_WIDEST[$],xt=9-nt,_t=Vt.getRSSvalue(x,nt,!1),dt=Vt.getRSSvalue(_,xt,!0),ae=Rt.OUTSIDE_EVEN_TOTAL_SUBSET[$],Kt=Rt.OUTSIDE_GSUM[$];return new jt(_t*ae+dt+Kt,H)}else{if(V&1||V>10||V<4)throw new J;let $=(10-V)/2,nt=Rt.INSIDE_ODD_WIDEST[$],xt=9-nt,_t=Vt.getRSSvalue(x,nt,!0),dt=Vt.getRSSvalue(_,xt,!1),ae=Rt.INSIDE_ODD_TOTAL_SUBSET[$],Kt=Rt.INSIDE_GSUM[$];return new jt(dt*ae+_t+Kt,H)}}findFinderPattern(i,o){let a=this.getDecodeFinderCounters();a[0]=0,a[1]=0,a[2]=0,a[3]=0;let h=i.getSize(),c=!1,d=0;for(;d<h&&(c=!i.get(d),o!==c);)d++;let x=0,_=d;for(let C=d;C<h;C++)if(i.get(C)!==c)a[x]++;else{if(x===3){if(ce.isFinderPattern(a))return[_,C];_+=a[0]+a[1],a[0]=a[2],a[1]=a[3],a[2]=0,a[3]=0,x--}else x++;a[x]=1,c=!c}throw new J}parseFoundFinderPattern(i,o,a,h){let c=i.get(h[0]),d=h[0]-1;for(;d>=0&&c!==i.get(d);)d--;d++;const x=h[0]-d,_=this.getDecodeFinderCounters(),C=new Int32Array(_.length);F.arraycopy(_,0,C,1,_.length-1),C[0]=x;const M=this.parseFinderValue(C,Rt.FINDER_PATTERNS);let R=d,L=h[1];return a&&(R=i.getSize()-1-R,L=i.getSize()-1-L),new si(M,[d,h[1]],R,L,o)}adjustOddEvenCounts(i,o){let a=te.sum(new Int32Array(this.getOddCounts())),h=te.sum(new Int32Array(this.getEvenCounts())),c=!1,d=!1,x=!1,_=!1;i?(a>12?d=!0:a<4&&(c=!0),h>12?_=!0:h<4&&(x=!0)):(a>11?d=!0:a<5&&(c=!0),h>10?_=!0:h<4&&(x=!0));let C=a+h-o,M=(a&1)===(i?1:0),R=(h&1)===1;if(C===1)if(M){if(R)throw new J;d=!0}else{if(!R)throw new J;_=!0}else if(C===-1)if(M){if(R)throw new J;c=!0}else{if(!R)throw new J;x=!0}else if(C===0){if(M){if(!R)throw new J;a<h?(c=!0,_=!0):(d=!0,x=!0)}else if(R)throw new J}else throw new J;if(c){if(d)throw new J;ce.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(d&&ce.decrement(this.getOddCounts(),this.getOddRoundingErrors()),x){if(_)throw new J;ce.increment(this.getEvenCounts(),this.getOddRoundingErrors())}_&&ce.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Rt.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],Rt.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],Rt.OUTSIDE_GSUM=[0,161,961,2015,2715],Rt.INSIDE_GSUM=[0,336,1036,1516],Rt.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],Rt.INSIDE_ODD_WIDEST=[2,4,6,8],Rt.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class ps extends Ce{constructor(i,o){super(),this.readers=[],this.verbose=o===!0;const a=i?i.get(rt.POSSIBLE_FORMATS):null,h=i&&i.get(rt.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;a?((a.includes(Tt.EAN_13)||a.includes(Tt.UPC_A)||a.includes(Tt.EAN_8)||a.includes(Tt.UPC_E))&&this.readers.push(new ue(i)),a.includes(Tt.CODE_39)&&this.readers.push(new Se(h)),a.includes(Tt.CODE_128)&&this.readers.push(new wt),a.includes(Tt.ITF)&&this.readers.push(new ne),a.includes(Tt.RSS_14)&&this.readers.push(new Rt),a.includes(Tt.RSS_EXPANDED)&&this.readers.push(new ct(this.verbose))):(this.readers.push(new ue(i)),this.readers.push(new Se),this.readers.push(new ue(i)),this.readers.push(new wt),this.readers.push(new ne),this.readers.push(new Rt),this.readers.push(new ct(this.verbose)))}decodeRow(i,o,a){for(let h=0;h<this.readers.length;h++)try{return this.readers[h].decodeRow(i,o,a)}catch{}throw new J}reset(){this.readers.forEach(i=>i.reset())}}class ri extends $t{constructor(i=500,o){super(new ps(o),i,o)}}class ge{constructor(i,o,a){this.ecCodewords=i,this.ecBlocks=[o],a&&this.ecBlocks.push(a)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class me{constructor(i,o){this.count=i,this.dataCodewords=o}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class se{constructor(i,o,a,h,c,d){this.versionNumber=i,this.symbolSizeRows=o,this.symbolSizeColumns=a,this.dataRegionSizeRows=h,this.dataRegionSizeColumns=c,this.ecBlocks=d;let x=0;const _=d.getECCodewords(),C=d.getECBlocks();for(let M of C)x+=M.getCount()*(M.getDataCodewords()+_);this.totalCodewords=x}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(i,o){if(i&1||o&1)throw new K;for(let a of se.VERSIONS)if(a.symbolSizeRows===i&&a.symbolSizeColumns===o)return a;throw new K}toString(){return""+this.versionNumber}static buildVersions(){return[new se(1,10,10,8,8,new ge(5,new me(1,3))),new se(2,12,12,10,10,new ge(7,new me(1,5))),new se(3,14,14,12,12,new ge(10,new me(1,8))),new se(4,16,16,14,14,new ge(12,new me(1,12))),new se(5,18,18,16,16,new ge(14,new me(1,18))),new se(6,20,20,18,18,new ge(18,new me(1,22))),new se(7,22,22,20,20,new ge(20,new me(1,30))),new se(8,24,24,22,22,new ge(24,new me(1,36))),new se(9,26,26,24,24,new ge(28,new me(1,44))),new se(10,32,32,14,14,new ge(36,new me(1,62))),new se(11,36,36,16,16,new ge(42,new me(1,86))),new se(12,40,40,18,18,new ge(48,new me(1,114))),new se(13,44,44,20,20,new ge(56,new me(1,144))),new se(14,48,48,22,22,new ge(68,new me(1,174))),new se(15,52,52,24,24,new ge(42,new me(2,102))),new se(16,64,64,14,14,new ge(56,new me(2,140))),new se(17,72,72,16,16,new ge(36,new me(4,92))),new se(18,80,80,18,18,new ge(48,new me(4,114))),new se(19,88,88,20,20,new ge(56,new me(4,144))),new se(20,96,96,22,22,new ge(68,new me(4,174))),new se(21,104,104,24,24,new ge(56,new me(6,136))),new se(22,120,120,18,18,new ge(68,new me(6,175))),new se(23,132,132,20,20,new ge(62,new me(8,163))),new se(24,144,144,22,22,new ge(62,new me(8,156),new me(2,155))),new se(25,8,18,6,16,new ge(7,new me(1,5))),new se(26,8,32,6,14,new ge(11,new me(1,10))),new se(27,12,26,10,24,new ge(14,new me(1,16))),new se(28,12,36,10,16,new ge(18,new me(1,22))),new se(29,16,36,14,16,new ge(24,new me(1,32))),new se(30,16,48,14,22,new ge(28,new me(1,49)))]}}se.VERSIONS=se.buildVersions();class hr{constructor(i){const o=i.getHeight();if(o<8||o>144||o&1)throw new K;this.version=hr.readVersion(i),this.mappingBitMatrix=this.extractDataRegion(i),this.readMappingMatrix=new Nt(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(i){const o=i.getHeight(),a=i.getWidth();return se.getVersionForDimensions(o,a)}readCodewords(){const i=new Int8Array(this.version.getTotalCodewords());let o=0,a=4,h=0;const c=this.mappingBitMatrix.getHeight(),d=this.mappingBitMatrix.getWidth();let x=!1,_=!1,C=!1,M=!1;do if(a===c&&h===0&&!x)i[o++]=this.readCorner1(c,d)&255,a-=2,h+=2,x=!0;else if(a===c-2&&h===0&&d&3&&!_)i[o++]=this.readCorner2(c,d)&255,a-=2,h+=2,_=!0;else if(a===c+4&&h===2&&!(d&7)&&!C)i[o++]=this.readCorner3(c,d)&255,a-=2,h+=2,C=!0;else if(a===c-2&&h===0&&(d&7)===4&&!M)i[o++]=this.readCorner4(c,d)&255,a-=2,h+=2,M=!0;else{do a<c&&h>=0&&!this.readMappingMatrix.get(h,a)&&(i[o++]=this.readUtah(a,h,c,d)&255),a-=2,h+=2;while(a>=0&&h<d);a+=1,h+=3;do a>=0&&h<d&&!this.readMappingMatrix.get(h,a)&&(i[o++]=this.readUtah(a,h,c,d)&255),a+=2,h-=2;while(a<c&&h>=0);a+=3,h+=1}while(a<c||h<d);if(o!==this.version.getTotalCodewords())throw new K;return i}readModule(i,o,a,h){return i<0&&(i+=a,o+=4-(a+4&7)),o<0&&(o+=h,i+=4-(h+4&7)),this.readMappingMatrix.set(o,i),this.mappingBitMatrix.get(o,i)}readUtah(i,o,a,h){let c=0;return this.readModule(i-2,o-2,a,h)&&(c|=1),c<<=1,this.readModule(i-2,o-1,a,h)&&(c|=1),c<<=1,this.readModule(i-1,o-2,a,h)&&(c|=1),c<<=1,this.readModule(i-1,o-1,a,h)&&(c|=1),c<<=1,this.readModule(i-1,o,a,h)&&(c|=1),c<<=1,this.readModule(i,o-2,a,h)&&(c|=1),c<<=1,this.readModule(i,o-1,a,h)&&(c|=1),c<<=1,this.readModule(i,o,a,h)&&(c|=1),c}readCorner1(i,o){let a=0;return this.readModule(i-1,0,i,o)&&(a|=1),a<<=1,this.readModule(i-1,1,i,o)&&(a|=1),a<<=1,this.readModule(i-1,2,i,o)&&(a|=1),a<<=1,this.readModule(0,o-2,i,o)&&(a|=1),a<<=1,this.readModule(0,o-1,i,o)&&(a|=1),a<<=1,this.readModule(1,o-1,i,o)&&(a|=1),a<<=1,this.readModule(2,o-1,i,o)&&(a|=1),a<<=1,this.readModule(3,o-1,i,o)&&(a|=1),a}readCorner2(i,o){let a=0;return this.readModule(i-3,0,i,o)&&(a|=1),a<<=1,this.readModule(i-2,0,i,o)&&(a|=1),a<<=1,this.readModule(i-1,0,i,o)&&(a|=1),a<<=1,this.readModule(0,o-4,i,o)&&(a|=1),a<<=1,this.readModule(0,o-3,i,o)&&(a|=1),a<<=1,this.readModule(0,o-2,i,o)&&(a|=1),a<<=1,this.readModule(0,o-1,i,o)&&(a|=1),a<<=1,this.readModule(1,o-1,i,o)&&(a|=1),a}readCorner3(i,o){let a=0;return this.readModule(i-1,0,i,o)&&(a|=1),a<<=1,this.readModule(i-1,o-1,i,o)&&(a|=1),a<<=1,this.readModule(0,o-3,i,o)&&(a|=1),a<<=1,this.readModule(0,o-2,i,o)&&(a|=1),a<<=1,this.readModule(0,o-1,i,o)&&(a|=1),a<<=1,this.readModule(1,o-3,i,o)&&(a|=1),a<<=1,this.readModule(1,o-2,i,o)&&(a|=1),a<<=1,this.readModule(1,o-1,i,o)&&(a|=1),a}readCorner4(i,o){let a=0;return this.readModule(i-3,0,i,o)&&(a|=1),a<<=1,this.readModule(i-2,0,i,o)&&(a|=1),a<<=1,this.readModule(i-1,0,i,o)&&(a|=1),a<<=1,this.readModule(0,o-2,i,o)&&(a|=1),a<<=1,this.readModule(0,o-1,i,o)&&(a|=1),a<<=1,this.readModule(1,o-1,i,o)&&(a|=1),a<<=1,this.readModule(2,o-1,i,o)&&(a|=1),a<<=1,this.readModule(3,o-1,i,o)&&(a|=1),a}extractDataRegion(i){const o=this.version.getSymbolSizeRows(),a=this.version.getSymbolSizeColumns();if(i.getHeight()!==o)throw new A("Dimension of bitMatrix must match the version size");const h=this.version.getDataRegionSizeRows(),c=this.version.getDataRegionSizeColumns(),d=o/h|0,x=a/c|0,_=d*h,C=x*c,M=new Nt(C,_);for(let R=0;R<d;++R){const L=R*h;for(let k=0;k<x;++k){const V=k*c;for(let H=0;H<h;++H){const $=R*(h+2)+1+H,nt=L+H;for(let xt=0;xt<c;++xt){const _t=k*(c+2)+1+xt;if(i.get(_t,$)){const dt=V+xt;M.set(dt,nt)}}}}}return M}}class Hr{constructor(i,o){this.numDataCodewords=i,this.codewords=o}static getDataBlocks(i,o){const a=o.getECBlocks();let h=0;const c=a.getECBlocks();for(let H of c)h+=H.getCount();const d=new Array(h);let x=0;for(let H of c)for(let $=0;$<H.getCount();$++){const nt=H.getDataCodewords(),xt=a.getECCodewords()+nt;d[x++]=new Hr(nt,new Uint8Array(xt))}const C=d[0].codewords.length-a.getECCodewords(),M=C-1;let R=0;for(let H=0;H<M;H++)for(let $=0;$<x;$++)d[$].codewords[H]=i[R++];const L=o.getVersionNumber()===24,k=L?8:x;for(let H=0;H<k;H++)d[H].codewords[C-1]=i[R++];const V=d[0].codewords.length;for(let H=C;H<V;H++)for(let $=0;$<x;$++){const nt=L?($+8)%x:$,xt=L&&nt>7?H-1:H;d[nt].codewords[xt]=i[R++]}if(R!==i.length)throw new A;return d}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class cr{constructor(i){this.bytes=i,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(i){if(i<1||i>32||i>this.available())throw new A(""+i);let o=0,a=this.bitOffset,h=this.byteOffset;const c=this.bytes;if(a>0){const d=8-a,x=i<d?i:d,_=d-x,C=255>>8-x<<_;o=(c[h]&C)>>_,i-=x,a+=x,a===8&&(a=0,h++)}if(i>0){for(;i>=8;)o=o<<8|c[h]&255,h++,i-=8;if(i>0){const d=8-i,x=255>>d<<d;o=o<<i|(c[h]&x)>>d,a+=i}}return this.bitOffset=a,this.byteOffset=h,o}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var qe;(function(T){T[T.PAD_ENCODE=0]="PAD_ENCODE",T[T.ASCII_ENCODE=1]="ASCII_ENCODE",T[T.C40_ENCODE=2]="C40_ENCODE",T[T.TEXT_ENCODE=3]="TEXT_ENCODE",T[T.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",T[T.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",T[T.BASE256_ENCODE=6]="BASE256_ENCODE"})(qe||(qe={}));class pn{static decode(i){const o=new cr(i),a=new yt,h=new yt,c=new Array;let d=qe.ASCII_ENCODE;do if(d===qe.ASCII_ENCODE)d=this.decodeAsciiSegment(o,a,h);else{switch(d){case qe.C40_ENCODE:this.decodeC40Segment(o,a);break;case qe.TEXT_ENCODE:this.decodeTextSegment(o,a);break;case qe.ANSIX12_ENCODE:this.decodeAnsiX12Segment(o,a);break;case qe.EDIFACT_ENCODE:this.decodeEdifactSegment(o,a);break;case qe.BASE256_ENCODE:this.decodeBase256Segment(o,a,c);break;default:throw new K}d=qe.ASCII_ENCODE}while(d!==qe.PAD_ENCODE&&o.available()>0);return h.length()>0&&a.append(h.toString()),new fi(i,a.toString(),c.length===0?null:c,null)}static decodeAsciiSegment(i,o,a){let h=!1;do{let c=i.readBits(8);if(c===0)throw new K;if(c<=128)return h&&(c+=128),o.append(String.fromCharCode(c-1)),qe.ASCII_ENCODE;if(c===129)return qe.PAD_ENCODE;if(c<=229){const d=c-130;d<10&&o.append("0"),o.append(""+d)}else switch(c){case 230:return qe.C40_ENCODE;case 231:return qe.BASE256_ENCODE;case 232:o.append("");break;case 233:case 234:break;case 235:h=!0;break;case 236:o.append("[)>05"),a.insert(0,"");break;case 237:o.append("[)>06"),a.insert(0,"");break;case 238:return qe.ANSIX12_ENCODE;case 239:return qe.TEXT_ENCODE;case 240:return qe.EDIFACT_ENCODE;case 241:break;default:if(c!==254||i.available()!==0)throw new K;break}}while(i.available()>0);return qe.ASCII_ENCODE}static decodeC40Segment(i,o){let a=!1;const h=[];let c=0;do{if(i.available()===8)return;const d=i.readBits(8);if(d===254)return;this.parseTwoBytes(d,i.readBits(8),h);for(let x=0;x<3;x++){const _=h[x];switch(c){case 0:if(_<3)c=_+1;else if(_<this.C40_BASIC_SET_CHARS.length){const C=this.C40_BASIC_SET_CHARS[_];a?(o.append(String.fromCharCode(C.charCodeAt(0)+128)),a=!1):o.append(C)}else throw new K;break;case 1:a?(o.append(String.fromCharCode(_+128)),a=!1):o.append(String.fromCharCode(_)),c=0;break;case 2:if(_<this.C40_SHIFT2_SET_CHARS.length){const C=this.C40_SHIFT2_SET_CHARS[_];a?(o.append(String.fromCharCode(C.charCodeAt(0)+128)),a=!1):o.append(C)}else switch(_){case 27:o.append("");break;case 30:a=!0;break;default:throw new K}c=0;break;case 3:a?(o.append(String.fromCharCode(_+224)),a=!1):o.append(String.fromCharCode(_+96)),c=0;break;default:throw new K}}}while(i.available()>0)}static decodeTextSegment(i,o){let a=!1,h=[],c=0;do{if(i.available()===8)return;const d=i.readBits(8);if(d===254)return;this.parseTwoBytes(d,i.readBits(8),h);for(let x=0;x<3;x++){const _=h[x];switch(c){case 0:if(_<3)c=_+1;else if(_<this.TEXT_BASIC_SET_CHARS.length){const C=this.TEXT_BASIC_SET_CHARS[_];a?(o.append(String.fromCharCode(C.charCodeAt(0)+128)),a=!1):o.append(C)}else throw new K;break;case 1:a?(o.append(String.fromCharCode(_+128)),a=!1):o.append(String.fromCharCode(_)),c=0;break;case 2:if(_<this.TEXT_SHIFT2_SET_CHARS.length){const C=this.TEXT_SHIFT2_SET_CHARS[_];a?(o.append(String.fromCharCode(C.charCodeAt(0)+128)),a=!1):o.append(C)}else switch(_){case 27:o.append("");break;case 30:a=!0;break;default:throw new K}c=0;break;case 3:if(_<this.TEXT_SHIFT3_SET_CHARS.length){const C=this.TEXT_SHIFT3_SET_CHARS[_];a?(o.append(String.fromCharCode(C.charCodeAt(0)+128)),a=!1):o.append(C),c=0}else throw new K;break;default:throw new K}}}while(i.available()>0)}static decodeAnsiX12Segment(i,o){const a=[];do{if(i.available()===8)return;const h=i.readBits(8);if(h===254)return;this.parseTwoBytes(h,i.readBits(8),a);for(let c=0;c<3;c++){const d=a[c];switch(d){case 0:o.append("\r");break;case 1:o.append("*");break;case 2:o.append(">");break;case 3:o.append(" ");break;default:if(d<14)o.append(String.fromCharCode(d+44));else if(d<40)o.append(String.fromCharCode(d+51));else throw new K;break}}}while(i.available()>0)}static parseTwoBytes(i,o,a){let h=(i<<8)+o-1,c=Math.floor(h/1600);a[0]=c,h-=c*1600,c=Math.floor(h/40),a[1]=c,a[2]=h-c*40}static decodeEdifactSegment(i,o){do{if(i.available()<=16)return;for(let a=0;a<4;a++){let h=i.readBits(6);if(h===31){const c=8-i.getBitOffset();c!==8&&i.readBits(c);return}h&32||(h|=64),o.append(String.fromCharCode(h))}}while(i.available()>0)}static decodeBase256Segment(i,o,a){let h=1+i.getByteOffset();const c=this.unrandomize255State(i.readBits(8),h++);let d;if(c===0?d=i.available()/8|0:c<250?d=c:d=250*(c-249)+this.unrandomize255State(i.readBits(8),h++),d<0)throw new K;const x=new Uint8Array(d);for(let _=0;_<d;_++){if(i.available()<8)throw new K;x[_]=this.unrandomize255State(i.readBits(8),h++)}a.push(x);try{o.append(St.decode(x,ut.ISO88591))}catch(_){throw new li("Platform does not support required encoding: "+_.message)}}static unrandomize255State(i,o){const a=149*o%255+1,h=i-a;return h>=0?h:h+256}}pn.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],pn.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],pn.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],pn.TEXT_SHIFT2_SET_CHARS=pn.C40_SHIFT2_SET_CHARS,pn.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class Go{constructor(){this.rsDecoder=new _i(ie.DATA_MATRIX_FIELD_256)}decode(i){const o=new hr(i),a=o.getVersion(),h=o.readCodewords(),c=Hr.getDataBlocks(h,a);let d=0;for(let C of c)d+=C.getNumDataCodewords();const x=new Uint8Array(d),_=c.length;for(let C=0;C<_;C++){const M=c[C],R=M.getCodewords(),L=M.getNumDataCodewords();this.correctErrors(R,L);for(let k=0;k<L;k++)x[k*_+C]=R[k]}return pn.decode(x)}correctErrors(i,o){const a=new Int32Array(i);try{this.rsDecoder.decode(a,i.length-o)}catch{throw new D}for(let h=0;h<o;h++)i[h]=a[h]}}class Ne{constructor(i){this.image=i,this.rectangleDetector=new hi(this.image)}detect(){const i=this.rectangleDetector.detect();let o=this.detectSolid1(i);if(o=this.detectSolid2(o),o[3]=this.correctTopRight(o),!o[3])throw new J;o=this.shiftToModuleCenter(o);const a=o[0],h=o[1],c=o[2],d=o[3];let x=this.transitionsBetween(a,d)+1,_=this.transitionsBetween(c,d)+1;(x&1)===1&&(x+=1),(_&1)===1&&(_+=1),4*x<7*_&&4*_<7*x&&(x=_=Math.max(x,_));let C=Ne.sampleGrid(this.image,a,h,c,d,x,_);return new yi(C,[a,h,c,d])}static shiftPoint(i,o,a){let h=(o.getX()-i.getX())/(a+1),c=(o.getY()-i.getY())/(a+1);return new Mt(i.getX()+h,i.getY()+c)}static moveAway(i,o,a){let h=i.getX(),c=i.getY();return h<o?h-=1:h+=1,c<a?c-=1:c+=1,new Mt(h,c)}detectSolid1(i){let o=i[0],a=i[1],h=i[3],c=i[2],d=this.transitionsBetween(o,a),x=this.transitionsBetween(a,h),_=this.transitionsBetween(h,c),C=this.transitionsBetween(c,o),M=d,R=[c,o,a,h];return M>x&&(M=x,R[0]=o,R[1]=a,R[2]=h,R[3]=c),M>_&&(M=_,R[0]=a,R[1]=h,R[2]=c,R[3]=o),M>C&&(R[0]=h,R[1]=c,R[2]=o,R[3]=a),R}detectSolid2(i){let o=i[0],a=i[1],h=i[2],c=i[3],d=this.transitionsBetween(o,c),x=Ne.shiftPoint(a,h,(d+1)*4),_=Ne.shiftPoint(h,a,(d+1)*4),C=this.transitionsBetween(x,o),M=this.transitionsBetween(_,c);return C<M?(i[0]=o,i[1]=a,i[2]=h,i[3]=c):(i[0]=a,i[1]=h,i[2]=c,i[3]=o),i}correctTopRight(i){let o=i[0],a=i[1],h=i[2],c=i[3],d=this.transitionsBetween(o,c),x=this.transitionsBetween(a,c),_=Ne.shiftPoint(o,a,(x+1)*4),C=Ne.shiftPoint(h,a,(d+1)*4);d=this.transitionsBetween(_,c),x=this.transitionsBetween(C,c);let M=new Mt(c.getX()+(h.getX()-a.getX())/(d+1),c.getY()+(h.getY()-a.getY())/(d+1)),R=new Mt(c.getX()+(o.getX()-a.getX())/(x+1),c.getY()+(o.getY()-a.getY())/(x+1));if(!this.isValid(M))return this.isValid(R)?R:null;if(!this.isValid(R))return M;let L=this.transitionsBetween(_,M)+this.transitionsBetween(C,M),k=this.transitionsBetween(_,R)+this.transitionsBetween(C,R);return L>k?M:R}shiftToModuleCenter(i){let o=i[0],a=i[1],h=i[2],c=i[3],d=this.transitionsBetween(o,c)+1,x=this.transitionsBetween(h,c)+1,_=Ne.shiftPoint(o,a,x*4),C=Ne.shiftPoint(h,a,d*4);d=this.transitionsBetween(_,c)+1,x=this.transitionsBetween(C,c)+1,(d&1)===1&&(d+=1),(x&1)===1&&(x+=1);let M=(o.getX()+a.getX()+h.getX()+c.getX())/4,R=(o.getY()+a.getY()+h.getY()+c.getY())/4;o=Ne.moveAway(o,M,R),a=Ne.moveAway(a,M,R),h=Ne.moveAway(h,M,R),c=Ne.moveAway(c,M,R);let L,k;return _=Ne.shiftPoint(o,a,x*4),_=Ne.shiftPoint(_,c,d*4),L=Ne.shiftPoint(a,o,x*4),L=Ne.shiftPoint(L,h,d*4),C=Ne.shiftPoint(h,c,x*4),C=Ne.shiftPoint(C,a,d*4),k=Ne.shiftPoint(c,h,x*4),k=Ne.shiftPoint(k,o,d*4),[_,L,C,k]}isValid(i){return i.getX()>=0&&i.getX()<this.image.getWidth()&&i.getY()>0&&i.getY()<this.image.getHeight()}static sampleGrid(i,o,a,h,c,d,x){return Ke.getInstance().sampleGrid(i,d,x,.5,.5,d-.5,.5,d-.5,x-.5,.5,x-.5,o.getX(),o.getY(),c.getX(),c.getY(),h.getX(),h.getY(),a.getX(),a.getY())}transitionsBetween(i,o){let a=Math.trunc(i.getX()),h=Math.trunc(i.getY()),c=Math.trunc(o.getX()),d=Math.trunc(o.getY()),x=Math.abs(d-h)>Math.abs(c-a);if(x){let H=a;a=h,h=H,H=c,c=d,d=H}let _=Math.abs(c-a),C=Math.abs(d-h),M=-_/2,R=h<d?1:-1,L=a<c?1:-1,k=0,V=this.image.get(x?h:a,x?a:h);for(let H=a,$=h;H!==c;H+=L){let nt=this.image.get(x?$:H,x?H:$);if(nt!==V&&(k++,V=nt),M+=C,M>0){if($===d)break;$+=R,M-=_}}return k}}class Ve{constructor(){this.decoder=new Go}decode(i,o=null){let a,h;if(o!=null&&o.has(rt.PURE_BARCODE)){const C=Ve.extractPureBits(i.getBlackMatrix());a=this.decoder.decode(C),h=Ve.NO_POINTS}else{const C=new Ne(i.getBlackMatrix()).detect();a=this.decoder.decode(C.getBits()),h=C.getPoints()}const c=a.getRawBytes(),d=new ft(a.getText(),c,8*c.length,h,Tt.DATA_MATRIX,F.currentTimeMillis()),x=a.getByteSegments();x!=null&&d.putMetadata(_e.BYTE_SEGMENTS,x);const _=a.getECLevel();return _!=null&&d.putMetadata(_e.ERROR_CORRECTION_LEVEL,_),d}reset(){}static extractPureBits(i){const o=i.getTopLeftOnBit(),a=i.getBottomRightOnBit();if(o==null||a==null)throw new J;const h=this.moduleSize(o,i);let c=o[1];const d=a[1];let x=o[0];const C=(a[0]-x+1)/h,M=(d-c+1)/h;if(C<=0||M<=0)throw new J;const R=h/2;c+=R,x+=R;const L=new Nt(C,M);for(let k=0;k<M;k++){const V=c+k*h;for(let H=0;H<C;H++)i.get(x+H*h,V)&&L.set(H,k)}return L}static moduleSize(i,o){const a=o.getWidth();let h=i[0];const c=i[1];for(;h<a&&o.get(h,c);)h++;if(h===a)throw new J;const d=h-i[0];if(d===0)throw new J;return d}}Ve.NO_POINTS=[];class ki extends $t{constructor(i=500){super(new Ve,i)}}var cn;(function(T){T[T.L=0]="L",T[T.M=1]="M",T[T.Q=2]="Q",T[T.H=3]="H"})(cn||(cn={}));class Ee{constructor(i,o,a){this.value=i,this.stringValue=o,this.bits=a,Ee.FOR_BITS.set(a,this),Ee.FOR_VALUE.set(i,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(i){switch(i){case"L":return Ee.L;case"M":return Ee.M;case"Q":return Ee.Q;case"H":return Ee.H;default:throw new E(i+"not available")}}toString(){return this.stringValue}equals(i){if(!(i instanceof Ee))return!1;const o=i;return this.value===o.value}static forBits(i){if(i<0||i>=Ee.FOR_BITS.size)throw new A;return Ee.FOR_BITS.get(i)}}Ee.FOR_BITS=new Map,Ee.FOR_VALUE=new Map,Ee.L=new Ee(cn.L,"L",1),Ee.M=new Ee(cn.M,"M",0),Ee.Q=new Ee(cn.Q,"Q",3),Ee.H=new Ee(cn.H,"H",2);class mi{constructor(i){this.errorCorrectionLevel=Ee.forBits(i>>3&3),this.dataMask=i&7}static numBitsDiffering(i,o){return X.bitCount(i^o)}static decodeFormatInformation(i,o){const a=mi.doDecodeFormatInformation(i,o);return a!==null?a:mi.doDecodeFormatInformation(i^mi.FORMAT_INFO_MASK_QR,o^mi.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(i,o){let a=Number.MAX_SAFE_INTEGER,h=0;for(const c of mi.FORMAT_INFO_DECODE_LOOKUP){const d=c[0];if(d===i||d===o)return new mi(c[1]);let x=mi.numBitsDiffering(i,d);x<a&&(h=c[1],a=x),i!==o&&(x=mi.numBitsDiffering(o,d),x<a&&(h=c[1],a=x))}return a<=3?new mi(h):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(i){if(!(i instanceof mi))return!1;const o=i;return this.errorCorrectionLevel===o.errorCorrectionLevel&&this.dataMask===o.dataMask}}mi.FORMAT_INFO_MASK_QR=21522,mi.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class tt{constructor(i,...o){this.ecCodewordsPerBlock=i,this.ecBlocks=o}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let i=0;const o=this.ecBlocks;for(const a of o)i+=a.getCount();return i}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class B{constructor(i,o){this.count=i,this.dataCodewords=o}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Dt{constructor(i,o,...a){this.versionNumber=i,this.alignmentPatternCenters=o,this.ecBlocks=a;let h=0;const c=a[0].getECCodewordsPerBlock(),d=a[0].getECBlocks();for(const x of d)h+=x.getCount()*(x.getDataCodewords()+c);this.totalCodewords=h}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(i){return this.ecBlocks[i.getValue()]}static getProvisionalVersionForDimension(i){if(i%4!==1)throw new K;try{return this.getVersionForNumber((i-17)/4)}catch{throw new K}}static getVersionForNumber(i){if(i<1||i>40)throw new A;return Dt.VERSIONS[i-1]}static decodeVersionInformation(i){let o=Number.MAX_SAFE_INTEGER,a=0;for(let h=0;h<Dt.VERSION_DECODE_INFO.length;h++){const c=Dt.VERSION_DECODE_INFO[h];if(c===i)return Dt.getVersionForNumber(h+7);const d=mi.numBitsDiffering(i,c);d<o&&(a=h+7,o=d)}return o<=3?Dt.getVersionForNumber(a):null}buildFunctionPattern(){const i=this.getDimensionForVersion(),o=new Nt(i);o.setRegion(0,0,9,9),o.setRegion(i-8,0,8,9),o.setRegion(0,i-8,9,8);const a=this.alignmentPatternCenters.length;for(let h=0;h<a;h++){const c=this.alignmentPatternCenters[h]-2;for(let d=0;d<a;d++)h===0&&(d===0||d===a-1)||h===a-1&&d===0||o.setRegion(this.alignmentPatternCenters[d]-2,c,5,5)}return o.setRegion(6,9,1,i-17),o.setRegion(9,6,i-17,1),this.versionNumber>6&&(o.setRegion(i-11,0,3,6),o.setRegion(0,i-11,6,3)),o}toString(){return""+this.versionNumber}}Dt.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Dt.VERSIONS=[new Dt(1,new Int32Array(0),new tt(7,new B(1,19)),new tt(10,new B(1,16)),new tt(13,new B(1,13)),new tt(17,new B(1,9))),new Dt(2,Int32Array.from([6,18]),new tt(10,new B(1,34)),new tt(16,new B(1,28)),new tt(22,new B(1,22)),new tt(28,new B(1,16))),new Dt(3,Int32Array.from([6,22]),new tt(15,new B(1,55)),new tt(26,new B(1,44)),new tt(18,new B(2,17)),new tt(22,new B(2,13))),new Dt(4,Int32Array.from([6,26]),new tt(20,new B(1,80)),new tt(18,new B(2,32)),new tt(26,new B(2,24)),new tt(16,new B(4,9))),new Dt(5,Int32Array.from([6,30]),new tt(26,new B(1,108)),new tt(24,new B(2,43)),new tt(18,new B(2,15),new B(2,16)),new tt(22,new B(2,11),new B(2,12))),new Dt(6,Int32Array.from([6,34]),new tt(18,new B(2,68)),new tt(16,new B(4,27)),new tt(24,new B(4,19)),new tt(28,new B(4,15))),new Dt(7,Int32Array.from([6,22,38]),new tt(20,new B(2,78)),new tt(18,new B(4,31)),new tt(18,new B(2,14),new B(4,15)),new tt(26,new B(4,13),new B(1,14))),new Dt(8,Int32Array.from([6,24,42]),new tt(24,new B(2,97)),new tt(22,new B(2,38),new B(2,39)),new tt(22,new B(4,18),new B(2,19)),new tt(26,new B(4,14),new B(2,15))),new Dt(9,Int32Array.from([6,26,46]),new tt(30,new B(2,116)),new tt(22,new B(3,36),new B(2,37)),new tt(20,new B(4,16),new B(4,17)),new tt(24,new B(4,12),new B(4,13))),new Dt(10,Int32Array.from([6,28,50]),new tt(18,new B(2,68),new B(2,69)),new tt(26,new B(4,43),new B(1,44)),new tt(24,new B(6,19),new B(2,20)),new tt(28,new B(6,15),new B(2,16))),new Dt(11,Int32Array.from([6,30,54]),new tt(20,new B(4,81)),new tt(30,new B(1,50),new B(4,51)),new tt(28,new B(4,22),new B(4,23)),new tt(24,new B(3,12),new B(8,13))),new Dt(12,Int32Array.from([6,32,58]),new tt(24,new B(2,92),new B(2,93)),new tt(22,new B(6,36),new B(2,37)),new tt(26,new B(4,20),new B(6,21)),new tt(28,new B(7,14),new B(4,15))),new Dt(13,Int32Array.from([6,34,62]),new tt(26,new B(4,107)),new tt(22,new B(8,37),new B(1,38)),new tt(24,new B(8,20),new B(4,21)),new tt(22,new B(12,11),new B(4,12))),new Dt(14,Int32Array.from([6,26,46,66]),new tt(30,new B(3,115),new B(1,116)),new tt(24,new B(4,40),new B(5,41)),new tt(20,new B(11,16),new B(5,17)),new tt(24,new B(11,12),new B(5,13))),new Dt(15,Int32Array.from([6,26,48,70]),new tt(22,new B(5,87),new B(1,88)),new tt(24,new B(5,41),new B(5,42)),new tt(30,new B(5,24),new B(7,25)),new tt(24,new B(11,12),new B(7,13))),new Dt(16,Int32Array.from([6,26,50,74]),new tt(24,new B(5,98),new B(1,99)),new tt(28,new B(7,45),new B(3,46)),new tt(24,new B(15,19),new B(2,20)),new tt(30,new B(3,15),new B(13,16))),new Dt(17,Int32Array.from([6,30,54,78]),new tt(28,new B(1,107),new B(5,108)),new tt(28,new B(10,46),new B(1,47)),new tt(28,new B(1,22),new B(15,23)),new tt(28,new B(2,14),new B(17,15))),new Dt(18,Int32Array.from([6,30,56,82]),new tt(30,new B(5,120),new B(1,121)),new tt(26,new B(9,43),new B(4,44)),new tt(28,new B(17,22),new B(1,23)),new tt(28,new B(2,14),new B(19,15))),new Dt(19,Int32Array.from([6,30,58,86]),new tt(28,new B(3,113),new B(4,114)),new tt(26,new B(3,44),new B(11,45)),new tt(26,new B(17,21),new B(4,22)),new tt(26,new B(9,13),new B(16,14))),new Dt(20,Int32Array.from([6,34,62,90]),new tt(28,new B(3,107),new B(5,108)),new tt(26,new B(3,41),new B(13,42)),new tt(30,new B(15,24),new B(5,25)),new tt(28,new B(15,15),new B(10,16))),new Dt(21,Int32Array.from([6,28,50,72,94]),new tt(28,new B(4,116),new B(4,117)),new tt(26,new B(17,42)),new tt(28,new B(17,22),new B(6,23)),new tt(30,new B(19,16),new B(6,17))),new Dt(22,Int32Array.from([6,26,50,74,98]),new tt(28,new B(2,111),new B(7,112)),new tt(28,new B(17,46)),new tt(30,new B(7,24),new B(16,25)),new tt(24,new B(34,13))),new Dt(23,Int32Array.from([6,30,54,78,102]),new tt(30,new B(4,121),new B(5,122)),new tt(28,new B(4,47),new B(14,48)),new tt(30,new B(11,24),new B(14,25)),new tt(30,new B(16,15),new B(14,16))),new Dt(24,Int32Array.from([6,28,54,80,106]),new tt(30,new B(6,117),new B(4,118)),new tt(28,new B(6,45),new B(14,46)),new tt(30,new B(11,24),new B(16,25)),new tt(30,new B(30,16),new B(2,17))),new Dt(25,Int32Array.from([6,32,58,84,110]),new tt(26,new B(8,106),new B(4,107)),new tt(28,new B(8,47),new B(13,48)),new tt(30,new B(7,24),new B(22,25)),new tt(30,new B(22,15),new B(13,16))),new Dt(26,Int32Array.from([6,30,58,86,114]),new tt(28,new B(10,114),new B(2,115)),new tt(28,new B(19,46),new B(4,47)),new tt(28,new B(28,22),new B(6,23)),new tt(30,new B(33,16),new B(4,17))),new Dt(27,Int32Array.from([6,34,62,90,118]),new tt(30,new B(8,122),new B(4,123)),new tt(28,new B(22,45),new B(3,46)),new tt(30,new B(8,23),new B(26,24)),new tt(30,new B(12,15),new B(28,16))),new Dt(28,Int32Array.from([6,26,50,74,98,122]),new tt(30,new B(3,117),new B(10,118)),new tt(28,new B(3,45),new B(23,46)),new tt(30,new B(4,24),new B(31,25)),new tt(30,new B(11,15),new B(31,16))),new Dt(29,Int32Array.from([6,30,54,78,102,126]),new tt(30,new B(7,116),new B(7,117)),new tt(28,new B(21,45),new B(7,46)),new tt(30,new B(1,23),new B(37,24)),new tt(30,new B(19,15),new B(26,16))),new Dt(30,Int32Array.from([6,26,52,78,104,130]),new tt(30,new B(5,115),new B(10,116)),new tt(28,new B(19,47),new B(10,48)),new tt(30,new B(15,24),new B(25,25)),new tt(30,new B(23,15),new B(25,16))),new Dt(31,Int32Array.from([6,30,56,82,108,134]),new tt(30,new B(13,115),new B(3,116)),new tt(28,new B(2,46),new B(29,47)),new tt(30,new B(42,24),new B(1,25)),new tt(30,new B(23,15),new B(28,16))),new Dt(32,Int32Array.from([6,34,60,86,112,138]),new tt(30,new B(17,115)),new tt(28,new B(10,46),new B(23,47)),new tt(30,new B(10,24),new B(35,25)),new tt(30,new B(19,15),new B(35,16))),new Dt(33,Int32Array.from([6,30,58,86,114,142]),new tt(30,new B(17,115),new B(1,116)),new tt(28,new B(14,46),new B(21,47)),new tt(30,new B(29,24),new B(19,25)),new tt(30,new B(11,15),new B(46,16))),new Dt(34,Int32Array.from([6,34,62,90,118,146]),new tt(30,new B(13,115),new B(6,116)),new tt(28,new B(14,46),new B(23,47)),new tt(30,new B(44,24),new B(7,25)),new tt(30,new B(59,16),new B(1,17))),new Dt(35,Int32Array.from([6,30,54,78,102,126,150]),new tt(30,new B(12,121),new B(7,122)),new tt(28,new B(12,47),new B(26,48)),new tt(30,new B(39,24),new B(14,25)),new tt(30,new B(22,15),new B(41,16))),new Dt(36,Int32Array.from([6,24,50,76,102,128,154]),new tt(30,new B(6,121),new B(14,122)),new tt(28,new B(6,47),new B(34,48)),new tt(30,new B(46,24),new B(10,25)),new tt(30,new B(2,15),new B(64,16))),new Dt(37,Int32Array.from([6,28,54,80,106,132,158]),new tt(30,new B(17,122),new B(4,123)),new tt(28,new B(29,46),new B(14,47)),new tt(30,new B(49,24),new B(10,25)),new tt(30,new B(24,15),new B(46,16))),new Dt(38,Int32Array.from([6,32,58,84,110,136,162]),new tt(30,new B(4,122),new B(18,123)),new tt(28,new B(13,46),new B(32,47)),new tt(30,new B(48,24),new B(14,25)),new tt(30,new B(42,15),new B(32,16))),new Dt(39,Int32Array.from([6,26,54,82,110,138,166]),new tt(30,new B(20,117),new B(4,118)),new tt(28,new B(40,47),new B(7,48)),new tt(30,new B(43,24),new B(22,25)),new tt(30,new B(10,15),new B(67,16))),new Dt(40,Int32Array.from([6,30,58,86,114,142,170]),new tt(30,new B(19,118),new B(6,119)),new tt(28,new B(18,47),new B(31,48)),new tt(30,new B(34,24),new B(34,25)),new tt(30,new B(20,15),new B(61,16)))];var oi;(function(T){T[T.DATA_MASK_000=0]="DATA_MASK_000",T[T.DATA_MASK_001=1]="DATA_MASK_001",T[T.DATA_MASK_010=2]="DATA_MASK_010",T[T.DATA_MASK_011=3]="DATA_MASK_011",T[T.DATA_MASK_100=4]="DATA_MASK_100",T[T.DATA_MASK_101=5]="DATA_MASK_101",T[T.DATA_MASK_110=6]="DATA_MASK_110",T[T.DATA_MASK_111=7]="DATA_MASK_111"})(oi||(oi={}));class wi{constructor(i,o){this.value=i,this.isMasked=o}unmaskBitMatrix(i,o){for(let a=0;a<o;a++)for(let h=0;h<o;h++)this.isMasked(a,h)&&i.flip(h,a)}}wi.values=new Map([[oi.DATA_MASK_000,new wi(oi.DATA_MASK_000,(T,i)=>(T+i&1)===0)],[oi.DATA_MASK_001,new wi(oi.DATA_MASK_001,(T,i)=>(T&1)===0)],[oi.DATA_MASK_010,new wi(oi.DATA_MASK_010,(T,i)=>i%3===0)],[oi.DATA_MASK_011,new wi(oi.DATA_MASK_011,(T,i)=>(T+i)%3===0)],[oi.DATA_MASK_100,new wi(oi.DATA_MASK_100,(T,i)=>(Math.floor(T/2)+Math.floor(i/3)&1)===0)],[oi.DATA_MASK_101,new wi(oi.DATA_MASK_101,(T,i)=>T*i%6===0)],[oi.DATA_MASK_110,new wi(oi.DATA_MASK_110,(T,i)=>T*i%6<3)],[oi.DATA_MASK_111,new wi(oi.DATA_MASK_111,(T,i)=>(T+i+T*i%3&1)===0)]]);class zo{constructor(i){const o=i.getHeight();if(o<21||(o&3)!==1)throw new K;this.bitMatrix=i}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let i=0;for(let c=0;c<6;c++)i=this.copyBit(c,8,i);i=this.copyBit(7,8,i),i=this.copyBit(8,8,i),i=this.copyBit(8,7,i);for(let c=5;c>=0;c--)i=this.copyBit(8,c,i);const o=this.bitMatrix.getHeight();let a=0;const h=o-7;for(let c=o-1;c>=h;c--)a=this.copyBit(8,c,a);for(let c=o-8;c<o;c++)a=this.copyBit(c,8,a);if(this.parsedFormatInfo=mi.decodeFormatInformation(i,a),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new K}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const i=this.bitMatrix.getHeight(),o=Math.floor((i-17)/4);if(o<=6)return Dt.getVersionForNumber(o);let a=0;const h=i-11;for(let d=5;d>=0;d--)for(let x=i-9;x>=h;x--)a=this.copyBit(x,d,a);let c=Dt.decodeVersionInformation(a);if(c!==null&&c.getDimensionForVersion()===i)return this.parsedVersion=c,c;a=0;for(let d=5;d>=0;d--)for(let x=i-9;x>=h;x--)a=this.copyBit(d,x,a);if(c=Dt.decodeVersionInformation(a),c!==null&&c.getDimensionForVersion()===i)return this.parsedVersion=c,c;throw new K}copyBit(i,o,a){return(this.isMirror?this.bitMatrix.get(o,i):this.bitMatrix.get(i,o))?a<<1|1:a<<1}readCodewords(){const i=this.readFormatInformation(),o=this.readVersion(),a=wi.values.get(i.getDataMask()),h=this.bitMatrix.getHeight();a.unmaskBitMatrix(this.bitMatrix,h);const c=o.buildFunctionPattern();let d=!0;const x=new Uint8Array(o.getTotalCodewords());let _=0,C=0,M=0;for(let R=h-1;R>0;R-=2){R===6&&R--;for(let L=0;L<h;L++){const k=d?h-1-L:L;for(let V=0;V<2;V++)c.get(R-V,k)||(M++,C<<=1,this.bitMatrix.get(R-V,k)&&(C|=1),M===8&&(x[_++]=C,M=0,C=0))}d=!d}if(_!==o.getTotalCodewords())throw new K;return x}remask(){if(this.parsedFormatInfo===null)return;const i=wi.values[this.parsedFormatInfo.getDataMask()],o=this.bitMatrix.getHeight();i.unmaskBitMatrix(this.bitMatrix,o)}setMirror(i){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=i}mirror(){const i=this.bitMatrix;for(let o=0,a=i.getWidth();o<a;o++)for(let h=o+1,c=i.getHeight();h<c;h++)i.get(o,h)!==i.get(h,o)&&(i.flip(h,o),i.flip(o,h))}}class bi{constructor(i,o){this.numDataCodewords=i,this.codewords=o}static getDataBlocks(i,o,a){if(i.length!==o.getTotalCodewords())throw new A;const h=o.getECBlocksForLevel(a);let c=0;const d=h.getECBlocks();for(const V of d)c+=V.getCount();const x=new Array(c);let _=0;for(const V of d)for(let H=0;H<V.getCount();H++){const $=V.getDataCodewords(),nt=h.getECCodewordsPerBlock()+$;x[_++]=new bi($,new Uint8Array(nt))}const C=x[0].codewords.length;let M=x.length-1;for(;M>=0&&x[M].codewords.length!==C;)M--;M++;const R=C-h.getECCodewordsPerBlock();let L=0;for(let V=0;V<R;V++)for(let H=0;H<_;H++)x[H].codewords[V]=i[L++];for(let V=M;V<_;V++)x[V].codewords[R]=i[L++];const k=x[0].codewords.length;for(let V=R;V<k;V++)for(let H=0;H<_;H++){const $=H<M?V:V+1;x[H].codewords[$]=i[L++]}return x}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var Ui;(function(T){T[T.TERMINATOR=0]="TERMINATOR",T[T.NUMERIC=1]="NUMERIC",T[T.ALPHANUMERIC=2]="ALPHANUMERIC",T[T.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",T[T.BYTE=4]="BYTE",T[T.ECI=5]="ECI",T[T.KANJI=6]="KANJI",T[T.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",T[T.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",T[T.HANZI=9]="HANZI"})(Ui||(Ui={}));class Pt{constructor(i,o,a,h){this.value=i,this.stringValue=o,this.characterCountBitsForVersions=a,this.bits=h,Pt.FOR_BITS.set(h,this),Pt.FOR_VALUE.set(i,this)}static forBits(i){const o=Pt.FOR_BITS.get(i);if(o===void 0)throw new A;return o}getCharacterCountBits(i){const o=i.getVersionNumber();let a;return o<=9?a=0:o<=26?a=1:a=2,this.characterCountBitsForVersions[a]}getValue(){return this.value}getBits(){return this.bits}equals(i){if(!(i instanceof Pt))return!1;const o=i;return this.value===o.value}toString(){return this.stringValue}}Pt.FOR_BITS=new Map,Pt.FOR_VALUE=new Map,Pt.TERMINATOR=new Pt(Ui.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Pt.NUMERIC=new Pt(Ui.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Pt.ALPHANUMERIC=new Pt(Ui.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Pt.STRUCTURED_APPEND=new Pt(Ui.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Pt.BYTE=new Pt(Ui.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Pt.ECI=new Pt(Ui.ECI,"ECI",Int32Array.from([0,0,0]),7),Pt.KANJI=new Pt(Ui.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Pt.FNC1_FIRST_POSITION=new Pt(Ui.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Pt.FNC1_SECOND_POSITION=new Pt(Ui.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Pt.HANZI=new Pt(Ui.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class De{static decode(i,o,a,h){const c=new cr(i);let d=new yt;const x=new Array;let _=-1,C=-1;try{let M=null,R=!1,L;do{if(c.available()<4)L=Pt.TERMINATOR;else{const k=c.readBits(4);L=Pt.forBits(k)}switch(L){case Pt.TERMINATOR:break;case Pt.FNC1_FIRST_POSITION:case Pt.FNC1_SECOND_POSITION:R=!0;break;case Pt.STRUCTURED_APPEND:if(c.available()<16)throw new K;_=c.readBits(8),C=c.readBits(8);break;case Pt.ECI:const k=De.parseECIValue(c);if(M=Z.getCharacterSetECIByValue(k),M===null)throw new K;break;case Pt.HANZI:const V=c.readBits(4),H=c.readBits(L.getCharacterCountBits(o));V===De.GB2312_SUBSET&&De.decodeHanziSegment(c,d,H);break;default:const $=c.readBits(L.getCharacterCountBits(o));switch(L){case Pt.NUMERIC:De.decodeNumericSegment(c,d,$);break;case Pt.ALPHANUMERIC:De.decodeAlphanumericSegment(c,d,$,R);break;case Pt.BYTE:De.decodeByteSegment(c,d,$,M,x,h);break;case Pt.KANJI:De.decodeKanjiSegment(c,d,$);break;default:throw new K}break}}while(L!==Pt.TERMINATOR)}catch{throw new K}return new fi(i,d.toString(),x.length===0?null:x,a===null?null:a.toString(),_,C)}static decodeHanziSegment(i,o,a){if(a*13>i.available())throw new K;const h=new Uint8Array(2*a);let c=0;for(;a>0;){const d=i.readBits(13);let x=d/96<<8&4294967295|d%96;x<959?x+=41377:x+=42657,h[c]=x>>8&255,h[c+1]=x&255,c+=2,a--}try{o.append(St.decode(h,ut.GB2312))}catch(d){throw new K(d)}}static decodeKanjiSegment(i,o,a){if(a*13>i.available())throw new K;const h=new Uint8Array(2*a);let c=0;for(;a>0;){const d=i.readBits(13);let x=d/192<<8&4294967295|d%192;x<7936?x+=33088:x+=49472,h[c]=x>>8,h[c+1]=x,c+=2,a--}try{o.append(St.decode(h,ut.SHIFT_JIS))}catch(d){throw new K(d)}}static decodeByteSegment(i,o,a,h,c,d){if(8*a>i.available())throw new K;const x=new Uint8Array(a);for(let C=0;C<a;C++)x[C]=i.readBits(8);let _;h===null?_=ut.guessEncoding(x,d):_=h.getName();try{o.append(St.decode(x,_))}catch(C){throw new K(C)}c.push(x)}static toAlphaNumericChar(i){if(i>=De.ALPHANUMERIC_CHARS.length)throw new K;return De.ALPHANUMERIC_CHARS[i]}static decodeAlphanumericSegment(i,o,a,h){const c=o.length();for(;a>1;){if(i.available()<11)throw new K;const d=i.readBits(11);o.append(De.toAlphaNumericChar(Math.floor(d/45))),o.append(De.toAlphaNumericChar(d%45)),a-=2}if(a===1){if(i.available()<6)throw new K;o.append(De.toAlphaNumericChar(i.readBits(6)))}if(h)for(let d=c;d<o.length();d++)o.charAt(d)==="%"&&(d<o.length()-1&&o.charAt(d+1)==="%"?o.deleteCharAt(d+1):o.setCharAt(d,""))}static decodeNumericSegment(i,o,a){for(;a>=3;){if(i.available()<10)throw new K;const h=i.readBits(10);if(h>=1e3)throw new K;o.append(De.toAlphaNumericChar(Math.floor(h/100))),o.append(De.toAlphaNumericChar(Math.floor(h/10)%10)),o.append(De.toAlphaNumericChar(h%10)),a-=3}if(a===2){if(i.available()<7)throw new K;const h=i.readBits(7);if(h>=100)throw new K;o.append(De.toAlphaNumericChar(Math.floor(h/10))),o.append(De.toAlphaNumericChar(h%10))}else if(a===1){if(i.available()<4)throw new K;const h=i.readBits(4);if(h>=10)throw new K;o.append(De.toAlphaNumericChar(h))}}static parseECIValue(i){const o=i.readBits(8);if(!(o&128))return o&127;if((o&192)===128){const a=i.readBits(8);return(o&63)<<8&4294967295|a}if((o&224)===192){const a=i.readBits(16);return(o&31)<<16&4294967295|a}throw new K}}De.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",De.GB2312_SUBSET=1;class jo{constructor(i){this.mirrored=i}isMirrored(){return this.mirrored}applyMirroredCorrection(i){if(!this.mirrored||i===null||i.length<3)return;const o=i[0];i[0]=i[2],i[2]=o}}class hl{constructor(){this.rsDecoder=new _i(ie.QR_CODE_FIELD_256)}decodeBooleanArray(i,o){return this.decodeBitMatrix(Nt.parseFromBooleanArray(i),o)}decodeBitMatrix(i,o){const a=new zo(i);let h=null;try{return this.decodeBitMatrixParser(a,o)}catch(c){h=c}try{a.remask(),a.setMirror(!0),a.readVersion(),a.readFormatInformation(),a.mirror();const c=this.decodeBitMatrixParser(a,o);return c.setOther(new jo(!0)),c}catch(c){throw h!==null?h:c}}decodeBitMatrixParser(i,o){const a=i.readVersion(),h=i.readFormatInformation().getErrorCorrectionLevel(),c=i.readCodewords(),d=bi.getDataBlocks(c,a,h);let x=0;for(const M of d)x+=M.getNumDataCodewords();const _=new Uint8Array(x);let C=0;for(const M of d){const R=M.getCodewords(),L=M.getNumDataCodewords();this.correctErrors(R,L);for(let k=0;k<L;k++)_[C++]=R[k]}return De.decode(_,a,h,o)}correctErrors(i,o){const a=new Int32Array(i);try{this.rsDecoder.decode(a,i.length-o)}catch{throw new D}for(let h=0;h<o;h++)i[h]=a[h]}}class ur extends Mt{constructor(i,o,a){super(i,o),this.estimatedModuleSize=a}aboutEquals(i,o,a){if(Math.abs(o-this.getY())<=i&&Math.abs(a-this.getX())<=i){const h=Math.abs(i-this.estimatedModuleSize);return h<=1||h<=this.estimatedModuleSize}return!1}combineEstimate(i,o,a){const h=(this.getX()+o)/2,c=(this.getY()+i)/2,d=(this.estimatedModuleSize+a)/2;return new ur(h,c,d)}}class Yn{constructor(i,o,a,h,c,d,x){this.image=i,this.startX=o,this.startY=a,this.width=h,this.height=c,this.moduleSize=d,this.resultPointCallback=x,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const i=this.startX,o=this.height,a=this.width,h=i+a,c=this.startY+o/2,d=new Int32Array(3),x=this.image;for(let _=0;_<o;_++){const C=c+(_&1?-Math.floor((_+1)/2):Math.floor((_+1)/2));d[0]=0,d[1]=0,d[2]=0;let M=i;for(;M<h&&!x.get(M,C);)M++;let R=0;for(;M<h;){if(x.get(M,C))if(R===1)d[1]++;else if(R===2){if(this.foundPatternCross(d)){const L=this.handlePossibleCenter(d,C,M);if(L!==null)return L}d[0]=d[2],d[1]=1,d[2]=0,R=1}else d[++R]++;else R===1&&R++,d[R]++;M++}if(this.foundPatternCross(d)){const L=this.handlePossibleCenter(d,C,h);if(L!==null)return L}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new J}static centerFromEnd(i,o){return o-i[2]-i[1]/2}foundPatternCross(i){const o=this.moduleSize,a=o/2;for(let h=0;h<3;h++)if(Math.abs(o-i[h])>=a)return!1;return!0}crossCheckVertical(i,o,a,h){const c=this.image,d=c.getHeight(),x=this.crossCheckStateCount;x[0]=0,x[1]=0,x[2]=0;let _=i;for(;_>=0&&c.get(o,_)&&x[1]<=a;)x[1]++,_--;if(_<0||x[1]>a)return NaN;for(;_>=0&&!c.get(o,_)&&x[0]<=a;)x[0]++,_--;if(x[0]>a)return NaN;for(_=i+1;_<d&&c.get(o,_)&&x[1]<=a;)x[1]++,_++;if(_===d||x[1]>a)return NaN;for(;_<d&&!c.get(o,_)&&x[2]<=a;)x[2]++,_++;if(x[2]>a)return NaN;const C=x[0]+x[1]+x[2];return 5*Math.abs(C-h)>=2*h?NaN:this.foundPatternCross(x)?Yn.centerFromEnd(x,_):NaN}handlePossibleCenter(i,o,a){const h=i[0]+i[1]+i[2],c=Yn.centerFromEnd(i,a),d=this.crossCheckVertical(o,c,2*i[1],h);if(!isNaN(d)){const x=(i[0]+i[1]+i[2])/3;for(const C of this.possibleCenters)if(C.aboutEquals(x,d,c))return C.combineEstimate(d,c,x);const _=new ur(c,d,x);this.possibleCenters.push(_),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(_)}return null}}class Zr extends Mt{constructor(i,o,a,h){super(i,o),this.estimatedModuleSize=a,this.count=h,h===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(i,o,a){if(Math.abs(o-this.getY())<=i&&Math.abs(a-this.getX())<=i){const h=Math.abs(i-this.estimatedModuleSize);return h<=1||h<=this.estimatedModuleSize}return!1}combineEstimate(i,o,a){const h=this.count+1,c=(this.count*this.getX()+o)/h,d=(this.count*this.getY()+i)/h,x=(this.count*this.estimatedModuleSize+a)/h;return new Zr(c,d,x,h)}}class cl{constructor(i){this.bottomLeft=i[0],this.topLeft=i[1],this.topRight=i[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Qe{constructor(i,o){this.image=i,this.resultPointCallback=o,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=o}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(i){const o=i!=null&&i.get(rt.TRY_HARDER)!==void 0,a=i!=null&&i.get(rt.PURE_BARCODE)!==void 0,h=this.image,c=h.getHeight(),d=h.getWidth();let x=Math.floor(3*c/(4*Qe.MAX_MODULES));(x<Qe.MIN_SKIP||o)&&(x=Qe.MIN_SKIP);let _=!1;const C=new Int32Array(5);for(let R=x-1;R<c&&!_;R+=x){C[0]=0,C[1]=0,C[2]=0,C[3]=0,C[4]=0;let L=0;for(let k=0;k<d;k++)if(h.get(k,R))(L&1)===1&&L++,C[L]++;else if(L&1)C[L]++;else if(L===4)if(Qe.foundPatternCross(C)){if(this.handlePossibleCenter(C,R,k,a)===!0)if(x=2,this.hasSkipped===!0)_=this.haveMultiplyConfirmedCenters();else{const H=this.findRowSkip();H>C[2]&&(R+=H-C[2]-x,k=d-1)}else{C[0]=C[2],C[1]=C[3],C[2]=C[4],C[3]=1,C[4]=0,L=3;continue}L=0,C[0]=0,C[1]=0,C[2]=0,C[3]=0,C[4]=0}else C[0]=C[2],C[1]=C[3],C[2]=C[4],C[3]=1,C[4]=0,L=3;else C[++L]++;Qe.foundPatternCross(C)&&this.handlePossibleCenter(C,R,d,a)===!0&&(x=C[0],this.hasSkipped&&(_=this.haveMultiplyConfirmedCenters()))}const M=this.selectBestPatterns();return Mt.orderBestPatterns(M),new cl(M)}static centerFromEnd(i,o){return o-i[4]-i[3]-i[2]/2}static foundPatternCross(i){let o=0;for(let c=0;c<5;c++){const d=i[c];if(d===0)return!1;o+=d}if(o<7)return!1;const a=o/7,h=a/2;return Math.abs(a-i[0])<h&&Math.abs(a-i[1])<h&&Math.abs(3*a-i[2])<3*h&&Math.abs(a-i[3])<h&&Math.abs(a-i[4])<h}getCrossCheckStateCount(){const i=this.crossCheckStateCount;return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i}crossCheckDiagonal(i,o,a,h){const c=this.getCrossCheckStateCount();let d=0;const x=this.image;for(;i>=d&&o>=d&&x.get(o-d,i-d);)c[2]++,d++;if(i<d||o<d)return!1;for(;i>=d&&o>=d&&!x.get(o-d,i-d)&&c[1]<=a;)c[1]++,d++;if(i<d||o<d||c[1]>a)return!1;for(;i>=d&&o>=d&&x.get(o-d,i-d)&&c[0]<=a;)c[0]++,d++;if(c[0]>a)return!1;const _=x.getHeight(),C=x.getWidth();for(d=1;i+d<_&&o+d<C&&x.get(o+d,i+d);)c[2]++,d++;if(i+d>=_||o+d>=C)return!1;for(;i+d<_&&o+d<C&&!x.get(o+d,i+d)&&c[3]<a;)c[3]++,d++;if(i+d>=_||o+d>=C||c[3]>=a)return!1;for(;i+d<_&&o+d<C&&x.get(o+d,i+d)&&c[4]<a;)c[4]++,d++;if(c[4]>=a)return!1;const M=c[0]+c[1]+c[2]+c[3]+c[4];return Math.abs(M-h)<2*h&&Qe.foundPatternCross(c)}crossCheckVertical(i,o,a,h){const c=this.image,d=c.getHeight(),x=this.getCrossCheckStateCount();let _=i;for(;_>=0&&c.get(o,_);)x[2]++,_--;if(_<0)return NaN;for(;_>=0&&!c.get(o,_)&&x[1]<=a;)x[1]++,_--;if(_<0||x[1]>a)return NaN;for(;_>=0&&c.get(o,_)&&x[0]<=a;)x[0]++,_--;if(x[0]>a)return NaN;for(_=i+1;_<d&&c.get(o,_);)x[2]++,_++;if(_===d)return NaN;for(;_<d&&!c.get(o,_)&&x[3]<a;)x[3]++,_++;if(_===d||x[3]>=a)return NaN;for(;_<d&&c.get(o,_)&&x[4]<a;)x[4]++,_++;if(x[4]>=a)return NaN;const C=x[0]+x[1]+x[2]+x[3]+x[4];return 5*Math.abs(C-h)>=2*h?NaN:Qe.foundPatternCross(x)?Qe.centerFromEnd(x,_):NaN}crossCheckHorizontal(i,o,a,h){const c=this.image,d=c.getWidth(),x=this.getCrossCheckStateCount();let _=i;for(;_>=0&&c.get(_,o);)x[2]++,_--;if(_<0)return NaN;for(;_>=0&&!c.get(_,o)&&x[1]<=a;)x[1]++,_--;if(_<0||x[1]>a)return NaN;for(;_>=0&&c.get(_,o)&&x[0]<=a;)x[0]++,_--;if(x[0]>a)return NaN;for(_=i+1;_<d&&c.get(_,o);)x[2]++,_++;if(_===d)return NaN;for(;_<d&&!c.get(_,o)&&x[3]<a;)x[3]++,_++;if(_===d||x[3]>=a)return NaN;for(;_<d&&c.get(_,o)&&x[4]<a;)x[4]++,_++;if(x[4]>=a)return NaN;const C=x[0]+x[1]+x[2]+x[3]+x[4];return 5*Math.abs(C-h)>=h?NaN:Qe.foundPatternCross(x)?Qe.centerFromEnd(x,_):NaN}handlePossibleCenter(i,o,a,h){const c=i[0]+i[1]+i[2]+i[3]+i[4];let d=Qe.centerFromEnd(i,a),x=this.crossCheckVertical(o,Math.floor(d),i[2],c);if(!isNaN(x)&&(d=this.crossCheckHorizontal(Math.floor(d),Math.floor(x),i[2],c),!isNaN(d)&&(!h||this.crossCheckDiagonal(Math.floor(x),Math.floor(d),i[2],c)))){const _=c/7;let C=!1;const M=this.possibleCenters;for(let R=0,L=M.length;R<L;R++){const k=M[R];if(k.aboutEquals(_,x,d)){M[R]=k.combineEstimate(x,d,_),C=!0;break}}if(!C){const R=new Zr(d,x,_);M.push(R),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(R)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let o=null;for(const a of this.possibleCenters)if(a.getCount()>=Qe.CENTER_QUORUM)if(o==null)o=a;else return this.hasSkipped=!0,Math.floor((Math.abs(o.getX()-a.getX())-Math.abs(o.getY()-a.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let i=0,o=0;const a=this.possibleCenters.length;for(const d of this.possibleCenters)d.getCount()>=Qe.CENTER_QUORUM&&(i++,o+=d.getEstimatedModuleSize());if(i<3)return!1;const h=o/a;let c=0;for(const d of this.possibleCenters)c+=Math.abs(d.getEstimatedModuleSize()-h);return c<=.05*o}selectBestPatterns(){const i=this.possibleCenters.length;if(i<3)throw new J;const o=this.possibleCenters;let a;if(i>3){let h=0,c=0;for(const _ of this.possibleCenters){const C=_.getEstimatedModuleSize();h+=C,c+=C*C}a=h/i;let d=Math.sqrt(c/i-a*a);o.sort((_,C)=>{const M=Math.abs(C.getEstimatedModuleSize()-a),R=Math.abs(_.getEstimatedModuleSize()-a);return M<R?-1:M>R?1:0});const x=Math.max(.2*a,d);for(let _=0;_<o.length&&o.length>3;_++){const C=o[_];Math.abs(C.getEstimatedModuleSize()-a)>x&&(o.splice(_,1),_--)}}if(o.length>3){let h=0;for(const c of o)h+=c.getEstimatedModuleSize();a=h/o.length,o.sort((c,d)=>{if(d.getCount()===c.getCount()){const x=Math.abs(d.getEstimatedModuleSize()-a),_=Math.abs(c.getEstimatedModuleSize()-a);return x<_?1:x>_?-1:0}else return d.getCount()-c.getCount()}),o.splice(3)}return[o[0],o[1],o[2]]}}Qe.CENTER_QUORUM=2,Qe.MIN_SKIP=3,Qe.MAX_MODULES=57;class Gs{constructor(i){this.image=i}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(i){this.resultPointCallback=i==null?null:i.get(rt.NEED_RESULT_POINT_CALLBACK);const a=new Qe(this.image,this.resultPointCallback).find(i);return this.processFinderPatternInfo(a)}processFinderPatternInfo(i){const o=i.getTopLeft(),a=i.getTopRight(),h=i.getBottomLeft(),c=this.calculateModuleSize(o,a,h);if(c<1)throw new J("No pattern found in proccess finder.");const d=Gs.computeDimension(o,a,h,c),x=Dt.getProvisionalVersionForDimension(d),_=x.getDimensionForVersion()-7;let C=null;if(x.getAlignmentPatternCenters().length>0){const k=a.getX()-o.getX()+h.getX(),V=a.getY()-o.getY()+h.getY(),H=1-3/_,$=Math.floor(o.getX()+H*(k-o.getX())),nt=Math.floor(o.getY()+H*(V-o.getY()));for(let xt=4;xt<=16;xt<<=1)try{C=this.findAlignmentInRegion(c,$,nt,xt);break}catch(_t){if(!(_t instanceof J))throw _t}}const M=Gs.createTransform(o,a,h,C,d),R=Gs.sampleGrid(this.image,M,d);let L;return C===null?L=[h,o,a]:L=[h,o,a,C],new yi(R,L)}static createTransform(i,o,a,h,c){const d=c-3.5;let x,_,C,M;return h!==null?(x=h.getX(),_=h.getY(),C=d-3,M=C):(x=o.getX()-i.getX()+a.getX(),_=o.getY()-i.getY()+a.getY(),C=d,M=d),ni.quadrilateralToQuadrilateral(3.5,3.5,d,3.5,C,M,3.5,d,i.getX(),i.getY(),o.getX(),o.getY(),x,_,a.getX(),a.getY())}static sampleGrid(i,o,a){return Ke.getInstance().sampleGridWithTransform(i,a,a,o)}static computeDimension(i,o,a,h){const c=te.round(Mt.distance(i,o)/h),d=te.round(Mt.distance(i,a)/h);let x=Math.floor((c+d)/2)+7;switch(x&3){case 0:x++;break;case 2:x--;break;case 3:throw new J("Dimensions could be not found.")}return x}calculateModuleSize(i,o,a){return(this.calculateModuleSizeOneWay(i,o)+this.calculateModuleSizeOneWay(i,a))/2}calculateModuleSizeOneWay(i,o){const a=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(i.getX()),Math.floor(i.getY()),Math.floor(o.getX()),Math.floor(o.getY())),h=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(o.getX()),Math.floor(o.getY()),Math.floor(i.getX()),Math.floor(i.getY()));return isNaN(a)?h/7:isNaN(h)?a/7:(a+h)/14}sizeOfBlackWhiteBlackRunBothWays(i,o,a,h){let c=this.sizeOfBlackWhiteBlackRun(i,o,a,h),d=1,x=i-(a-i);x<0?(d=i/(i-x),x=0):x>=this.image.getWidth()&&(d=(this.image.getWidth()-1-i)/(x-i),x=this.image.getWidth()-1);let _=Math.floor(o-(h-o)*d);return d=1,_<0?(d=o/(o-_),_=0):_>=this.image.getHeight()&&(d=(this.image.getHeight()-1-o)/(_-o),_=this.image.getHeight()-1),x=Math.floor(i+(x-i)*d),c+=this.sizeOfBlackWhiteBlackRun(i,o,x,_),c-1}sizeOfBlackWhiteBlackRun(i,o,a,h){const c=Math.abs(h-o)>Math.abs(a-i);if(c){let k=i;i=o,o=k,k=a,a=h,h=k}const d=Math.abs(a-i),x=Math.abs(h-o);let _=-d/2;const C=i<a?1:-1,M=o<h?1:-1;let R=0;const L=a+C;for(let k=i,V=o;k!==L;k+=C){const H=c?V:k,$=c?k:V;if(R===1===this.image.get(H,$)){if(R===2)return te.distance(k,V,i,o);R++}if(_+=x,_>0){if(V===h)break;V+=M,_-=d}}return R===2?te.distance(a+C,h,i,o):NaN}findAlignmentInRegion(i,o,a,h){const c=Math.floor(h*i),d=Math.max(0,o-c),x=Math.min(this.image.getWidth()-1,o+c);if(x-d<i*3)throw new J("Alignment top exceeds estimated module size.");const _=Math.max(0,a-c),C=Math.min(this.image.getHeight()-1,a+c);if(C-_<i*3)throw new J("Alignment bottom exceeds estimated module size.");return new Yn(this.image,d,_,x-d,C-_,i,this.resultPointCallback).find()}}class un{constructor(){this.decoder=new hl}getDecoder(){return this.decoder}decode(i,o){let a,h;if(o!=null&&o.get(rt.PURE_BARCODE)!==void 0){const _=un.extractPureBits(i.getBlackMatrix());a=this.decoder.decodeBitMatrix(_,o),h=un.NO_POINTS}else{const _=new Gs(i.getBlackMatrix()).detect(o);a=this.decoder.decodeBitMatrix(_.getBits(),o),h=_.getPoints()}a.getOther()instanceof jo&&a.getOther().applyMirroredCorrection(h);const c=new ft(a.getText(),a.getRawBytes(),void 0,h,Tt.QR_CODE,void 0),d=a.getByteSegments();d!==null&&c.putMetadata(_e.BYTE_SEGMENTS,d);const x=a.getECLevel();return x!==null&&c.putMetadata(_e.ERROR_CORRECTION_LEVEL,x),a.hasStructuredAppend()&&(c.putMetadata(_e.STRUCTURED_APPEND_SEQUENCE,a.getStructuredAppendSequenceNumber()),c.putMetadata(_e.STRUCTURED_APPEND_PARITY,a.getStructuredAppendParity())),c}reset(){}static extractPureBits(i){const o=i.getTopLeftOnBit(),a=i.getBottomRightOnBit();if(o===null||a===null)throw new J;const h=this.moduleSize(o,i);let c=o[1],d=a[1],x=o[0],_=a[0];if(x>=_||c>=d)throw new J;if(d-c!==_-x&&(_=x+(d-c),_>=i.getWidth()))throw new J;const C=Math.round((_-x+1)/h),M=Math.round((d-c+1)/h);if(C<=0||M<=0)throw new J;if(M!==C)throw new J;const R=Math.floor(h/2);c+=R,x+=R;const L=x+Math.floor((C-1)*h)-_;if(L>0){if(L>R)throw new J;x-=L}const k=c+Math.floor((M-1)*h)-d;if(k>0){if(k>R)throw new J;c-=k}const V=new Nt(C,M);for(let H=0;H<M;H++){const $=c+Math.floor(H*h);for(let nt=0;nt<C;nt++)i.get(x+Math.floor(nt*h),$)&&V.set(nt,H)}return V}static moduleSize(i,o){const a=o.getHeight(),h=o.getWidth();let c=i[0],d=i[1],x=!0,_=0;for(;c<h&&d<a;){if(x!==o.get(c,d)){if(++_===5)break;x=!x}c++,d++}if(c===h||d===a)throw new J;return(c-i[0])/7}}un.NO_POINTS=new Array;class Gt{PDF417Common(){}static getBitCountSum(i){return te.sum(i)}static toIntArray(i){if(i==null||!i.length)return Gt.EMPTY_INT_ARRAY;const o=new Int32Array(i.length);let a=0;for(const h of i)o[a++]=h;return o}static getCodeword(i){const o=G.binarySearch(Gt.SYMBOL_TABLE,i&262143);return o<0?-1:(Gt.CODEWORD_TABLE[o]-1)%Gt.NUMBER_OF_CODEWORDS}}Gt.NUMBER_OF_CODEWORDS=929,Gt.MAX_CODEWORDS_IN_BARCODE=Gt.NUMBER_OF_CODEWORDS-1,Gt.MIN_ROWS_IN_BARCODE=3,Gt.MAX_ROWS_IN_BARCODE=90,Gt.MODULES_IN_CODEWORD=17,Gt.MODULES_IN_STOP_PATTERN=18,Gt.BARS_IN_MODULE=8,Gt.EMPTY_INT_ARRAY=new Int32Array([]),Gt.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Gt.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class ul{constructor(i,o){this.bits=i,this.points=o}getBits(){return this.bits}getPoints(){return this.points}}class Zt{static detectMultiple(i,o,a){let h=i.getBlackMatrix(),c=Zt.detect(a,h);return c.length||(h=h.clone(),h.rotate180(),c=Zt.detect(a,h)),new ul(h,c)}static detect(i,o){const a=new Array;let h=0,c=0,d=!1;for(;h<o.getHeight();){const x=Zt.findVertices(o,h,c);if(x[0]==null&&x[3]==null){if(!d)break;d=!1,c=0;for(const _ of a)_[1]!=null&&(h=Math.trunc(Math.max(h,_[1].getY()))),_[3]!=null&&(h=Math.max(h,Math.trunc(_[3].getY())));h+=Zt.ROW_STEP;continue}if(d=!0,a.push(x),!i)break;x[2]!=null?(c=Math.trunc(x[2].getX()),h=Math.trunc(x[2].getY())):(c=Math.trunc(x[4].getX()),h=Math.trunc(x[4].getY()))}return a}static findVertices(i,o,a){const h=i.getHeight(),c=i.getWidth(),d=new Array(8);return Zt.copyToResult(d,Zt.findRowsWithPattern(i,h,c,o,a,Zt.START_PATTERN),Zt.INDEXES_START_PATTERN),d[4]!=null&&(a=Math.trunc(d[4].getX()),o=Math.trunc(d[4].getY())),Zt.copyToResult(d,Zt.findRowsWithPattern(i,h,c,o,a,Zt.STOP_PATTERN),Zt.INDEXES_STOP_PATTERN),d}static copyToResult(i,o,a){for(let h=0;h<a.length;h++)i[a[h]]=o[h]}static findRowsWithPattern(i,o,a,h,c,d){const x=new Array(4);let _=!1;const C=new Int32Array(d.length);for(;h<o;h+=Zt.ROW_STEP){let R=Zt.findGuardPattern(i,c,h,a,!1,d,C);if(R!=null){for(;h>0;){const L=Zt.findGuardPattern(i,c,--h,a,!1,d,C);if(L!=null)R=L;else{h++;break}}x[0]=new Mt(R[0],h),x[1]=new Mt(R[1],h),_=!0;break}}let M=h+1;if(_){let R=0,L=Int32Array.from([Math.trunc(x[0].getX()),Math.trunc(x[1].getX())]);for(;M<o;M++){const k=Zt.findGuardPattern(i,L[0],M,a,!1,d,C);if(k!=null&&Math.abs(L[0]-k[0])<Zt.MAX_PATTERN_DRIFT&&Math.abs(L[1]-k[1])<Zt.MAX_PATTERN_DRIFT)L=k,R=0;else{if(R>Zt.SKIPPED_ROW_COUNT_MAX)break;R++}}M-=R+1,x[2]=new Mt(L[0],M),x[3]=new Mt(L[1],M)}return M-h<Zt.BARCODE_MIN_HEIGHT&&G.fill(x,null),x}static findGuardPattern(i,o,a,h,c,d,x){G.fillWithin(x,0,x.length,0);let _=o,C=0;for(;i.get(_,a)&&_>0&&C++<Zt.MAX_PIXEL_DRIFT;)_--;let M=_,R=0,L=d.length;for(let k=c;M<h;M++)if(i.get(M,a)!==k)x[R]++;else{if(R===L-1){if(Zt.patternMatchVariance(x,d,Zt.MAX_INDIVIDUAL_VARIANCE)<Zt.MAX_AVG_VARIANCE)return new Int32Array([_,M]);_+=x[0]+x[1],F.arraycopy(x,2,x,0,R-1),x[R-1]=0,x[R]=0,R--}else R++;x[R]=1,k=!k}return R===L-1&&Zt.patternMatchVariance(x,d,Zt.MAX_INDIVIDUAL_VARIANCE)<Zt.MAX_AVG_VARIANCE?new Int32Array([_,M-1]):null}static patternMatchVariance(i,o,a){let h=i.length,c=0,d=0;for(let C=0;C<h;C++)c+=i[C],d+=o[C];if(c<d)return 1/0;let x=c/d;a*=x;let _=0;for(let C=0;C<h;C++){let M=i[C],R=o[C]*x,L=M>R?M-R:R-M;if(L>a)return 1/0;_+=L}return _/c}}Zt.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Zt.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Zt.MAX_AVG_VARIANCE=.42,Zt.MAX_INDIVIDUAL_VARIANCE=.8,Zt.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Zt.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Zt.MAX_PIXEL_DRIFT=3,Zt.MAX_PATTERN_DRIFT=5,Zt.SKIPPED_ROW_COUNT_MAX=25,Zt.ROW_STEP=5,Zt.BARCODE_MIN_HEIGHT=10;class je{constructor(i,o){if(o.length===0)throw new A;this.field=i;let a=o.length;if(a>1&&o[0]===0){let h=1;for(;h<a&&o[h]===0;)h++;h===a?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(a-h),F.arraycopy(o,h,this.coefficients,0,this.coefficients.length))}else this.coefficients=o}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(i){return this.coefficients[this.coefficients.length-1-i]}evaluateAt(i){if(i===0)return this.getCoefficient(0);if(i===1){let h=0;for(let c of this.coefficients)h=this.field.add(h,c);return h}let o=this.coefficients[0],a=this.coefficients.length;for(let h=1;h<a;h++)o=this.field.add(this.field.multiply(i,o),this.coefficients[h]);return o}add(i){if(!this.field.equals(i.field))throw new A("ModulusPolys do not have same ModulusGF field");if(this.isZero())return i;if(i.isZero())return this;let o=this.coefficients,a=i.coefficients;if(o.length>a.length){let d=o;o=a,a=d}let h=new Int32Array(a.length),c=a.length-o.length;F.arraycopy(a,0,h,0,c);for(let d=c;d<a.length;d++)h[d]=this.field.add(o[d-c],a[d]);return new je(this.field,h)}subtract(i){if(!this.field.equals(i.field))throw new A("ModulusPolys do not have same ModulusGF field");return i.isZero()?this:this.add(i.negative())}multiply(i){return i instanceof je?this.multiplyOther(i):this.multiplyScalar(i)}multiplyOther(i){if(!this.field.equals(i.field))throw new A("ModulusPolys do not have same ModulusGF field");if(this.isZero()||i.isZero())return new je(this.field,new Int32Array([0]));let o=this.coefficients,a=o.length,h=i.coefficients,c=h.length,d=new Int32Array(a+c-1);for(let x=0;x<a;x++){let _=o[x];for(let C=0;C<c;C++)d[x+C]=this.field.add(d[x+C],this.field.multiply(_,h[C]))}return new je(this.field,d)}negative(){let i=this.coefficients.length,o=new Int32Array(i);for(let a=0;a<i;a++)o[a]=this.field.subtract(0,this.coefficients[a]);return new je(this.field,o)}multiplyScalar(i){if(i===0)return new je(this.field,new Int32Array([0]));if(i===1)return this;let o=this.coefficients.length,a=new Int32Array(o);for(let h=0;h<o;h++)a[h]=this.field.multiply(this.coefficients[h],i);return new je(this.field,a)}multiplyByMonomial(i,o){if(i<0)throw new A;if(o===0)return new je(this.field,new Int32Array([0]));let a=this.coefficients.length,h=new Int32Array(a+i);for(let c=0;c<a;c++)h[c]=this.field.multiply(this.coefficients[c],o);return new je(this.field,h)}toString(){let i=new yt;for(let o=this.getDegree();o>=0;o--){let a=this.getCoefficient(o);a!==0&&(a<0?(i.append(" - "),a=-a):i.length()>0&&i.append(" + "),(o===0||a!==1)&&i.append(a),o!==0&&(o===1?i.append("x"):(i.append("x^"),i.append(o))))}return i.toString()}}class fl{add(i,o){return(i+o)%this.modulus}subtract(i,o){return(this.modulus+i-o)%this.modulus}exp(i){return this.expTable[i]}log(i){if(i===0)throw new A;return this.logTable[i]}inverse(i){if(i===0)throw new ze;return this.expTable[this.modulus-this.logTable[i]-1]}multiply(i,o){return i===0||o===0?0:this.expTable[(this.logTable[i]+this.logTable[o])%(this.modulus-1)]}getSize(){return this.modulus}equals(i){return i===this}}class Kr extends fl{constructor(i,o){super(),this.modulus=i,this.expTable=new Int32Array(i),this.logTable=new Int32Array(i);let a=1;for(let h=0;h<i;h++)this.expTable[h]=a,a=a*o%i;for(let h=0;h<i-1;h++)this.logTable[this.expTable[h]]=h;this.zero=new je(this,new Int32Array([0])),this.one=new je(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(i,o){if(i<0)throw new A;if(o===0)return this.zero;let a=new Int32Array(i+1);return a[0]=o,new je(this,a)}}Kr.PDF417_GF=new Kr(Gt.NUMBER_OF_CODEWORDS,3);class Wo{constructor(){this.field=Kr.PDF417_GF}decode(i,o,a){let h=new je(this.field,i),c=new Int32Array(o),d=!1;for(let V=o;V>0;V--){let H=h.evaluateAt(this.field.exp(V));c[o-V]=H,H!==0&&(d=!0)}if(!d)return 0;let x=this.field.getOne();if(a!=null)for(const V of a){let H=this.field.exp(i.length-1-V),$=new je(this.field,new Int32Array([this.field.subtract(0,H),1]));x=x.multiply($)}let _=new je(this.field,c),C=this.runEuclideanAlgorithm(this.field.buildMonomial(o,1),_,o),M=C[0],R=C[1],L=this.findErrorLocations(M),k=this.findErrorMagnitudes(R,M,L);for(let V=0;V<L.length;V++){let H=i.length-1-this.field.log(L[V]);if(H<0)throw D.getChecksumInstance();i[H]=this.field.subtract(i[H],k[V])}return L.length}runEuclideanAlgorithm(i,o,a){if(i.getDegree()<o.getDegree()){let L=i;i=o,o=L}let h=i,c=o,d=this.field.getZero(),x=this.field.getOne();for(;c.getDegree()>=Math.round(a/2);){let L=h,k=d;if(h=c,d=x,h.isZero())throw D.getChecksumInstance();c=L;let V=this.field.getZero(),H=h.getCoefficient(h.getDegree()),$=this.field.inverse(H);for(;c.getDegree()>=h.getDegree()&&!c.isZero();){let nt=c.getDegree()-h.getDegree(),xt=this.field.multiply(c.getCoefficient(c.getDegree()),$);V=V.add(this.field.buildMonomial(nt,xt)),c=c.subtract(h.multiplyByMonomial(nt,xt))}x=V.multiply(d).subtract(k).negative()}let _=x.getCoefficient(0);if(_===0)throw D.getChecksumInstance();let C=this.field.inverse(_),M=x.multiply(C),R=c.multiply(C);return[M,R]}findErrorLocations(i){let o=i.getDegree(),a=new Int32Array(o),h=0;for(let c=1;c<this.field.getSize()&&h<o;c++)i.evaluateAt(c)===0&&(a[h]=this.field.inverse(c),h++);if(h!==o)throw D.getChecksumInstance();return a}findErrorMagnitudes(i,o,a){let h=o.getDegree(),c=new Int32Array(h);for(let C=1;C<=h;C++)c[h-C]=this.field.multiply(C,o.getCoefficient(C));let d=new je(this.field,c),x=a.length,_=new Int32Array(x);for(let C=0;C<x;C++){let M=this.field.inverse(a[C]),R=this.field.subtract(0,i.evaluateAt(M)),L=this.field.inverse(d.evaluateAt(M));_[C]=this.field.multiply(R,L)}return _}}class Ye{constructor(i,o,a,h,c){i instanceof Ye?this.constructor_2(i):this.constructor_1(i,o,a,h,c)}constructor_1(i,o,a,h,c){const d=o==null||a==null,x=h==null||c==null;if(d&&x)throw new J;d?(o=new Mt(0,h.getY()),a=new Mt(0,c.getY())):x&&(h=new Mt(i.getWidth()-1,o.getY()),c=new Mt(i.getWidth()-1,a.getY())),this.image=i,this.topLeft=o,this.bottomLeft=a,this.topRight=h,this.bottomRight=c,this.minX=Math.trunc(Math.min(o.getX(),a.getX())),this.maxX=Math.trunc(Math.max(h.getX(),c.getX())),this.minY=Math.trunc(Math.min(o.getY(),h.getY())),this.maxY=Math.trunc(Math.max(a.getY(),c.getY()))}constructor_2(i){this.image=i.image,this.topLeft=i.getTopLeft(),this.bottomLeft=i.getBottomLeft(),this.topRight=i.getTopRight(),this.bottomRight=i.getBottomRight(),this.minX=i.getMinX(),this.maxX=i.getMaxX(),this.minY=i.getMinY(),this.maxY=i.getMaxY()}static merge(i,o){return i==null?o:o==null?i:new Ye(i.image,i.topLeft,i.bottomLeft,o.topRight,o.bottomRight)}addMissingRows(i,o,a){let h=this.topLeft,c=this.bottomLeft,d=this.topRight,x=this.bottomRight;if(i>0){let _=a?this.topLeft:this.topRight,C=Math.trunc(_.getY()-i);C<0&&(C=0);let M=new Mt(_.getX(),C);a?h=M:d=M}if(o>0){let _=a?this.bottomLeft:this.bottomRight,C=Math.trunc(_.getY()+o);C>=this.image.getHeight()&&(C=this.image.getHeight()-1);let M=new Mt(_.getX(),C);a?c=M:x=M}return new Ye(this.image,h,c,d,x)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class zs{constructor(i,o,a,h){this.columnCount=i,this.errorCorrectionLevel=h,this.rowCountUpperPart=o,this.rowCountLowerPart=a,this.rowCount=o+a}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class _n{constructor(){this.buffer=""}static form(i,o){let a=-1;function h(d,x,_,C,M,R){if(d==="%%")return"%";if(o[++a]===void 0)return;d=C?parseInt(C.substr(1)):void 0;let L=M?parseInt(M.substr(1)):void 0,k;switch(R){case"s":k=o[a];break;case"c":k=o[a][0];break;case"f":k=parseFloat(o[a]).toFixed(d);break;case"p":k=parseFloat(o[a]).toPrecision(d);break;case"e":k=parseFloat(o[a]).toExponential(d);break;case"x":k=parseInt(o[a]).toString(L||16);break;case"d":k=parseFloat(parseInt(o[a],L||10).toPrecision(d)).toFixed(0);break}k=typeof k=="object"?JSON.stringify(k):(+k).toString(L);let V=parseInt(_),H=_&&_[0]+""=="0"?"0":" ";for(;k.length<V;)k=x!==void 0?k+H:H+k;return k}let c=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return i.replace(c,h)}format(i,...o){this.buffer+=_n.form(i,o)}toString(){return this.buffer}}class yn{constructor(i){this.boundingBox=new Ye(i),this.codewords=new Array(i.getMaxY()-i.getMinY()+1)}getCodewordNearby(i){let o=this.getCodeword(i);if(o!=null)return o;for(let a=1;a<yn.MAX_NEARBY_DISTANCE;a++){let h=this.imageRowToCodewordIndex(i)-a;if(h>=0&&(o=this.codewords[h],o!=null)||(h=this.imageRowToCodewordIndex(i)+a,h<this.codewords.length&&(o=this.codewords[h],o!=null)))return o}return null}imageRowToCodewordIndex(i){return i-this.boundingBox.getMinY()}setCodeword(i,o){this.codewords[this.imageRowToCodewordIndex(i)]=o}getCodeword(i){return this.codewords[this.imageRowToCodewordIndex(i)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const i=new _n;let o=0;for(const a of this.codewords){if(a==null){i.format("%3d:    |   %n",o++);continue}i.format("%3d: %3d|%3d%n",o++,a.getRowNumber(),a.getValue())}return i.toString()}}yn.MAX_NEARBY_DISTANCE=5;class En{constructor(){this.values=new Map}setValue(i){i=Math.trunc(i);let o=this.values.get(i);o==null&&(o=0),o++,this.values.set(i,o)}getValue(){let i=-1,o=new Array;for(const[a,h]of this.values.entries()){const c={getKey:()=>a,getValue:()=>h};c.getValue()>i?(i=c.getValue(),o=[],o.push(c.getKey())):c.getValue()===i&&o.push(c.getKey())}return Gt.toIntArray(o)}getConfidence(i){return this.values.get(i)}}class Hn extends yn{constructor(i,o){super(i),this._isLeft=o}setRowNumbers(){for(let i of this.getCodewords())i?.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(i){let o=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(o,i);let a=this.getBoundingBox(),h=this._isLeft?a.getTopLeft():a.getTopRight(),c=this._isLeft?a.getBottomLeft():a.getBottomRight(),d=this.imageRowToCodewordIndex(Math.trunc(h.getY())),x=this.imageRowToCodewordIndex(Math.trunc(c.getY())),_=-1,C=1,M=0;for(let R=d;R<x;R++){if(o[R]==null)continue;let L=o[R],k=L.getRowNumber()-_;if(k===0)M++;else if(k===1)C=Math.max(C,M),M=1,_=L.getRowNumber();else if(k<0||L.getRowNumber()>=i.getRowCount()||k>R)o[R]=null;else{let V;C>2?V=(C-2)*k:V=k;let H=V>=R;for(let $=1;$<=V&&!H;$++)H=o[R-$]!=null;H?o[R]=null:(_=L.getRowNumber(),M=1)}}}getRowHeights(){let i=this.getBarcodeMetadata();if(i==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(i);let o=new Int32Array(i.getRowCount());for(let a of this.getCodewords())if(a!=null){let h=a.getRowNumber();if(h>=o.length)continue;o[h]++}return o}adjustIncompleteIndicatorColumnRowNumbers(i){let o=this.getBoundingBox(),a=this._isLeft?o.getTopLeft():o.getTopRight(),h=this._isLeft?o.getBottomLeft():o.getBottomRight(),c=this.imageRowToCodewordIndex(Math.trunc(a.getY())),d=this.imageRowToCodewordIndex(Math.trunc(h.getY())),x=this.getCodewords(),_=-1;for(let C=c;C<d;C++){if(x[C]==null)continue;let M=x[C];M.setRowNumberAsRowIndicatorColumn();let R=M.getRowNumber()-_;R===0||(R===1?_=M.getRowNumber():M.getRowNumber()>=i.getRowCount()?x[C]=null:_=M.getRowNumber())}}getBarcodeMetadata(){let i=this.getCodewords(),o=new En,a=new En,h=new En,c=new En;for(let x of i){if(x==null)continue;x.setRowNumberAsRowIndicatorColumn();let _=x.getValue()%30,C=x.getRowNumber();switch(this._isLeft||(C+=2),C%3){case 0:a.setValue(_*3+1);break;case 1:c.setValue(_/3),h.setValue(_%3);break;case 2:o.setValue(_+1);break}}if(o.getValue().length===0||a.getValue().length===0||h.getValue().length===0||c.getValue().length===0||o.getValue()[0]<1||a.getValue()[0]+h.getValue()[0]<Gt.MIN_ROWS_IN_BARCODE||a.getValue()[0]+h.getValue()[0]>Gt.MAX_ROWS_IN_BARCODE)return null;let d=new zs(o.getValue()[0],a.getValue()[0],h.getValue()[0],c.getValue()[0]);return this.removeIncorrectCodewords(i,d),d}removeIncorrectCodewords(i,o){for(let a=0;a<i.length;a++){let h=i[a];if(i[a]==null)continue;let c=h.getValue()%30,d=h.getRowNumber();if(d>o.getRowCount()){i[a]=null;continue}switch(this._isLeft||(d+=2),d%3){case 0:c*3+1!==o.getRowCountUpperPart()&&(i[a]=null);break;case 1:(Math.trunc(c/3)!==o.getErrorCorrectionLevel()||c%3!==o.getRowCountLowerPart())&&(i[a]=null);break;case 2:c+1!==o.getColumnCount()&&(i[a]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class fn{constructor(i,o){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=i,this.barcodeColumnCount=i.getColumnCount(),this.boundingBox=o,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let i=Gt.MAX_CODEWORDS_IN_BARCODE,o;do o=i,i=this.adjustRowNumbersAndGetCount();while(i>0&&i<o);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(i){i?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let i=this.adjustRowNumbersByRow();if(i===0)return 0;for(let o=1;o<this.barcodeColumnCount+1;o++){let a=this.detectionResultColumns[o].getCodewords();for(let h=0;h<a.length;h++)a[h]!=null&&(a[h].hasValidRowNumber()||this.adjustRowNumbers(o,h,a))}return i}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let i=this.detectionResultColumns[0].getCodewords(),o=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let a=0;a<i.length;a++)if(i[a]!=null&&o[a]!=null&&i[a].getRowNumber()===o[a].getRowNumber())for(let h=1;h<=this.barcodeColumnCount;h++){let c=this.detectionResultColumns[h].getCodewords()[a];c!=null&&(c.setRowNumber(i[a].getRowNumber()),c.hasValidRowNumber()||(this.detectionResultColumns[h].getCodewords()[a]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let i=0,o=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let a=0;a<o.length;a++){if(o[a]==null)continue;let h=o[a].getRowNumber(),c=0;for(let d=this.barcodeColumnCount+1;d>0&&c<this.ADJUST_ROW_NUMBER_SKIP;d--){let x=this.detectionResultColumns[d].getCodewords()[a];x!=null&&(c=fn.adjustRowNumberIfValid(h,c,x),x.hasValidRowNumber()||i++)}}return i}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let i=0,o=this.detectionResultColumns[0].getCodewords();for(let a=0;a<o.length;a++){if(o[a]==null)continue;let h=o[a].getRowNumber(),c=0;for(let d=1;d<this.barcodeColumnCount+1&&c<this.ADJUST_ROW_NUMBER_SKIP;d++){let x=this.detectionResultColumns[d].getCodewords()[a];x!=null&&(c=fn.adjustRowNumberIfValid(h,c,x),x.hasValidRowNumber()||i++)}}return i}static adjustRowNumberIfValid(i,o,a){return a==null||a.hasValidRowNumber()||(a.isValidRowNumber(i)?(a.setRowNumber(i),o=0):++o),o}adjustRowNumbers(i,o,a){if(!this.detectionResultColumns[i-1])return;let h=a[o],c=this.detectionResultColumns[i-1].getCodewords(),d=c;this.detectionResultColumns[i+1]!=null&&(d=this.detectionResultColumns[i+1].getCodewords());let x=new Array(14);x[2]=c[o],x[3]=d[o],o>0&&(x[0]=a[o-1],x[4]=c[o-1],x[5]=d[o-1]),o>1&&(x[8]=a[o-2],x[10]=c[o-2],x[11]=d[o-2]),o<a.length-1&&(x[1]=a[o+1],x[6]=c[o+1],x[7]=d[o+1]),o<a.length-2&&(x[9]=a[o+2],x[12]=c[o+2],x[13]=d[o+2]);for(let _ of x)if(fn.adjustRowNumber(h,_))return}static adjustRowNumber(i,o){return o==null?!1:o.hasValidRowNumber()&&o.getBucket()===i.getBucket()?(i.setRowNumber(o.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(i){this.boundingBox=i}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(i,o){this.detectionResultColumns[i]=o}getDetectionResultColumn(i){return this.detectionResultColumns[i]}toString(){let i=this.detectionResultColumns[0];i==null&&(i=this.detectionResultColumns[this.barcodeColumnCount+1]);let o=new _n;for(let a=0;a<i.getCodewords().length;a++){o.format("CW %3d:",a);for(let h=0;h<this.barcodeColumnCount+2;h++){if(this.detectionResultColumns[h]==null){o.format("    |   ");continue}let c=this.detectionResultColumns[h].getCodewords()[a];if(c==null){o.format("    |   ");continue}o.format(" %3d|%3d",c.getRowNumber(),c.getValue())}o.format("%n")}return o.toString()}}class On{constructor(i,o,a,h){this.rowNumber=On.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(i),this.endX=Math.trunc(o),this.bucket=Math.trunc(a),this.value=Math.trunc(h)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(i){return i!==On.BARCODE_ROW_UNKNOWN&&this.bucket===i%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(i){this.rowNumber=i}toString(){return this.rowNumber+"|"+this.value}}On.BARCODE_ROW_UNKNOWN=-1;class Ri{static initialize(){for(let i=0;i<Gt.SYMBOL_TABLE.length;i++){let o=Gt.SYMBOL_TABLE[i],a=o&1;for(let h=0;h<Gt.BARS_IN_MODULE;h++){let c=0;for(;(o&1)===a;)c+=1,o>>=1;a=o&1,Ri.RATIOS_TABLE[i]||(Ri.RATIOS_TABLE[i]=new Array(Gt.BARS_IN_MODULE)),Ri.RATIOS_TABLE[i][Gt.BARS_IN_MODULE-h-1]=Math.fround(c/Gt.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(i){let o=Ri.getDecodedCodewordValue(Ri.sampleBitCounts(i));return o!==-1?o:Ri.getClosestDecodedValue(i)}static sampleBitCounts(i){let o=te.sum(i),a=new Int32Array(Gt.BARS_IN_MODULE),h=0,c=0;for(let d=0;d<Gt.MODULES_IN_CODEWORD;d++){let x=o/(2*Gt.MODULES_IN_CODEWORD)+d*o/Gt.MODULES_IN_CODEWORD;c+i[h]<=x&&(c+=i[h],h++),a[h]++}return a}static getDecodedCodewordValue(i){let o=Ri.getBitValue(i);return Gt.getCodeword(o)===-1?-1:o}static getBitValue(i){let o=0;for(let a=0;a<i.length;a++)for(let h=0;h<i[a];h++)o=o<<1|(a%2===0?1:0);return Math.trunc(o)}static getClosestDecodedValue(i){let o=te.sum(i),a=new Array(Gt.BARS_IN_MODULE);if(o>1)for(let d=0;d<a.length;d++)a[d]=Math.fround(i[d]/o);let h=gi.MAX_VALUE,c=-1;this.bSymbolTableReady||Ri.initialize();for(let d=0;d<Ri.RATIOS_TABLE.length;d++){let x=0,_=Ri.RATIOS_TABLE[d];for(let C=0;C<Gt.BARS_IN_MODULE;C++){let M=Math.fround(_[C]-a[C]);if(x+=Math.fround(M*M),x>=h)break}x<h&&(h=x,c=Gt.SYMBOL_TABLE[d])}return c}}Ri.bSymbolTableReady=!1,Ri.RATIOS_TABLE=new Array(Gt.SYMBOL_TABLE.length).map(T=>new Array(Gt.BARS_IN_MODULE));class wn{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(i){this.segmentIndex=i}getFileId(){return this.fileId}setFileId(i){this.fileId=i}getOptionalData(){return this.optionalData}setOptionalData(i){this.optionalData=i}isLastSegment(){return this.lastSegment}setLastSegment(i){this.lastSegment=i}getSegmentCount(){return this.segmentCount}setSegmentCount(i){this.segmentCount=i}getSender(){return this.sender||null}setSender(i){this.sender=i}getAddressee(){return this.addressee||null}setAddressee(i){this.addressee=i}getFileName(){return this.fileName}setFileName(i){this.fileName=i}getFileSize(){return this.fileSize}setFileSize(i){this.fileSize=i}getChecksum(){return this.checksum}setChecksum(i){this.checksum=i}getTimestamp(){return this.timestamp}setTimestamp(i){this.timestamp=i}}class Xo{static parseLong(i,o=void 0){return parseInt(i,o)}}class Vo extends p{}Vo.kind="NullPointerException";class dl{writeBytes(i){this.writeBytesOffset(i,0,i.length)}writeBytesOffset(i,o,a){if(i==null)throw new Vo;if(o<0||o>i.length||a<0||o+a>i.length||o+a<0)throw new z;if(a===0)return;for(let h=0;h<a;h++)this.write(i[o+h])}flush(){}close(){}}class gl extends p{}class ml extends dl{constructor(i=32){if(super(),this.count=0,i<0)throw new A("Negative initial size: "+i);this.buf=new Uint8Array(i)}ensureCapacity(i){i-this.buf.length>0&&this.grow(i)}grow(i){let a=this.buf.length<<1;if(a-i<0&&(a=i),a<0){if(i<0)throw new gl;a=X.MAX_VALUE}this.buf=G.copyOfUint8Array(this.buf,a)}write(i){this.ensureCapacity(this.count+1),this.buf[this.count]=i,this.count+=1}writeBytesOffset(i,o,a){if(o<0||o>i.length||a<0||o+a-i.length>0)throw new z;this.ensureCapacity(this.count+a),F.arraycopy(i,o,this.buf,this.count,a),this.count+=a}writeTo(i){i.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return G.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(i){return i?typeof i=="string"?this.toString_string(i):this.toString_number(i):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(i){return new String(this.buf).toString()}toString_number(i){return new String(this.buf).toString()}close(){}}var Ae;(function(T){T[T.ALPHA=0]="ALPHA",T[T.LOWER=1]="LOWER",T[T.MIXED=2]="MIXED",T[T.PUNCT=3]="PUNCT",T[T.ALPHA_SHIFT=4]="ALPHA_SHIFT",T[T.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(Ae||(Ae={}));function Yo(){if(typeof window<"u")return window.BigInt||null;if(typeof Ir<"u")return Ir.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Zi;function Dn(T){if(typeof Zi>"u"&&(Zi=Yo()),Zi===null)throw new Error("BigInt is not supported!");return Zi(T)}function xl(){let T=[];T[0]=Dn(1);let i=Dn(900);T[1]=i;for(let o=2;o<16;o++)T[o]=T[o-1]*i;return T}class it{static decode(i,o){let a=new yt(""),h=Z.ISO8859_1;a.enableDecoding(h);let c=1,d=i[c++],x=new wn;for(;c<i[0];){switch(d){case it.TEXT_COMPACTION_MODE_LATCH:c=it.textCompaction(i,c,a);break;case it.BYTE_COMPACTION_MODE_LATCH:case it.BYTE_COMPACTION_MODE_LATCH_6:c=it.byteCompaction(d,i,h,c,a);break;case it.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(i[c++]);break;case it.NUMERIC_COMPACTION_MODE_LATCH:c=it.numericCompaction(i,c,a);break;case it.ECI_CHARSET:Z.getCharacterSetECIByValue(i[c++]);break;case it.ECI_GENERAL_PURPOSE:c+=2;break;case it.ECI_USER_DEFINED:c++;break;case it.BEGIN_MACRO_PDF417_CONTROL_BLOCK:c=it.decodeMacroBlock(i,c,x);break;case it.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case it.MACRO_PDF417_TERMINATOR:throw new K;default:c--,c=it.textCompaction(i,c,a);break}if(c<i.length)d=i[c++];else throw K.getFormatInstance()}if(a.length()===0)throw K.getFormatInstance();let _=new fi(null,a.toString(),null,o);return _.setOther(x),_}static decodeMacroBlock(i,o,a){if(o+it.NUMBER_OF_SEQUENCE_CODEWORDS>i[0])throw K.getFormatInstance();let h=new Int32Array(it.NUMBER_OF_SEQUENCE_CODEWORDS);for(let x=0;x<it.NUMBER_OF_SEQUENCE_CODEWORDS;x++,o++)h[x]=i[o];a.setSegmentIndex(X.parseInt(it.decodeBase900toBase10(h,it.NUMBER_OF_SEQUENCE_CODEWORDS)));let c=new yt;o=it.textCompaction(i,o,c),a.setFileId(c.toString());let d=-1;for(i[o]===it.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(d=o+1);o<i[0];)switch(i[o]){case it.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(o++,i[o]){case it.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let x=new yt;o=it.textCompaction(i,o+1,x),a.setFileName(x.toString());break;case it.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let _=new yt;o=it.textCompaction(i,o+1,_),a.setSender(_.toString());break;case it.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let C=new yt;o=it.textCompaction(i,o+1,C),a.setAddressee(C.toString());break;case it.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let M=new yt;o=it.numericCompaction(i,o+1,M),a.setSegmentCount(X.parseInt(M.toString()));break;case it.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let R=new yt;o=it.numericCompaction(i,o+1,R),a.setTimestamp(Xo.parseLong(R.toString()));break;case it.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let L=new yt;o=it.numericCompaction(i,o+1,L),a.setChecksum(X.parseInt(L.toString()));break;case it.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let k=new yt;o=it.numericCompaction(i,o+1,k),a.setFileSize(Xo.parseLong(k.toString()));break;default:throw K.getFormatInstance()}break;case it.MACRO_PDF417_TERMINATOR:o++,a.setLastSegment(!0);break;default:throw K.getFormatInstance()}if(d!==-1){let x=o-d;a.isLastSegment()&&x--,a.setOptionalData(G.copyOfRange(i,d,d+x))}return o}static textCompaction(i,o,a){let h=new Int32Array((i[0]-o)*2),c=new Int32Array((i[0]-o)*2),d=0,x=!1;for(;o<i[0]&&!x;){let _=i[o++];if(_<it.TEXT_COMPACTION_MODE_LATCH)h[d]=_/30,h[d+1]=_%30,d+=2;else switch(_){case it.TEXT_COMPACTION_MODE_LATCH:h[d++]=it.TEXT_COMPACTION_MODE_LATCH;break;case it.BYTE_COMPACTION_MODE_LATCH:case it.BYTE_COMPACTION_MODE_LATCH_6:case it.NUMERIC_COMPACTION_MODE_LATCH:case it.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case it.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case it.MACRO_PDF417_TERMINATOR:o--,x=!0;break;case it.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h[d]=it.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,_=i[o++],c[d]=_,d++;break}}return it.decodeTextCompaction(h,c,d,a),o}static decodeTextCompaction(i,o,a,h){let c=Ae.ALPHA,d=Ae.ALPHA,x=0;for(;x<a;){let _=i[x],C="";switch(c){case Ae.ALPHA:if(_<26)C=String.fromCharCode(65+_);else switch(_){case 26:C=" ";break;case it.LL:c=Ae.LOWER;break;case it.ML:c=Ae.MIXED;break;case it.PS:d=c,c=Ae.PUNCT_SHIFT;break;case it.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(o[x]);break;case it.TEXT_COMPACTION_MODE_LATCH:c=Ae.ALPHA;break}break;case Ae.LOWER:if(_<26)C=String.fromCharCode(97+_);else switch(_){case 26:C=" ";break;case it.AS:d=c,c=Ae.ALPHA_SHIFT;break;case it.ML:c=Ae.MIXED;break;case it.PS:d=c,c=Ae.PUNCT_SHIFT;break;case it.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(o[x]);break;case it.TEXT_COMPACTION_MODE_LATCH:c=Ae.ALPHA;break}break;case Ae.MIXED:if(_<it.PL)C=it.MIXED_CHARS[_];else switch(_){case it.PL:c=Ae.PUNCT;break;case 26:C=" ";break;case it.LL:c=Ae.LOWER;break;case it.AL:c=Ae.ALPHA;break;case it.PS:d=c,c=Ae.PUNCT_SHIFT;break;case it.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(o[x]);break;case it.TEXT_COMPACTION_MODE_LATCH:c=Ae.ALPHA;break}break;case Ae.PUNCT:if(_<it.PAL)C=it.PUNCT_CHARS[_];else switch(_){case it.PAL:c=Ae.ALPHA;break;case it.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(o[x]);break;case it.TEXT_COMPACTION_MODE_LATCH:c=Ae.ALPHA;break}break;case Ae.ALPHA_SHIFT:if(c=d,_<26)C=String.fromCharCode(65+_);else switch(_){case 26:C=" ";break;case it.TEXT_COMPACTION_MODE_LATCH:c=Ae.ALPHA;break}break;case Ae.PUNCT_SHIFT:if(c=d,_<it.PAL)C=it.PUNCT_CHARS[_];else switch(_){case it.PAL:c=Ae.ALPHA;break;case it.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(o[x]);break;case it.TEXT_COMPACTION_MODE_LATCH:c=Ae.ALPHA;break}break}C!==""&&h.append(C),x++}}static byteCompaction(i,o,a,h,c){let d=new ml,x=0,_=0,C=!1;switch(i){case it.BYTE_COMPACTION_MODE_LATCH:let M=new Int32Array(6),R=o[h++];for(;h<o[0]&&!C;)switch(M[x++]=R,_=900*_+R,R=o[h++],R){case it.TEXT_COMPACTION_MODE_LATCH:case it.BYTE_COMPACTION_MODE_LATCH:case it.NUMERIC_COMPACTION_MODE_LATCH:case it.BYTE_COMPACTION_MODE_LATCH_6:case it.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case it.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case it.MACRO_PDF417_TERMINATOR:h--,C=!0;break;default:if(x%5===0&&x>0){for(let L=0;L<6;++L)d.write(Number(Dn(_)>>Dn(8*(5-L))));_=0,x=0}break}h===o[0]&&R<it.TEXT_COMPACTION_MODE_LATCH&&(M[x++]=R);for(let L=0;L<x;L++)d.write(M[L]);break;case it.BYTE_COMPACTION_MODE_LATCH_6:for(;h<o[0]&&!C;){let L=o[h++];if(L<it.TEXT_COMPACTION_MODE_LATCH)x++,_=900*_+L;else switch(L){case it.TEXT_COMPACTION_MODE_LATCH:case it.BYTE_COMPACTION_MODE_LATCH:case it.NUMERIC_COMPACTION_MODE_LATCH:case it.BYTE_COMPACTION_MODE_LATCH_6:case it.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case it.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case it.MACRO_PDF417_TERMINATOR:h--,C=!0;break}if(x%5===0&&x>0){for(let k=0;k<6;++k)d.write(Number(Dn(_)>>Dn(8*(5-k))));_=0,x=0}}break}return c.append(St.decode(d.toByteArray(),a)),h}static numericCompaction(i,o,a){let h=0,c=!1,d=new Int32Array(it.MAX_NUMERIC_CODEWORDS);for(;o<i[0]&&!c;){let x=i[o++];if(o===i[0]&&(c=!0),x<it.TEXT_COMPACTION_MODE_LATCH)d[h]=x,h++;else switch(x){case it.TEXT_COMPACTION_MODE_LATCH:case it.BYTE_COMPACTION_MODE_LATCH:case it.BYTE_COMPACTION_MODE_LATCH_6:case it.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case it.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case it.MACRO_PDF417_TERMINATOR:o--,c=!0;break}(h%it.MAX_NUMERIC_CODEWORDS===0||x===it.NUMERIC_COMPACTION_MODE_LATCH||c)&&h>0&&(a.append(it.decodeBase900toBase10(d,h)),h=0)}return o}static decodeBase900toBase10(i,o){let a=Dn(0);for(let c=0;c<o;c++)a+=it.EXP900[o-c-1]*Dn(i[c]);let h=a.toString();if(h.charAt(0)!=="1")throw new K;return h.substring(1)}}it.TEXT_COMPACTION_MODE_LATCH=900,it.BYTE_COMPACTION_MODE_LATCH=901,it.NUMERIC_COMPACTION_MODE_LATCH=902,it.BYTE_COMPACTION_MODE_LATCH_6=924,it.ECI_USER_DEFINED=925,it.ECI_GENERAL_PURPOSE=926,it.ECI_CHARSET=927,it.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,it.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,it.MACRO_PDF417_TERMINATOR=922,it.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,it.MAX_NUMERIC_CODEWORDS=15,it.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,it.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,it.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,it.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,it.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,it.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,it.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,it.PL=25,it.LL=27,it.AS=27,it.ML=28,it.AL=28,it.PS=29,it.PAL=29,it.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,it.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",it.EXP900=Yo()?xl():[],it.NUMBER_OF_SEQUENCE_CODEWORDS=2;class qt{constructor(){}static decode(i,o,a,h,c,d,x){let _=new Ye(i,o,a,h,c),C=null,M=null,R;for(let V=!0;;V=!1){if(o!=null&&(C=qt.getRowIndicatorColumn(i,_,o,!0,d,x)),h!=null&&(M=qt.getRowIndicatorColumn(i,_,h,!1,d,x)),R=qt.merge(C,M),R==null)throw J.getNotFoundInstance();let H=R.getBoundingBox();if(V&&H!=null&&(H.getMinY()<_.getMinY()||H.getMaxY()>_.getMaxY()))_=H;else break}R.setBoundingBox(_);let L=R.getBarcodeColumnCount()+1;R.setDetectionResultColumn(0,C),R.setDetectionResultColumn(L,M);let k=C!=null;for(let V=1;V<=L;V++){let H=k?V:L-V;if(R.getDetectionResultColumn(H)!==void 0)continue;let $;H===0||H===L?$=new Hn(_,H===0):$=new yn(_),R.setDetectionResultColumn(H,$);let nt=-1,xt=nt;for(let _t=_.getMinY();_t<=_.getMaxY();_t++){if(nt=qt.getStartColumn(R,H,_t,k),nt<0||nt>_.getMaxX()){if(xt===-1)continue;nt=xt}let dt=qt.detectCodeword(i,_.getMinX(),_.getMaxX(),k,nt,_t,d,x);dt!=null&&($.setCodeword(_t,dt),xt=nt,d=Math.min(d,dt.getWidth()),x=Math.max(x,dt.getWidth()))}}return qt.createDecoderResult(R)}static merge(i,o){if(i==null&&o==null)return null;let a=qt.getBarcodeMetadata(i,o);if(a==null)return null;let h=Ye.merge(qt.adjustBoundingBox(i),qt.adjustBoundingBox(o));return new fn(a,h)}static adjustBoundingBox(i){if(i==null)return null;let o=i.getRowHeights();if(o==null)return null;let a=qt.getMax(o),h=0;for(let x of o)if(h+=a-x,x>0)break;let c=i.getCodewords();for(let x=0;h>0&&c[x]==null;x++)h--;let d=0;for(let x=o.length-1;x>=0&&(d+=a-o[x],!(o[x]>0));x--);for(let x=c.length-1;d>0&&c[x]==null;x--)d--;return i.getBoundingBox().addMissingRows(h,d,i.isLeft())}static getMax(i){let o=-1;for(let a of i)o=Math.max(o,a);return o}static getBarcodeMetadata(i,o){let a;if(i==null||(a=i.getBarcodeMetadata())==null)return o==null?null:o.getBarcodeMetadata();let h;return o==null||(h=o.getBarcodeMetadata())==null?a:a.getColumnCount()!==h.getColumnCount()&&a.getErrorCorrectionLevel()!==h.getErrorCorrectionLevel()&&a.getRowCount()!==h.getRowCount()?null:a}static getRowIndicatorColumn(i,o,a,h,c,d){let x=new Hn(o,h);for(let _=0;_<2;_++){let C=_===0?1:-1,M=Math.trunc(Math.trunc(a.getX()));for(let R=Math.trunc(Math.trunc(a.getY()));R<=o.getMaxY()&&R>=o.getMinY();R+=C){let L=qt.detectCodeword(i,0,i.getWidth(),h,M,R,c,d);L!=null&&(x.setCodeword(R,L),h?M=L.getStartX():M=L.getEndX())}}return x}static adjustCodewordCount(i,o){let a=o[0][1],h=a.getValue(),c=i.getBarcodeColumnCount()*i.getBarcodeRowCount()-qt.getNumberOfECCodeWords(i.getBarcodeECLevel());if(h.length===0){if(c<1||c>Gt.MAX_CODEWORDS_IN_BARCODE)throw J.getNotFoundInstance();a.setValue(c)}else h[0]!==c&&a.setValue(c)}static createDecoderResult(i){let o=qt.createBarcodeMatrix(i);qt.adjustCodewordCount(i,o);let a=new Array,h=new Int32Array(i.getBarcodeRowCount()*i.getBarcodeColumnCount()),c=[],d=new Array;for(let _=0;_<i.getBarcodeRowCount();_++)for(let C=0;C<i.getBarcodeColumnCount();C++){let M=o[_][C+1].getValue(),R=_*i.getBarcodeColumnCount()+C;M.length===0?a.push(R):M.length===1?h[R]=M[0]:(d.push(R),c.push(M))}let x=new Array(c.length);for(let _=0;_<x.length;_++)x[_]=c[_];return qt.createDecoderResultFromAmbiguousValues(i.getBarcodeECLevel(),h,Gt.toIntArray(a),Gt.toIntArray(d),x)}static createDecoderResultFromAmbiguousValues(i,o,a,h,c){let d=new Int32Array(h.length),x=100;for(;x-- >0;){for(let _=0;_<d.length;_++)o[h[_]]=c[_][d[_]];try{return qt.decodeCodewords(o,i,a)}catch(_){if(!(_ instanceof D))throw _}if(d.length===0)throw D.getChecksumInstance();for(let _=0;_<d.length;_++)if(d[_]<c[_].length-1){d[_]++;break}else if(d[_]=0,_===d.length-1)throw D.getChecksumInstance()}throw D.getChecksumInstance()}static createBarcodeMatrix(i){let o=Array.from({length:i.getBarcodeRowCount()},()=>new Array(i.getBarcodeColumnCount()+2));for(let h=0;h<o.length;h++)for(let c=0;c<o[h].length;c++)o[h][c]=new En;let a=0;for(let h of i.getDetectionResultColumns()){if(h!=null){for(let c of h.getCodewords())if(c!=null){let d=c.getRowNumber();if(d>=0){if(d>=o.length)continue;o[d][a].setValue(c.getValue())}}}a++}return o}static isValidBarcodeColumn(i,o){return o>=0&&o<=i.getBarcodeColumnCount()+1}static getStartColumn(i,o,a,h){let c=h?1:-1,d=null;if(qt.isValidBarcodeColumn(i,o-c)&&(d=i.getDetectionResultColumn(o-c).getCodeword(a)),d!=null)return h?d.getEndX():d.getStartX();if(d=i.getDetectionResultColumn(o).getCodewordNearby(a),d!=null)return h?d.getStartX():d.getEndX();if(qt.isValidBarcodeColumn(i,o-c)&&(d=i.getDetectionResultColumn(o-c).getCodewordNearby(a)),d!=null)return h?d.getEndX():d.getStartX();let x=0;for(;qt.isValidBarcodeColumn(i,o-c);){o-=c;for(let _ of i.getDetectionResultColumn(o).getCodewords())if(_!=null)return(h?_.getEndX():_.getStartX())+c*x*(_.getEndX()-_.getStartX());x++}return h?i.getBoundingBox().getMinX():i.getBoundingBox().getMaxX()}static detectCodeword(i,o,a,h,c,d,x,_){c=qt.adjustCodewordStartColumn(i,o,a,h,c,d);let C=qt.getModuleBitCount(i,o,a,h,c,d);if(C==null)return null;let M,R=te.sum(C);if(h)M=c+R;else{for(let V=0;V<C.length/2;V++){let H=C[V];C[V]=C[C.length-1-V],C[C.length-1-V]=H}M=c,c=M-R}if(!qt.checkCodewordSkew(R,x,_))return null;let L=Ri.getDecodedValue(C),k=Gt.getCodeword(L);return k===-1?null:new On(c,M,qt.getCodewordBucketNumber(L),k)}static getModuleBitCount(i,o,a,h,c,d){let x=c,_=new Int32Array(8),C=0,M=h?1:-1,R=h;for(;(h?x<a:x>=o)&&C<_.length;)i.get(x,d)===R?(_[C]++,x+=M):(C++,R=!R);return C===_.length||x===(h?a:o)&&C===_.length-1?_:null}static getNumberOfECCodeWords(i){return 2<<i}static adjustCodewordStartColumn(i,o,a,h,c,d){let x=c,_=h?-1:1;for(let C=0;C<2;C++){for(;(h?x>=o:x<a)&&h===i.get(x,d);){if(Math.abs(c-x)>qt.CODEWORD_SKEW_SIZE)return c;x+=_}_=-_,h=!h}return x}static checkCodewordSkew(i,o,a){return o-qt.CODEWORD_SKEW_SIZE<=i&&i<=a+qt.CODEWORD_SKEW_SIZE}static decodeCodewords(i,o,a){if(i.length===0)throw K.getFormatInstance();let h=1<<o+1,c=qt.correctErrors(i,a,h);qt.verifyCodewordCount(i,h);let d=it.decode(i,""+o);return d.setErrorsCorrected(c),d.setErasures(a.length),d}static correctErrors(i,o,a){if(o!=null&&o.length>a/2+qt.MAX_ERRORS||a<0||a>qt.MAX_EC_CODEWORDS)throw D.getChecksumInstance();return qt.errorCorrection.decode(i,a,o)}static verifyCodewordCount(i,o){if(i.length<4)throw K.getFormatInstance();let a=i[0];if(a>i.length)throw K.getFormatInstance();if(a===0)if(o<i.length)i[0]=i.length-o;else throw K.getFormatInstance()}static getBitCountForCodeword(i){let o=new Int32Array(8),a=0,h=o.length-1;for(;!((i&1)!==a&&(a=i&1,h--,h<0));)o[h]++,i>>=1;return o}static getCodewordBucketNumber(i){return i instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(i):this.getCodewordBucketNumber_number(i)}static getCodewordBucketNumber_number(i){return qt.getCodewordBucketNumber(qt.getBitCountForCodeword(i))}static getCodewordBucketNumber_Int32Array(i){return(i[0]-i[2]+i[4]-i[6]+9)%9}static toString(i){let o=new _n;for(let a=0;a<i.length;a++){o.format("Row %2d: ",a);for(let h=0;h<i[a].length;h++){let c=i[a][h];c.getValue().length===0?o.format("        ",null):o.format("%4d(%2d)",c.getValue()[0],c.getConfidence(c.getValue()[0]))}o.format("%n")}return o.toString()}}qt.CODEWORD_SKEW_SIZE=2,qt.MAX_ERRORS=3,qt.MAX_EC_CODEWORDS=512,qt.errorCorrection=new Wo;class ui{decode(i,o=null){let a=ui.decode(i,o,!1);if(a==null||a.length===0||a[0]==null)throw J.getNotFoundInstance();return a[0]}decodeMultiple(i,o=null){try{return ui.decode(i,o,!0)}catch(a){throw a instanceof K||a instanceof D?J.getNotFoundInstance():a}}static decode(i,o,a){const h=new Array,c=Zt.detectMultiple(i,o,a);for(const d of c.getPoints()){const x=qt.decode(c.getBits(),d[4],d[5],d[6],d[7],ui.getMinCodewordWidth(d),ui.getMaxCodewordWidth(d)),_=new ft(x.getText(),x.getRawBytes(),void 0,d,Tt.PDF_417);_.putMetadata(_e.ERROR_CORRECTION_LEVEL,x.getECLevel());const C=x.getOther();C!=null&&_.putMetadata(_e.PDF417_EXTRA_METADATA,C),h.push(_)}return h.map(d=>d)}static getMaxWidth(i,o){return i==null||o==null?0:Math.trunc(Math.abs(i.getX()-o.getX()))}static getMinWidth(i,o){return i==null||o==null?X.MAX_VALUE:Math.trunc(Math.abs(i.getX()-o.getX()))}static getMaxCodewordWidth(i){return Math.floor(Math.max(Math.max(ui.getMaxWidth(i[0],i[4]),ui.getMaxWidth(i[6],i[2])*Gt.MODULES_IN_CODEWORD/Gt.MODULES_IN_STOP_PATTERN),Math.max(ui.getMaxWidth(i[1],i[5]),ui.getMaxWidth(i[7],i[3])*Gt.MODULES_IN_CODEWORD/Gt.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(i){return Math.floor(Math.min(Math.min(ui.getMinWidth(i[0],i[4]),ui.getMinWidth(i[6],i[2])*Gt.MODULES_IN_CODEWORD/Gt.MODULES_IN_STOP_PATTERN),Math.min(ui.getMinWidth(i[1],i[5]),ui.getMinWidth(i[7],i[3])*Gt.MODULES_IN_CODEWORD/Gt.MODULES_IN_STOP_PATTERN)))}reset(){}}class js extends p{}js.kind="ReaderException";class Ho{constructor(i,o){this.verbose=i===!0,o&&this.setHints(o)}decode(i,o){return o&&this.setHints(o),this.decodeInternal(i)}decodeWithState(i){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(i)}setHints(i){this.hints=i;const o=!n(i)&&i.get(rt.TRY_HARDER)===!0,a=n(i)?null:i.get(rt.POSSIBLE_FORMATS),h=new Array;if(!n(a)){const c=a.some(d=>d===Tt.UPC_A||d===Tt.UPC_E||d===Tt.EAN_13||d===Tt.EAN_8||d===Tt.CODABAR||d===Tt.CODE_39||d===Tt.CODE_93||d===Tt.CODE_128||d===Tt.ITF||d===Tt.RSS_14||d===Tt.RSS_EXPANDED);c&&!o&&h.push(new ps(i,this.verbose)),a.includes(Tt.QR_CODE)&&h.push(new un),a.includes(Tt.DATA_MATRIX)&&h.push(new Ve),a.includes(Tt.AZTEC)&&h.push(new Xn),a.includes(Tt.PDF_417)&&h.push(new ui),c&&o&&h.push(new ps(i,this.verbose))}h.length===0&&(o||h.push(new ps(i,this.verbose)),h.push(new un),h.push(new Ve),h.push(new Xn),h.push(new ui),o&&h.push(new ps(i,this.verbose))),this.readers=h}reset(){if(this.readers!==null)for(const i of this.readers)i.reset()}decodeInternal(i){if(this.readers===null)throw new js("No readers where selected, nothing can be read.");for(const o of this.readers)try{return o.decode(i,this.hints)}catch(a){if(a instanceof js)continue}throw new J("No MultiFormat Readers were able to detect the code.")}}class pl extends $t{constructor(i=null,o=500){const a=new Ho;a.setHints(i),super(a,o)}decodeBitmap(i){return this.reader.decodeWithState(i)}}class _l extends $t{constructor(i=500){super(new ui,i)}}class yl extends $t{constructor(i=500){super(new un,i)}}var qr;(function(T){T[T.ERROR_CORRECTION=0]="ERROR_CORRECTION",T[T.CHARACTER_SET=1]="CHARACTER_SET",T[T.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",T[T.MIN_SIZE=3]="MIN_SIZE",T[T.MAX_SIZE=4]="MAX_SIZE",T[T.MARGIN=5]="MARGIN",T[T.PDF417_COMPACT=6]="PDF417_COMPACT",T[T.PDF417_COMPACTION=7]="PDF417_COMPACTION",T[T.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",T[T.AZTEC_LAYERS=9]="AZTEC_LAYERS",T[T.QR_VERSION=10]="QR_VERSION"})(qr||(qr={}));var ai=qr;class Qr{constructor(i){this.field=i,this.cachedGenerators=[],this.cachedGenerators.push(new Ze(i,Int32Array.from([1])))}buildGenerator(i){const o=this.cachedGenerators;if(i>=o.length){let a=o[o.length-1];const h=this.field;for(let c=o.length;c<=i;c++){const d=a.multiply(new Ze(h,Int32Array.from([1,h.exp(c-1+h.getGeneratorBase())])));o.push(d),a=d}}return o[i]}encode(i,o){if(o===0)throw new A("No error correction bytes");const a=i.length-o;if(a<=0)throw new A("No data bytes provided");const h=this.buildGenerator(o),c=new Int32Array(a);F.arraycopy(i,0,c,0,a);let d=new Ze(this.field,c);d=d.multiplyByMonomial(o,1);const _=d.divide(h)[1].getCoefficients(),C=o-_.length;for(let M=0;M<C;M++)i[a+M]=0;F.arraycopy(_,0,i,a+C,_.length)}}class We{constructor(){}static applyMaskPenaltyRule1(i){return We.applyMaskPenaltyRule1Internal(i,!0)+We.applyMaskPenaltyRule1Internal(i,!1)}static applyMaskPenaltyRule2(i){let o=0;const a=i.getArray(),h=i.getWidth(),c=i.getHeight();for(let d=0;d<c-1;d++){const x=a[d];for(let _=0;_<h-1;_++){const C=x[_];C===x[_+1]&&C===a[d+1][_]&&C===a[d+1][_+1]&&o++}}return We.N2*o}static applyMaskPenaltyRule3(i){let o=0;const a=i.getArray(),h=i.getWidth(),c=i.getHeight();for(let d=0;d<c;d++)for(let x=0;x<h;x++){const _=a[d];x+6<h&&_[x]===1&&_[x+1]===0&&_[x+2]===1&&_[x+3]===1&&_[x+4]===1&&_[x+5]===0&&_[x+6]===1&&(We.isWhiteHorizontal(_,x-4,x)||We.isWhiteHorizontal(_,x+7,x+11))&&o++,d+6<c&&a[d][x]===1&&a[d+1][x]===0&&a[d+2][x]===1&&a[d+3][x]===1&&a[d+4][x]===1&&a[d+5][x]===0&&a[d+6][x]===1&&(We.isWhiteVertical(a,x,d-4,d)||We.isWhiteVertical(a,x,d+7,d+11))&&o++}return o*We.N3}static isWhiteHorizontal(i,o,a){o=Math.max(o,0),a=Math.min(a,i.length);for(let h=o;h<a;h++)if(i[h]===1)return!1;return!0}static isWhiteVertical(i,o,a,h){a=Math.max(a,0),h=Math.min(h,i.length);for(let c=a;c<h;c++)if(i[c][o]===1)return!1;return!0}static applyMaskPenaltyRule4(i){let o=0;const a=i.getArray(),h=i.getWidth(),c=i.getHeight();for(let _=0;_<c;_++){const C=a[_];for(let M=0;M<h;M++)C[M]===1&&o++}const d=i.getHeight()*i.getWidth();return Math.floor(Math.abs(o*2-d)*10/d)*We.N4}static getDataMaskBit(i,o,a){let h,c;switch(i){case 0:h=a+o&1;break;case 1:h=a&1;break;case 2:h=o%3;break;case 3:h=(a+o)%3;break;case 4:h=Math.floor(a/2)+Math.floor(o/3)&1;break;case 5:c=a*o,h=(c&1)+c%3;break;case 6:c=a*o,h=(c&1)+c%3&1;break;case 7:c=a*o,h=c%3+(a+o&1)&1;break;default:throw new A("Invalid mask pattern: "+i)}return h===0}static applyMaskPenaltyRule1Internal(i,o){let a=0;const h=o?i.getHeight():i.getWidth(),c=o?i.getWidth():i.getHeight(),d=i.getArray();for(let x=0;x<h;x++){let _=0,C=-1;for(let M=0;M<c;M++){const R=o?d[x][M]:d[M][x];R===C?_++:(_>=5&&(a+=We.N1+(_-5)),_=1,C=R)}_>=5&&(a+=We.N1+(_-5))}return a}}We.N1=3,We.N2=3,We.N3=40,We.N4=10;class fr{constructor(i,o){this.width=i,this.height=o;const a=new Array(o);for(let h=0;h!==o;h++)a[h]=new Uint8Array(i);this.bytes=a}getHeight(){return this.height}getWidth(){return this.width}get(i,o){return this.bytes[o][i]}getArray(){return this.bytes}setNumber(i,o,a){this.bytes[o][i]=a}setBoolean(i,o,a){this.bytes[o][i]=a?1:0}clear(i){for(const o of this.bytes)G.fill(o,i)}equals(i){if(!(i instanceof fr))return!1;const o=i;if(this.width!==o.width||this.height!==o.height)return!1;for(let a=0,h=this.height;a<h;++a){const c=this.bytes[a],d=o.bytes[a];for(let x=0,_=this.width;x<_;++x)if(c[x]!==d[x])return!1}return!0}toString(){const i=new yt;for(let o=0,a=this.height;o<a;++o){const h=this.bytes[o];for(let c=0,d=this.width;c<d;++c)switch(h[c]){case 0:i.append(" 0");break;case 1:i.append(" 1");break;default:i.append("  ");break}i.append(`
`)}return i.toString()}}class Zn{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const i=new yt;return i.append(`<<
`),i.append(" mode: "),i.append(this.mode?this.mode.toString():"null"),i.append(`
 ecLevel: `),i.append(this.ecLevel?this.ecLevel.toString():"null"),i.append(`
 version: `),i.append(this.version?this.version.toString():"null"),i.append(`
 maskPattern: `),i.append(this.maskPattern.toString()),this.matrix?(i.append(`
 matrix:
`),i.append(this.matrix.toString())):i.append(`
 matrix: null
`),i.append(`>>
`),i.toString()}setMode(i){this.mode=i}setECLevel(i){this.ecLevel=i}setVersion(i){this.version=i}setMaskPattern(i){this.maskPattern=i}setMatrix(i){this.matrix=i}static isValidMaskPattern(i){return i>=0&&i<Zn.NUM_MASK_PATTERNS}}Zn.NUM_MASK_PATTERNS=8;class zt extends p{}zt.kind="WriterException";class At{constructor(){}static clearMatrix(i){i.clear(255)}static buildMatrix(i,o,a,h,c){At.clearMatrix(c),At.embedBasicPatterns(a,c),At.embedTypeInfo(o,h,c),At.maybeEmbedVersionInfo(a,c),At.embedDataBits(i,h,c)}static embedBasicPatterns(i,o){At.embedPositionDetectionPatternsAndSeparators(o),At.embedDarkDotAtLeftBottomCorner(o),At.maybeEmbedPositionAdjustmentPatterns(i,o),At.embedTimingPatterns(o)}static embedTypeInfo(i,o,a){const h=new Y;At.makeTypeInfoBits(i,o,h);for(let c=0,d=h.getSize();c<d;++c){const x=h.get(h.getSize()-1-c),_=At.TYPE_INFO_COORDINATES[c],C=_[0],M=_[1];if(a.setBoolean(C,M,x),c<8){const R=a.getWidth()-c-1;a.setBoolean(R,8,x)}else{const L=a.getHeight()-7+(c-8);a.setBoolean(8,L,x)}}}static maybeEmbedVersionInfo(i,o){if(i.getVersionNumber()<7)return;const a=new Y;At.makeVersionInfoBits(i,a);let h=6*3-1;for(let c=0;c<6;++c)for(let d=0;d<3;++d){const x=a.get(h);h--,o.setBoolean(c,o.getHeight()-11+d,x),o.setBoolean(o.getHeight()-11+d,c,x)}}static embedDataBits(i,o,a){let h=0,c=-1,d=a.getWidth()-1,x=a.getHeight()-1;for(;d>0;){for(d===6&&(d-=1);x>=0&&x<a.getHeight();){for(let _=0;_<2;++_){const C=d-_;if(!At.isEmpty(a.get(C,x)))continue;let M;h<i.getSize()?(M=i.get(h),++h):M=!1,o!==255&&We.getDataMaskBit(o,C,x)&&(M=!M),a.setBoolean(C,x,M)}x+=c}c=-c,x+=c,d-=2}if(h!==i.getSize())throw new zt("Not all bits consumed: "+h+"/"+i.getSize())}static findMSBSet(i){return 32-X.numberOfLeadingZeros(i)}static calculateBCHCode(i,o){if(o===0)throw new A("0 polynomial");const a=At.findMSBSet(o);for(i<<=a-1;At.findMSBSet(i)>=a;)i^=o<<At.findMSBSet(i)-a;return i}static makeTypeInfoBits(i,o,a){if(!Zn.isValidMaskPattern(o))throw new zt("Invalid mask pattern");const h=i.getBits()<<3|o;a.appendBits(h,5);const c=At.calculateBCHCode(h,At.TYPE_INFO_POLY);a.appendBits(c,10);const d=new Y;if(d.appendBits(At.TYPE_INFO_MASK_PATTERN,15),a.xor(d),a.getSize()!==15)throw new zt("should not happen but we got: "+a.getSize())}static makeVersionInfoBits(i,o){o.appendBits(i.getVersionNumber(),6);const a=At.calculateBCHCode(i.getVersionNumber(),At.VERSION_INFO_POLY);if(o.appendBits(a,12),o.getSize()!==18)throw new zt("should not happen but we got: "+o.getSize())}static isEmpty(i){return i===255}static embedTimingPatterns(i){for(let o=8;o<i.getWidth()-8;++o){const a=(o+1)%2;At.isEmpty(i.get(o,6))&&i.setNumber(o,6,a),At.isEmpty(i.get(6,o))&&i.setNumber(6,o,a)}}static embedDarkDotAtLeftBottomCorner(i){if(i.get(8,i.getHeight()-8)===0)throw new zt;i.setNumber(8,i.getHeight()-8,1)}static embedHorizontalSeparationPattern(i,o,a){for(let h=0;h<8;++h){if(!At.isEmpty(a.get(i+h,o)))throw new zt;a.setNumber(i+h,o,0)}}static embedVerticalSeparationPattern(i,o,a){for(let h=0;h<7;++h){if(!At.isEmpty(a.get(i,o+h)))throw new zt;a.setNumber(i,o+h,0)}}static embedPositionAdjustmentPattern(i,o,a){for(let h=0;h<5;++h){const c=At.POSITION_ADJUSTMENT_PATTERN[h];for(let d=0;d<5;++d)a.setNumber(i+d,o+h,c[d])}}static embedPositionDetectionPattern(i,o,a){for(let h=0;h<7;++h){const c=At.POSITION_DETECTION_PATTERN[h];for(let d=0;d<7;++d)a.setNumber(i+d,o+h,c[d])}}static embedPositionDetectionPatternsAndSeparators(i){const o=At.POSITION_DETECTION_PATTERN[0].length;At.embedPositionDetectionPattern(0,0,i),At.embedPositionDetectionPattern(i.getWidth()-o,0,i),At.embedPositionDetectionPattern(0,i.getWidth()-o,i);const a=8;At.embedHorizontalSeparationPattern(0,a-1,i),At.embedHorizontalSeparationPattern(i.getWidth()-a,a-1,i),At.embedHorizontalSeparationPattern(0,i.getWidth()-a,i);const h=7;At.embedVerticalSeparationPattern(h,0,i),At.embedVerticalSeparationPattern(i.getHeight()-h-1,0,i),At.embedVerticalSeparationPattern(h,i.getHeight()-h,i)}static maybeEmbedPositionAdjustmentPatterns(i,o){if(i.getVersionNumber()<2)return;const a=i.getVersionNumber()-1,h=At.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[a];for(let c=0,d=h.length;c!==d;c++){const x=h[c];if(x>=0)for(let _=0;_!==d;_++){const C=h[_];C>=0&&At.isEmpty(o.get(C,x))&&At.embedPositionAdjustmentPattern(C-2,x-2,o)}}}}At.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),At.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),At.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),At.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),At.VERSION_INFO_POLY=7973,At.TYPE_INFO_POLY=1335,At.TYPE_INFO_MASK_PATTERN=21522;class El{constructor(i,o){this.dataBytes=i,this.errorCorrectionBytes=o}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class be{constructor(){}static calculateMaskPenalty(i){return We.applyMaskPenaltyRule1(i)+We.applyMaskPenaltyRule2(i)+We.applyMaskPenaltyRule3(i)+We.applyMaskPenaltyRule4(i)}static encode(i,o,a=null){let h=be.DEFAULT_BYTE_MODE_ENCODING;const c=a!==null&&a.get(ai.CHARACTER_SET)!==void 0;c&&(h=a.get(ai.CHARACTER_SET).toString());const d=this.chooseMode(i,h),x=new Y;if(d===Pt.BYTE&&(c||be.DEFAULT_BYTE_MODE_ENCODING!==h)){const _t=Z.getCharacterSetECIByName(h);_t!==void 0&&this.appendECI(_t,x)}this.appendModeInfo(d,x);const _=new Y;this.appendBytes(i,d,_,h);let C;if(a!==null&&a.get(ai.QR_VERSION)!==void 0){const _t=Number.parseInt(a.get(ai.QR_VERSION).toString(),10);C=Dt.getVersionForNumber(_t);const dt=this.calculateBitsNeeded(d,x,_,C);if(!this.willFit(dt,C,o))throw new zt("Data too big for requested version")}else C=this.recommendVersion(o,d,x,_);const M=new Y;M.appendBitArray(x);const R=d===Pt.BYTE?_.getSizeInBytes():i.length;this.appendLengthInfo(R,C,d,M),M.appendBitArray(_);const L=C.getECBlocksForLevel(o),k=C.getTotalCodewords()-L.getTotalECCodewords();this.terminateBits(k,M);const V=this.interleaveWithECBytes(M,C.getTotalCodewords(),k,L.getNumBlocks()),H=new Zn;H.setECLevel(o),H.setMode(d),H.setVersion(C);const $=C.getDimensionForVersion(),nt=new fr($,$),xt=this.chooseMaskPattern(V,o,C,nt);return H.setMaskPattern(xt),At.buildMatrix(V,o,C,xt,nt),H.setMatrix(nt),H}static recommendVersion(i,o,a,h){const c=this.calculateBitsNeeded(o,a,h,Dt.getVersionForNumber(1)),d=this.chooseVersion(c,i),x=this.calculateBitsNeeded(o,a,h,d);return this.chooseVersion(x,i)}static calculateBitsNeeded(i,o,a,h){return o.getSize()+i.getCharacterCountBits(h)+a.getSize()}static getAlphanumericCode(i){return i<be.ALPHANUMERIC_TABLE.length?be.ALPHANUMERIC_TABLE[i]:-1}static chooseMode(i,o=null){if(Z.SJIS.getName()===o&&this.isOnlyDoubleByteKanji(i))return Pt.KANJI;let a=!1,h=!1;for(let c=0,d=i.length;c<d;++c){const x=i.charAt(c);if(be.isDigit(x))a=!0;else if(this.getAlphanumericCode(x.charCodeAt(0))!==-1)h=!0;else return Pt.BYTE}return h?Pt.ALPHANUMERIC:a?Pt.NUMERIC:Pt.BYTE}static isOnlyDoubleByteKanji(i){let o;try{o=St.encode(i,Z.SJIS)}catch{return!1}const a=o.length;if(a%2!==0)return!1;for(let h=0;h<a;h+=2){const c=o[h]&255;if((c<129||c>159)&&(c<224||c>235))return!1}return!0}static chooseMaskPattern(i,o,a,h){let c=Number.MAX_SAFE_INTEGER,d=-1;for(let x=0;x<Zn.NUM_MASK_PATTERNS;x++){At.buildMatrix(i,o,a,x,h);let _=this.calculateMaskPenalty(h);_<c&&(c=_,d=x)}return d}static chooseVersion(i,o){for(let a=1;a<=40;a++){const h=Dt.getVersionForNumber(a);if(be.willFit(i,h,o))return h}throw new zt("Data too big")}static willFit(i,o,a){const h=o.getTotalCodewords(),d=o.getECBlocksForLevel(a).getTotalECCodewords(),x=h-d,_=(i+7)/8;return x>=_}static terminateBits(i,o){const a=i*8;if(o.getSize()>a)throw new zt("data bits cannot fit in the QR Code"+o.getSize()+" > "+a);for(let d=0;d<4&&o.getSize()<a;++d)o.appendBit(!1);const h=o.getSize()&7;if(h>0)for(let d=h;d<8;d++)o.appendBit(!1);const c=i-o.getSizeInBytes();for(let d=0;d<c;++d)o.appendBits(d&1?17:236,8);if(o.getSize()!==a)throw new zt("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(i,o,a,h,c,d){if(h>=a)throw new zt("Block ID too large");const x=i%a,_=a-x,C=Math.floor(i/a),M=C+1,R=Math.floor(o/a),L=R+1,k=C-R,V=M-L;if(k!==V)throw new zt("EC bytes mismatch");if(a!==_+x)throw new zt("RS blocks mismatch");if(i!==(R+k)*_+(L+V)*x)throw new zt("Total bytes mismatch");h<_?(c[0]=R,d[0]=k):(c[0]=L,d[0]=V)}static interleaveWithECBytes(i,o,a,h){if(i.getSizeInBytes()!==a)throw new zt("Number of bits and data bytes does not match");let c=0,d=0,x=0;const _=new Array;for(let M=0;M<h;++M){const R=new Int32Array(1),L=new Int32Array(1);be.getNumDataBytesAndNumECBytesForBlockID(o,a,h,M,R,L);const k=R[0],V=new Uint8Array(k);i.toBytes(8*c,V,0,k);const H=be.generateECBytes(V,L[0]);_.push(new El(V,H)),d=Math.max(d,k),x=Math.max(x,H.length),c+=R[0]}if(a!==c)throw new zt("Data bytes does not match offset");const C=new Y;for(let M=0;M<d;++M)for(const R of _){const L=R.getDataBytes();M<L.length&&C.appendBits(L[M],8)}for(let M=0;M<x;++M)for(const R of _){const L=R.getErrorCorrectionBytes();M<L.length&&C.appendBits(L[M],8)}if(o!==C.getSizeInBytes())throw new zt("Interleaving error: "+o+" and "+C.getSizeInBytes()+" differ.");return C}static generateECBytes(i,o){const a=i.length,h=new Int32Array(a+o);for(let d=0;d<a;d++)h[d]=i[d]&255;new Qr(ie.QR_CODE_FIELD_256).encode(h,o);const c=new Uint8Array(o);for(let d=0;d<o;d++)c[d]=h[a+d];return c}static appendModeInfo(i,o){o.appendBits(i.getBits(),4)}static appendLengthInfo(i,o,a,h){const c=a.getCharacterCountBits(o);if(i>=1<<c)throw new zt(i+" is bigger than "+((1<<c)-1));h.appendBits(i,c)}static appendBytes(i,o,a,h){switch(o){case Pt.NUMERIC:be.appendNumericBytes(i,a);break;case Pt.ALPHANUMERIC:be.appendAlphanumericBytes(i,a);break;case Pt.BYTE:be.append8BitBytes(i,a,h);break;case Pt.KANJI:be.appendKanjiBytes(i,a);break;default:throw new zt("Invalid mode: "+o)}}static getDigit(i){return i.charCodeAt(0)-48}static isDigit(i){const o=be.getDigit(i);return o>=0&&o<=9}static appendNumericBytes(i,o){const a=i.length;let h=0;for(;h<a;){const c=be.getDigit(i.charAt(h));if(h+2<a){const d=be.getDigit(i.charAt(h+1)),x=be.getDigit(i.charAt(h+2));o.appendBits(c*100+d*10+x,10),h+=3}else if(h+1<a){const d=be.getDigit(i.charAt(h+1));o.appendBits(c*10+d,7),h+=2}else o.appendBits(c,4),h++}}static appendAlphanumericBytes(i,o){const a=i.length;let h=0;for(;h<a;){const c=be.getAlphanumericCode(i.charCodeAt(h));if(c===-1)throw new zt;if(h+1<a){const d=be.getAlphanumericCode(i.charCodeAt(h+1));if(d===-1)throw new zt;o.appendBits(c*45+d,11),h+=2}else o.appendBits(c,6),h++}}static append8BitBytes(i,o,a){let h;try{h=St.encode(i,a)}catch(c){throw new zt(c)}for(let c=0,d=h.length;c!==d;c++){const x=h[c];o.appendBits(x,8)}}static appendKanjiBytes(i,o){let a;try{a=St.encode(i,Z.SJIS)}catch(c){throw new zt(c)}const h=a.length;for(let c=0;c<h;c+=2){const d=a[c]&255,x=a[c+1]&255,_=d<<8&4294967295|x;let C=-1;if(_>=33088&&_<=40956?C=_-33088:_>=57408&&_<=60351&&(C=_-49472),C===-1)throw new zt("Invalid byte sequence");const M=(C>>8)*192+(C&255);o.appendBits(M,13)}}static appendECI(i,o){o.appendBits(Pt.ECI.getBits(),4),o.appendBits(i.getValue(),8)}}be.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),be.DEFAULT_BYTE_MODE_ENCODING=Z.UTF8.getName();class Ki{write(i,o,a,h=null){if(i.length===0)throw new A("Found empty contents");if(o<0||a<0)throw new A("Requested dimensions are too small: "+o+"x"+a);let c=Ee.L,d=Ki.QUIET_ZONE_SIZE;h!==null&&(h.get(ai.ERROR_CORRECTION)!==void 0&&(c=Ee.fromString(h.get(ai.ERROR_CORRECTION).toString())),h.get(ai.MARGIN)!==void 0&&(d=Number.parseInt(h.get(ai.MARGIN).toString(),10)));const x=be.encode(i,c,h);return this.renderResult(x,o,a,d)}writeToDom(i,o,a,h,c=null){typeof i=="string"&&(i=document.querySelector(i));const d=this.write(o,a,h,c);i&&i.appendChild(d)}renderResult(i,o,a,h){const c=i.getMatrix();if(c===null)throw new li;const d=c.getWidth(),x=c.getHeight(),_=d+h*2,C=x+h*2,M=Math.max(o,_),R=Math.max(a,C),L=Math.min(Math.floor(M/_),Math.floor(R/C)),k=Math.floor((M-d*L)/2),V=Math.floor((R-x*L)/2),H=this.createSVGElement(M,R);for(let $=0,nt=V;$<x;$++,nt+=L)for(let xt=0,_t=k;xt<d;xt++,_t+=L)if(c.get(xt,$)===1){const dt=this.createSvgRectElement(_t,nt,L,L);H.appendChild(dt)}return H}createSVGElement(i,o){const a=document.createElementNS(Ki.SVG_NS,"svg");return a.setAttributeNS(null,"height",i.toString()),a.setAttributeNS(null,"width",o.toString()),a}createSvgRectElement(i,o,a,h){const c=document.createElementNS(Ki.SVG_NS,"rect");return c.setAttributeNS(null,"x",i.toString()),c.setAttributeNS(null,"y",o.toString()),c.setAttributeNS(null,"height",a.toString()),c.setAttributeNS(null,"width",h.toString()),c.setAttributeNS(null,"fill","#000000"),c}}Ki.QUIET_ZONE_SIZE=4,Ki.SVG_NS="http://www.w3.org/2000/svg";class Kn{encode(i,o,a,h,c){if(i.length===0)throw new A("Found empty contents");if(o!==Tt.QR_CODE)throw new A("Can only encode QR_CODE, but got "+o);if(a<0||h<0)throw new A(`Requested dimensions are too small: ${a}x${h}`);let d=Ee.L,x=Kn.QUIET_ZONE_SIZE;c!==null&&(c.get(ai.ERROR_CORRECTION)!==void 0&&(d=Ee.fromString(c.get(ai.ERROR_CORRECTION).toString())),c.get(ai.MARGIN)!==void 0&&(x=Number.parseInt(c.get(ai.MARGIN).toString(),10)));const _=be.encode(i,d,c);return Kn.renderResult(_,a,h,x)}static renderResult(i,o,a,h){const c=i.getMatrix();if(c===null)throw new li;const d=c.getWidth(),x=c.getHeight(),_=d+h*2,C=x+h*2,M=Math.max(o,_),R=Math.max(a,C),L=Math.min(Math.floor(M/_),Math.floor(R/C)),k=Math.floor((M-d*L)/2),V=Math.floor((R-x*L)/2),H=new Nt(M,R);for(let $=0,nt=V;$<x;$++,nt+=L)for(let xt=0,_t=k;xt<d;xt++,_t+=L)c.get(xt,$)===1&&H.setRegion(_t,nt,L,L);return H}}Kn.QUIET_ZONE_SIZE=4;class Zo{encode(i,o,a,h,c){let d;switch(o){case Tt.QR_CODE:d=new Kn;break;default:throw new A("No encoder available for format "+o)}return d.encode(i,o,a,h,c)}}class qi extends Wt{constructor(i,o,a,h,c,d,x,_){if(super(d,x),this.yuvData=i,this.dataWidth=o,this.dataHeight=a,this.left=h,this.top=c,h+d>o||c+x>a)throw new A("Crop rectangle does not fit within image data.");_&&this.reverseHorizontal(d,x)}getRow(i,o){if(i<0||i>=this.getHeight())throw new A("Requested row is outside the image: "+i);const a=this.getWidth();(o==null||o.length<a)&&(o=new Uint8ClampedArray(a));const h=(i+this.top)*this.dataWidth+this.left;return F.arraycopy(this.yuvData,h,o,0,a),o}getMatrix(){const i=this.getWidth(),o=this.getHeight();if(i===this.dataWidth&&o===this.dataHeight)return this.yuvData;const a=i*o,h=new Uint8ClampedArray(a);let c=this.top*this.dataWidth+this.left;if(i===this.dataWidth)return F.arraycopy(this.yuvData,c,h,0,a),h;for(let d=0;d<o;d++){const x=d*i;F.arraycopy(this.yuvData,c,h,x,i),c+=this.dataWidth}return h}isCropSupported(){return!0}crop(i,o,a,h){return new qi(this.yuvData,this.dataWidth,this.dataHeight,this.left+i,this.top+o,a,h,!1)}renderThumbnail(){const i=this.getWidth()/qi.THUMBNAIL_SCALE_FACTOR,o=this.getHeight()/qi.THUMBNAIL_SCALE_FACTOR,a=new Int32Array(i*o),h=this.yuvData;let c=this.top*this.dataWidth+this.left;for(let d=0;d<o;d++){const x=d*i;for(let _=0;_<i;_++){const C=h[c+_*qi.THUMBNAIL_SCALE_FACTOR]&255;a[x+_]=4278190080|C*65793}c+=this.dataWidth*qi.THUMBNAIL_SCALE_FACTOR}return a}getThumbnailWidth(){return this.getWidth()/qi.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/qi.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(i,o){const a=this.yuvData;for(let h=0,c=this.top*this.dataWidth+this.left;h<o;h++,c+=this.dataWidth){const d=c+i/2;for(let x=c,_=c+i-1;x<d;x++,_--){const C=a[x];a[x]=a[_],a[_]=C}}}invert(){return new re(this)}}qi.THUMBNAIL_SCALE_FACTOR=2;class Jr extends Wt{constructor(i,o,a,h,c,d,x){if(super(o,a),this.dataWidth=h,this.dataHeight=c,this.left=d,this.top=x,i.BYTES_PER_ELEMENT===4){const _=o*a,C=new Uint8ClampedArray(_);for(let M=0;M<_;M++){const R=i[M],L=R>>16&255,k=R>>7&510,V=R&255;C[M]=(L+k+V)/4&255}this.luminances=C}else this.luminances=i;if(h===void 0&&(this.dataWidth=o),c===void 0&&(this.dataHeight=a),d===void 0&&(this.left=0),x===void 0&&(this.top=0),this.left+o>this.dataWidth||this.top+a>this.dataHeight)throw new A("Crop rectangle does not fit within image data.")}getRow(i,o){if(i<0||i>=this.getHeight())throw new A("Requested row is outside the image: "+i);const a=this.getWidth();(o==null||o.length<a)&&(o=new Uint8ClampedArray(a));const h=(i+this.top)*this.dataWidth+this.left;return F.arraycopy(this.luminances,h,o,0,a),o}getMatrix(){const i=this.getWidth(),o=this.getHeight();if(i===this.dataWidth&&o===this.dataHeight)return this.luminances;const a=i*o,h=new Uint8ClampedArray(a);let c=this.top*this.dataWidth+this.left;if(i===this.dataWidth)return F.arraycopy(this.luminances,c,h,0,a),h;for(let d=0;d<o;d++){const x=d*i;F.arraycopy(this.luminances,c,h,x,i),c+=this.dataWidth}return h}isCropSupported(){return!0}crop(i,o,a,h){return new Jr(this.luminances,a,h,this.dataWidth,this.dataHeight,this.left+i,this.top+o)}invert(){return new re(this)}}class qn extends Z{static forName(i){return this.getCharacterSetECIByName(i)}}class _s{}_s.ISO_8859_1=Z.ISO8859_1;class Ko{isCompact(){return this.compact}setCompact(i){this.compact=i}getSize(){return this.size}setSize(i){this.size=i}getLayers(){return this.layers}setLayers(i){this.layers=i}getCodeWords(){return this.codeWords}setCodeWords(i){this.codeWords=i}getMatrix(){return this.matrix}setMatrix(i){this.matrix=i}}class qo{static singletonList(i){return[i]}static min(i,o){return i.sort(o)[0]}}class wl{constructor(i){this.previous=i}getPrevious(){return this.previous}}class He extends wl{constructor(i,o,a){super(i),this.value=o,this.bitCount=a}appendTo(i,o){i.appendBits(this.value,this.bitCount)}add(i,o){return new He(this,i,o)}addBinaryShift(i,o){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new He(this,i,o)}toString(){let i=this.value&(1<<this.bitCount)-1;return i|=1<<this.bitCount,"<"+X.toBinaryString(i|1<<this.bitCount).substring(1)+">"}}class Qn extends He{constructor(i,o,a){super(i,0,0),this.binaryShiftStart=o,this.binaryShiftByteCount=a}appendTo(i,o){for(let a=0;a<this.binaryShiftByteCount;a++)(a===0||a===31&&this.binaryShiftByteCount<=62)&&(i.appendBits(31,5),this.binaryShiftByteCount>62?i.appendBits(this.binaryShiftByteCount-31,16):a===0?i.appendBits(Math.min(this.binaryShiftByteCount,31),5):i.appendBits(this.binaryShiftByteCount-31,5)),i.appendBits(o[this.binaryShiftStart+a],8)}addBinaryShift(i,o){return new Qn(this,i,o)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Cl(T,i,o){return new Qn(T,i,o)}function Ws(T,i,o){return new He(T,i,o)}const f=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],y=0,w=1,S=2,I=3,v=4,O=new He(null,0,0),N=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function U(T){for(let i of T)G.fill(i,-1);return T[y][v]=0,T[w][v]=0,T[w][y]=28,T[I][v]=0,T[S][v]=0,T[S][y]=15,T}const W=U(G.createInt32Array(6,6));class q{constructor(i,o,a,h){this.token=i,this.mode=o,this.binaryShiftByteCount=a,this.bitCount=h}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(i,o){let a=this.bitCount,h=this.token;if(i!==this.mode){let d=N[this.mode][i];h=Ws(h,d&65535,d>>16),a+=d>>16}let c=i===S?4:5;return h=Ws(h,o,c),new q(h,i,0,a+c)}shiftAndAppend(i,o){let a=this.token,h=this.mode===S?4:5;return a=Ws(a,W[this.mode][i],h),a=Ws(a,o,5),new q(a,this.mode,0,this.bitCount+h+5)}addBinaryShiftChar(i){let o=this.token,a=this.mode,h=this.bitCount;if(this.mode===v||this.mode===S){let x=N[a][y];o=Ws(o,x&65535,x>>16),h+=x>>16,a=y}let c=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,d=new q(o,a,this.binaryShiftByteCount+1,h+c);return d.binaryShiftByteCount===2078&&(d=d.endBinaryShift(i+1)),d}endBinaryShift(i){if(this.binaryShiftByteCount===0)return this;let o=this.token;return o=Cl(o,i-this.binaryShiftByteCount,this.binaryShiftByteCount),new q(o,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(i){let o=this.bitCount+(N[this.mode][i.mode]>>16);return this.binaryShiftByteCount<i.binaryShiftByteCount?o+=q.calculateBinaryShiftCost(i)-q.calculateBinaryShiftCost(this):this.binaryShiftByteCount>i.binaryShiftByteCount&&i.binaryShiftByteCount>0&&(o+=10),o<=i.bitCount}toBitArray(i){let o=[];for(let h=this.endBinaryShift(i.length).token;h!==null;h=h.getPrevious())o.unshift(h);let a=new Y;for(const h of o)h.appendTo(a,i);return a}toString(){return ut.format("%s bits=%d bytes=%d",f[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(i){return i.binaryShiftByteCount>62?21:i.binaryShiftByteCount>31?20:i.binaryShiftByteCount>0?10:0}}q.INITIAL_STATE=new q(O,y,0,0);function et(T){const i=ut.getCharCode(" "),o=ut.getCharCode("."),a=ut.getCharCode(",");T[y][i]=1;const h=ut.getCharCode("Z"),c=ut.getCharCode("A");for(let L=c;L<=h;L++)T[y][L]=L-c+2;T[w][i]=1;const d=ut.getCharCode("z"),x=ut.getCharCode("a");for(let L=x;L<=d;L++)T[w][L]=L-x+2;T[S][i]=1;const _=ut.getCharCode("9"),C=ut.getCharCode("0");for(let L=C;L<=_;L++)T[S][L]=L-C+2;T[S][a]=12,T[S][o]=13;const M=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let L=0;L<M.length;L++)T[I][ut.getCharCode(M[L])]=L;const R=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let L=0;L<R.length;L++)ut.getCharCode(R[L])>0&&(T[v][ut.getCharCode(R[L])]=L);return T}const lt=et(G.createInt32Array(5,256));class mt{constructor(i){this.text=i}encode(){const i=ut.getCharCode(" "),o=ut.getCharCode(`
`);let a=qo.singletonList(q.INITIAL_STATE);for(let c=0;c<this.text.length;c++){let d,x=c+1<this.text.length?this.text[c+1]:0;switch(this.text[c]){case ut.getCharCode("\r"):d=x===o?2:0;break;case ut.getCharCode("."):d=x===i?3:0;break;case ut.getCharCode(","):d=x===i?4:0;break;case ut.getCharCode(":"):d=x===i?5:0;break;default:d=0}d>0?(a=mt.updateStateListForPair(a,c,d),c++):a=this.updateStateListForChar(a,c)}return qo.min(a,(c,d)=>c.getBitCount()-d.getBitCount()).toBitArray(this.text)}updateStateListForChar(i,o){const a=[];for(let h of i)this.updateStateForChar(h,o,a);return mt.simplifyStates(a)}updateStateForChar(i,o,a){let h=this.text[o]&255,c=lt[i.getMode()][h]>0,d=null;for(let x=0;x<=v;x++){let _=lt[x][h];if(_>0){if(d==null&&(d=i.endBinaryShift(o)),!c||x===i.getMode()||x===S){const C=d.latchAndAppend(x,_);a.push(C)}if(!c&&W[i.getMode()][x]>=0){const C=d.shiftAndAppend(x,_);a.push(C)}}}if(i.getBinaryShiftByteCount()>0||lt[i.getMode()][h]===0){let x=i.addBinaryShiftChar(o);a.push(x)}}static updateStateListForPair(i,o,a){const h=[];for(let c of i)this.updateStateForPair(c,o,a,h);return this.simplifyStates(h)}static updateStateForPair(i,o,a,h){let c=i.endBinaryShift(o);if(h.push(c.latchAndAppend(v,a)),i.getMode()!==v&&h.push(c.shiftAndAppend(v,a)),a===3||a===4){let d=c.latchAndAppend(S,16-a).latchAndAppend(S,1);h.push(d)}if(i.getBinaryShiftByteCount()>0){let d=i.addBinaryShiftChar(o).addBinaryShiftChar(o+1);h.push(d)}}static simplifyStates(i){let o=[];for(const a of i){let h=!0;for(const c of o){if(c.isBetterThanOrEqualTo(a)){h=!1;break}a.isBetterThanOrEqualTo(c)&&(o=o.filter(d=>d!==c))}h&&o.push(a)}return o}}class st{constructor(){}static encodeBytes(i){return st.encode(i,st.DEFAULT_EC_PERCENT,st.DEFAULT_AZTEC_LAYERS)}static encode(i,o,a){let h=new mt(i).encode(),c=X.truncDivision(h.getSize()*o,100)+11,d=h.getSize()+c,x,_,C,M,R;if(a!==st.DEFAULT_AZTEC_LAYERS){if(x=a<0,_=Math.abs(a),_>(x?st.MAX_NB_BITS_COMPACT:st.MAX_NB_BITS))throw new A(ut.format("Illegal value %s for layers",a));C=st.totalBitsInLayer(_,x),M=st.WORD_SIZE[_];let dt=C-C%M;if(R=st.stuffBits(h,M),R.getSize()+c>dt)throw new A("Data to large for user specified layer");if(x&&R.getSize()>M*64)throw new A("Data to large for user specified layer")}else{M=0,R=null;for(let dt=0;;dt++){if(dt>st.MAX_NB_BITS)throw new A("Data too large for an Aztec code");if(x=dt<=3,_=x?dt+1:dt,C=st.totalBitsInLayer(_,x),d>C)continue;(R==null||M!==st.WORD_SIZE[_])&&(M=st.WORD_SIZE[_],R=st.stuffBits(h,M));let ae=C-C%M;if(!(x&&R.getSize()>M*64)&&R.getSize()+c<=ae)break}}let L=st.generateCheckWords(R,C,M),k=R.getSize()/M,V=st.generateModeMessage(x,_,k),H=(x?11:14)+_*4,$=new Int32Array(H),nt;if(x){nt=H;for(let dt=0;dt<$.length;dt++)$[dt]=dt}else{nt=H+1+2*X.truncDivision(X.truncDivision(H,2)-1,15);let dt=X.truncDivision(H,2),ae=X.truncDivision(nt,2);for(let Kt=0;Kt<dt;Kt++){let Gi=Kt+X.truncDivision(Kt,15);$[dt-Kt-1]=ae-Gi-1,$[dt+Kt]=ae+Gi+1}}let xt=new Nt(nt);for(let dt=0,ae=0;dt<_;dt++){let Kt=(_-dt)*4+(x?9:12);for(let Gi=0;Gi<Kt;Gi++){let Cn=Gi*2;for(let zi=0;zi<2;zi++)L.get(ae+Cn+zi)&&xt.set($[dt*2+zi],$[dt*2+Gi]),L.get(ae+Kt*2+Cn+zi)&&xt.set($[dt*2+Gi],$[H-1-dt*2-zi]),L.get(ae+Kt*4+Cn+zi)&&xt.set($[H-1-dt*2-zi],$[H-1-dt*2-Gi]),L.get(ae+Kt*6+Cn+zi)&&xt.set($[H-1-dt*2-Gi],$[dt*2+zi])}ae+=Kt*8}if(st.drawModeMessage(xt,x,nt,V),x)st.drawBullsEye(xt,X.truncDivision(nt,2),5);else{st.drawBullsEye(xt,X.truncDivision(nt,2),7);for(let dt=0,ae=0;dt<X.truncDivision(H,2)-1;dt+=15,ae+=16)for(let Kt=X.truncDivision(nt,2)&1;Kt<nt;Kt+=2)xt.set(X.truncDivision(nt,2)-ae,Kt),xt.set(X.truncDivision(nt,2)+ae,Kt),xt.set(Kt,X.truncDivision(nt,2)-ae),xt.set(Kt,X.truncDivision(nt,2)+ae)}let _t=new Ko;return _t.setCompact(x),_t.setSize(nt),_t.setLayers(_),_t.setCodeWords(k),_t.setMatrix(xt),_t}static drawBullsEye(i,o,a){for(let h=0;h<a;h+=2)for(let c=o-h;c<=o+h;c++)i.set(c,o-h),i.set(c,o+h),i.set(o-h,c),i.set(o+h,c);i.set(o-a,o-a),i.set(o-a+1,o-a),i.set(o-a,o-a+1),i.set(o+a,o-a),i.set(o+a,o-a+1),i.set(o+a,o+a-1)}static generateModeMessage(i,o,a){let h=new Y;return i?(h.appendBits(o-1,2),h.appendBits(a-1,6),h=st.generateCheckWords(h,28,4)):(h.appendBits(o-1,5),h.appendBits(a-1,11),h=st.generateCheckWords(h,40,4)),h}static drawModeMessage(i,o,a,h){let c=X.truncDivision(a,2);if(o)for(let d=0;d<7;d++){let x=c-3+d;h.get(d)&&i.set(x,c-5),h.get(d+7)&&i.set(c+5,x),h.get(20-d)&&i.set(x,c+5),h.get(27-d)&&i.set(c-5,x)}else for(let d=0;d<10;d++){let x=c-5+d+X.truncDivision(d,5);h.get(d)&&i.set(x,c-7),h.get(d+10)&&i.set(c+7,x),h.get(29-d)&&i.set(x,c+7),h.get(39-d)&&i.set(c-7,x)}}static generateCheckWords(i,o,a){let h=i.getSize()/a,c=new Qr(st.getGF(a)),d=X.truncDivision(o,a),x=st.bitsToWords(i,a,d);c.encode(x,d-h);let _=o%a,C=new Y;C.appendBits(0,_);for(const M of Array.from(x))C.appendBits(M,a);return C}static bitsToWords(i,o,a){let h=new Int32Array(a),c,d;for(c=0,d=i.getSize()/o;c<d;c++){let x=0;for(let _=0;_<o;_++)x|=i.get(c*o+_)?1<<o-_-1:0;h[c]=x}return h}static getGF(i){switch(i){case 4:return ie.AZTEC_PARAM;case 6:return ie.AZTEC_DATA_6;case 8:return ie.AZTEC_DATA_8;case 10:return ie.AZTEC_DATA_10;case 12:return ie.AZTEC_DATA_12;default:throw new A("Unsupported word size "+i)}}static stuffBits(i,o){let a=new Y,h=i.getSize(),c=(1<<o)-2;for(let d=0;d<h;d+=o){let x=0;for(let _=0;_<o;_++)(d+_>=h||i.get(d+_))&&(x|=1<<o-1-_);(x&c)===c?(a.appendBits(x&c,o),d--):x&c?a.appendBits(x,o):(a.appendBits(x|1,o),d--)}return a}static totalBitsInLayer(i,o){return((o?88:112)+16*i)*i}}st.DEFAULT_EC_PERCENT=33,st.DEFAULT_AZTEC_LAYERS=0,st.MAX_NB_BITS=32,st.MAX_NB_BITS_COMPACT=4,st.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class Ct{encode(i,o,a,h){return this.encodeWithHints(i,o,a,h,null)}encodeWithHints(i,o,a,h,c){let d=_s.ISO_8859_1,x=st.DEFAULT_EC_PERCENT,_=st.DEFAULT_AZTEC_LAYERS;return c!=null&&(c.has(ai.CHARACTER_SET)&&(d=qn.forName(c.get(ai.CHARACTER_SET).toString())),c.has(ai.ERROR_CORRECTION)&&(x=X.parseInt(c.get(ai.ERROR_CORRECTION).toString())),c.has(ai.AZTEC_LAYERS)&&(_=X.parseInt(c.get(ai.AZTEC_LAYERS).toString()))),Ct.encodeLayers(i,o,a,h,d,x,_)}static encodeLayers(i,o,a,h,c,d,x){if(o!==Tt.AZTEC)throw new A("Can only encode AZTEC, but got "+o);let _=st.encode(ut.getBytes(i,c),d,x);return Ct.renderResult(_,a,h)}static renderResult(i,o,a){let h=i.getMatrix();if(h==null)throw new li;let c=h.getWidth(),d=h.getHeight(),x=Math.max(o,c),_=Math.max(a,d),C=Math.min(x/c,_/d),M=(x-c*C)/2,R=(_-d*C)/2,L=new Nt(x,_);for(let k=0,V=R;k<d;k++,V+=C)for(let H=0,$=M;H<c;H++,$+=C)h.get(H,k)&&L.setRegion($,V,C,C);return L}}e.AbstractExpandedDecoder=ds,e.ArgumentException=E,e.ArithmeticException=ze,e.AztecCode=Ko,e.AztecCodeReader=Xn,e.AztecCodeWriter=Ct,e.AztecDecoder=le,e.AztecDetector=ar,e.AztecDetectorResult=on,e.AztecEncoder=st,e.AztecHighLevelEncoder=mt,e.AztecPoint=he,e.BarcodeFormat=Tt,e.Binarizer=P,e.BinaryBitmap=b,e.BitArray=Y,e.BitMatrix=Nt,e.BitSource=cr,e.BrowserAztecCodeReader=Vn,e.BrowserBarcodeReader=ri,e.BrowserCodeReader=$t,e.BrowserDatamatrixCodeReader=ki,e.BrowserMultiFormatReader=pl,e.BrowserPDF417Reader=_l,e.BrowserQRCodeReader=yl,e.BrowserQRCodeSvgWriter=Ki,e.CharacterSetECI=Z,e.ChecksumException=D,e.Code128Reader=wt,e.Code39Reader=Se,e.DataMatrixDecodedBitStreamParser=pn,e.DataMatrixReader=Ve,e.DecodeHintType=rt,e.DecoderResult=fi,e.DefaultGridSampler=Hi,e.DetectorResult=yi,e.EAN13Reader=Fi,e.EncodeHintType=ai,e.Exception=p,e.FormatException=K,e.GenericGF=ie,e.GenericGFPoly=Ze,e.GlobalHistogramBinarizer=gt,e.GridSampler=Bi,e.GridSamplerInstance=Ke,e.HTMLCanvasElementLuminanceSource=Ut,e.HybridBinarizer=Et,e.ITFReader=ne,e.IllegalArgumentException=A,e.IllegalStateException=li,e.InvertedLuminanceSource=re,e.LuminanceSource=Wt,e.MathUtils=te,e.MultiFormatOneDReader=ps,e.MultiFormatReader=Ho,e.MultiFormatWriter=Zo,e.NotFoundException=J,e.OneDReader=Ce,e.PDF417DecodedBitStreamParser=it,e.PDF417DecoderErrorCorrection=Wo,e.PDF417Reader=ui,e.PDF417ResultMetadata=wn,e.PerspectiveTransform=ni,e.PlanarYUVLuminanceSource=qi,e.QRCodeByteMatrix=fr,e.QRCodeDataMask=wi,e.QRCodeDecodedBitStreamParser=De,e.QRCodeDecoderErrorCorrectionLevel=Ee,e.QRCodeDecoderFormatInformation=mi,e.QRCodeEncoder=be,e.QRCodeEncoderQRCode=Zn,e.QRCodeMaskUtil=We,e.QRCodeMatrixUtil=At,e.QRCodeMode=Pt,e.QRCodeReader=un,e.QRCodeVersion=Dt,e.QRCodeWriter=Kn,e.RGBLuminanceSource=Jr,e.RSS14Reader=Rt,e.RSSExpandedReader=ct,e.ReaderException=js,e.ReedSolomonDecoder=_i,e.ReedSolomonEncoder=Qr,e.ReedSolomonException=di,e.Result=ft,e.ResultMetadataType=_e,e.ResultPoint=Mt,e.StringUtils=ut,e.UnsupportedOperationException=Ot,e.VideoInputDevice=Jt,e.WhiteRectangleDetector=hi,e.WriterException=zt,e.ZXingArrays=G,e.ZXingCharset=qn,e.ZXingInteger=X,e.ZXingStandardCharsets=_s,e.ZXingStringBuilder=yt,e.ZXingStringEncoding=St,e.ZXingSystem=F,e.createAbstractExpandedDecoder=ms,Object.defineProperty(e,"__esModule",{value:!0})})})(_h,_h.exports);var Ue=_h.exports;const Kx=xf(Ue),qx=Yf({__proto__:null,default:Kx},[Ue]);var Mu=function(){function s(t,e,n){if(this.formatMap=new Map([[vt.QR_CODE,Ue.BarcodeFormat.QR_CODE],[vt.AZTEC,Ue.BarcodeFormat.AZTEC],[vt.CODABAR,Ue.BarcodeFormat.CODABAR],[vt.CODE_39,Ue.BarcodeFormat.CODE_39],[vt.CODE_93,Ue.BarcodeFormat.CODE_93],[vt.CODE_128,Ue.BarcodeFormat.CODE_128],[vt.DATA_MATRIX,Ue.BarcodeFormat.DATA_MATRIX],[vt.MAXICODE,Ue.BarcodeFormat.MAXICODE],[vt.ITF,Ue.BarcodeFormat.ITF],[vt.EAN_13,Ue.BarcodeFormat.EAN_13],[vt.EAN_8,Ue.BarcodeFormat.EAN_8],[vt.PDF_417,Ue.BarcodeFormat.PDF_417],[vt.RSS_14,Ue.BarcodeFormat.RSS_14],[vt.RSS_EXPANDED,Ue.BarcodeFormat.RSS_EXPANDED],[vt.UPC_A,Ue.BarcodeFormat.UPC_A],[vt.UPC_E,Ue.BarcodeFormat.UPC_E],[vt.UPC_EAN_EXTENSION,Ue.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!qx)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=e,this.logger=n;var r=this.createZXingFormats(t),l=new Map;l.set(Ue.DecodeHintType.POSSIBLE_FORMATS,r),l.set(Ue.DecodeHintType.TRY_HARDER,!1),this.hints=l}return s.prototype.decodeAsync=function(t){var e=this;return new Promise(function(n,r){try{n(e.decode(t))}catch(l){r(l)}})},s.prototype.decode=function(t){var e=new Ue.MultiFormatReader(this.verbose,this.hints),n=new Ue.HTMLCanvasElementLuminanceSource(t),r=new Ue.BinaryBitmap(new Ue.HybridBinarizer(n)),l=e.decode(r);return{text:l.text,format:Lf.create(this.toHtml5QrcodeSupportedFormats(l.format)),debugData:this.createDebugData()}},s.prototype.createReverseFormatMap=function(){var t=new Map;return this.formatMap.forEach(function(e,n,r){t.set(e,n)}),t},s.prototype.toHtml5QrcodeSupportedFormats=function(t){if(!this.reverseFormatMap.has(t))throw"reverseFormatMap doesn't have ".concat(t);return this.reverseFormatMap.get(t)},s.prototype.createZXingFormats=function(t){for(var e=[],n=0,r=t;n<r.length;n++){var l=r[n];this.formatMap.has(l)?e.push(this.formatMap.get(l)):this.logger.logError("".concat(l," is not supported by")+"ZXingHtml5QrcodeShim")}return e},s.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},s}(),Qx=function(s,t,e,n){function r(l){return l instanceof e?l:new e(function(u){u(l)})}return new(e||(e=Promise))(function(l,u){function g(E){try{p(n.next(E))}catch(A){u(A)}}function m(E){try{p(n.throw(E))}catch(A){u(A)}}function p(E){E.done?l(E.value):r(E.value).then(g,m)}p((n=n.apply(s,t||[])).next())})},Jx=function(s,t){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,r,l,u;return u={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function g(p){return function(E){return m([p,E])}}function m(p){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,p[0]&&(e=0)),e;)try{if(n=1,r&&(l=p[0]&2?r.return:p[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,p[1])).done)return l;switch(r=0,l&&(p=[p[0]&2,l.value]),p[0]){case 0:case 1:l=p;break;case 4:return e.label++,{value:p[1],done:!1};case 5:e.label++,r=p[1],p=[0];continue;case 7:p=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(p[0]===6||p[0]===2)){e=0;continue}if(p[0]===3&&(!l||p[1]>l[0]&&p[1]<l[3])){e.label=p[1];break}if(p[0]===6&&e.label<l[1]){e.label=l[1],l=p;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(p);break}l[2]&&e.ops.pop(),e.trys.pop();continue}p=t.call(s,e)}catch(E){p=[6,E],r=0}finally{n=l=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},Su=function(){function s(t,e,n){if(this.formatMap=new Map([[vt.QR_CODE,"qr_code"],[vt.AZTEC,"aztec"],[vt.CODABAR,"codabar"],[vt.CODE_39,"code_39"],[vt.CODE_93,"code_93"],[vt.CODE_128,"code_128"],[vt.DATA_MATRIX,"data_matrix"],[vt.ITF,"itf"],[vt.EAN_13,"ean_13"],[vt.EAN_8,"ean_8"],[vt.PDF_417,"pdf417"],[vt.UPC_A,"upc_a"],[vt.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!s.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=e,this.logger=n;var r=this.createBarcodeDetectorFormats(t);if(this.detector=new BarcodeDetector(r),!this.detector)throw"BarcodeDetector detector not supported"}return s.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var t=new BarcodeDetector({formats:["qr_code"]});return typeof t<"u"},s.prototype.decodeAsync=function(t){return Qx(this,void 0,void 0,function(){var e,n;return Jx(this,function(r){switch(r.label){case 0:return[4,this.detector.detect(t)];case 1:if(e=r.sent(),!e||e.length===0)throw"No barcode or QR code detected.";return n=this.selectLargestBarcode(e),[2,{text:n.rawValue,format:Lf.create(this.toHtml5QrcodeSupportedFormats(n.format)),debugData:this.createDebugData()}]}})})},s.prototype.selectLargestBarcode=function(t){for(var e=null,n=0,r=0,l=t;r<l.length;r++){var u=l[r],g=u.boundingBox.width*u.boundingBox.height;g>n&&(n=g,e=u)}if(!e)throw"No largest barcode found";return e},s.prototype.createBarcodeDetectorFormats=function(t){for(var e=[],n=0,r=t;n<r.length;n++){var l=r[n];this.formatMap.has(l)?e.push(this.formatMap.get(l)):this.logger.warn("".concat(l," is not supported by")+"BarcodeDetectorDelegate")}return{formats:e}},s.prototype.toHtml5QrcodeSupportedFormats=function(t){if(!this.reverseFormatMap.has(t))throw"reverseFormatMap doesn't have ".concat(t);return this.reverseFormatMap.get(t)},s.prototype.createReverseFormatMap=function(){var t=new Map;return this.formatMap.forEach(function(e,n,r){t.set(e,n)}),t},s.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},s}(),Tu=function(s,t,e,n){function r(l){return l instanceof e?l:new e(function(u){u(l)})}return new(e||(e=Promise))(function(l,u){function g(E){try{p(n.next(E))}catch(A){u(A)}}function m(E){try{p(n.throw(E))}catch(A){u(A)}}function p(E){E.done?l(E.value):r(E.value).then(g,m)}p((n=n.apply(s,t||[])).next())})},bu=function(s,t){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,r,l,u;return u={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function g(p){return function(E){return m([p,E])}}function m(p){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,p[0]&&(e=0)),e;)try{if(n=1,r&&(l=p[0]&2?r.return:p[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,p[1])).done)return l;switch(r=0,l&&(p=[p[0]&2,l.value]),p[0]){case 0:case 1:l=p;break;case 4:return e.label++,{value:p[1],done:!1};case 5:e.label++,r=p[1],p=[0];continue;case 7:p=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(p[0]===6||p[0]===2)){e=0;continue}if(p[0]===3&&(!l||p[1]>l[0]&&p[1]<l[3])){e.label=p[1];break}if(p[0]===6&&e.label<l[1]){e.label=l[1],l=p;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(p);break}l[2]&&e.ops.pop(),e.trys.pop();continue}p=t.call(s,e)}catch(E){p=[6,E],r=0}finally{n=l=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},$x=function(){function s(t,e,n,r){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=n,e&&Su.isSupported()?(this.primaryDecoder=new Su(t,n,r),this.secondaryDecoder=new Mu(t,n,r)):this.primaryDecoder=new Mu(t,n,r)}return s.prototype.decodeAsync=function(t){return Tu(this,void 0,void 0,function(){var e;return bu(this,function(n){switch(n.label){case 0:e=performance.now(),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(t)];case 2:return[2,n.sent()];case 3:return this.possiblyLogPerformance(e),[7];case 4:return[2]}})})},s.prototype.decodeRobustlyAsync=function(t){return Tu(this,void 0,void 0,function(){var e,n;return bu(this,function(r){switch(r.label){case 0:e=performance.now(),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(t)];case 2:return[2,r.sent()];case 3:if(n=r.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(t)];throw n;case 4:return this.possiblyLogPerformance(e),[7];case 5:return[2]}})})},s.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},s.prototype.possiblyLogPerformance=function(t){if(this.verbose){var e=performance.now()-t;this.executionResults.push(e),this.executions++,this.possiblyFlushPerformanceReport()}},s.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var t=0,e=0,n=this.executionResults;e<n.length;e++){var r=n[e];t+=r}var l=t/this.executionResults.length;console.log("".concat(l," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},s}(),_c=function(){var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(n[l]=r[l])},s(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Oa=function(s,t,e,n){function r(l){return l instanceof e?l:new e(function(u){u(l)})}return new(e||(e=Promise))(function(l,u){function g(E){try{p(n.next(E))}catch(A){u(A)}}function m(E){try{p(n.throw(E))}catch(A){u(A)}}function p(E){E.done?l(E.value):r(E.value).then(g,m)}p((n=n.apply(s,t||[])).next())})},Da=function(s,t){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,r,l,u;return u={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function g(p){return function(E){return m([p,E])}}function m(p){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,p[0]&&(e=0)),e;)try{if(n=1,r&&(l=p[0]&2?r.return:p[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,p[1])).done)return l;switch(r=0,l&&(p=[p[0]&2,l.value]),p[0]){case 0:case 1:l=p;break;case 4:return e.label++,{value:p[1],done:!1};case 5:e.label++,r=p[1],p=[0];continue;case 7:p=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(p[0]===6||p[0]===2)){e=0;continue}if(p[0]===3&&(!l||p[1]>l[0]&&p[1]<l[3])){e.label=p[1];break}if(p[0]===6&&e.label<l[1]){e.label=l[1],l=p;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(p);break}l[2]&&e.ops.pop(),e.trys.pop();continue}p=t.call(s,e)}catch(E){p=[6,E],r=0}finally{n=l=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},kf=function(){function s(t,e){this.name=t,this.track=e}return s.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},s.prototype.apply=function(t){var e={};e[this.name]=t;var n={advanced:[e]};return this.track.applyConstraints(n)},s.prototype.value=function(){var t=this.track.getSettings();if(this.name in t){var e=t[this.name];return e}return null},s}(),tp=function(s){_c(t,s);function t(e,n){return s.call(this,e,n)||this}return t.prototype.min=function(){return this.getCapabilities().min},t.prototype.max=function(){return this.getCapabilities().max},t.prototype.step=function(){return this.getCapabilities().step},t.prototype.apply=function(e){var n={};n[this.name]=e;var r={advanced:[n]};return this.track.applyConstraints(r)},t.prototype.getCapabilities=function(){this.failIfNotSupported();var e=this.track.getCapabilities(),n=e[this.name];return{min:n.min,max:n.max,step:n.step}},t.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},t}(kf),ep=function(s){_c(t,s);function t(e){return s.call(this,"zoom",e)||this}return t}(tp),ip=function(s){_c(t,s);function t(e){return s.call(this,"torch",e)||this}return t}(kf),np=function(){function s(t){this.track=t}return s.prototype.zoomFeature=function(){return new ep(this.track)},s.prototype.torchFeature=function(){return new ip(this.track)},s}(),sp=function(){function s(t,e,n){this.isClosed=!1,this.parentElement=t,this.mediaStream=e,this.callbacks=n,this.surface=this.createVideoElement(this.parentElement.clientWidth),t.append(this.surface)}return s.prototype.createVideoElement=function(t){var e=document.createElement("video");return e.style.width="".concat(t,"px"),e.style.display="block",e.muted=!0,e.setAttribute("muted","true"),e.playsInline=!0,e},s.prototype.setupSurface=function(){var t=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var e=function(){var n=t.surface.clientWidth,r=t.surface.clientHeight;t.callbacks.onRenderSurfaceReady(n,r),t.surface.removeEventListener("playing",e)};this.surface.addEventListener("playing",e),this.surface.srcObject=this.mediaStream,this.surface.play()},s.create=function(t,e,n,r){return Oa(this,void 0,void 0,function(){var l,u;return Da(this,function(g){switch(g.label){case 0:return l=new s(t,e,r),n.aspectRatio?(u={aspectRatio:n.aspectRatio},[4,l.getFirstTrackOrFail().applyConstraints(u)]):[3,2];case 1:g.sent(),g.label=2;case 2:return l.setupSurface(),[2,l]}})})},s.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},s.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},s.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},s.prototype.resume=function(t){this.failIfClosed();var e=this,n=function(){setTimeout(t,200),e.surface.removeEventListener("playing",n)};this.surface.addEventListener("playing",n),this.surface.play()},s.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},s.prototype.getSurface=function(){return this.failIfClosed(),this.surface},s.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},s.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},s.prototype.applyVideoConstraints=function(t){return Oa(this,void 0,void 0,function(){return Da(this,function(e){if("aspectRatio"in t)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(t)]})})},s.prototype.close=function(){if(this.isClosed)return Promise.resolve();var t=this;return new Promise(function(e,n){var r=t.mediaStream.getVideoTracks(),l=r.length,u=0;t.mediaStream.getVideoTracks().forEach(function(g){t.mediaStream.removeTrack(g),g.stop(),++u,u>=l&&(t.isClosed=!0,t.parentElement.removeChild(t.surface),e())})})},s.prototype.getCapabilities=function(){return new np(this.getFirstTrackOrFail())},s}(),rp=function(){function s(t){this.mediaStream=t}return s.prototype.render=function(t,e,n){return Oa(this,void 0,void 0,function(){return Da(this,function(r){return[2,sp.create(t,this.mediaStream,e,n)]})})},s.create=function(t){return Oa(this,void 0,void 0,function(){var e,n;return Da(this,function(r){switch(r.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return e={audio:!1,video:t},[4,navigator.mediaDevices.getUserMedia(e)];case 1:return n=r.sent(),[2,new s(n)]}})})},s}(),Ru=function(s,t,e,n){function r(l){return l instanceof e?l:new e(function(u){u(l)})}return new(e||(e=Promise))(function(l,u){function g(E){try{p(n.next(E))}catch(A){u(A)}}function m(E){try{p(n.throw(E))}catch(A){u(A)}}function p(E){E.done?l(E.value):r(E.value).then(g,m)}p((n=n.apply(s,t||[])).next())})},vu=function(s,t){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,r,l,u;return u={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function g(p){return function(E){return m([p,E])}}function m(p){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,p[0]&&(e=0)),e;)try{if(n=1,r&&(l=p[0]&2?r.return:p[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,p[1])).done)return l;switch(r=0,l&&(p=[p[0]&2,l.value]),p[0]){case 0:case 1:l=p;break;case 4:return e.label++,{value:p[1],done:!1};case 5:e.label++,r=p[1],p=[0];continue;case 7:p=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(p[0]===6||p[0]===2)){e=0;continue}if(p[0]===3&&(!l||p[1]>l[0]&&p[1]<l[3])){e.label=p[1];break}if(p[0]===6&&e.label<l[1]){e.label=l[1],l=p;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(p);break}l[2]&&e.ops.pop(),e.trys.pop();continue}p=t.call(s,e)}catch(E){p=[6,E],r=0}finally{n=l=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},op=function(){function s(){}return s.failIfNotSupported=function(){return Ru(this,void 0,void 0,function(){return vu(this,function(t){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new s]})})},s.prototype.create=function(t){return Ru(this,void 0,void 0,function(){return vu(this,function(e){return[2,rp.create(t)]})})},s}(),ap=function(s,t,e,n){function r(l){return l instanceof e?l:new e(function(u){u(l)})}return new(e||(e=Promise))(function(l,u){function g(E){try{p(n.next(E))}catch(A){u(A)}}function m(E){try{p(n.throw(E))}catch(A){u(A)}}function p(E){E.done?l(E.value):r(E.value).then(g,m)}p((n=n.apply(s,t||[])).next())})},lp=function(s,t){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,r,l,u;return u={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function g(p){return function(E){return m([p,E])}}function m(p){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,p[0]&&(e=0)),e;)try{if(n=1,r&&(l=p[0]&2?r.return:p[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,p[1])).done)return l;switch(r=0,l&&(p=[p[0]&2,l.value]),p[0]){case 0:case 1:l=p;break;case 4:return e.label++,{value:p[1],done:!1};case 5:e.label++,r=p[1],p=[0];continue;case 7:p=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(p[0]===6||p[0]===2)){e=0;continue}if(p[0]===3&&(!l||p[1]>l[0]&&p[1]<l[3])){e.label=p[1];break}if(p[0]===6&&e.label<l[1]){e.label=l[1],l=p;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(p);break}l[2]&&e.ops.pop(),e.trys.pop();continue}p=t.call(s,e)}catch(E){p=[6,E],r=0}finally{n=l=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},hp=function(){function s(){}return s.retrieve=function(){if(navigator.mediaDevices)return s.getCamerasFromMediaDevices();var t=MediaStreamTrack;return MediaStreamTrack&&t.getSources?s.getCamerasFromMediaStreamTrack():s.rejectWithError()},s.rejectWithError=function(){var t=Tr.unableToQuerySupportedDevices();return s.isHttpsOrLocalhost()||(t=Tr.insecureContextCameraQueryError()),Promise.reject(t)},s.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var t=location.host.split(":")[0];return t==="127.0.0.1"||t==="localhost"},s.getCamerasFromMediaDevices=function(){return ap(this,void 0,void 0,function(){var t,e,n,r,l,u,g;return lp(this,function(m){switch(m.label){case 0:return t=function(p){for(var E=p.getVideoTracks(),A=0,b=E;A<b.length;A++){var D=b[A];D.enabled=!1,D.stop(),p.removeTrack(D)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return e=m.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(n=m.sent(),r=[],l=0,u=n;l<u.length;l++)g=u[l],g.kind==="videoinput"&&r.push({id:g.deviceId,label:g.label});return t(e),[2,r]}})})},s.getCamerasFromMediaStreamTrack=function(){return new Promise(function(t,e){var n=function(l){for(var u=[],g=0,m=l;g<m.length;g++){var p=m[g];p.kind==="video"&&u.push({id:p.id,label:p.label})}t(u)},r=MediaStreamTrack;r.getSources(n)})},s}(),ti;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.NOT_STARTED=1]="NOT_STARTED",s[s.SCANNING=2]="SCANNING",s[s.PAUSED=3]="PAUSED"})(ti||(ti={}));var cp=function(){function s(){this.state=ti.NOT_STARTED,this.onGoingTransactionNewState=ti.UNKNOWN}return s.prototype.directTransition=function(t){this.failIfTransitionOngoing(),this.validateTransition(t),this.state=t},s.prototype.startTransition=function(t){return this.failIfTransitionOngoing(),this.validateTransition(t),this.onGoingTransactionNewState=t,this},s.prototype.execute=function(){if(this.onGoingTransactionNewState===ti.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var t=this.onGoingTransactionNewState;this.onGoingTransactionNewState=ti.UNKNOWN,this.directTransition(t)},s.prototype.cancel=function(){if(this.onGoingTransactionNewState===ti.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=ti.UNKNOWN},s.prototype.getState=function(){return this.state},s.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==ti.UNKNOWN)throw"Cannot transition to a new state, already under transition"},s.prototype.validateTransition=function(t){switch(this.state){case ti.UNKNOWN:throw"Transition from unknown is not allowed";case ti.NOT_STARTED:this.failIfNewStateIs(t,[ti.PAUSED]);break;case ti.SCANNING:break;case ti.PAUSED:break}},s.prototype.failIfNewStateIs=function(t,e){for(var n=0,r=e;n<r.length;n++){var l=r[n];if(t===l)throw"Cannot transition from ".concat(this.state," to ").concat(t)}},s}(),up=function(){function s(t){this.stateManager=t}return s.prototype.startTransition=function(t){return this.stateManager.startTransition(t)},s.prototype.directTransition=function(t){this.stateManager.directTransition(t)},s.prototype.getState=function(){return this.stateManager.getState()},s.prototype.canScanFile=function(){return this.stateManager.getState()===ti.NOT_STARTED},s.prototype.isScanning=function(){return this.stateManager.getState()!==ti.NOT_STARTED},s.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===ti.SCANNING},s.prototype.isPaused=function(){return this.stateManager.getState()===ti.PAUSED},s}(),fp=function(){function s(){}return s.create=function(){return new up(new cp)},s}(),dp=function(){var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(n[l]=r[l])},s(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Ji=function(s){dp(t,s);function t(){return s!==null&&s.apply(this,arguments)||this}return t.DEFAULT_WIDTH=300,t.DEFAULT_WIDTH_OFFSET=2,t.FILE_SCAN_MIN_HEIGHT=300,t.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,t.MIN_QR_BOX_SIZE=50,t.SHADED_LEFT=1,t.SHADED_RIGHT=2,t.SHADED_TOP=3,t.SHADED_BOTTOM=4,t.SHADED_REGION_ELEMENT_ID="qr-shaded-region",t.VERBOSE=!1,t.BORDER_SHADER_DEFAULT_COLOR="#ffffff",t.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",t}(In),gp=function(){function s(t,e){this.logger=e,this.fps=Ji.SCAN_DEFAULT_FPS,t?(t.fps&&(this.fps=t.fps),this.disableFlip=t.disableFlip===!0,this.qrbox=t.qrbox,this.aspectRatio=t.aspectRatio,this.videoConstraints=t.videoConstraints):this.disableFlip=Ji.DEFAULT_DISABLE_FLIP}return s.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?Bf.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},s.prototype.isShadedBoxEnabled=function(){return!Ln(this.qrbox)},s.create=function(t,e){return new s(t,e)},s}(),Nu=function(){function s(t,e){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(t))throw"HTML Element with id=".concat(t," not found");this.elementId=t,this.verbose=!1;var n;typeof e=="boolean"?this.verbose=e===!0:e&&(n=e,this.verbose=n.verbose===!0,n.experimentalFeatures),this.logger=new Ff(this.verbose),this.qrcode=new $x(this.getSupportedFormats(e),this.getUseBarCodeDetectorIfSupported(n),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=fp.create()}return s.prototype.start=function(t,e,n,r){var l=this;if(!t)throw"cameraIdOrConfig is required";if(!n||typeof n!="function")throw"qrCodeSuccessCallback is required and should be a function.";var u;r?u=r:u=this.verbose?this.logger.log:function(){};var g=gp.create(e,this.logger);this.clearElement();var m=!1;g.videoConstraints&&(g.isMediaStreamConstraintsValid()?m=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var p=m,E=document.getElementById(this.elementId);E.clientWidth?E.clientWidth:Ji.DEFAULT_WIDTH,E.style.position="relative",this.shouldScan=!0,this.element=E;var A=this,b=this.stateManagerProxy.startTransition(ti.SCANNING);return new Promise(function(D,P){var F=p?g.videoConstraints:A.createVideoConstraints(t);if(!F){b.cancel(),P("videoConstraints should be defined");return}var z={};(!p||g.aspectRatio)&&(z.aspectRatio=g.aspectRatio);var j={onRenderSurfaceReady:function(G,X){A.setupUi(G,X,g),A.isScanning=!0,A.foreverScan(g,n,u)}};op.failIfNotSupported().then(function(G){G.create(F).then(function(X){return X.render(l.element,z,j).then(function(Y){A.renderedCamera=Y,b.execute(),D(null)}).catch(function(Y){b.cancel(),P(Y)})}).catch(function(X){b.cancel(),P(Tr.errorGettingUserMedia(X))})}).catch(function(G){b.cancel(),P(Tr.cameraStreamingNotSupported())})})},s.prototype.pause=function(t){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(ti.PAUSED),this.showPausedState(),(Ln(t)||t!==!0)&&(t=!1),t&&this.renderedCamera&&this.renderedCamera.pause()},s.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var t=this,e=function(){t.stateManagerProxy.directTransition(ti.SCANNING),t.hidePausedState()};if(!this.renderedCamera.isPaused()){e();return}this.renderedCamera.resume(function(){e()})},s.prototype.getState=function(){return this.stateManagerProxy.getState()},s.prototype.stop=function(){var t=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var e=this.stateManagerProxy.startTransition(ti.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var n=function(){if(t.element){var l=document.getElementById(Ji.SHADED_REGION_ELEMENT_ID);l&&t.element.removeChild(l)}},r=this;return this.renderedCamera.close().then(function(){return r.renderedCamera=null,r.element&&(r.element.removeChild(r.canvasElement),r.canvasElement=null),n(),r.qrRegion&&(r.qrRegion=null),r.context&&(r.context=null),e.execute(),r.hidePausedState(),r.isScanning=!1,Promise.resolve()})},s.prototype.scanFile=function(t,e){return this.scanFileV2(t,e).then(function(n){return n.decodedText})},s.prototype.scanFileV2=function(t,e){var n=this;if(!t||!(t instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(Ln(e)&&(e=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(r,l){n.possiblyCloseLastScanImageFile(),n.clearElement(),n.lastScanImageFile=URL.createObjectURL(t);var u=new Image;u.onload=function(){var g=u.width,m=u.height,p=document.getElementById(n.elementId),E=p.clientWidth?p.clientWidth:Ji.DEFAULT_WIDTH,A=Math.max(p.clientHeight?p.clientHeight:m,Ji.FILE_SCAN_MIN_HEIGHT),b=n.computeCanvasDrawConfig(g,m,E,A);if(e){var D=n.createCanvasElement(E,A,"qr-canvas-visible");D.style.display="inline-block",p.appendChild(D);var P=D.getContext("2d");if(!P)throw"Unable to get 2d context from canvas";P.canvas.width=E,P.canvas.height=A,P.drawImage(u,0,0,g,m,b.x,b.y,b.width,b.height)}var F=Ji.FILE_SCAN_HIDDEN_CANVAS_PADDING,z=Math.max(u.width,b.width),j=Math.max(u.height,b.height),G=z+2*F,X=j+2*F,Y=n.createCanvasElement(G,X);p.appendChild(Y);var Q=Y.getContext("2d");if(!Q)throw"Unable to get 2d context from canvas";Q.canvas.width=G,Q.canvas.height=X,Q.drawImage(u,0,0,g,m,F,F,z,j);try{n.qrcode.decodeRobustlyAsync(Y).then(function(rt){r(Au.createFromQrcodeResult(rt))}).catch(l)}catch(rt){l("QR code parse error, error = ".concat(rt))}},u.onerror=l,u.onabort=l,u.onstalled=l,u.onsuspend=l,u.src=URL.createObjectURL(t)})},s.prototype.clear=function(){this.clearElement()},s.getCameras=function(){return hp.retrieve()},s.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},s.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},s.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},s.prototype.applyVideoConstraints=function(t){if(t){if(!Bf.isMediaStreamConstraintsValid(t,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(t)},s.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},s.prototype.getSupportedFormats=function(t){var e=[vt.QR_CODE,vt.AZTEC,vt.CODABAR,vt.CODE_39,vt.CODE_93,vt.CODE_128,vt.DATA_MATRIX,vt.MAXICODE,vt.ITF,vt.EAN_13,vt.EAN_8,vt.PDF_417,vt.RSS_14,vt.RSS_EXPANDED,vt.UPC_A,vt.UPC_E,vt.UPC_EAN_EXTENSION];if(!t||typeof t=="boolean"||!t.formatsToSupport)return e;if(!Array.isArray(t.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(t.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var n=[],r=0,l=t.formatsToSupport;r<l.length;r++){var u=l[r];Hx(u)?n.push(u):this.logger.warn("Invalid format: ".concat(u," passed in config, ignoring."))}if(n.length===0)throw"None of formatsToSupport match supported values.";return n},s.prototype.getUseBarCodeDetectorIfSupported=function(t){if(Ln(t))return!0;if(!Ln(t.useBarCodeDetectorIfSupported))return t.useBarCodeDetectorIfSupported!==!1;if(Ln(t.experimentalFeatures))return!0;var e=t.experimentalFeatures;return Ln(e.useBarCodeDetectorIfSupported)?!0:e.useBarCodeDetectorIfSupported!==!1},s.prototype.validateQrboxSize=function(t,e,n){var r=this,l=n.qrbox;this.validateQrboxConfig(l);var u=this.toQrdimensions(t,e,l),g=function(p){if(p<Ji.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(Ji.MIN_QR_BOX_SIZE,"px.")},m=function(p){return p>t&&(r.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),p=t),p};g(u.width),g(u.height),u.width=m(u.width)},s.prototype.validateQrboxConfig=function(t){if(typeof t!="number"&&typeof t!="function"&&(t.width===void 0||t.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},s.prototype.toQrdimensions=function(t,e,n){if(typeof n=="number")return{width:n,height:n};if(typeof n=="function")try{return n(t,e)}catch(r){throw new Error("qrbox config was passed as a function but it failed with unknown error"+r)}return n},s.prototype.setupUi=function(t,e,n){n.isShadedBoxEnabled()&&this.validateQrboxSize(t,e,n);var r=Ln(n.qrbox)?{width:t,height:e}:n.qrbox;this.validateQrboxConfig(r);var l=this.toQrdimensions(t,e,r);l.height>e&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var u=n.isShadedBoxEnabled()&&l.height<=e,g={x:0,y:0,width:t,height:e},m=u?this.getShadedRegionBounds(t,e,l):g,p=this.createCanvasElement(m.width,m.height),E={willReadFrequently:!0},A=p.getContext("2d",E);A.canvas.width=m.width,A.canvas.height=m.height,this.element.append(p),u&&this.possiblyInsertShadingElement(this.element,t,e,l),this.createScannerPausedUiElement(this.element),this.qrRegion=m,this.context=A,this.canvasElement=p},s.prototype.createScannerPausedUiElement=function(t){var e=document.createElement("div");e.innerText=Tr.scannerPaused(),e.style.display="none",e.style.position="absolute",e.style.top="0px",e.style.zIndex="1",e.style.background="rgba(9, 9, 9, 0.46)",e.style.color="#FFECEC",e.style.textAlign="center",e.style.width="100%",t.appendChild(e),this.scannerPausedUiElement=e},s.prototype.scanContext=function(t,e){var n=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(r){return t(r.text,Au.createFromQrcodeResult(r)),n.possiblyUpdateShaders(!0),!0}).catch(function(r){n.possiblyUpdateShaders(!1);var l=Tr.codeParseError(r);return e(l,Pf.createFrom(l)),!1})},s.prototype.foreverScan=function(t,e,n){var r=this;if(this.shouldScan&&this.renderedCamera){var l=this.renderedCamera.getSurface(),u=l.videoWidth/l.clientWidth,g=l.videoHeight/l.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var m=this.qrRegion.width*u,p=this.qrRegion.height*g,E=this.qrRegion.x*u,A=this.qrRegion.y*g;this.context.drawImage(l,E,A,m,p,0,0,this.qrRegion.width,this.qrRegion.height);var b=function(){r.foreverScanTimeout=setTimeout(function(){r.foreverScan(t,e,n)},r.getTimeoutFps(t.fps))};this.scanContext(e,n).then(function(D){!D&&t.disableFlip!==!0?(r.context.translate(r.context.canvas.width,0),r.context.scale(-1,1),r.scanContext(e,n).finally(function(){b()})):b()}).catch(function(D){r.logger.logError("Error happend while scanning context",D),b()})}},s.prototype.createVideoConstraints=function(t){if(typeof t=="string")return{deviceId:{exact:t}};if(typeof t=="object"){var e="facingMode",n="deviceId",r={user:!0,environment:!0},l="exact",u=function(P){if(P in r)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(P,"'")},g=Object.keys(t);if(g.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(g.length," keys");var m=Object.keys(t)[0];if(m!==e&&m!==n)throw"Only '".concat(e,"' and '").concat(n,"' ")+" are supported for 'cameraIdOrConfig'";if(m===e){var p=t.facingMode;if(typeof p=="string"){if(u(p))return{facingMode:p}}else if(typeof p=="object")if(l in p){if(u(p["".concat(l)]))return{facingMode:{exact:p["".concat(l)]}}}else throw"'facingMode' should be string or object with"+" ".concat(l," as key.");else{var E=typeof p;throw"Invalid type of 'facingMode' = ".concat(E)}}else{var A=t.deviceId;if(typeof A=="string")return{deviceId:A};if(typeof A=="object"){if(l in A)return{deviceId:{exact:A["".concat(l)]}};throw"'deviceId' should be string or object with"+" ".concat(l," as key.")}else{var b=typeof A;throw"Invalid type of 'deviceId' = ".concat(b)}}}var D=typeof t;throw"Invalid type of 'cameraIdOrConfig' = ".concat(D)},s.prototype.computeCanvasDrawConfig=function(t,e,n,r){if(t<=n&&e<=r){var l=(n-t)/2,u=(r-e)/2;return{x:l,y:u,width:t,height:e}}else{var g=t,m=e;return t>n&&(e=n/t*e,t=n),e>r&&(t=r/e*t,e=r),this.logger.log("Image downsampled from "+"".concat(g,"X").concat(m)+" to ".concat(t,"X").concat(e,".")),this.computeCanvasDrawConfig(t,e,n,r)}},s.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var t=document.getElementById(this.elementId);t&&(t.innerHTML="")},s.prototype.possiblyUpdateShaders=function(t){this.qrMatch!==t&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(e){e.style.backgroundColor=t?Ji.BORDER_SHADER_MATCH_COLOR:Ji.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=t)},s.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},s.prototype.createCanvasElement=function(t,e,n){var r=t,l=e,u=document.createElement("canvas");return u.style.width="".concat(r,"px"),u.style.height="".concat(l,"px"),u.style.display="none",u.id=Ln(n)?"qr-canvas":n,u},s.prototype.getShadedRegionBounds=function(t,e,n){if(n.width>t||n.height>e)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(t-n.width)/2,y:(e-n.height)/2,width:n.width,height:n.height}},s.prototype.possiblyInsertShadingElement=function(t,e,n,r){if(!(e-r.width<1||n-r.height<1)){var l=document.createElement("div");l.style.position="absolute";var u=(e-r.width)/2,g=(n-r.height)/2;if(l.style.borderLeft="".concat(u,"px solid rgba(0, 0, 0, 0.48)"),l.style.borderRight="".concat(u,"px solid rgba(0, 0, 0, 0.48)"),l.style.borderTop="".concat(g,"px solid rgba(0, 0, 0, 0.48)"),l.style.borderBottom="".concat(g,"px solid rgba(0, 0, 0, 0.48)"),l.style.boxSizing="border-box",l.style.top="0px",l.style.bottom="0px",l.style.left="0px",l.style.right="0px",l.id="".concat(Ji.SHADED_REGION_ELEMENT_ID),e-r.width<11||n-r.height<11)this.hasBorderShaders=!1;else{var m=5,p=40;this.insertShaderBorders(l,p,m,-m,null,0,!0),this.insertShaderBorders(l,p,m,-m,null,0,!1),this.insertShaderBorders(l,p,m,null,-m,0,!0),this.insertShaderBorders(l,p,m,null,-m,0,!1),this.insertShaderBorders(l,m,p+m,-m,null,-m,!0),this.insertShaderBorders(l,m,p+m,null,-m,-m,!0),this.insertShaderBorders(l,m,p+m,-m,null,-m,!1),this.insertShaderBorders(l,m,p+m,null,-m,-m,!1),this.hasBorderShaders=!0}t.append(l)}},s.prototype.insertShaderBorders=function(t,e,n,r,l,u,g){var m=document.createElement("div");m.style.position="absolute",m.style.backgroundColor=Ji.BORDER_SHADER_DEFAULT_COLOR,m.style.width="".concat(e,"px"),m.style.height="".concat(n,"px"),r!==null&&(m.style.top="".concat(r,"px")),l!==null&&(m.style.bottom="".concat(l,"px")),g?m.style.left="".concat(u,"px"):m.style.right="".concat(u,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(m),t.appendChild(m)},s.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},s.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},s.prototype.getTimeoutFps=function(t){return 1e3/t},s}(),yc="data:image/svg+xml;base64,",mp=yc+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",xp=yc+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",Ou=yc+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",pp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",Du=function(){function s(){}return s.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},s}(),_p=function(){function s(){this.data=Du.createDefault();var t=localStorage.getItem(s.LOCAL_STORAGE_KEY);t?this.data=JSON.parse(t):this.reset()}return s.prototype.hasCameraPermissions=function(){return this.data.hasPermission},s.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},s.prototype.setHasPermission=function(t){this.data.hasPermission=t,this.flush()},s.prototype.setLastUsedCameraId=function(t){this.data.lastUsedCameraId=t,this.flush()},s.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},s.prototype.reset=function(){this.data=Du.createDefault(),this.flush()},s.prototype.flush=function(){localStorage.setItem(s.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},s.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",s}(),yp=function(){function s(){this.infoDiv=document.createElement("div")}return s.prototype.renderInto=function(t){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=Iu.poweredBy();var e=document.createElement("a");e.innerText="ScanApp",e.href="https://scanapp.org",e.target="new",e.style.color="white",this.infoDiv.appendChild(e);var n=document.createElement("br"),r=document.createElement("br");this.infoDiv.appendChild(n),this.infoDiv.appendChild(r);var l=document.createElement("a");l.innerText=Iu.reportIssues(),l.href="https://github.com/mebjas/html5-qrcode/issues",l.target="new",l.style.color="white",this.infoDiv.appendChild(l),t.appendChild(this.infoDiv)},s.prototype.show=function(){this.infoDiv.style.display="block"},s.prototype.hide=function(){this.infoDiv.style.display="none"},s}(),Ep=function(){function s(t,e){this.isShowingInfoIcon=!0,this.onTapIn=t,this.onTapOut=e,this.infoIcon=document.createElement("img")}return s.prototype.renderInto=function(t){var e=this;this.infoIcon.alt="Info icon",this.infoIcon.src=Ou,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(n){return e.onHoverIn()},this.infoIcon.onmouseout=function(n){return e.onHoverOut()},this.infoIcon.onclick=function(n){return e.onClick()},t.appendChild(this.infoIcon)},s.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},s.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},s.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src=pp,this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=Ou,this.infoIcon.style.opacity="0.6")},s}(),wp=function(){function s(){var t=this;this.infoDiv=new yp,this.infoIcon=new Ep(function(){t.infoDiv.show()},function(){t.infoDiv.hide()})}return s.prototype.renderInto=function(t){this.infoDiv.renderInto(t),this.infoIcon.renderInto(t)},s}(),Cp=function(s,t,e,n){function r(l){return l instanceof e?l:new e(function(u){u(l)})}return new(e||(e=Promise))(function(l,u){function g(E){try{p(n.next(E))}catch(A){u(A)}}function m(E){try{p(n.throw(E))}catch(A){u(A)}}function p(E){E.done?l(E.value):r(E.value).then(g,m)}p((n=n.apply(s,t||[])).next())})},Ap=function(s,t){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,r,l,u;return u={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function g(p){return function(E){return m([p,E])}}function m(p){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,p[0]&&(e=0)),e;)try{if(n=1,r&&(l=p[0]&2?r.return:p[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,p[1])).done)return l;switch(r=0,l&&(p=[p[0]&2,l.value]),p[0]){case 0:case 1:l=p;break;case 4:return e.label++,{value:p[1],done:!1};case 5:e.label++,r=p[1],p=[0];continue;case 7:p=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(p[0]===6||p[0]===2)){e=0;continue}if(p[0]===3&&(!l||p[1]>l[0]&&p[1]<l[3])){e.label=p[1];break}if(p[0]===6&&e.label<l[1]){e.label=l[1],l=p;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(p);break}l[2]&&e.ops.pop(),e.trys.pop();continue}p=t.call(s,e)}catch(E){p=[6,E],r=0}finally{n=l=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},Lu=function(){function s(){}return s.hasPermissions=function(){return Cp(this,void 0,void 0,function(){var t,e,n,r;return Ap(this,function(l){switch(l.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)if(r=n[e],r.kind==="videoinput"&&r.label)return[2,!0];return[2,!1]}})})},s}(),Is=function(){function s(t){this.supportedScanTypes=this.validateAndReturnScanTypes(t)}return s.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},s.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},s.prototype.isCameraScanRequired=function(){for(var t=0,e=this.supportedScanTypes;t<e.length;t++){var n=e[t];if(s.isCameraScanType(n))return!0}return!1},s.isCameraScanType=function(t){return t===Ps.SCAN_TYPE_CAMERA},s.isFileScanType=function(t){return t===Ps.SCAN_TYPE_FILE},s.prototype.validateAndReturnScanTypes=function(t){if(!t||t.length===0)return In.DEFAULT_SUPPORTED_SCAN_TYPE;var e=In.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(t.length>e)throw"Max ".concat(e," values expected for ")+"supportedScanTypes";for(var n=0,r=t;n<r.length;n++){var l=r[n];if(!In.DEFAULT_SUPPORTED_SCAN_TYPE.includes(l))throw"Unsupported scan type ".concat(l)}return t},s}(),nn=function(){function s(){}return s.ALL_ELEMENT_CLASS="html5-qrcode-element",s.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",s.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",s.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",s.TORCH_BUTTON_ID="html5-qrcode-button-torch",s.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",s.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",s.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",s.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",s.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",s.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",s}(),ss=function(){function s(){}return s.createElement=function(t,e){var n=document.createElement(t);return n.id=e,n.classList.add(nn.ALL_ELEMENT_CLASS),t==="button"&&n.setAttribute("type","button"),n},s}(),Uf=function(s,t,e,n){function r(l){return l instanceof e?l:new e(function(u){u(l)})}return new(e||(e=Promise))(function(l,u){function g(E){try{p(n.next(E))}catch(A){u(A)}}function m(E){try{p(n.throw(E))}catch(A){u(A)}}function p(E){E.done?l(E.value):r(E.value).then(g,m)}p((n=n.apply(s,t||[])).next())})},Gf=function(s,t){var e={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,r,l,u;return u={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function g(p){return function(E){return m([p,E])}}function m(p){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,p[0]&&(e=0)),e;)try{if(n=1,r&&(l=p[0]&2?r.return:p[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,p[1])).done)return l;switch(r=0,l&&(p=[p[0]&2,l.value]),p[0]){case 0:case 1:l=p;break;case 4:return e.label++,{value:p[1],done:!1};case 5:e.label++,r=p[1],p=[0];continue;case 7:p=e.ops.pop(),e.trys.pop();continue;default:if(l=e.trys,!(l=l.length>0&&l[l.length-1])&&(p[0]===6||p[0]===2)){e=0;continue}if(p[0]===3&&(!l||p[1]>l[0]&&p[1]<l[3])){e.label=p[1];break}if(p[0]===6&&e.label<l[1]){e.label=l[1],l=p;break}if(l&&e.label<l[2]){e.label=l[2],e.ops.push(p);break}l[2]&&e.ops.pop(),e.trys.pop();continue}p=t.call(s,e)}catch(E){p=[6,E],r=0}finally{n=l=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},Pu=function(){function s(t,e,n){this.isTorchOn=!1,this.torchCapability=t,this.buttonController=e,this.onTorchActionFailureCallback=n}return s.prototype.isTorchEnabled=function(){return this.isTorchOn},s.prototype.flipState=function(){return Uf(this,void 0,void 0,function(){var t,e;return Gf(this,function(n){switch(n.label){case 0:this.buttonController.disable(),t=!this.isTorchOn,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.torchCapability.apply(t)];case 2:return n.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),t),[3,4];case 3:return e=n.sent(),this.propagateFailure(t,e),this.buttonController.enable(),[3,4];case 4:return[2]}})})},s.prototype.updateUiBasedOnLatestSettings=function(t,e){t===e?(this.buttonController.setText(e?ve.torchOffButton():ve.torchOnButton()),this.isTorchOn=e):this.propagateFailure(e),this.buttonController.enable()},s.prototype.propagateFailure=function(t,e){var n=t?ve.torchOnFailedMessage():ve.torchOffFailedMessage();e&&(n+="; Error = "+e),this.onTorchActionFailureCallback(n)},s.prototype.reset=function(){this.isTorchOn=!1},s}(),Ip=function(){function s(t,e){this.onTorchActionFailureCallback=e,this.torchButton=ss.createElement("button",nn.TORCH_BUTTON_ID),this.torchController=new Pu(t,this,e)}return s.prototype.render=function(t,e){var n=this;this.torchButton.innerText=ve.torchOnButton(),this.torchButton.style.display=e.display,this.torchButton.style.marginLeft=e.marginLeft;var r=this;this.torchButton.addEventListener("click",function(l){return Uf(n,void 0,void 0,function(){return Gf(this,function(u){switch(u.label){case 0:return[4,r.torchController.flipState()];case 1:return u.sent(),r.torchController.isTorchEnabled()?(r.torchButton.classList.remove(nn.TORCH_BUTTON_CLASS_TORCH_OFF),r.torchButton.classList.add(nn.TORCH_BUTTON_CLASS_TORCH_ON)):(r.torchButton.classList.remove(nn.TORCH_BUTTON_CLASS_TORCH_ON),r.torchButton.classList.add(nn.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}})})}),t.appendChild(this.torchButton)},s.prototype.updateTorchCapability=function(t){this.torchController=new Pu(t,this,this.onTorchActionFailureCallback)},s.prototype.getTorchButton=function(){return this.torchButton},s.prototype.hide=function(){this.torchButton.style.display="none"},s.prototype.show=function(){this.torchButton.style.display="inline-block"},s.prototype.disable=function(){this.torchButton.disabled=!0},s.prototype.enable=function(){this.torchButton.disabled=!1},s.prototype.setText=function(t){this.torchButton.innerText=t},s.prototype.reset=function(){this.torchButton.innerText=ve.torchOnButton(),this.torchController.reset()},s.create=function(t,e,n,r){var l=new s(e,r);return l.render(t,n),l},s}(),Mp=function(){function s(t,e,n){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=e?"block":"none",t.appendChild(this.fileBasedScanRegion);var r=document.createElement("label");r.setAttribute("for",this.getFileScanInputId()),r.style.display="inline-block",this.fileBasedScanRegion.appendChild(r),this.fileSelectionButton=ss.createElement("button",nn.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",function(g){r.click()}),r.append(this.fileSelectionButton),this.fileScanInput=ss.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",r.appendChild(this.fileScanInput);var l=this;this.fileScanInput.addEventListener("change",function(g){if(!(g==null||g.target==null)){var m=g.target;if(!(m.files&&m.files.length===0)){var p=m.files,E=p[0],A=E.name;l.setImageNameToButton(A),n(E)}}});var u=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(u),this.fileBasedScanRegion.addEventListener("dragenter",function(g){l.fileBasedScanRegion.style.border=l.fileBasedScanRegionActiveBorder(),g.stopPropagation(),g.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragleave",function(g){l.fileBasedScanRegion.style.border=l.fileBasedScanRegionDefaultBorder(),g.stopPropagation(),g.preventDefault()}),this.fileBasedScanRegion.addEventListener("dragover",function(g){l.fileBasedScanRegion.style.border=l.fileBasedScanRegionActiveBorder(),g.stopPropagation(),g.preventDefault()}),this.fileBasedScanRegion.addEventListener("drop",function(g){g.stopPropagation(),g.preventDefault(),l.fileBasedScanRegion.style.border=l.fileBasedScanRegionDefaultBorder();var m=g.dataTransfer;if(m){var p=m.files;if(!p||p.length===0)return;for(var E=!1,A=0;A<p.length;++A){var b=p.item(A);if(b){var D=/image.*/;if(b.type.match(D)){E=!0;var P=b.name;l.setImageNameToButton(P),n(b),u.innerText=ve.dragAndDropMessage();break}}}E||(u.innerText=ve.dragAndDropMessageOnlyImages())}})}return s.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},s.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},s.prototype.isShowing=function(){return this.fileBasedScanRegion.style.display==="block"},s.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},s.prototype.createFileBasedScanRegion=function(){var t=document.createElement("div");return t.style.textAlign="center",t.style.margin="auto",t.style.width="80%",t.style.maxWidth="600px",t.style.border=this.fileBasedScanRegionDefaultBorder(),t.style.padding="10px",t.style.marginBottom="10px",t},s.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},s.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},s.prototype.createDragAndDropMessage=function(){var t=document.createElement("div");return t.innerText=ve.dragAndDropMessage(),t.style.fontWeight="400",t},s.prototype.setImageNameToButton=function(t){var e=20;if(t.length>e){var n=t.substring(0,8),r=t.length,l=t.substring(r-8,r);t="".concat(n,"....").concat(l)}var u=ve.fileSelectionChooseAnother()+" - "+t;this.fileSelectionButton.innerText=u},s.prototype.setInitialValueToButton=function(){var t=ve.fileSelectionChooseImage()+" - "+ve.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=t},s.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},s.create=function(t,e,n){var r=new s(t,e,n);return r},s}(),Sp=function(){function s(t){this.selectElement=ss.createElement("select",nn.CAMERA_SELECTION_SELECT_ID),this.cameras=t,this.options=[]}return s.prototype.render=function(t){var e=document.createElement("span");e.style.marginRight="10px";var n=this.cameras.length;if(n===0)throw new Error("No cameras found");if(n===1)e.style.display="none";else{var r=ve.selectCamera();e.innerText="".concat(r," (").concat(this.cameras.length,")  ")}for(var l=1,u=0,g=this.cameras;u<g.length;u++){var m=g[u],p=m.id,E=m.label==null?p:m.label;(!E||E==="")&&(E=[ve.anonymousCameraPrefix(),l++].join(" "));var A=document.createElement("option");A.value=p,A.innerText=E,this.options.push(A),this.selectElement.appendChild(A)}e.appendChild(this.selectElement),t.appendChild(e)},s.prototype.disable=function(){this.selectElement.disabled=!0},s.prototype.isDisabled=function(){return this.selectElement.disabled===!0},s.prototype.enable=function(){this.selectElement.disabled=!1},s.prototype.getValue=function(){return this.selectElement.value},s.prototype.hasValue=function(t){for(var e=0,n=this.options;e<n.length;e++){var r=n[e];if(r.value===t)return!0}return!1},s.prototype.setValue=function(t){if(!this.hasValue(t))throw new Error("".concat(t," is not present in the camera list."));this.selectElement.value=t},s.prototype.hasSingleItem=function(){return this.cameras.length===1},s.prototype.numCameras=function(){return this.cameras.length},s.create=function(t,e){var n=new s(e);return n.render(t),n},s}(),Tp=function(){function s(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=ss.createElement("input",nn.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return s.prototype.render=function(t,e){this.zoomElementContainer.style.display=e?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",t.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var n=ve.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(n),this.rangeText.style.marginRight="10px";var r=this;this.rangeInput.addEventListener("input",function(){return r.onValueChange()}),this.rangeInput.addEventListener("change",function(){return r.onValueChange()}),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},s.prototype.onValueChange=function(){var t=ve.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(t),this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},s.prototype.setValues=function(t,e,n,r){this.rangeInput.min=t.toString(),this.rangeInput.max=e.toString(),this.rangeInput.step=r.toString(),this.rangeInput.value=n.toString(),this.onValueChange()},s.prototype.show=function(){this.zoomElementContainer.style.display="block"},s.prototype.hide=function(){this.zoomElementContainer.style.display="none"},s.prototype.setOnCameraZoomValueChangeCallback=function(t){this.onChangeCallback=t},s.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},s.create=function(t,e){var n=new s;return n.render(t,e),n},s}(),$i;(function(s){s[s.STATUS_DEFAULT=0]="STATUS_DEFAULT",s[s.STATUS_SUCCESS=1]="STATUS_SUCCESS",s[s.STATUS_WARNING=2]="STATUS_WARNING",s[s.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})($i||($i={}));function bp(s){return{fps:s.fps,qrbox:s.qrbox,aspectRatio:s.aspectRatio,disableFlip:s.disableFlip,videoConstraints:s.videoConstraints}}function Rp(s,t){return{formatsToSupport:s.formatsToSupport,useBarCodeDetectorIfSupported:s.useBarCodeDetectorIfSupported,experimentalFeatures:s.experimentalFeatures,verbose:t}}var vp=function(){function s(t,e,n){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=t,this.config=this.createConfig(e),this.verbose=n===!0,!document.getElementById(t))throw"HTML Element with id=".concat(t," not found");this.scanTypeSelector=new Is(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new Ff(this.verbose),this.persistedDataManager=new _p,e.rememberLastUsedCamera!==!0&&this.persistedDataManager.reset()}return s.prototype.render=function(t,e){var n=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(l,u){if(t)t(l,u);else{if(n.lastMatchFound===l)return;n.lastMatchFound=l,n.setHeaderMessage(ve.lastMatch(l),$i.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(l,u){e&&e(l,u)};var r=document.getElementById(this.elementId);if(!r)throw"HTML Element with id=".concat(this.elementId," not found");r.innerHTML="",this.createBasicLayout(r),this.html5Qrcode=new Nu(this.getScanRegionId(),Rp(this.config,this.verbose))},s.prototype.pause=function(t){(Ln(t)||t!==!0)&&(t=!1),this.getHtml5QrcodeOrFail().pause(t)},s.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},s.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},s.prototype.clear=function(){var t=this,e=function(){var n=document.getElementById(t.elementId);n&&(n.innerHTML="",t.resetBasicLayout(n))};return this.html5Qrcode?new Promise(function(n,r){if(!t.html5Qrcode){n();return}t.html5Qrcode.isScanning?t.html5Qrcode.stop().then(function(l){if(!t.html5Qrcode){n();return}t.html5Qrcode.clear(),e(),n()}).catch(function(l){t.verbose&&t.logger.logError("Unable to stop qrcode scanner",l),r(l)}):(t.html5Qrcode.clear(),e(),n())}):Promise.resolve()},s.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},s.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},s.prototype.applyVideoConstraints=function(t){return this.getHtml5QrcodeOrFail().applyVideoConstraints(t)},s.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},s.prototype.createConfig=function(t){return t?(t.fps||(t.fps=In.SCAN_DEFAULT_FPS),t.rememberLastUsedCamera!==!In.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(t.rememberLastUsedCamera=In.DEFAULT_REMEMBER_LAST_CAMERA_USED),t.supportedScanTypes||(t.supportedScanTypes=In.DEFAULT_SUPPORTED_SCAN_TYPE),t):{fps:In.SCAN_DEFAULT_FPS,rememberLastUsedCamera:In.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:In.DEFAULT_SUPPORTED_SCAN_TYPE}},s.prototype.createBasicLayout=function(t){t.style.position="relative",t.style.padding="0px",t.style.border="1px solid silver",this.createHeader(t);var e=document.createElement("div"),n=this.getScanRegionId();e.id=n,e.style.width="100%",e.style.minHeight="100px",e.style.textAlign="center",t.appendChild(e),Is.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var r=document.createElement("div"),l=this.getDashboardId();r.id=l,r.style.width="100%",t.appendChild(r),this.setupInitialDashboard(r)},s.prototype.resetBasicLayout=function(t){t.style.border="none"},s.prototype.setupInitialDashboard=function(t){this.createSection(t),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},s.prototype.createHeader=function(t){var e=document.createElement("div");e.style.textAlign="left",e.style.margin="0px",t.appendChild(e);var n=new wp;n.renderInto(e);var r=document.createElement("div");r.id=this.getHeaderMessageContainerId(),r.style.display="none",r.style.textAlign="center",r.style.fontSize="14px",r.style.padding="2px 10px",r.style.margin="4px",r.style.borderTop="1px solid #f6f6f6",e.appendChild(r)},s.prototype.createSection=function(t){var e=document.createElement("div");e.id=this.getDashboardSectionId(),e.style.width="100%",e.style.padding="10px 0px 10px 0px",e.style.textAlign="left",t.appendChild(e)},s.prototype.createCameraListUi=function(t,e,n){var r=this;r.showHideScanTypeSwapLink(!1),r.setHeaderMessage(ve.cameraPermissionRequesting());var l=function(){n||r.createPermissionButton(t,e)};Nu.getCameras().then(function(u){r.persistedDataManager.setHasPermission(!0),r.showHideScanTypeSwapLink(!0),r.resetHeaderMessage(),u&&u.length>0?(t.removeChild(e),r.renderCameraSelection(u)):(r.setHeaderMessage(ve.noCameraFound(),$i.STATUS_WARNING),l())}).catch(function(u){r.persistedDataManager.setHasPermission(!1),n?n.disabled=!1:l(),r.setHeaderMessage(u,$i.STATUS_WARNING),r.showHideScanTypeSwapLink(!0)})},s.prototype.createPermissionButton=function(t,e){var n=this,r=ss.createElement("button",this.getCameraPermissionButtonId());r.innerText=ve.cameraPermissionTitle(),r.addEventListener("click",function(){r.disabled=!0,n.createCameraListUi(t,e,r)}),e.appendChild(r)},s.prototype.createPermissionsUi=function(t,e){var n=this;if(Is.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()){Lu.hasPermissions().then(function(r){r?n.createCameraListUi(t,e):(n.persistedDataManager.setHasPermission(!1),n.createPermissionButton(t,e))}).catch(function(r){n.persistedDataManager.setHasPermission(!1),n.createPermissionButton(t,e)});return}this.createPermissionButton(t,e)},s.prototype.createSectionControlPanel=function(){var t=document.getElementById(this.getDashboardSectionId()),e=document.createElement("div");t.appendChild(e);var n=document.createElement("div");n.id=this.getDashboardSectionCameraScanRegionId(),n.style.display=Is.isCameraScanType(this.currentScanType)?"block":"none",e.appendChild(n);var r=document.createElement("div");r.style.textAlign="center",n.appendChild(r),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(n,r),this.renderFileScanUi(e)},s.prototype.renderFileScanUi=function(t){var e=Is.isFileScanType(this.currentScanType),n=this,r=function(l){if(!n.html5Qrcode)throw"html5Qrcode not defined";Is.isFileScanType(n.currentScanType)&&(n.setHeaderMessage(ve.loadingImage()),n.html5Qrcode.scanFileV2(l,!0).then(function(u){n.resetHeaderMessage(),n.qrCodeSuccessCallback(u.decodedText,u)}).catch(function(u){n.setHeaderMessage(u,$i.STATUS_WARNING),n.qrCodeErrorCallback(u,Pf.createFrom(u))}))};this.fileSelectionUi=Mp.create(t,e,r)},s.prototype.renderCameraSelection=function(t){var e=this,n=this,r=document.getElementById(this.getDashboardSectionCameraScanRegionId());r.style.textAlign="center";var l=Tp.create(r,!1),u=function(F){var z=F.zoomFeature();if(z.isSupported()){l.setOnCameraZoomValueChangeCallback(function(G){z.apply(G)});var j=1;e.config.defaultZoomValueIfSupported&&(j=e.config.defaultZoomValueIfSupported),j=Zx(j,z.min(),z.max()),l.setValues(z.min(),z.max(),j,z.step()),l.show()}},g=Sp.create(r,t),m=document.createElement("span"),p=ss.createElement("button",nn.CAMERA_START_BUTTON_ID);p.innerText=ve.scanButtonStartScanningText(),m.appendChild(p);var E=ss.createElement("button",nn.CAMERA_STOP_BUTTON_ID);E.innerText=ve.scanButtonStopScanningText(),E.style.display="none",E.disabled=!0,m.appendChild(E);var A,b=function(F){if(!F.torchFeature().isSupported()){A&&A.hide();return}A?A.updateTorchCapability(F.torchFeature()):A=Ip.create(m,F.torchFeature(),{display:"none",marginLeft:"5px"},function(z){n.setHeaderMessage(z,$i.STATUS_WARNING)}),A.show()};r.appendChild(m);var D=function(F){F||(p.style.display="none"),p.innerText=ve.scanButtonStartScanningText(),p.style.opacity="1",p.disabled=!1,F&&(p.style.display="inline-block")};if(p.addEventListener("click",function(F){p.innerText=ve.scanButtonScanningStarting(),g.disable(),p.disabled=!0,p.style.opacity="0.5",e.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!1),n.resetHeaderMessage();var z=g.getValue();n.persistedDataManager.setLastUsedCameraId(z),n.html5Qrcode.start(z,bp(n.config),n.qrCodeSuccessCallback,n.qrCodeErrorCallback).then(function(j){E.disabled=!1,E.style.display="inline-block",D(!1);var G=n.html5Qrcode.getRunningTrackCameraCapabilities();e.config.showTorchButtonIfSupported===!0&&b(G),e.config.showZoomSliderIfSupported===!0&&u(G)}).catch(function(j){n.showHideScanTypeSwapLink(!0),g.enable(),D(!0),n.setHeaderMessage(j,$i.STATUS_WARNING)})}),g.hasSingleItem()&&p.click(),E.addEventListener("click",function(F){if(!n.html5Qrcode)throw"html5Qrcode not defined";E.disabled=!0,n.html5Qrcode.stop().then(function(z){e.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!0),g.enable(),p.disabled=!1,E.style.display="none",p.style.display="inline-block",A&&(A.reset(),A.hide()),l.removeOnCameraZoomValueChangeCallback(),l.hide(),n.insertCameraScanImageToScanRegion()}).catch(function(z){E.disabled=!1,n.setHeaderMessage(z,$i.STATUS_WARNING)})}),n.persistedDataManager.getLastUsedCameraId()){var P=n.persistedDataManager.getLastUsedCameraId();g.hasValue(P)?(g.setValue(P),p.click()):n.persistedDataManager.resetLastUsedCameraId()}},s.prototype.createSectionSwap=function(){var t=this,e=ve.textIfCameraScanSelected(),n=ve.textIfFileScanSelected(),r=document.getElementById(this.getDashboardSectionId()),l=document.createElement("div");l.style.textAlign="center";var u=ss.createElement("span",this.getDashboardSectionSwapLinkId());u.style.textDecoration="underline",u.style.cursor="pointer",u.innerText=Is.isCameraScanType(this.currentScanType)?e:n,u.addEventListener("click",function(){if(!t.sectionSwapAllowed){t.verbose&&t.logger.logError("Section swap called when not allowed");return}t.resetHeaderMessage(),t.fileSelectionUi.resetValue(),t.sectionSwapAllowed=!1,Is.isCameraScanType(t.currentScanType)?(t.clearScanRegion(),t.getCameraScanRegion().style.display="none",t.fileSelectionUi.show(),u.innerText=n,t.currentScanType=Ps.SCAN_TYPE_FILE,t.insertFileScanImageToScanRegion()):(t.clearScanRegion(),t.getCameraScanRegion().style.display="block",t.fileSelectionUi.hide(),u.innerText=e,t.currentScanType=Ps.SCAN_TYPE_CAMERA,t.insertCameraScanImageToScanRegion(),t.startCameraScanIfPermissionExistsOnSwap()),t.sectionSwapAllowed=!0}),l.appendChild(u),r.appendChild(l)},s.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var t=this,e=this;if(this.persistedDataManager.hasCameraPermissions()){Lu.hasPermissions().then(function(n){if(n){var r=document.getElementById(e.getCameraPermissionButtonId());if(!r)throw t.logger.logError("Permission button not found, fail;"),"Permission button not found";r.click()}else e.persistedDataManager.setHasPermission(!1)}).catch(function(n){e.persistedDataManager.setHasPermission(!1)});return}},s.prototype.resetHeaderMessage=function(){var t=document.getElementById(this.getHeaderMessageContainerId());t.style.display="none"},s.prototype.setHeaderMessage=function(t,e){e||(e=$i.STATUS_DEFAULT);var n=this.getHeaderMessageDiv();switch(n.innerText=t,n.style.display="block",e){case $i.STATUS_SUCCESS:n.style.background="rgba(106, 175, 80, 0.26)",n.style.color="#477735";break;case $i.STATUS_WARNING:n.style.background="rgba(203, 36, 49, 0.14)",n.style.color="#cb2431";break;case $i.STATUS_DEFAULT:default:n.style.background="rgba(0, 0, 0, 0)",n.style.color="rgb(17, 17, 17)";break}},s.prototype.showHideScanTypeSwapLink=function(t){this.scanTypeSelector.hasMoreThanOneScanType()&&(t!==!0&&(t=!1),this.sectionSwapAllowed=t,this.getDashboardSectionSwapLink().style.display=t?"inline-block":"none")},s.prototype.insertCameraScanImageToScanRegion=function(){var t=this,e=document.getElementById(this.getScanRegionId());if(this.cameraScanImage){e.innerHTML="<br>",e.appendChild(this.cameraScanImage);return}this.cameraScanImage=new Image,this.cameraScanImage.onload=function(n){e.innerHTML="<br>",e.appendChild(t.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=mp,this.cameraScanImage.alt=ve.cameraScanAltText()},s.prototype.insertFileScanImageToScanRegion=function(){var t=this,e=document.getElementById(this.getScanRegionId());if(this.fileScanImage){e.innerHTML="<br>",e.appendChild(this.fileScanImage);return}this.fileScanImage=new Image,this.fileScanImage.onload=function(n){e.innerHTML="<br>",e.appendChild(t.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=xp,this.fileScanImage.alt=ve.fileScanAltText()},s.prototype.clearScanRegion=function(){var t=document.getElementById(this.getScanRegionId());t.innerHTML=""},s.prototype.getDashboardSectionId=function(){return"".concat(this.elementId,"__dashboard_section")},s.prototype.getDashboardSectionCameraScanRegionId=function(){return"".concat(this.elementId,"__dashboard_section_csr")},s.prototype.getDashboardSectionSwapLinkId=function(){return nn.SCAN_TYPE_CHANGE_ANCHOR_ID},s.prototype.getScanRegionId=function(){return"".concat(this.elementId,"__scan_region")},s.prototype.getDashboardId=function(){return"".concat(this.elementId,"__dashboard")},s.prototype.getHeaderMessageContainerId=function(){return"".concat(this.elementId,"__header_message")},s.prototype.getCameraPermissionButtonId=function(){return nn.CAMERA_PERMISSION_BUTTON_ID},s.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},s.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},s.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())},s}();const yh=(s,t)=>t.some(e=>s instanceof e);let Fu,Bu;function Np(){return Fu||(Fu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Op(){return Bu||(Bu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Eh=new WeakMap,Vl=new WeakMap,al=new WeakMap;function Dp(s){const t=new Promise((e,n)=>{const r=()=>{s.removeEventListener("success",l),s.removeEventListener("error",u)},l=()=>{e(tr(s.result)),r()},u=()=>{n(s.error),r()};s.addEventListener("success",l),s.addEventListener("error",u)});return al.set(t,s),t}function Lp(s){if(Eh.has(s))return;const t=new Promise((e,n)=>{const r=()=>{s.removeEventListener("complete",l),s.removeEventListener("error",u),s.removeEventListener("abort",u)},l=()=>{e(),r()},u=()=>{n(s.error||new DOMException("AbortError","AbortError")),r()};s.addEventListener("complete",l),s.addEventListener("error",u),s.addEventListener("abort",u)});Eh.set(s,t)}let wh={get(s,t,e){if(s instanceof IDBTransaction){if(t==="done")return Eh.get(s);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return tr(s[t])},set(s,t,e){return s[t]=e,!0},has(s,t){return s instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in s}};function zf(s){wh=s(wh)}function Pp(s){return Op().includes(s)?function(...t){return s.apply(Ch(this),t),tr(this.request)}:function(...t){return tr(s.apply(Ch(this),t))}}function Fp(s){return typeof s=="function"?Pp(s):(s instanceof IDBTransaction&&Lp(s),yh(s,Np())?new Proxy(s,wh):s)}function tr(s){if(s instanceof IDBRequest)return Dp(s);if(Vl.has(s))return Vl.get(s);const t=Fp(s);return t!==s&&(Vl.set(s,t),al.set(t,s)),t}const Ch=s=>al.get(s);function Bp(s,t,{blocked:e,upgrade:n,blocking:r,terminated:l}={}){const u=indexedDB.open(s,t),g=tr(u);return n&&u.addEventListener("upgradeneeded",m=>{n(tr(u.result),m.oldVersion,m.newVersion,tr(u.transaction),m)}),e&&u.addEventListener("blocked",m=>e(m.oldVersion,m.newVersion,m)),g.then(m=>{l&&m.addEventListener("close",()=>l()),r&&m.addEventListener("versionchange",p=>r(p.oldVersion,p.newVersion,p))}).catch(()=>{}),g}const kp=["get","getKey","getAll","getAllKeys","count"],Up=["put","add","delete","clear"],Yl=new Map;function ku(s,t){if(!(s instanceof IDBDatabase&&!(t in s)&&typeof t=="string"))return;if(Yl.get(t))return Yl.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,r=Up.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(r||kp.includes(e)))return;const l=async function(u,...g){const m=this.transaction(u,r?"readwrite":"readonly");let p=m.store;return n&&(p=p.index(g.shift())),(await Promise.all([p[e](...g),r&&m.done]))[0]};return Yl.set(t,l),l}zf(s=>({...s,get:(t,e,n)=>ku(t,e)||s.get(t,e,n),has:(t,e)=>!!ku(t,e)||s.has(t,e)}));const Gp=["continue","continuePrimaryKey","advance"],Uu={},Ah=new WeakMap,jf=new WeakMap,zp={get(s,t){if(!Gp.includes(t))return s[t];let e=Uu[t];return e||(e=Uu[t]=function(...n){Ah.set(this,jf.get(this)[t](...n))}),e}};async function*jp(...s){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...s)),!t)return;t=t;const e=new Proxy(t,zp);for(jf.set(e,t),al.set(e,Ch(t));t;)yield e,t=await(Ah.get(e)||t.continue()),Ah.delete(e)}function Gu(s,t){return t===Symbol.asyncIterator&&yh(s,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&yh(s,[IDBIndex,IDBObjectStore])}zf(s=>({...s,get(t,e,n){return Gu(t,e)?jp:s.get(t,e,n)},has(t,e){return Gu(t,e)||s.has(t,e)}}));fc.defs("EPSG:31287","+proj=lcc +lat_0=47.5 +lon_0=13.3333333333333 +lat_1=49 +lat_2=46 +x_0=400000 +y_0=400000 +ellps=bessel +towgs84=577.326,90.129,463.919,5.137,1.474,5.297,2.4232 +units=m +no_defs +type=crs");fc.defs("EPSG:3035","+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs");nx(fc);let da=new Q0;const zu=await Bp("hofapp",3,{upgrade(s,t,e,n,r){s.objectStore(imgs)&&s.deleteObjectStore("imgs"),s.createObjectStore("imgs",{keyPath:"url"}).createIndex("url","url")}}),Sn=new om({target:"map",layers:[new wm({source:new Pm({url:"https://mapproxy.rest-gdi.geo-data.space/tiles/osm/webmercator/{z}/{x}/{y}.png",maxZoom:19,tileLoadFunction:async function(s,t){const e=s.getImage(),r=zu.transaction("imgs","readonly").objectStore("imgs").index("url"),l=IDBKeyRange.only(t),u=await r.openCursor(l);if(u)console.log("laoding cached tile: "+t),e.src=u.value.data;else{console.log("requesting tile: "+t),e.src=t;const m=await(await fetch(t)).blob(),p=new FileReader;p.onload=E=>{zu.transaction("imgs","readwrite").objectStore("imgs").put({url:t,data:p.result})},p.readAsDataURL(m)}}})}),da],view:new Pn({center:[401306,423398],zoom:8,projection:"EPSG:31287"})}),ju=localStorage.getItem("center"),Wu=localStorage.getItem("zoom");ju&&Sn.getView().setCenter(JSON.parse(ju));Wu&&Sn.getView().setZoom(JSON.parse(Wu));Sn.getView().on("change",s=>{const t=Sn.getView().getCenter(),e=Sn.getView().getZoom();localStorage.setItem("center",JSON.stringify(t)),localStorage.setItem("zoom",JSON.stringify(e))});const Wp=document.getElementById("popup"),Xp=document.getElementById("popup-content"),Xu=document.getElementById("popup-closer"),Vp=document.getElementById("scanBtn"),Wf=document.getElementById("openBtn"),Yp=document.getElementById("identifierInput"),Ec=new am({element:Wp,autoPan:{animation:{duration:250}}});Sn.addOverlay(Ec);Sn.on("click",async function(s){Sn.forEachFeatureAtPixel(s.pixel,async function(t,e){{const n=t.getProperties().identifier.value,r=await Bo.toDataURL(n),l=s.coordinate;Xp.innerHTML=`<img src=${r}></img>`,Ec.setPosition(l)}})});Xu.onclick=function(){return Ec.setPosition(void 0),Xu.blur(),!1};function Hp(s){}Vp.onclick=async function(s){let t=new vp("reader",{fps:10,qrbox:{width:350,height:350}},!1);t.render((e,n)=>{console.log(`Code matched = ${e}`,n),t.clear(),Yp.value=e,Wf.click()},Hp)};Wf.onclick=async function(s){const t=document.getElementById("identifierInput").value;let e=null;try{e=await fetch(t+"?outputFormat=application%2Fjson&srsName=epsg%3A31287")}catch{}if(e===null||!e.ok){alert("Fehler beim Auflösen des Identifiers");return}const n=await e.json();Sn.removeLayer(da);let r={};try{r={dataProjection:n.crs.properties.name,featureProjection:"EPSG:31287"}}catch{}const l=new Gm().readFeatures(n,r);da=new Q0({source:new x2({features:l}),declutter:!0}),Sn.addLayer(da);let u=[n.bbox[1],n.bbox[0],n.bbox[3],n.bbox[2]];r.dataProjection&&(u=bd(u,r.dataProjection,"EPSG:31287")),Sn.getView().fit(u)};
//# sourceMappingURL=index-bF6XNE2K.js.map
